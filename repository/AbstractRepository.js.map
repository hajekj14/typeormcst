{"version":3,"sources":["../../src/repository/AbstractRepository.ts"],"names":[],"mappings":";;AAQA,yGAAsG;AAEtG;;;;;;GAMG;AACH;IAAA;IAsGA,CAAC;IApFG,sBAAc,6CAAa;QAP3B,4EAA4E;QAC5E,sBAAsB;QACtB,4EAA4E;QAE5E;;WAEG;aACH;YACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QACzC,CAAC;;;OAAA;IAMD,sBAAc,0CAAU;QAJxB;;;WAGG;aACH;YACI,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,yBAAyB,CAAC,IAAW,CAAC,CAAC;YACtE,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC;gBACR,MAAM,IAAI,+EAAsC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAEvE,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAS,MAAM,CAAC,CAAC;QACzD,CAAC;;;OAAA;IAMD,sBAAc,8CAAc;QAJ5B;;;WAGG;aACH;YACI,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,yBAAyB,CAAC,IAAW,CAAC,CAAC;YACtE,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC;gBACR,MAAM,IAAI,+EAAsC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAEvE,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAS,MAAM,CAAC,CAAC;QAC7D,CAAC;;;OAAA;IAMD,sBAAc,kDAAkB;QAJhC;;;WAGG;aACH;YACI,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,yBAAyB,CAAC,IAAW,CAAC,CAAC;YACtE,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC;gBACR,MAAM,IAAI,+EAAsC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAEvE,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAS,MAAM,CAAC,CAAC;QACjE,CAAC;;;OAAA;IAED,4EAA4E;IAC5E,oBAAoB;IACpB,4EAA4E;IAE5E;;;OAGG;IACO,+CAAkB,GAA5B,UAA6B,KAAa;QACtC,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,yBAAyB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAC3E,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC;YACR,MAAM,IAAI,+EAAsC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAEvE,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAC3E,CAAC;IAED;;OAEG;IACO,kDAAqB,GAA/B,UAAmC,MAAqB,EAAE,KAAa;QACnE,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;IACnE,CAAC;IAED;;OAEG;IACO,6CAAgB,GAA1B,UAA8B,MAAqB;QAC/C,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IACpD,CAAC;IAED;;OAEG;IACO,iDAAoB,GAA9B,UAAkC,MAAqB;QACnD,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;IACxD,CAAC;IAED;;OAEG;IACO,qDAAwB,GAAlC,UAAsC,MAAqB;QACvD,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;IAC5D,CAAC;IAEL,yBAAC;AAAD,CAtGA,AAsGC,IAAA;AAtGY,gDAAkB","file":"AbstractRepository.js","sourcesContent":["import {Connection} from \"../connection/Connection\";\r\nimport {QueryBuilder} from \"../query-builder/QueryBuilder\";\r\nimport {ObjectLiteral} from \"../common/ObjectLiteral\";\r\nimport {EntityManager} from \"../entity-manager/EntityManager\";\r\nimport {Repository} from \"./Repository\";\r\nimport {TreeRepository} from \"./TreeRepository\";\r\nimport {SpecificRepository} from \"./SpecificRepository\";\r\nimport {ObjectType} from \"../common/ObjectType\";\r\nimport {CustomRepositoryDoesNotHaveEntityError} from \"./error/CustomRepositoryDoesNotHaveEntityError\";\r\n\r\n/**\r\n * Provides abstract class for custom repositories that do not inherit from original orm Repository.\r\n * Contains all most-necessary methods to simplify code in the custom repository.\r\n * All methods are protected thus not exposed and it allows to create encapsulated custom repository.\r\n *\r\n * @experimental\r\n */\r\nexport class AbstractRepository<Entity extends ObjectLiteral> {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods Set Dynamically\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Connection used by this repository.\r\n     */\r\n    protected connection: Connection;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Accessors\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Gets entity manager that allows to perform repository operations with any entity.\r\n     */\r\n    protected get entityManager(): EntityManager {\r\n        return this.connection.entityManager;\r\n    }\r\n\r\n    /**\r\n     * Gets the original ORM repository for the entity that is managed by this repository.\r\n     * If current repository does not manage any entity, then exception will be thrown.\r\n     */\r\n    protected get repository(): Repository<Entity> {\r\n        const target = this.connection.getCustomRepositoryTarget(this as any);\r\n        if (!target)\r\n            throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);\r\n\r\n        return this.connection.getRepository<Entity>(target);\r\n    }\r\n\r\n    /**\r\n     * Gets the original ORM tree repository for the entity that is managed by this repository.\r\n     * If current repository does not manage any entity, then exception will be thrown.\r\n     */\r\n    protected get treeRepository(): TreeRepository<Entity> {\r\n        const target = this.connection.getCustomRepositoryTarget(this as any);\r\n        if (!target)\r\n            throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);\r\n\r\n        return this.connection.getTreeRepository<Entity>(target);\r\n    }\r\n\r\n    /**\r\n     * Gets the original ORM specific repository for the entity that is managed by this repository.\r\n     * If current repository does not manage any entity, then exception will be thrown.\r\n     */\r\n    protected get specificRepository(): SpecificRepository<Entity> {\r\n        const target = this.connection.getCustomRepositoryTarget(this as any);\r\n        if (!target)\r\n            throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);\r\n\r\n        return this.connection.getSpecificRepository<Entity>(target);\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Creates a new query builder for the repository's entity that can be used to build a sql query.\r\n     * If current repository does not manage any entity, then exception will be thrown.\r\n     */\r\n    protected createQueryBuilder(alias: string): QueryBuilder<Entity> {\r\n        const target = this.connection.getCustomRepositoryTarget(this.constructor);\r\n        if (!target)\r\n            throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);\r\n\r\n        return this.connection.getRepository(target).createQueryBuilder(alias);\r\n    }\r\n\r\n    /**\r\n     * Creates a new query builder for the given entity that can be used to build a sql query.\r\n     */\r\n    protected createQueryBuilderFor<T>(entity: ObjectType<T>, alias: string): QueryBuilder<T> {\r\n        return this.getRepositoryFor(entity).createQueryBuilder(alias);\r\n    }\r\n\r\n    /**\r\n     * Gets the original ORM repository for the given entity class.\r\n     */\r\n    protected getRepositoryFor<T>(entity: ObjectType<T>): Repository<T> {\r\n        return this.entityManager.getRepository(entity);\r\n    }\r\n\r\n    /**\r\n     * Gets the original ORM tree repository for the given entity class.\r\n     */\r\n    protected getTreeRepositoryFor<T>(entity: ObjectType<T>): TreeRepository<T> {\r\n        return this.entityManager.getTreeRepository(entity);\r\n    }\r\n\r\n    /**\r\n     * Gets the original ORM specific repository for the given entity class.\r\n     */\r\n    protected getSpecificRepositoryFor<T>(entity: ObjectType<T>): SpecificRepository<T> {\r\n        return this.entityManager.getSpecificRepository(entity);\r\n    }\r\n\r\n}"],"sourceRoot":".."}