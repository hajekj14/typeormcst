{"version":3,"sources":["../../src/metadata-builder/ClosureJunctionEntityMetadataBuilder.ts"],"names":[],"mappings":";;AAAA,6DAA0D;AAE1D,6DAA0D;AAE1D,qEAAkE;AAClE,2DAAwD;AAExD,6DAA0D;AAc1D;;GAEG;AACH;IAAA;IA8DA,CAAC;IA5DG,oDAAK,GAAL,UAAM,MAAc,EAAE,oBAA0C,EAAE,IAA8C;QAE5G,IAAM,OAAO,GAAG;YACZ,IAAI,+BAAc,CAAsB;gBACpC,MAAM,EAAE,aAAa;gBACrB,YAAY,EAAE,aAAa;gBAC3B,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI;gBACrC,IAAI,EAAE,SAAS;gBACf,OAAO,EAAkB;oBACrB,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM;oBACjC,IAAI,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI;oBAC7B,IAAI,EAAE,UAAU;iBACnB;aACJ,CAAC;YACF,IAAI,+BAAc,CAAsB;gBACpC,MAAM,EAAE,aAAa;gBACrB,YAAY,EAAE,aAAa;gBAC3B,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI;gBACrC,IAAI,EAAE,SAAS;gBACf,OAAO,EAAkB;oBACrB,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM;oBACjC,IAAI,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI;oBAC7B,IAAI,EAAE,YAAY;iBACrB;aACJ,CAAC;SACL,CAAC;QAEF,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAC1B,OAAO,CAAC,IAAI,CAAC,IAAI,+BAAc,CAAsB;gBACjD,MAAM,EAAE,aAAa;gBACrB,YAAY,EAAE,aAAa;gBAC3B,YAAY,EAAE,yBAAW,CAAC,OAAO;gBACjC,IAAI,EAAE,SAAS;gBACf,OAAO,EAAE;oBACL,IAAI,EAAE,yBAAW,CAAC,OAAO;oBACzB,IAAI,EAAE,OAAO;iBAChB;aACJ,CAAC,CAAC,CAAC;QACR,CAAC;QAED,IAAM,4BAA4B,GAAG,IAAI,6BAAa,CAAC;YACnD,MAAM,EAAE,aAAa;YACrB,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI;YACrB,IAAI,EAAE,kBAAkB;SAC3B,CAAC,CAAC;QAEH,MAAM,CAAC,IAAI,+BAAc,CAAC;YACtB,QAAQ,EAAE,IAAI;YACd,MAAM,EAAE,aAAa;YACrB,YAAY,EAAE,MAAM,CAAC,OAAO,CAAC,YAAY;YACzC,cAAc,EAAE,IAAI,CAAC,cAAc;YACnC,aAAa,EAAE,4BAA4B;YAC3C,eAAe,EAAE,OAAO;YACxB,mBAAmB,EAAE;gBACjB,IAAI,uCAAkB,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBACtE,IAAI,uCAAkB,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;aACzE;SACJ,EAAE,oBAAoB,CAAC,CAAC;IAC7B,CAAC;IAEL,2CAAC;AAAD,CA9DA,AA8DC,IAAA;AA9DY,oFAAoC","file":"ClosureJunctionEntityMetadataBuilder.js","sourcesContent":["import {EntityMetadata} from \"../metadata/EntityMetadata\";\r\nimport {NamingStrategyInterface} from \"../naming-strategy/NamingStrategyInterface\";\r\nimport {ColumnMetadata} from \"../metadata/ColumnMetadata\";\r\nimport {ColumnOptions} from \"../decorator/options/ColumnOptions\";\r\nimport {ForeignKeyMetadata} from \"../metadata/ForeignKeyMetadata\";\r\nimport {TableMetadata} from \"../metadata/TableMetadata\";\r\nimport {ColumnMetadataArgs} from \"../metadata-args/ColumnMetadataArgs\";\r\nimport {ColumnTypes} from \"../metadata/types/ColumnTypes\";\r\nimport {LazyRelationsWrapper} from \"../lazy-loading/LazyRelationsWrapper\";\r\nimport {Driver} from \"../driver/Driver\";\r\n\r\n/**\r\n * Helps to create EntityMetadatas for junction tables.\r\n */\r\nexport interface ClosureJunctionEntityMetadataBuilderArgs {\r\n    namingStrategy: NamingStrategyInterface;\r\n    table: TableMetadata;\r\n    primaryColumn: ColumnMetadata;\r\n    hasTreeLevelColumn: boolean;\r\n}\r\n\r\n/**\r\n * Helps to create EntityMetadatas for junction tables for closure tables.\r\n */\r\nexport class ClosureJunctionEntityMetadataBuilder {\r\n\r\n    build(driver: Driver, lazyRelationsWrapper: LazyRelationsWrapper, args: ClosureJunctionEntityMetadataBuilderArgs) {\r\n\r\n        const columns = [\r\n            new ColumnMetadata(<ColumnMetadataArgs> {\r\n                target: \"__virtual__\",\r\n                propertyName: \"__virtual__\",\r\n                propertyType: args.primaryColumn.type,\r\n                mode: \"virtual\",\r\n                options: <ColumnOptions> {\r\n                    length: args.primaryColumn.length,\r\n                    type: args.primaryColumn.type,\r\n                    name: \"ancestor\"\r\n                }\r\n            }),\r\n            new ColumnMetadata(<ColumnMetadataArgs> {\r\n                target: \"__virtual__\",\r\n                propertyName: \"__virtual__\",\r\n                propertyType: args.primaryColumn.type,\r\n                mode: \"virtual\",\r\n                options: <ColumnOptions> {\r\n                    length: args.primaryColumn.length,\r\n                    type: args.primaryColumn.type,\r\n                    name: \"descendant\"\r\n                }\r\n            })\r\n        ];\r\n\r\n        if (args.hasTreeLevelColumn) {\r\n            columns.push(new ColumnMetadata(<ColumnMetadataArgs> {\r\n                target: \"__virtual__\",\r\n                propertyName: \"__virtual__\",\r\n                propertyType: ColumnTypes.INTEGER,\r\n                mode: \"virtual\",\r\n                options: {\r\n                    type: ColumnTypes.INTEGER,\r\n                    name: \"level\"\r\n                }\r\n            }));\r\n        }\r\n\r\n        const closureJunctionTableMetadata = new TableMetadata({\r\n            target: \"__virtual__\",\r\n            name: args.table.name,\r\n            type: \"closure-junction\"\r\n        });\r\n\r\n        return new EntityMetadata({\r\n            junction: true,\r\n            target: \"__virtual__\",\r\n            tablesPrefix: driver.options.tablesPrefix,\r\n            namingStrategy: args.namingStrategy,\r\n            tableMetadata: closureJunctionTableMetadata,\r\n            columnMetadatas: columns,\r\n            foreignKeyMetadatas: [\r\n                new ForeignKeyMetadata([columns[0]], args.table, [args.primaryColumn]),\r\n                new ForeignKeyMetadata([columns[1]], args.table, [args.primaryColumn])\r\n            ]\r\n        }, lazyRelationsWrapper);\r\n    }\r\n\r\n}"],"sourceRoot":".."}