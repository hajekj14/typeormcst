{"version":3,"sources":["../../src/query-runner/QueryRunnerProvider.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA;;;GAGG;AACH;IAiBI,4EAA4E;IAC5E,cAAc;IACd,4EAA4E;IAE5E,6BAAsB,MAAc,EACd,oBAAqC;QAArC,qCAAA,EAAA,4BAAqC;QADrC,WAAM,GAAN,MAAM,CAAQ;QACd,yBAAoB,GAApB,oBAAoB,CAAiB;IAC3D,CAAC;IAMD,sBAAI,2CAAU;QAJd,4EAA4E;QAC5E,YAAY;QACZ,4EAA4E;aAE5E;YACI,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC;QAC5B,CAAC;;;OAAA;IAED,4EAA4E;IAC5E,iBAAiB;IACjB,4EAA4E;IAE5E;;;OAGG;IACH,qCAAO,GAAP;QAAA,iBAkBC;QAjBG,EAAE,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAC5B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;gBAC5B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC,CAAC;oBACnC,+DAA+D;oBAC/D,oDAAoD;oBACpD,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,MAAM;yBACxC,iBAAiB,EAAE;yBACnB,IAAI,CAAC,UAAA,mBAAmB;wBACrB,KAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;wBAC/C,MAAM,CAAC,mBAAmB,CAAC;oBAC/B,CAAC,CAAC,CAAC;gBACX,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,0BAA0B,CAAC;YAC3C,CAAC;YACD,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QACrD,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC;IAC3C,CAAC;IAED;;;;;OAKG;IACG,qCAAO,GAAb,UAAc,WAAwB;;;gBAClC,EAAE,CAAC,CAAC,WAAW,KAAK,IAAI,CAAC,mBAAmB,CAAC;oBACzC,MAAM,gBAAC;gBAEX,sBAAO,WAAW,CAAC,OAAO,EAAE,EAAC;;;KAChC;IAED;;OAEG;IACG,2CAAa,GAAnB;;;gBACI,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBACxB,EAAE,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC;oBACzB,MAAM,gBAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,EAAC;;;;KACjD;IAEL,0BAAC;AAAD,CAnFA,AAmFC,IAAA;AAnFY,kDAAmB","file":"QueryRunnerProvider.js","sourcesContent":["import {QueryRunner} from \"./QueryRunner\";\r\nimport {Driver} from \"../driver/Driver\";\r\n\r\n/**\r\n * Represents functionality to provide a new query runners, and release old ones.\r\n * Also can provide always same query runner.\r\n */\r\nexport class QueryRunnerProvider {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    protected reusableQueryRunner: QueryRunner;\r\n\r\n    protected reusableQueryRunnerPromise: Promise<QueryRunner>;\r\n\r\n    /**\r\n     * Indicates if this entity manager is released.\r\n     * Entity manager can be released only if custom queryRunnerProvider is provided.\r\n     * Once entity manager is released, its repositories and some other methods can't be used anymore.\r\n     */\r\n    protected _isReleased: boolean;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Constructor\r\n    // -------------------------------------------------------------------------\r\n\r\n    constructor(protected driver: Driver,\r\n                protected useSingleQueryRunner: boolean = false) {\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Accessors\r\n    // -------------------------------------------------------------------------\r\n\r\n    get isReleased() {\r\n        return this._isReleased;\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Provides a new query runner used to run repository queries.\r\n     * If use useSingleQueryRunner mode is enabled then reusable query runner will be provided instead.\r\n     */\r\n    provide(): Promise<QueryRunner> {\r\n        if (this.useSingleQueryRunner) {\r\n            if (!this.reusableQueryRunner) {\r\n                if (!this.reusableQueryRunnerPromise) {\r\n                    // we do this because this method can be created multiple times\r\n                    // this will lead to multiple query runner creations\r\n                    this.reusableQueryRunnerPromise = this.driver\r\n                        .createQueryRunner()\r\n                        .then(reusableQueryRunner => {\r\n                            this.reusableQueryRunner = reusableQueryRunner;\r\n                            return reusableQueryRunner;\r\n                        });\r\n                }\r\n                return this.reusableQueryRunnerPromise;\r\n            }\r\n            return Promise.resolve(this.reusableQueryRunner);\r\n        }\r\n        return this.driver.createQueryRunner();\r\n    }\r\n\r\n    /**\r\n     * Query runner release logic extracted into separated methods intently,\r\n     * to make possible to create a subclass with its own release query runner logic.\r\n     * Note: release only query runners that provided by a provide() method.\r\n     * This is important and by design.\r\n     */\r\n    async release(queryRunner: QueryRunner): Promise<void> {\r\n        if (queryRunner === this.reusableQueryRunner)\r\n            return;\r\n\r\n        return queryRunner.release();\r\n    }\r\n\r\n    /**\r\n     * Releases reused query runner.\r\n     */\r\n    async releaseReused(): Promise<void> {\r\n        this._isReleased = true;\r\n        if (this.reusableQueryRunner)\r\n            return this.reusableQueryRunner.release();\r\n    }\r\n\r\n}"],"sourceRoot":".."}