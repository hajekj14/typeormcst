{"version":3,"sources":["../../src/metadata/JoinColumnMetadata.ts"],"names":[],"mappings":";;AAIA;;GAEG;AACH;IAmCI,wEAAwE;IACxE,cAAc;IACd,wEAAwE;IAExE,4BAAY,IAA4B;QACpC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACtC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,oBAAoB,CAAC;IAC1D,CAAC;IASD,sBAAI,oCAAI;QAPR,wEAAwE;QACxE,YAAY;QACZ,wEAAwE;QAExE;;WAEG;aACH;YACI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,yBAAyB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QACzH,CAAC;;;OAAA;IAKD,sBAAI,gDAAgB;QAHpB;;WAEG;aACH;YAAA,iBAgBC;YAfG,EAAE,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;gBAC5B,IAAM,gBAAgB,GAAG,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,UAAU,CAAC,IAAI,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,QAAQ,KAAK,KAAI,CAAC,oBAAoB,EAA7C,CAA6C,CAAC,CAAC;gBACtI,EAAE,CAAC,CAAC,CAAC,gBAAgB,CAAC;oBAClB,MAAM,IAAI,KAAK,CAAC,uBAAqB,IAAI,CAAC,oBAAoB,iCAA4B,IAAI,CAAC,IAAM,CAAC,CAAC;gBAE3G,MAAM,CAAC,gBAAgB,CAAC;YAC5B,CAAC;YAED,IAAM,qBAAqB,GAAG,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC;YAClE,IAAM,cAAc,GAAG,qBAAqB,CAAC,iCAAiC,CAAC;YAE/E,EAAE,CAAC,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC1B,MAAM,IAAI,KAAK,CAAC,iEAA8D,qBAAqB,CAAC,IAAI,gGAA4F,CAAC,CAAC;YAE1M,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC;;;OAAA;IAEL,yBAAC;AAAD,CA9EA,AA8EC,IAAA;AA9EY,gDAAkB","file":"JoinColumnMetadata.js","sourcesContent":["import {RelationMetadata} from \"./RelationMetadata\";\r\nimport {ColumnMetadata} from \"./ColumnMetadata\";\r\nimport {JoinColumnMetadataArgs} from \"../metadata-args/JoinColumnMetadataArgs\";\r\n\r\n/**\r\n * JoinColumnMetadata contains all information about relation's join column.\r\n */\r\nexport class JoinColumnMetadata {\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Public Properties\r\n    // ---------------------------------------------------------------------\r\n\r\n    /**\r\n     * Relation - owner of this join column metadata.\r\n     */\r\n    relation: RelationMetadata;\r\n\r\n    /**\r\n     * Target class to which metadata is applied.\r\n     */\r\n    readonly target: Function|string;\r\n\r\n    /**\r\n     * Target's property name to which this metadata is applied.\r\n     */\r\n    readonly propertyName: string;\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Readonly Properties\r\n    // ---------------------------------------------------------------------\r\n\r\n    /**\r\n     * Join column name.\r\n     */\r\n    private readonly _name: string|undefined;\r\n\r\n    /**\r\n     * Join column referenced column name.\r\n     */\r\n    private readonly referencedColumnName: string|undefined;\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Constructor\r\n    // ---------------------------------------------------------------------\r\n\r\n    constructor(args: JoinColumnMetadataArgs) {\r\n        this.target = args.target;\r\n        this.propertyName = args.propertyName;\r\n        this._name = args.name;\r\n        this.referencedColumnName = args.referencedColumnName;\r\n    }\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Accessors\r\n    // ---------------------------------------------------------------------\r\n\r\n    /**\r\n     * Join column name.\r\n     */\r\n    get name() {\r\n        return this.relation.entityMetadata.namingStrategy.joinColumnInverseSideName(this._name, this.relation.propertyName);\r\n    }\r\n\r\n    /**\r\n     * Referenced join column.\r\n     */\r\n    get referencedColumn(): ColumnMetadata {\r\n        if (this.referencedColumnName) {\r\n            const referencedColumn = this.relation.inverseEntityMetadata.allColumns.find(column => column.fullName === this.referencedColumnName);\r\n            if (!referencedColumn)\r\n                throw new Error(`Referenced column ${this.referencedColumnName} was not found in entity ${this.name}`);\r\n\r\n            return referencedColumn;\r\n        }\r\n\r\n        const inverseEntityMetadata = this.relation.inverseEntityMetadata;\r\n        const primaryColumns = inverseEntityMetadata.primaryColumnsWithParentIdColumns;\r\n\r\n        if (primaryColumns.length > 1)\r\n            throw new Error(`Cannot automatically determine a referenced column of the \"${inverseEntityMetadata.name}\", because it has multiple primary columns. Try to specify a referenced column explicitly.`);\r\n\r\n        return primaryColumns[0];\r\n    }\r\n\r\n}"],"sourceRoot":".."}