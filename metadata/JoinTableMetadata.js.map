{"version":3,"sources":["../../src/metadata/JoinTableMetadata.ts"],"names":[],"mappings":"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","file":"JoinTableMetadata.js","sourcesContent":["import {RelationMetadata} from \"./RelationMetadata\";\r\nimport {ColumnMetadata} from \"./ColumnMetadata\";\r\nimport {JoinTableMetadataArgs} from \"../metadata-args/JoinTableMetadataArgs\";\r\n\r\n/**\r\n * JoinTableMetadata contains all information about relation's join table.\r\n */\r\nexport class JoinTableMetadata {\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Public Properties\r\n    // ---------------------------------------------------------------------\r\n\r\n    /**\r\n     * Relation - owner of this join table metadata.\r\n     */\r\n    relation: RelationMetadata;\r\n\r\n    /**\r\n     * Target class to which metadata is applied.\r\n     */\r\n    readonly target: Function|string;\r\n\r\n    /**\r\n     * Target's property name to which this metadata is applied.\r\n     */\r\n    readonly propertyName: string;\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Readonly Properties\r\n    // ---------------------------------------------------------------------\r\n\r\n    /**\r\n     * Join table name.\r\n     */\r\n    private readonly _name?: string;\r\n\r\n    /**\r\n     * Join column name.\r\n     */\r\n    private readonly _joinColumnName: string;\r\n\r\n    /**\r\n     * Join column referenced column name.\r\n     */\r\n    private readonly _joinColumnReferencedColumnName: string;\r\n\r\n    /**\r\n     * Join column name of the inverse side.\r\n     */\r\n    private readonly _inverseJoinColumnName: string;\r\n\r\n    /**\r\n     * Join column referenced column name of the inverse side.\r\n     */\r\n    private readonly _inverseJoinColumnReferencedColumnName: string;\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Constructor\r\n    // ---------------------------------------------------------------------\r\n\r\n    constructor(args: JoinTableMetadataArgs) {\r\n        this.target = args.target;\r\n        this.propertyName = args.propertyName;\r\n        this._name = args.name;\r\n\r\n        if (args.joinColumn) {\r\n            if (args.joinColumn.name)\r\n                this._joinColumnName = args.joinColumn.name;\r\n            if (args.joinColumn.referencedColumnName)\r\n                this._joinColumnReferencedColumnName = args.joinColumn.referencedColumnName;\r\n        }\r\n\r\n        if (args.inverseJoinColumn) {\r\n            if (args.inverseJoinColumn.name)\r\n                this._inverseJoinColumnName = args.inverseJoinColumn.name;\r\n            if (args.inverseJoinColumn.referencedColumnName)\r\n                this._inverseJoinColumnReferencedColumnName = args.inverseJoinColumn.referencedColumnName;\r\n        }\r\n    }\r\n\r\n    // ---------------------------------------------------------------------\r\n    // Accessors\r\n    // ---------------------------------------------------------------------\r\n\r\n    /**\r\n     * Join table name.\r\n     */\r\n    get name() {\r\n        if (this._name)\r\n            return this._name;\r\n\r\n        return this.relation.entityMetadata.namingStrategy.joinTableName(\r\n            this.relation.entityMetadata.table.nameWithoutPrefix,\r\n            this.relation.inverseEntityMetadata.table.nameWithoutPrefix,\r\n            this.relation.propertyName,\r\n            this.relation.hasInverseSide ? this.relation.inverseRelation.propertyName : \"\",\r\n            this.referencedColumn.fullName,\r\n            this.inverseReferencedColumn.fullName\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Join column name.\r\n     */\r\n    get joinColumnName() {\r\n        if (this._joinColumnName)\r\n            return this._joinColumnName;\r\n\r\n        return this.relation\r\n            .entityMetadata\r\n            .namingStrategy\r\n            .joinTableColumnName(\r\n                this.relation.entityMetadata.table.nameWithoutPrefix,\r\n                this.referencedColumn.fullName,\r\n                this.relation.inverseEntityMetadata.table.nameWithoutPrefix,\r\n                this.inverseReferencedColumn.fullName\r\n            );\r\n    }\r\n\r\n    /**\r\n     * Join column name of the inverse side.\r\n     */\r\n    get inverseJoinColumnName() {\r\n        if (this._inverseJoinColumnName)\r\n            return this._inverseJoinColumnName;\r\n\r\n        return this.relation\r\n            .entityMetadata\r\n            .namingStrategy\r\n            .joinTableInverseColumnName(\r\n                this.relation.inverseEntityMetadata.table.nameWithoutPrefix,\r\n                this.inverseReferencedColumn.fullName,\r\n                this.relation.entityMetadata.table.nameWithoutPrefix,\r\n                this.referencedColumn.fullName\r\n            );\r\n    }\r\n\r\n    /**\r\n     * Referenced join column.\r\n     */\r\n    get referencedColumn(): ColumnMetadata {\r\n        if (this._joinColumnReferencedColumnName) {\r\n            const referencedColumn = this.relation.entityMetadata.columns.find(column => column.fullName === this._joinColumnReferencedColumnName);\r\n            if (!referencedColumn)\r\n                throw new Error(`Referenced column ${this._joinColumnReferencedColumnName} was not found in entity ${this.name}`);\r\n\r\n            return referencedColumn;\r\n        }\r\n\r\n        if (this.relation.entityMetadata.primaryColumns.length > 1)\r\n            throw new Error(`Cannot automatically determine a referenced column of the \"${this.relation.entityMetadata.name}\", because it has multiple primary columns. Try to specify a referenced column explicitly.`);\r\n\r\n        return this.relation.entityMetadata.firstPrimaryColumn;\r\n    }\r\n\r\n    /**\r\n     * Referenced join column of the inverse side.\r\n     */\r\n    get inverseReferencedColumn(): ColumnMetadata {\r\n        if (this._inverseJoinColumnReferencedColumnName) {\r\n            const referencedColumn = this.relation.inverseEntityMetadata.columns.find(column => column.fullName === this._inverseJoinColumnReferencedColumnName);\r\n            if (!referencedColumn)\r\n                throw new Error(`Referenced column ${this._inverseJoinColumnReferencedColumnName} was not found in entity ${this.name}`);\r\n\r\n            return referencedColumn;\r\n        }\r\n\r\n        if (this.relation.inverseEntityMetadata.primaryColumns.length > 1)\r\n            throw new Error(`Cannot automatically determine inverse referenced column of the \"${this.relation.inverseEntityMetadata.name}\", because it has multiple primary columns. Try to specify a referenced column explicitly.`);\r\n\r\n        return this.relation.inverseEntityMetadata.firstPrimaryColumn;\r\n    }\r\n\r\n}"],"sourceRoot":".."}