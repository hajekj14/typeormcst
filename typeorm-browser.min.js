var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};System.register("typeorm/driver/DriverOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/ColumnTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isTypeSupported=function(e){return-1!==this.supportedTypes.indexOf(e)},Object.defineProperty(e,"supportedTypes",{get:function(){return[this.STRING,this.TEXT,this.NUMBER,this.INTEGER,this.INT,this.SMALLINT,this.BIGINT,this.FLOAT,this.DOUBLE,this.DECIMAL,this.DATE,this.TIME,this.DATETIME,this.BOOLEAN,this.JSON,this.JSONB,this.SIMPLE_ARRAY,this.UUID]},enumerable:!0,configurable:!0}),e.determineTypeFromFunction=function(t){if(t instanceof Date)return e.DATETIME;if(t instanceof Function){switch(t.name.toLowerCase()){case"number":return e.NUMBER;case"boolean":return e.BOOLEAN;case"string":return e.STRING;case"date":return e.DATETIME;case"object":return e.JSON}}else if(t instanceof Object)return e.JSON},e.typeToString=function(e){return e.name.toLowerCase()},e.isNumeric=function(t){return t===e.NUMBER||t===e.INT||t===e.INTEGER||t===e.BIGINT||t===e.SMALLINT||t===e.DOUBLE||t===e.FLOAT},e}(),n.STRING="string",n.TEXT="text",n.NUMBER="number",n.INTEGER="integer",n.INT="int",n.SMALLINT="smallint",n.BIGINT="bigint",n.FLOAT="float",n.DOUBLE="double",n.DECIMAL="decimal",n.DATE="date",n.TIME="time",n.DATETIME="datetime",n.BOOLEAN="boolean",n.JSON="json",n.JSONB="jsonb",n.SIMPLE_ARRAY="simple_array",n.UUID="uuid",e("ColumnTypes",n)}}}),System.register("typeorm/decorator/options/ColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/ColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/TableTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e}(),n.REGULAR="regular",n.ABSTRACT="abstract",n.JUNCTION="junction",n.CLOSURE="closure",n.CLOSURE_JUNCTION="closure-junction",n.EMBEDDABLE="embeddable",n.SINGLE_TABLE_CHILD="single-table-child",n.CLASS_TABLE_CHILD="class-table-child",e("TableTypes",n)}}}),System.register("typeorm/find-options/OrderByCondition",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/error/EntityMetadataAlreadySetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;i.name="EntityMetadataAlreadySetError";var o=n?" for "+(n instanceof Function?n.constructor.name:n):"",a=r?" with "+r+" table name":"";return i.message="Entity metadata"+o+a+" has been already set to this "+t.constructor.name,i}return __extends(t,e),t}(Error),e("EntityMetadataAlreadySetError",n)}}}),System.register("typeorm/metadata/error/EntityMetadataNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;i.name="EntityMetadataNotSetError";var o=n?" for "+(n instanceof Function?n.constructor.name:n):"",a=r?" with "+r+" table name":"";return i.message="Entity metadata"+o+a+" is not set in "+t.constructor.name,i}return __extends(t,e),t}(Error),e("EntityMetadataNotSetError",n)}}}),System.register("typeorm/metadata/TableMetadata",["typeorm/metadata/types/TableTypes","typeorm/metadata/error/EntityMetadataAlreadySetError","typeorm/metadata/error/EntityMetadataNotSetError"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e){this.tableType="regular",this.target=e.target,this.tableType=e.type,this._name=e.name,this._orderBy=e.orderBy,this.engine=e.engine,this.skipSchemaSync=e.skipSchemaSync}return Object.defineProperty(e.prototype,"entityMetadata",{get:function(){if(!this._entityMetadata)throw new i.EntityMetadataNotSetError(e,this.target,this._name);return this._entityMetadata},set:function(t){if(this._entityMetadata)throw new r.EntityMetadataAlreadySetError(e,this.target,this._name);this._entityMetadata=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nameWithoutPrefix",{get:function(){if(this.isClosureJunction&&this._name)return this.entityMetadata.namingStrategy.closureJunctionTableName(this._name);var e=this.target instanceof Function?this.target.name:this.target;return this.entityMetadata.namingStrategy.tableName(e,this._name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.entityMetadata.tablesPrefix?this.entityMetadata.namingStrategy.prefixTableName(this.entityMetadata.tablesPrefix,this.nameWithoutPrefix):this.nameWithoutPrefix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orderBy",{get:function(){return this._orderBy instanceof Function?this._orderBy(this.entityMetadata.createPropertiesMap()):this._orderBy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRegular",{get:function(){return this.tableType===n.TableTypes.REGULAR},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAbstract",{get:function(){return this.tableType===n.TableTypes.ABSTRACT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isJunction",{get:function(){return this.tableType===n.TableTypes.JUNCTION},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isClosure",{get:function(){return this.tableType===n.TableTypes.CLOSURE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isClosureJunction",{get:function(){return this.tableType===n.TableTypes.CLOSURE_JUNCTION},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmbeddable",{get:function(){return this.tableType===n.TableTypes.EMBEDDABLE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingleTableChild",{get:function(){return this.tableType===n.TableTypes.SINGLE_TABLE_CHILD},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isClassTableChild",{get:function(){return this.tableType===n.TableTypes.CLASS_TABLE_CHILD},enumerable:!0,configurable:!0}),e}(),e("TableMetadata",o)}}}),System.register("typeorm/metadata/types/RelationTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e}(),n.ONE_TO_ONE="one-to-one",n.ONE_TO_MANY="one-to-many",n.MANY_TO_ONE="many-to-one",n.MANY_TO_MANY="many-to-many",e("RelationTypes",n)}}}),System.register("typeorm/metadata/ForeignKeyMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.columns=e,this.referencedTable=t,this.referencedColumns=n,r&&(this.onDelete=r)}return Object.defineProperty(e.prototype,"tableName",{get:function(){return this.entityMetadata.table.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedTableName",{get:function(){return this.referencedTable.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.entityMetadata.namingStrategy.foreignKeyName(this.tableName,this.columnNames,this.referencedTable.name,this.referencedColumnNames)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columns.map(function(e){return e.fullName})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedColumnNames",{get:function(){return this.referencedColumns.map(function(e){return e.fullName})},enumerable:!0,configurable:!0}),e}(),e("ForeignKeyMetadata",n)}}}),System.register("typeorm/decorator/options/JoinColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinTableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/JoinTableMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this.propertyName=e.propertyName,this._name=e.name,e.joinColumn&&(e.joinColumn.name&&(this._joinColumnName=e.joinColumn.name),e.joinColumn.referencedColumnName&&(this._joinColumnReferencedColumnName=e.joinColumn.referencedColumnName)),e.inverseJoinColumn&&(e.inverseJoinColumn.name&&(this._inverseJoinColumnName=e.inverseJoinColumn.name),e.inverseJoinColumn.referencedColumnName&&(this._inverseJoinColumnReferencedColumnName=e.inverseJoinColumn.referencedColumnName))}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name?this._name:this.relation.entityMetadata.namingStrategy.joinTableName(this.relation.entityMetadata.table.nameWithoutPrefix,this.relation.inverseEntityMetadata.table.nameWithoutPrefix,this.relation.propertyName,this.relation.hasInverseSide?this.relation.inverseRelation.propertyName:"",this.referencedColumn.fullName,this.inverseReferencedColumn.fullName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"joinColumnName",{get:function(){return this._joinColumnName?this._joinColumnName:this.relation.entityMetadata.namingStrategy.joinTableColumnName(this.relation.entityMetadata.table.nameWithoutPrefix,this.referencedColumn.fullName,this.relation.inverseEntityMetadata.table.nameWithoutPrefix,this.inverseReferencedColumn.fullName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseJoinColumnName",{get:function(){return this._inverseJoinColumnName?this._inverseJoinColumnName:this.relation.entityMetadata.namingStrategy.joinTableInverseColumnName(this.relation.inverseEntityMetadata.table.nameWithoutPrefix,this.inverseReferencedColumn.fullName,this.relation.entityMetadata.table.nameWithoutPrefix,this.referencedColumn.fullName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedColumn",{get:function(){var e=this;if(this._joinColumnReferencedColumnName){var t=this.relation.entityMetadata.columns.find(function(t){return t.fullName===e._joinColumnReferencedColumnName});if(!t)throw new Error("Referenced column "+this._joinColumnReferencedColumnName+" was not found in entity "+this.name);return t}if(this.relation.entityMetadata.primaryColumns.length>1)throw new Error('Cannot automatically determine a referenced column of the "'+this.relation.entityMetadata.name+'", because it has multiple primary columns. Try to specify a referenced column explicitly.');return this.relation.entityMetadata.firstPrimaryColumn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseReferencedColumn",{get:function(){var e=this;if(this._inverseJoinColumnReferencedColumnName){var t=this.relation.inverseEntityMetadata.columns.find(function(t){return t.fullName===e._inverseJoinColumnReferencedColumnName});if(!t)throw new Error("Referenced column "+this._inverseJoinColumnReferencedColumnName+" was not found in entity "+this.name);return t}if(this.relation.inverseEntityMetadata.primaryColumns.length>1)throw new Error('Cannot automatically determine inverse referenced column of the "'+this.relation.inverseEntityMetadata.name+'", because it has multiple primary columns. Try to specify a referenced column explicitly.');return this.relation.inverseEntityMetadata.firstPrimaryColumn},enumerable:!0,configurable:!0}),e}(),e("JoinTableMetadata",n)}}}),System.register("typeorm/metadata-args/JoinColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/JoinColumnMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this.propertyName=e.propertyName,this._name=e.name,this.referencedColumnName=e.referencedColumnName}return Object.defineProperty(e.prototype,"name",{get:function(){return this.relation.entityMetadata.namingStrategy.joinColumnInverseSideName(this._name,this.relation.propertyName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedColumn",{get:function(){var e=this;if(this.referencedColumnName){var t=this.relation.inverseEntityMetadata.allColumns.find(function(t){return t.fullName===e.referencedColumnName});if(!t)throw new Error("Referenced column "+this.referencedColumnName+" was not found in entity "+this.name);return t}var n=this.relation.inverseEntityMetadata,r=n.primaryColumnsWithParentIdColumns;if(r.length>1)throw new Error('Cannot automatically determine a referenced column of the "'+n.name+'", because it has multiple primary columns. Try to specify a referenced column explicitly.');return r[0]},enumerable:!0,configurable:!0}),e}(),e("JoinColumnMetadata",n)}}}),System.register("typeorm/decorator/options/RelationOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/RelationMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/ObjectLiteral",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationMetadata",["typeorm/metadata/types/RelationTypes"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isNullable=!0,this.target=e.target,this.propertyName=e.propertyName,this.relationType=e.relationType,e.inverseSideProperty&&(this._inverseSideProperty=e.inverseSideProperty),void 0!==e.isLazy&&(this.isLazy=e.isLazy),(e.options.cascadeInsert||e.options.cascadeAll)&&(this.isCascadeInsert=!0),(e.options.cascadeUpdate||e.options.cascadeAll)&&(this.isCascadeUpdate=!0),(e.options.cascadeRemove||e.options.cascadeAll)&&(this.isCascadeRemove=!0),void 0!==e.options.nullable&&(this.isNullable=e.options.nullable),e.options.onDelete&&(this.onDelete=e.options.onDelete),void 0!==e.options.primary&&(this.isPrimary=e.options.primary),e.isTreeParent&&(this.isTreeParent=!0),e.isTreeChildren&&(this.isTreeChildren=!0),this._type||(this._type=e.type)}return Object.defineProperty(e.prototype,"entityTarget",{get:function(){return this.entityMetadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){if(this.isOwning){if(this.joinTable)return this.joinTable.joinColumnName;if(this.joinColumn)return this.joinColumn.name}else if(this.hasInverseSide){if(this.inverseRelation.joinTable)return this.inverseRelation.joinTable.inverseJoinColumnName;if(this.inverseRelation.joinColumn&&this.inverseRelation.joinColumn.referencedColumn)return this.inverseRelation.joinColumn.referencedColumn.fullName}throw new Error("Relation name cannot be retrieved.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedColumnName",{get:function(){if(this.isOwning){if(this.joinTable)return this.joinTable.referencedColumn.fullName;if(this.joinColumn)return this.joinColumn.referencedColumn.fullName}else if(this.hasInverseSide){if(this.inverseRelation.joinTable)return this.inverseRelation.joinTable.inverseReferencedColumn.fullName;if(this.inverseRelation.joinColumn)return this.inverseRelation.joinColumn.name}throw new Error("Cannot get referenced column name of the relation "+this.entityMetadata.name+"#"+this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedColumn",{get:function(){if(this.isOwning){if(this.joinTable)return this.joinTable.referencedColumn;if(this.joinColumn)return this.joinColumn.referencedColumn}else if(this.hasInverseSide){if(this.inverseRelation.joinTable)return this.inverseRelation.joinTable.inverseReferencedColumn;if(this.inverseRelation.joinColumn)return this.inverseRelation.joinColumn.referencedColumn}throw new Error("Cannot get referenced column of the relation "+this.entityMetadata.name+"#"+this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type instanceof Function?this._type():this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOwning",{get:function(){return!!(this.isManyToOne||this.isManyToMany&&this.joinTable||this.isOneToOne&&this.joinColumn)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOneToOne",{get:function(){return this.relationType===n.RelationTypes.ONE_TO_ONE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOneToOneOwner",{get:function(){return this.isOneToOne&&this.isOwning},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOneToOneNotOwner",{get:function(){return this.isOneToOne&&!this.isOwning},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOneToMany",{get:function(){return this.relationType===n.RelationTypes.ONE_TO_MANY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isManyToOne",{get:function(){return this.relationType===n.RelationTypes.MANY_TO_ONE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isManyToMany",{get:function(){return this.relationType===n.RelationTypes.MANY_TO_MANY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isManyToManyOwner",{get:function(){return this.isManyToMany&&this.isOwning},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isManyToManyNotOwner",{get:function(){return this.isManyToMany&&!this.isOwning},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasInverseSide",{get:function(){return this.inverseEntityMetadata&&this.inverseEntityMetadata.hasRelationWithPropertyName(this.inverseSideProperty)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseSideProperty",{get:function(){return this._inverseSideProperty?this.computeInverseSide(this._inverseSideProperty):this.isTreeParent&&this.entityMetadata.hasTreeChildrenRelation?this.entityMetadata.treeChildrenRelation.propertyName:this.isTreeChildren&&this.entityMetadata.hasTreeParentRelation?this.entityMetadata.treeParentRelation.propertyName:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseRelation",{get:function(){var e=this.inverseEntityMetadata.findRelationWithPropertyName(this.inverseSideProperty);if(!e)throw new Error("Inverse side was not found in the relation "+this.entityMetadata.name+"#"+this.inverseSideProperty);return e},enumerable:!0,configurable:!0}),e.prototype.getEntityValue=function(e){return this.isLazy?e["__"+this.propertyName+"__"]:e[this.propertyName]},e.prototype.hasEntityValue=function(e){return this.isLazy?e["__"+this.propertyName+"__"]:e[this.propertyName]},e.prototype.getOwnEntityRelationId=function(e){return this.isManyToManyOwner?e[this.joinTable.referencedColumn.propertyName]:this.isManyToManyNotOwner?e[this.inverseRelation.joinTable.inverseReferencedColumn.propertyName]:this.isOneToOneOwner||this.isManyToOne?e[this.joinColumn.propertyName]:this.isOneToOneNotOwner||this.isOneToMany?e[this.inverseRelation.joinColumn.referencedColumn.propertyName]:void 0},e.prototype.getInverseEntityRelationId=function(e){return this.isManyToManyOwner?e[this.joinTable.inverseReferencedColumn.propertyName]:this.isManyToManyNotOwner?e[this.inverseRelation.joinTable.referencedColumn.propertyName]:this.isOneToOneOwner||this.isManyToOne?e[this.joinColumn.referencedColumn.propertyName]:this.isOneToOneNotOwner||this.isOneToMany?e[this.inverseRelation.joinColumn.propertyName]:void 0},e.prototype.computeInverseSide=function(e){var t=this.inverseEntityMetadata.createPropertiesMap();return"function"==typeof e?e(t):"string"==typeof e?e:""},e}(),e("RelationMetadata",r)}}}),System.register("typeorm/metadata-args/IndexMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/IndexMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this._columns=e.columns,this._name=e.name,this.isUnique=e.unique}return Object.defineProperty(e.prototype,"name",{get:function(){return this.entityMetadata.namingStrategy.indexName(this._name,this.entityMetadata.table.name,this.columns)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){return this.entityMetadata.table.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){var e=this,t=[];if(this._columns instanceof Array)t=this._columns;else{var n=this.entityMetadata.createPropertiesMap(),r=this._columns(n),i=r instanceof Array?r:Object.keys(r);t=i.map(function(e){return String(e)})}var o=this.entityMetadata.columns.filter(function(e){return-1!==t.indexOf(e.propertyName)}),a=t.filter(function(t){return!e.entityMetadata.columns.find(function(e){return e.propertyName===t})});if(a.length>0)throw new Error("Index "+(this._name?'"'+this._name+'" ':"")+"contains columns that are missing in the entity: "+a.join(", "));return o.map(function(e){return e.fullName})},enumerable:!0,configurable:!0}),e.prototype.buildColumnsAsMap=function(e){var t=this;void 0===e&&(e=0);var n={};if(this._columns instanceof Array)this._columns.forEach(function(t){return n[t]=e});else{var r=this.entityMetadata.createPropertiesMap(),i=this._columns(r);i instanceof Array?i.forEach(function(t){return n[t]=e}):Object.keys(i).forEach(function(e){return n[e]=i[e]})}return Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyName===r});if(!i)throw new Error("Index "+(t._name?'"'+t._name+'" ':"")+"contains columns that are missing in the entity: "+r);return e[i.name]=n[r],e},{})},e}(),e("IndexMetadata",n)}}}),System.register("typeorm/naming-strategy/NamingStrategyInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EmbeddedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EmbeddedMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){var i=this;this.type=r.type?r.type():void 0,this.propertyName=r.propertyName,this.isArray=r.isArray,this.customPrefix=r.prefix,this.table=e,this.columns=t,this.embeddeds=n,this.embeddeds.forEach(function(e){e.parentEmbeddedMetadata=i}),this.columns.forEach(function(e){e.embeddedMetadata=i})}return e.prototype.create=function(){if(!this.type)throw new Error("Embedded cannot be created because it does not have a type set.");return new this.type},Object.defineProperty(e.prototype,"prefix",{get:function(){return void 0!==this.customPrefix?this.customPrefix:this.propertyName},enumerable:!0,configurable:!0}),e}(),e("EmbeddedMetadata",n)}}}),System.register("typeorm/metadata-args/EntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/alias/Alias",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.name=e}return Object.defineProperty(e.prototype,"selection",{get:function(){return this.parentAliasName+"."+this.parentPropertyName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e}(),e("Alias",n)}}}),System.register("typeorm/query-builder/alias/AliasMap",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e,this.aliases=[]}return e.prototype.addMainAlias=function(e){this.hasMainAlias&&this.aliases.splice(this.aliases.indexOf(this.mainAlias),1),e.isMain=!0,this.aliases.push(e)},e.prototype.addAlias=function(e){this.aliases.push(e)},Object.defineProperty(e.prototype,"hasMainAlias",{get:function(){return!!this.aliases.find(function(e){return e.isMain})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mainAlias",{get:function(){var e=this.aliases.find(function(e){return e.isMain});if(!e)throw new Error("Main alias is not set.");return e},enumerable:!0,configurable:!0}),e.prototype.findAliasByName=function(e){return this.aliases.find(function(t){return t.name===e})},e.prototype.findAliasByParent=function(e,t){return this.aliases.find(function(n){return n.parentAliasName===e&&n.parentPropertyName===t})},e.prototype.getEntityMetadataByAlias=function(e){if(e.metadata)return e.metadata;if(e.parentAliasName&&e.parentPropertyName){var t=this.findAliasByName(e.parentAliasName);if(!t)throw new Error('Alias "'+e.parentAliasName+'" was not found');var n=this.getEntityMetadataByAlias(t);if(!n)throw new Error("Cannot get entity metadata for the given alias "+e.name);if(!n.hasRelationWithPropertyName(e.parentPropertyName))throw new Error("Relation metadata for "+e.parentAliasName+"#"+e.parentPropertyName+" was not found.");return n.findRelationWithPropertyName(e.parentPropertyName).inverseEntityMetadata}},e}(),e("AliasMap",n)}}}),System.register("typeorm/util/OrmUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},e}(),e("OrmUtils",n)}}}),System.register("typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer",["typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n,r,i){this.driver=e,this.aliasMap=t,this.joinMappings=n,this.relationCountMetas=r,this.enableRelationIdValues=i}return e.prototype.transform=function(e){return this.groupAndTransform(e,this.aliasMap.mainAlias)},e.prototype.groupAndTransform=function(e,t){var r=this,i=this.aliasMap.getEntityMetadataByAlias(t);if(!i)throw new Error("Cannot get entity metadata for the given alias "+t.name);return n.OrmUtils.groupBy(e,function(e){if(i)return i.primaryColumnsWithParentIdColumns.map(function(n){return e[t.name+"_"+n.fullName]}).join("_")}).map(function(e){if(i)return r.transformIntoSingleResult(e.items,t,i)}).filter(function(e){return!!e})},e.prototype.transformIntoSingleResult=function(e,t,n){var r=this,i=n.create(),o=!1;this.enableRelationIdValues&&n.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(n){var a=e[0][t.name+"_"+n.fullName];if(void 0!==a&&null!==a&&n.propertyName){var s=r.driver.prepareHydratedValue(a,n);i[n.propertyName]=s,o=!0}}),this.joinMappings.filter(function(e){return e.parentName===t.name&&!e.alias.parentAliasName&&e.alias.target}).map(function(t){var n=r.groupAndTransform(e,t.alias),a=t.isMany,s=a?n:n[0];s&&(!a||s.length>0)&&(i[t.propertyName]=s,o=!0)}),n.columnsWithoutEmbeddeds.forEach(function(n){var a=n.fullName,s=e[0][t.name+"_"+a];if(void 0!==s&&null!==s&&n.propertyName&&!n.isVirtual&&!n.isParentId&&!n.isDiscriminator){var u=r.driver.prepareHydratedValue(s,n);i[n.propertyName]=u,o=!0}});var a=function(n,r){r.forEach(function(r){r.columns.forEach(function(i){var a=e[0][t.name+"_"+i.fullName];a&&(n[r.propertyName]||(n[r.propertyName]=r.create()),n[r.propertyName][i.propertyName]=a,o=!0)}),a(n[r.propertyName],r.embeddeds)})};return a(i,n.embeddeds),n.parentEntityMetadata&&(n.parentEntityMetadata.columnsWithoutEmbeddeds.forEach(function(t){var a=t.fullName,s=e[0]["parentIdColumn_"+n.parentEntityMetadata.table.name+"_"+a];if(void 0!==s&&null!==s&&t.propertyName&&!t.isVirtual&&!t.isParentId&&!t.isDiscriminator){var u=r.driver.prepareHydratedValue(s,t);i[t.propertyName]=u,o=!0}}),a(i,n.parentEntityMetadata.embeddeds)),n.relations.forEach(function(a){var s=r.aliasMap.findAliasByParent(t.name,a.propertyName);if(s){var u=r.joinMappings.find(function(e){return"join"===e.type&&e.alias===s}),c=r.groupAndTransform(e,s),l=a.isManyToMany||a.isOneToMany,d=l?c:c[0];if(d){var m=a.propertyName;u&&(m=u.propertyName),a.isLazy?i["__"+m+"__"]=d:i[m]=d,(!l||d.length>0)&&(o=!0)}}if(a.isManyToMany){if(s){var p=[],u=r.joinMappings.find(function(e){return"relationId"===e.type&&e.alias===s});if(a.idField||u){var m=u?u.propertyName:a.idField,f=a.junctionEntityMetadata,y=a.isOwning?f.columns[1].fullName:f.columns[0].fullName;e.forEach(function(e){if(s){var t=s.name+"_"+y,n=r.driver.prepareHydratedValue(e[t],a.referencedColumn);void 0!==n&&null!==n&&p.push(n)}}),p&&p.length&&(i[m]=p)}}}else if(a.idField){var h=a.name;i[a.idField]=r.driver.prepareHydratedValue(e[0][t.name+"_"+h],a.referencedColumn)}r.relationCountMetas.forEach(function(e){e.alias===s&&e.entities.push({entity:i,metadata:n})})}),o?i:null},e}(),e("RawSqlResultsToEntityTransformer",r)}}}),System.register("typeorm/driver/error/ConnectionIsNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="ConnectionIsNotSetError",n.message="Connection with "+t+" database is not established. Check connection configuration.",n}return __extends(t,e),t}(Error),e("ConnectionIsNotSetError",n)}}}),System.register("typeorm/driver/DatabaseConnection",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/error/DriverPackageNotInstalledError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="DriverPackageNotInstalledError",r.message=t+" package has not been found installed. Try to install it: npm install "+n+" --save",r}return __extends(t,e),t}(Error),e("DriverPackageNotInstalledError",n)}}}),System.register("typeorm/driver/DriverUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}
return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url);if(t&&t.useSid){var r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,sid:n.database};return Object.assign(r,e)}var r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return Object.assign(r,e)}return Object.assign({},e)},e.parseConnectionUrl=function(e){var t=e.indexOf("//"),n=e.substr(t+2),r=n.indexOf("/"),i=-1!==r?n.substr(0,r):n,o=-1!==r?n.substr(r+1):void 0,a=i.split("@"),s=a[0],u=a[1],c=s.split(":"),l=c[0],d=c[1],m=u.split(":"),p=m[0],f=m[1];return{host:p,username:l,password:d,port:f?parseInt(f):void 0,database:o||void 0}},e}(),e("DriverUtils",n)}}}),System.register("typeorm/logger/LoggerOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/platform/PlatformTools",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getGlobalVariable=function(){return window},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormilize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.getEnvVariable=function(e){},e}(),n.type="browser",e("PlatformTools",n)}}}),System.register("typeorm/logger/Logger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t){(this.options.logQueries||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("log","executing query: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""))},e.prototype.logFailedQuery=function(e,t){(this.options.logQueries||this.options.logOnlyFailedQueries||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("error","query failed: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""))},e.prototype.logQueryError=function(e){(this.options.logFailedQueryError||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("error","error during executing query:"+e)},e.prototype.logSchemaBuild=function(e){(this.options.logSchemaCreation||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("info",e)},e.prototype.log=function(e,t){if(this.options)if(this.options.logger)this.options.logger(e,t);else switch(e){case"log":console.log(t);break;case"info":console.info(t);break;case"warn":console.warn(t);break;case"error":console.error(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e("Logger",r)}}}),System.register("typeorm/driver/error/TransactionAlreadyStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionAlreadyStartedError",t.message="Transaction already started for the given connection, commit current transaction before starting a new one.",t}return __extends(t,e),t}(Error),e("TransactionAlreadyStartedError",n)}}}),System.register("typeorm/driver/error/TransactionNotStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionNotStartedError",t.message="Transaction is not started yet, start transaction before committing or rolling it back.",t}return __extends(t,e),t}(Error),e("TransactionNotStartedError",n)}}}),System.register("typeorm/driver/error/DataTypeNotSupportedByDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="DataTypeNotSupportedByDriverError",r.message="Specified type ("+t+") is not supported by "+n+" driver.",r}return __extends(t,e),t}(Error),e("DataTypeNotSupportedByDriverError",n)}}}),System.register("typeorm/schema-builder/schema/IndexSchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.tableName=e,this.name=t,this.columnNames=n,this.isUnique=r}return e.prototype.clone=function(){return new e(this.tableName,this.name,this.columnNames.map(function(e){return e}),this.isUnique)},e.create=function(t){return new e(t.entityMetadata.table.name,t.name,t.columns,t.isUnique)},e}(),e("IndexSchema",n)}}}),System.register("typeorm/schema-builder/schema/ForeignKeySchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r,i){this.name=e,this.columnNames=t,this.referencedColumnNames=n,this.referencedTableName=r,this.onDelete=i}return e.prototype.clone=function(){return new e(this.name,this.columnNames,this.referencedColumnNames,this.referencedTableName)},e.create=function(t){return new e(t.name,t.columnNames,t.referencedColumnNames,t.referencedTableName,t.onDelete)},e}(),e("ForeignKeySchema",n)}}}),System.register("typeorm/schema-builder/schema/PrimaryKeySchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.name=e,this.columnName=t}return e.prototype.clone=function(){return new e(this.name,this.columnName)},e}(),e("PrimaryKeySchema",n)}}}),System.register("typeorm/schema-builder/schema/TableSchema",["typeorm/schema-builder/schema/ColumnSchema"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,r){this.columns=[],this.indices=[],this.foreignKeys=[],this.primaryKeys=[],this.justCreated=!1,this.name=e,t&&(this.columns=t.map(function(e){return e instanceof n.ColumnSchema?e:new n.ColumnSchema(e)})),void 0!==r&&(this.justCreated=r)}return Object.defineProperty(e.prototype,"primaryKeysWithoutGenerated",{get:function(){var e=this.columns.find(function(e){return e.isGenerated});return e?this.primaryKeys.filter(function(t){return t.columnName!==e.name}):this.primaryKeys},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeneratedColumn",{get:function(){return!!this.columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.name);return t.columns=this.columns.map(function(e){return e.clone()}),t.indices=this.indices.map(function(e){return e.clone()}),t.foreignKeys=this.foreignKeys.map(function(e){return e.clone()}),t.primaryKeys=this.primaryKeys.map(function(e){return e.clone()}),t},e.prototype.addColumns=function(e){this.columns=this.columns.concat(e)},e.prototype.replaceColumn=function(e,t){this.columns[this.columns.indexOf(e)]=t},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.removeColumns=function(e){var t=this;e.forEach(function(e){return t.removeColumn(e)})},e.prototype.addPrimaryKeys=function(e){var t=this;e.forEach(function(e){return t.primaryKeys.push(e)})},e.prototype.removePrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.splice(t.primaryKeys.indexOf(e),1)})},e.prototype.removePrimaryKeysOfColumns=function(e){this.primaryKeys=this.primaryKeys.filter(function(t){return!e.find(function(e){return e.name===t.columnName})})},e.prototype.addForeignKeys=function(e){this.foreignKeys=this.foreignKeys.concat(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.removeForeignKeys=function(e){var t=this;e.forEach(function(e){return t.removeForeignKey(e)})},e.prototype.removeIndex=function(e){var t=this.indices.find(function(t){return t.name===e.name});t&&this.indices.splice(this.indices.indexOf(t),1)},e.prototype.findChangedColumns=function(e,t){return this.columns.filter(function(n){var r=t.find(function(e){return e.fullName===n.name});return!!r&&(n.name!==r.fullName||n.type!==e.normalizeType(r)||n.comment!==r.comment||!n.isGenerated&&!e.compareDefaultValues(r.default,n.default)||n.isNullable!==r.isNullable||n.isUnique!==r.isUnique||n.isGenerated!==r.isGenerated)})},e.create=function(t,r){var i=new e(t.table.name);return t.columns.forEach(function(e){i.columns.push(n.ColumnSchema.create(e,r.normalizeType(e)))}),i},e}(),e("TableSchema",r)}}}),System.register("typeorm/query-runner/error/QueryRunnerAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerAlreadyReleasedError",t.message="Query runner already released. Cannot run queries anymore.",t}return __extends(t,e),t}(Error),e("QueryRunnerAlreadyReleasedError",n)}}}),System.register("typeorm/driver/sqlserver/SqlServerQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,7,9,11]),e="SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE'",[4,this.query(e)];case 3:return t=o.sent(),n=t.map(function(e){return e.TABLE_NAME}),[4,Promise.all(n.map(function(e){return __awaiter(i,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return t="SELECT 'ALTER TABLE ' +  OBJECT_SCHEMA_NAME(parent_object_id) + '.[' + OBJECT_NAME(parent_object_id) + '] DROP CONSTRAINT ' + name as query FROM sys.foreign_keys WHERE referenced_object_id = object_id('"+e+"')",[4,this.query(t)];case 1:return n=i.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return r.query(e)}))]}})})}))];case 4:return o.sent(),[4,Promise.all(n.map(function(e){var t='DROP TABLE "'+e+'"';return i.query(t)}))];case 5:return o.sent(),[4,this.commitTransaction()];case 6:return o.sent(),[3,11];case 7:return r=o.sent(),[4,this.rollbackTransaction()];case 8:throw o.sent(),r;case 9:return[4,this.release()];case 10:return o.sent(),[7];case 11:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return[2,new Promise(function(t,n){e.databaseConnection.isTransactionActive=!0,e.databaseConnection.transaction=e.databaseConnection.connection.transaction(),e.databaseConnection.transaction.begin(function(r){if(r)return e.databaseConnection.isTransactionActive=!1,n(r);t()})})]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.transaction.commit(function(r){if(r)return n(r);e.databaseConnection.isTransactionActive=!1,t()})})]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.transaction.rollback(function(r){if(r)return n(r);e.databaseConnection.isTransactionActive=!1,t()})})]})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t);var o=new n.driver.mssql.Request(n.isTransactionActive()?n.databaseConnection.transaction:n.databaseConnection.connection);t&&t.length&&t.forEach(function(e,n){o.input(n,t[n])}),o.query(e,function(o,a){if(o)return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o);r(a)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(d){switch(d.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"@"+t}).join(","),a=r.map(function(e){return t[e]}),s=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") "+(n?"OUTPUT INSERTED."+n.fullName+" ":"")+"VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" "+(n?"OUTPUT INSERTED."+n.fullName+" ":"")+"DEFAULT VALUES ",[4,this.query(s,a)];case 1:return u=d.sent(),[2,n?u instanceof Array?u[0][n.fullName]:u[n.fullName]:void 0]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(n).map(function(e){return n[e]}),i=Object.keys(t).map(function(e){return t[e]}),o=i.concat(r),a=this.parametrize(t).join(", "),s=this.parametrize(n,i.length).join(" AND "),u="UPDATE "+this.driver.escapeTableName(e)+" SET "+a+" "+(s?" WHERE "+s:""),[4,this.query(u,o)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,m,p,f,y,h,g,v,b=this;return __generator(this,function(E){switch(E.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME IN ("+t+")",r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_CATALOG = '"+this.dbName+"'",i="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages LEFT JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME WHERE columnUsages.TABLE_CATALOG = '"+this.dbName+"' AND tableConstraints.TABLE_CATALOG = '"+this.dbName+"'",d="SELECT COLUMN_NAME, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_CATALOG = '"+this.dbName+"' AND COLUMNPROPERTY(object_id(TABLE_NAME), COLUMN_NAME, 'IsIdentity') = 1;",m="SELECT TABLE_NAME = t.name, INDEX_NAME = ind.name, IndexId = ind.index_id, ColumnId = ic.index_column_id, COLUMN_NAME = col.name, ind.*, ic.*, col.* FROM sys.indexes ind INNER JOIN sys.index_columns ic ON ind.object_id = ic.object_id and ind.index_id = ic.index_id INNER JOIN sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id INNER JOIN sys.tables t ON ind.object_id = t.object_id WHERE ind.is_primary_key = 0 AND ind.is_unique = 0 AND ind.is_unique_constraint = 0 AND t.is_ms_shipped = 0 ORDER BY t.name, ind.name, ind.index_id, ic.index_column_id",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(d),this.query(m)])]):[2,[]];case 1:return p=E.sent(),f=p[0],y=p[1],h=p[2],g=p[3],v=p[4],f.length?[2,Promise.all(f.map(function(e){return __awaiter(b,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new a.TableSchema(e.TABLE_NAME),t.columns=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!h.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&"PRIMARY KEY"===n.CONSTRAINT_TYPE}),r=!!g.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),i=!!h.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&"UNIQUE"===n.CONSTRAINT_TYPE}),a=new o.ColumnSchema;return a.name=e.COLUMN_NAME,a.type=e.DATA_TYPE.toLowerCase()+(e.CHARACTER_MAXIMUM_LENGTH?"("+e.CHARACTER_MAXIMUM_LENGTH+")":""),a.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,a.isNullable="YES"===e.IS_NULLABLE,a.isPrimary=n,a.isGenerated=r,a.isUnique=i,a.comment="",a}),t.primaryKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&"PRIMARY KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new u.PrimaryKeySchema(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&"FOREIGN KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new s.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=v.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=v.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}).map(function(e){return e.COLUMN_NAME});return new c.IndexSchema(e.TABLE_NAME,n,r,!1)}),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){return', CONSTRAINT "uk_'+e.name+"_"+t.name+'" UNIQUE ("'+t.name+'")'}).join(" "),r=e.columns.filter(function(e){return e.isPrimary}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return n.isGenerated===i.isGenerated?[3,6]:[4,this.query('ALTER TABLE "'+r.name+'" DROP COLUMN "'+n.name+'"')];case 4:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ADD '+this.buildCreateColumnSql(n))];case 5:u.sent(),u.label=6;case 6:return s='ALTER TABLE "'+r.name+'" ALTER COLUMN '+this.buildCreateColumnSql(n,!0),[4,this.query(s)];case 7:return u.sent(),n.isUnique===i.isUnique?[3,11]:!0!==n.isUnique?[3,9]:[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "uk_'+n.name+'" UNIQUE ("'+n.name+'")')];case 8:return u.sent(),[3,11];case 9:return!1!==n.isUnique?[3,11]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "uk_'+n.name+'"')];case 10:u.sent(),u.label=11;case 11:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query('ALTER TABLE "'+n+'" DROP COLUMN "'+r+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages\nLEFT JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME AND tableConstraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\nWHERE columnUsages.TABLE_CATALOG = '"+this.dbName+"' AND tableConstraints.TABLE_CATALOG = '"+this.dbName+"'",[4,this.query(t)];case 1:return n=i.sent(),n.length>0?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n[0].CONSTRAINT_NAME+'"')]:[3,3];case 2:i.sent(),i.label=3;case 3:return r=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),r.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+r.join(", ")+")")]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(s){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),o='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.query(o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n='DROP INDEX "'+e+'"."'+t+'"',[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"nchar("+(e.length?e.length:255)+")":"nvarchar("+(e.length?e.length:255)+")";case"text":return"ntext";case"boolean":return"bit";case"integer":case"int":return"int";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"float";case"double":case"number":return"real";case"decimal":return"decimal";case"date":return"date";case"time":return"time";case"datetime":return"datetime";case"json":return"text";case"simple_array":return e.length?"nvarchar("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"SQLServer")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=@"+(t+r)})},e.prototype.buildCreateColumnSql=function(e,t){void 0===t&&(t=!1);var n='"'+e.name+'" '+e.type;return!0!==e.isNullable&&(n+=" NOT NULL"),!0!==e.isGenerated||t||(n+=" IDENTITY(1,1)"),e.comment&&(n+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?n+=" DEFAULT "+e.default:"boolean"==typeof e.default?n+=" DEFAULT "+(!0===e.default?"1":"0"):"function"==typeof e.default?n+=" DEFAULT "+e.default():"string"==typeof e.default?n+=" DEFAULT '"+e.default+"'":n+=" DEFAULT "+e.default),n},e}(),e("SqlServerQueryRunner",d)}}}),System.register("typeorm/driver/error/DriverOptionNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="DriverOptionNotSetError",n.message="Driver option ("+t+") is not set. Please set it to perform connection to the database.",n}return __extends(t,e),t}(Error),e("DriverOptionNotSetError",n)}}}),System.register("typeorm/util/DataTransformationUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.normalizeHydratedDate=function(e,t){if(!e)return e;var n="string"==typeof e?new Date(e):e;if(!t){var r=new Date;return r.setUTCFullYear(n.getFullYear(),n.getMonth(),n.getDate()),r.setUTCHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),r}return n},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToTimeString=function(e){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds()):e},e.mixedTimeToString=function(e){
return e=e instanceof Date?e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e,"string"==typeof e?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds()):e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.split(","):e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e}(),e("DataTransformationUtils",n)}}}),System.register("typeorm/driver/sqlserver/SqlServerDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/sqlserver/SqlServerQueryRunner","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e),this.logger=t,this.mssql=n,!this.options.host)throw new s.DriverOptionNotSetError("host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.database)throw new s.DriverOptionNotSetError("database");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{server:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return t.options?t.options.useUTC||(t.options.useUTC=!1):t.options={useUTC:!1},new Promise(function(n,r){var i=new e.mssql.Connection(t).connect(function(t){if(t)return r(t);e.connection=i,!1===e.options.usePool&&(e.databaseConnection={id:1,connection:new e.mssql.Request(i),isTransactionActive:!1}),n()})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.connection)throw new n.ConnectionIsNotSetError("mssql");return this.connection.close(),this.connection=void 0,this.databaseConnection=void 0,this.databaseConnectionPool=[],[2]})})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.connection?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("mssql"))];case 1:return e=t.sent(),[2,new o.SqlServerQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.mssql,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.connection}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"@"+(n.length-1)}).join(", "):(n.push(r),"@"+(n.length-1))}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case a.ColumnTypes.BOOLEAN:return!0===e?1:0;case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case a.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case a.ColumnTypes.JSON:return JSON.stringify(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case a.ColumnTypes.BOOLEAN:return!!e;case a.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case a.ColumnTypes.JSON:return JSON.parse(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(!this.connection)throw new n.ConnectionIsNotSetError("mssql");return new Promise(function(t,n){if(e.databaseConnection)return t(e.databaseConnection);var r={id:e.databaseConnectionPool.length,connection:e.connection,isTransactionActive:!1};r.releaseCallback=function(){return e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(r),1),Promise.resolve()},e.databaseConnectionPool.push(r),t(r)})},e.prototype.loadDependencies=function(){try{this.mssql=c.PlatformTools.load("mssql")}catch(e){throw new r.DriverPackageNotInstalledError("SQL Server","mssql")}},e}(),e("SqlServerDriver",l)}}}),System.register("typeorm/query-builder/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-runner/QueryRunnerProvider",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){void 0===t&&(t=!1),this.driver=e,this.useSingleQueryRunner=t}return Object.defineProperty(e.prototype,"isReleased",{get:function(){return this._isReleased},enumerable:!0,configurable:!0}),e.prototype.provide=function(){var e=this;return this.useSingleQueryRunner?this.reusableQueryRunner?Promise.resolve(this.reusableQueryRunner):(this.reusableQueryRunnerPromise||(this.reusableQueryRunnerPromise=this.driver.createQueryRunner().then(function(t){return e.reusableQueryRunner=t,t})),this.reusableQueryRunnerPromise):this.driver.createQueryRunner()},e.prototype.release=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return e===this.reusableQueryRunner?[2]:[2,e.release()]})})},e.prototype.releaseReused=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._isReleased=!0,this.reusableQueryRunner?[2,this.reusableQueryRunner.release()]:[2]})})},e}(),e("QueryRunnerProvider",n)}}}),System.register("typeorm/query-builder/error/PessimisticLockTransactionRequiredError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return __extends(t,e),t}(Error),e("PessimisticLockTransactionRequiredError",n)}}}),System.register("typeorm/query-builder/error/NoVersionOrUpdateDateColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return __extends(t,e),t}(Error),e("NoVersionOrUpdateDateColumnError",n)}}}),System.register("typeorm/query-builder/error/OptimisticLockVersionMismatchError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n,r,i){var o=e.call(this)||this;return o.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(o,t.prototype),o.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",o}return __extends(t,e),t}(Error),e("OptimisticLockVersionMismatchError",n)}}}),System.register("typeorm/query-builder/error/OptimisticLockCanNotBeUsedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return __extends(t,e),t}(Error),e("OptimisticLockCanNotBeUsedError",n)}}}),System.register("typeorm/driver/postgres/PostgresQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1,this.schemaName=t.schemaName||"public"}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,6,8,10]),e="SELECT 'DROP TABLE IF EXISTS \"' || tablename || '\" CASCADE;' as query FROM pg_tables WHERE schemaname = '"+this.schemaName+"'",[4,this.query(e)];case 3:return t=i.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 4:return i.sent(),[4,this.commitTransaction()];case 5:return i.sent(),[3,10];case 6:return n=i.sent(),[4,this.rollbackTransaction()];case 7:throw i.sent(),n;case 8:return[4,this.release()];case 9:return i.sent(),[7];case 10:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.query(e,t,function(o,a){o?(n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o)):r(a.rows)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(d){switch(d.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+") "+(n?" RETURNING "+this.driver.escapeColumnName(n.fullName):""):"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES "+(n?" RETURNING "+this.driver.escapeColumnName(n.fullName):""),s=r.map(function(e){return t[e]}),[4,this.query(a,s)];case 1:return u=d.sent(),n?[2,u[0][n.fullName]]:[2,u]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,m,p,f,y,h,g,v,b,E;return __generator(this,function(_){switch(_.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM information_schema.tables WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name IN ("+t+")",r="SELECT * FROM information_schema.columns WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"'",i="SELECT t.relname AS table_name, i.relname AS index_name, a.attname AS column_name  FROM pg_class t, pg_class i, pg_index ix, pg_attribute a, pg_namespace ns\nWHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid\nAND a.attnum = ANY(ix.indkey) AND t.relkind = 'r' AND t.relname IN ("+t+") AND t.relnamespace = ns.OID AND ns.nspname ='"+this.schemaName+"' ORDER BY t.relname, i.relname",d="SELECT table_name, constraint_name FROM information_schema.table_constraints WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND constraint_type = 'FOREIGN KEY'",m="SELECT * FROM information_schema.table_constraints WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND constraint_type = 'UNIQUE'",p="SELECT c.column_name, tc.table_name, tc.constraint_name FROM information_schema.table_constraints tc\nJOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_name)\nJOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name\nwhere constraint_type = 'PRIMARY KEY' AND c.table_schema = '"+this.schemaName+"' and tc.table_catalog = '"+this.dbName+"'",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(d),this.query(m),this.query(p)])]):[2,[]];case 1:return f=_.sent(),y=f[0],h=f[1],g=f[2],v=f[3],b=f[4],E=f[5],y.length?[2,y.map(function(e){var t=new a.TableSchema(e.table_name);return t.columns=h.filter(function(e){return e.table_name===t.name}).map(function(e){var t=e.data_type.toLowerCase()+(void 0!==e.character_maximum_length&&null!==e.character_maximum_length?"("+e.character_maximum_length+")":""),n=e.column_default==="nextval('"+e.table_name+"_id_seq'::regclass)"||e.column_default==="nextval('\""+e.table_name+"_id_seq\"'::regclass)"||/^uuid\_generate\_v\d\(\)/.test(e.column_default),r=new o.ColumnSchema;return r.name=e.column_name,r.type=t,r.default=null!==e.column_default&&void 0!==e.column_default?e.column_default:void 0,r.isNullable="YES"===e.is_nullable,r.isGenerated=n,r.comment="",r.isUnique=!!b.find(function(t){return t.constraint_name==="uk_"+e.table_name+"_"+e.column_name}),r}),t.primaryKeys=E.filter(function(e){return e.table_name===t.name}).map(function(e){return new c.PrimaryKeySchema(e.constraint_name,e.column_name)}),t.foreignKeys=v.filter(function(e){return e.table_name===t.name}).map(function(e){return new u.ForeignKeySchema(e.constraint_name,[],[],"","")}),t.indices=g.filter(function(e){return e.table_name===t.name&&!t.foreignKeys.find(function(t){return t.name===e.index_name})&&!t.primaryKeys.find(function(t){return t.name===e.index_name})&&!b.find(function(t){return t.constraint_name===e.index_name})}).map(function(e){return e.index_name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=g.filter(function(e){return e.table_name===t.name&&e.index_name===n}).map(function(e){return e.column_name});return new s.IndexSchema(e.TABLE_NAME,n,r,!1)}),t})]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM information_schema.tables WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),n='CREATE SCHEMA IF NOT EXISTS "'+this.schemaName+'";CREATE TABLE "'+e.name+'" ('+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){return', CONSTRAINT "uk_'+e.name+"_"+t.name+'" UNIQUE ("'+t.name+'")'}).join(" "),r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM information_schema.columns WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name = '"+e+"' AND column_name = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t,!1),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s,s;return __generator(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return i.type===n.type&&i.name===n.name?[3,5]:(s='ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'"',i.type!==n.type&&(s+=" TYPE "+n.type),i.name!==n.name&&(s+=" RENAME TO "+n.name),[4,this.query(s)]);case 4:u.sent(),u.label=5;case 5:return i.isNullable===n.isNullable?[3,7]:(s='ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'"',n.isNullable?s+=" DROP NOT NULL":s+=" SET NOT NULL",[4,this.query(s)]);case 6:u.sent(),u.label=7;case 7:return i.isGenerated===n.isGenerated?[3,13]:i.isGenerated||"uuid"===n.type?[3,10]:[4,this.query('CREATE SEQUENCE "'+r.name+'_id_seq" OWNED BY "'+r.name+'"."'+i.name+'"')];case 8:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'" SET DEFAULT nextval(\'"'+r.name+"_id_seq\"')")];case 9:return u.sent(),[3,13];case 10:return[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'" DROP DEFAULT')];case 11:return u.sent(),[4,this.query('DROP SEQUENCE "'+r.name+'_id_seq"')];case 12:u.sent(),u.label=13;case 13:return i.comment===n.comment?[3,15]:[4,this.query('COMMENT ON COLUMN "'+r.name+'"."'+i.name+"\" is '"+n.comment+"'")];case 14:u.sent(),u.label=15;case 15:return i.isUnique===n.isUnique?[3,19]:!0!==n.isUnique?[3,17]:[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "uk_'+n.name+'" UNIQUE ("'+n.name+'")')];case 16:return u.sent(),[3,19];case 17:return!1!==n.isUnique?[3,19]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "uk_'+n.name+'"')];case 18:u.sent(),u.label=19;case 19:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query('ALTER TABLE "'+n+'" DROP "'+r+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT IF EXISTS "'+e.name+'_pkey"')];case 1:return n.sent(),[4,this.query('DROP INDEX IF EXISTS "'+e.name+'_pkey"')];case 2:return n.sent(),t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ("'+t.columnNames.join('", "')+'") REFERENCES "'+t.referencedTableName+'"("'+t.referencedColumnNames.join('", "')+'")',t.onDelete&&(r+=" ON DELETE "+t.onDelete),[2,this.query(r)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t,n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n?[4,this.query('ALTER SEQUENCE "'+e+'_id_seq" OWNED BY NONE')]:[3,2];case 1:i.sent(),i.label=2;case 2:return r='DROP INDEX "'+t+'"',[4,this.query(r)];case 3:return i.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"character("+(e.length?e.length:255)+")":"character varying("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"boolean";case"integer":case"int":return"integer";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"real";case"double":case"number":return"double precision";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return e.timezone?"time with time zone":"time without time zone";case"datetime":return e.timezone?"timestamp with time zone":"timestamp without time zone";case"json":return"json";case"jsonb":return"jsonb";case"simple_array":return e.length?"character varying("+e.length+")":"text";case"uuid":return"uuid"}throw new i.DataTypeNotSupportedByDriverError(e.type,"Postgres")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=$"+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return!0===e.isGenerated&&"uuid"!==e.type&&(n+=" SERIAL"),e.isGenerated&&"uuid"!==e.type||(n+=" "+e.type),!0!==e.isNullable&&(n+=" NOT NULL"),e.isGenerated&&(n+=" PRIMARY KEY"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?n+=" DEFAULT "+e.default:"boolean"==typeof e.default?n+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?n+=" DEFAULT "+e.default():"string"==typeof e.default?n+=" DEFAULT '"+e.default+"'":n+=" DEFAULT "+e.default),e.isGenerated&&"uuid"===e.type&&!e.default&&(n+=" DEFAULT uuid_generate_v4()"),n},e}(),e("PostgresQueryRunner",d)}}}),System.register("typeorm/driver/postgres/PostgresDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/metadata/types/ColumnTypes","typeorm/driver/postgres/PostgresQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e),this.logger=t,this.postgres=n,this.schemaName=e.schemaName||"public",!this.options.host)throw new s.DriverOptionNotSetError("host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.database)throw new s.DriverOptionNotSetError("database");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{host:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return void 0===this.options.usePool||!0===this.options.usePool?(this.pool=new this.postgres.Pool(t),Promise.resolve()):new Promise(function(n,r){e.databaseConnection={id:1,connection:new e.postgres.Client(t),isTransactionActive:!1},e.databaseConnection.connection.connect(function(t){
t?r(t):e.databaseConnection.connection.query("SET search_path TO '"+e.schemaName+"', 'public';",function(t,i){t?(e.logger.logFailedQuery("SET search_path TO '"+e.schemaName+"', 'public';"),e.logger.logQueryError(t),r(t)):n()})})})},e.prototype.disconnect=function(){var e=this;if(!this.databaseConnection&&!this.pool)throw new n.ConnectionIsNotSetError("postgres");return new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.databaseConnection&&(e.databaseConnection.connection.end(),e.databaseConnection=void 0),e.pool&&(e.databaseConnectionPool.forEach(function(e){e&&e.releaseCallback&&e.releaseCallback()}),e.pool.end(r),e.pool=void 0,e.databaseConnectionPool=[]),t()})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection||this.pool?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("postgres"))];case 1:return e=t.sent(),[2,new a.PostgresQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.postgres,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.pool}},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case o.ColumnTypes.BOOLEAN:return!0===e?1:0;case o.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case o.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case o.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case o.ColumnTypes.JSON:case o.ColumnTypes.JSONB:return JSON.stringify(e);case o.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case o.ColumnTypes.BOOLEAN:return!!e;case o.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case o.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case o.ColumnTypes.JSON:case o.ColumnTypes.JSONB:return e;case o.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):(n.push(r),"$"+n.length)}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(this.pool)return new Promise(function(t,n){e.pool.connect(function(r,i,o){if(r)return void n(r);var a=e.databaseConnectionPool.find(function(e){return e.connection===i});a||(a={id:e.databaseConnectionPool.length,connection:i,isTransactionActive:!1},e.databaseConnectionPool.push(a)),a.releaseCallback=function(){return a&&e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(a),1),o(),Promise.resolve()},a.connection.query("SET search_path TO '"+e.schemaName+"', 'public';",function(r){r?(e.logger.logFailedQuery("SET search_path TO '"+e.schemaName+"', 'public';"),e.logger.logQueryError(r),n(r)):t(a)})})});if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("postgres")},e.prototype.loadDependencies=function(){try{this.postgres=c.PlatformTools.load("pg")}catch(e){throw new r.DriverPackageNotInstalledError("Postgres","pg")}},e}(),e("PostgresDriver",l)}}}),System.register("typeorm/driver/mysql/MysqlQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,8,10,12]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS ', table_name, ';') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return a.sent(),[4,this.query(t)];case 4:return r=a.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 5:return a.sent(),[4,this.query(n)];case 6:return a.sent(),[4,this.commitTransaction()];case 7:return a.sent(),[3,12];case 8:return i=a.sent(),[4,this.rollbackTransaction()];case 9:throw a.sent(),i;case 10:return[4,this.release()];case 11:return a.sent(),[7];case 12:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.query(e,t,function(o,a){if(o)return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o);r(a)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(d){switch(d.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e){return"?"}).join(","),a=r.map(function(e){return t[e]}),s="INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")",[4,this.query(s,a)];case 1:return u=d.sent(),[2,n?u.insertId:void 0]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,m,p,f,y,h,g=this;return __generator(this,function(v){switch(v.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME IN ("+t+")",r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"'",i="SELECT * FROM INFORMATION_SCHEMA.STATISTICS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND INDEX_NAME != 'PRIMARY'",d="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '"+this.dbName+"' AND REFERENCED_COLUMN_NAME IS NOT NULL",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(d)])]):[2,[]];case 1:return m=v.sent(),p=m[0],f=m[1],y=m[2],h=m[3],p.length?[2,Promise.all(p.map(function(e){return __awaiter(g,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=new a.TableSchema(e.TABLE_NAME),[4,this.query("SHOW INDEX FROM `"+e.TABLE_NAME+"` WHERE Key_name = 'PRIMARY'")];case 1:return n=r.sent(),t.columns=f.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var t=new o.ColumnSchema;return t.name=e.COLUMN_NAME,t.type=e.COLUMN_TYPE.toLowerCase(),t.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,t.isNullable="YES"===e.IS_NULLABLE,t.isPrimary=-1!==e.COLUMN_KEY.indexOf("PRI"),t.isUnique=-1!==e.COLUMN_KEY.indexOf("UNI"),t.isGenerated=-1!==e.EXTRA.indexOf("auto_increment"),t.comment=e.COLUMN_COMMENT,t}),t.primaryKeys=n.map(function(e){return new u.PrimaryKeySchema(e.Key_name,e.Column_name)}),t.foreignKeys=h.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new s.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=y.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=y.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}),i=r.map(function(e){return e.COLUMN_NAME});if(1===r.length&&0===r[0].NON_UNIQUE){var o=t.columns.find(function(e){return e.name===r[0].INDEX_NAME&&e.name===r[0].COLUMN_NAME});if(o)return void(o.isUnique=!0)}return new c.IndexSchema(e.TABLE_NAME,n,i,!1)}).filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),n="CREATE TABLE `"+e.name+"` ("+t,r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return"`"+e.name+"`"}).join(", ")+")"),n+=") ENGINE=InnoDB;",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t="DROP TABLE `"+e+"`",[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r="ALTER TABLE `"+n+"` ADD "+this.buildCreateColumnSql(t,!1),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(s){switch(s.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=s.sent(),s.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return!1!==n.isUnique||!0!==i.isUnique?[3,5]:[4,this.query("ALTER TABLE `"+r.name+"` DROP INDEX `"+i.name+"`")];case 4:s.sent(),s.label=5;case 5:return[2,this.query("ALTER TABLE `"+r.name+"` CHANGE `"+i.name+"` "+this.buildCreateColumnSql(n,i.isPrimary))]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query("ALTER TABLE `"+n+"` DROP `"+r+"`")]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e.hasGeneratedColumn?[3,2]:[4,this.query("ALTER TABLE "+e.name+" DROP PRIMARY KEY")];case 1:n.sent(),n.label=2;case 2:return t=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}).map(function(e){return"`"+e.name+"`"}),t.length>0?[4,this.query("ALTER TABLE "+e.name+" ADD PRIMARY KEY ("+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(s){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),i=t.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),o="ALTER TABLE `"+n+"` ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+r+") REFERENCES `"+t.referencedTableName+"`("+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.query(o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,[2,this.query("ALTER TABLE `"+n+"` DROP FOREIGN KEY `"+t.name+"`")]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE ":"")+"INDEX `"+t.name+"` ON `"+e+"`("+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n="ALTER TABLE `"+e+"` DROP INDEX `"+t+"`",[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"char("+(e.length?e.length:255)+")":"varchar("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"tinyint(1)";case"integer":case"int":return"int("+(e.length?e.length:11)+")";case"smallint":return"smallint("+(e.length?e.length:11)+")";case"bigint":return"bigint("+(e.length?e.length:11)+")";case"float":return"float";case"double":case"number":return"double";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return"time";case"datetime":return"datetime";case"json":return"text";case"simple_array":return e.length?"varchar("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"MySQL/MariaDB")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){var t=this;return Object.keys(e).map(function(e){return t.driver.escapeColumnName(e)+"=?"})},e.prototype.buildCreateColumnSql=function(e,t){var n="`"+e.name+"` "+e.type;return!0!==e.isNullable&&(n+=" NOT NULL"),!0===e.isUnique&&(n+=" UNIQUE"),e.isGenerated&&e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&(n+=" AUTO_INCREMENT"),e.comment&&(n+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?n+=" DEFAULT "+e.default:"boolean"==typeof e.default?n+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?n+=" DEFAULT "+e.default():"string"==typeof e.default?n+=" DEFAULT '"+e.default+"'":n+=" DEFAULT "+e.default),n},e}(),e("MysqlQueryRunner",d)}}}),System.register("typeorm/driver/mysql/MysqlDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/mysql/MysqlQueryRunner","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e),this.logger=t,this.mysql=n,!(this.options.host||this.options.extra&&this.options.extra.socketPath))throw new s.DriverOptionNotSetError("socketPath and host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.database)throw new s.DriverOptionNotSetError("database");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{host:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return void 0===this.options.usePool||!0===this.options.usePool?(this.pool=this.mysql.createPool(t),Promise.resolve()):new Promise(function(n,r){var i=e.mysql.createConnection(t);e.databaseConnection={id:1,connection:i,isTransactionActive:!1},e.databaseConnection.connection.connect(function(e){return e?r(e):n()})})},e.prototype.disconnect=function(){var e=this;if(!this.databaseConnection&&!this.pool)throw new n.ConnectionIsNotSetError("mysql");return new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.pool&&(e.pool.end(r),e.pool=void 0,e.databaseConnectionPool=[]),e.databaseConnection&&(e.databaseConnection.connection.end(r),e.databaseConnection=void 0)})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection||this.pool?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("mysql"))];case 1:return e=t.sent(),[2,new o.MysqlQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.mysql,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.pool}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),"?"}),[e,n]},e.prototype.escapeColumnName=function(e){return"`"+e+"`"},e.prototype.escapeAliasName=function(e){return"`"+e+"`"},e.prototype.escapeTableName=function(e){return"`"+e+"`"},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case a.ColumnTypes.BOOLEAN:return!0===e?1:0;case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case a.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case a.ColumnTypes.JSON:return JSON.stringify(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case a.ColumnTypes.BOOLEAN:return!!e;case a.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case a.ColumnTypes.JSON:return JSON.parse(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(this.pool)return new Promise(function(t,n){e.pool.getConnection(function(r,i){if(r)return n(r);var o=e.databaseConnectionPool.find(function(e){return e.connection===i});o||(o={id:e.databaseConnectionPool.length,connection:i,isTransactionActive:!1},o.releaseCallback=function(){return e.pool&&o&&(i.release(),e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(o),1)),Promise.resolve()},e.databaseConnectionPool.push(o)),t(o)})});if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("mysql")},e.prototype.loadDependencies=function(){try{this.mysql=c.PlatformTools.load("mysql")}catch(e){try{this.mysql=c.PlatformTools.load("mysql2")}catch(e){throw new r.DriverPackageNotInstalledError("Mysql","mysql")}}},e}(),e("MysqlDriver",l)}}}),System.register("typeorm/query-builder/error/LockNotSupportedOnGivenDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on giver driver.",n}return __extends(t,e),t}(Error),e("LockNotSupportedOnGivenDriverError",n)}}}),System.register("typeorm/driver/oracle/OracleQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,8,10,12]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS ', table_name, ';') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return a.sent(),[4,this.query(t)];case 4:return r=a.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 5:return a.sent(),[4,this.query(n)];case 6:return a.sent(),[4,this.commitTransaction()];case 7:return a.sent(),[3,12];case 8:return i=a.sent(),[4,this.rollbackTransaction()];case 9:throw a.sent(),i;case 10:return[4,this.release()];case 11:return a.sent(),[7];case 12:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t);var o=function(o,a){if(o)return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o);r(a.rows||a.outBinds)},a={autoCommit:!n.databaseConnection.isTransactionActive};n.databaseConnection.connection.execute(e,t||{},a,o)})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c,d=this;return __generator(this,function(m){switch(m.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),(i=r.map(function(e){return d.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e){return":"+e}).join(", "),a=r.map(function(e){return t[e]}),s=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES",n)?(u="declare lastId number; begin "+s+' returning "id" into lastId; dbms_output.enable; dbms_output.put_line(lastId); dbms_output.get_line(:ln, :st); end;',[4,this.query(u,a.concat([{dir:this.driver.oracle.BIND_OUT,
type:this.driver.oracle.STRING,maxSize:32767},{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.NUMBER}]))]):[3,2];case 1:return c=m.sent(),[2,parseInt(c[0])];case 2:return[2,this.query(s,a)]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,m,p,f,y,h,g,v;return __generator(this,function(b){switch(b.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME IN ("+t+")",r="SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, IDENTITY_COLUMN FROM all_tab_cols WHERE TABLE_NAME IN ("+t+")",i="SELECT ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS, LISTAGG(cols.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY cols.COLUMN_NAME) AS COLUMN_NAMES\n                                FROM USER_INDEXES ind, USER_IND_COLUMNS cols \n                                WHERE ind.INDEX_NAME = cols.INDEX_NAME AND ind.TABLE_NAME IN ("+t+")\n                                GROUP BY ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS",d="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '"+this.dbName+"' AND REFERENCED_COLUMN_NAME IS NOT NULL",m="SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND CONSTRAINT_TYPE = 'UNIQUE'",p="SELECT cols.table_name, cols.column_name, cols.position, cons.constraint_type, cons.constraint_name\nFROM all_constraints cons, all_cons_columns cols WHERE cols.table_name IN ("+t+") \nAND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner ORDER BY cols.table_name, cols.position",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(p)])]):[2,[]];case 1:return f=b.sent(),y=f[0],h=f[1],g=f[2],v=f[3],y.length?[2,y.map(function(e){var t=new a.TableSchema(e.TABLE_NAME);return t.columns=h.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!v.find(function(n){return n.TABLE_NAME===t.name&&"P"===n.CONSTRAINT_TYPE&&n.COLUMN_NAME===e.COLUMN_NAME}),r=e.DATA_TYPE.toLowerCase();"varchar2"===e.DATA_TYPE.toLowerCase()&&null!==e.DATA_LENGTH?r+="("+e.DATA_LENGTH+")":null!==e.DATA_PRECISION&&null!==e.DATA_SCALE?r+="("+e.DATA_PRECISION+","+e.DATA_SCALE+")":null!==e.DATA_SCALE?r+="(0,"+e.DATA_SCALE+")":null!==e.DATA_PRECISION&&(r+="("+e.DATA_PRECISION+")");var i=new o.ColumnSchema;return i.name=e.COLUMN_NAME,i.type=r,i.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,i.isNullable="N"!==e.NULLABLE,i.isPrimary=n,i.isGenerated="YES"===e.IDENTITY_COLUMN,i.comment="",i}),t.primaryKeys=v.filter(function(e){return e.TABLE_NAME===t.name&&"P"===e.CONSTRAINT_TYPE}).map(function(e){return new u.PrimaryKeySchema(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=v.filter(function(e){return e.TABLE_NAME===t.name&&"R"===e.CONSTRAINT_TYPE}).map(function(e){return new s.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=g.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(t){return new c.IndexSchema(e.TABLE_NAME,t.INDEX_NAME,t.COLUMN_NAMES,!("UNIQUE"!==t.COLUMN_NAMES))}),t})]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,r=e.columns.filter(function(e){return e.isPrimary}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT COLUMN_NAME FROM all_tab_cols WHERE TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s,u,c,d,d,d;return __generator(this,function(m){switch(m.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=m.sent(),m.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return n.isGenerated===i.isGenerated?[3,10]:n.isGenerated?r.primaryKeys.length>0&&i.isPrimary?(s='ALTER TABLE "'+r.name+'" DROP CONSTRAINT "'+r.primaryKeys[0].name+'"',[4,this.query(s)]):[3,5]:[3,8];case 4:m.sent(),m.label=5;case 5:return u='ALTER TABLE "'+r.name+'" DROP COLUMN "'+n.name+'"',[4,this.query(u)];case 6:return m.sent(),c='ALTER TABLE "'+r.name+'" ADD '+this.buildCreateColumnSql(n),[4,this.query(c)];case 7:return m.sent(),[3,10];case 8:return d='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" DROP IDENTITY',[4,this.query(d)];case 9:m.sent(),m.label=10;case 10:return n.isNullable===i.isNullable?[3,12]:(d='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" '+n.type+" "+(n.isNullable?"NULL":"NOT NULL"),[4,this.query(d)]);case 11:return m.sent(),[3,14];case 12:return n.type===i.type?[3,14]:(d='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" '+n.type,[4,this.query(d)]);case 13:m.sent(),m.label=14;case 14:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query('ALTER TABLE "'+n+'" DROP COLUMN "'+r+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),e.primaryKeys.length>0&&e.primaryKeys[0].name?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+e.primaryKeys[0].name+'"')]:[3,2];case 1:n.sent(),n.label=2;case 2:return t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(s){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),o='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.query(o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE":"")+' INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n='ALTER TABLE "'+e+'" DROP INDEX "'+t+'"',[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"char("+(e.length?e.length:255)+")":"varchar2("+(e.length?e.length:255)+")";case"text":return"clob";case"boolean":return"number(1)";case"integer":case"int":return e.precision&&e.scale?"number("+e.precision+","+e.scale+")":e.precision?"number("+e.precision+",0)":e.scale?"number(0,"+e.scale+")":"number(10,0)";case"smallint":return"number(5)";case"bigint":return"number(20)";case"float":return e.precision&&e.scale?"float("+e.precision+","+e.scale+")":e.precision?"float("+e.precision+",0)":e.scale?"float(0,"+e.scale+")":"float(126)";case"double":case"number":return"float(126)";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal(0,"+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":case"time":return"date";case"datetime":return"timestamp(0)";case"json":return"clob";case"simple_array":return e.length?"varchar2("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"Oracle")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.schemaName},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){var t=this;return Object.keys(e).map(function(e){return t.driver.escapeColumnName(e)+"=:"+e})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+e.type;return!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&(t+=" GENERATED BY DEFAULT ON NULL AS IDENTITY"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?t+=" DEFAULT "+e.default:"boolean"==typeof e.default?t+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?t+=" DEFAULT "+e.default():"string"==typeof e.default?t+=" DEFAULT '"+e.default+"'":t+=" DEFAULT "+e.default),t},e}(),e("OracleQueryRunner",d)}}}),System.register("typeorm/driver/oracle/OracleDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/oracle/OracleQueryRunner","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e,{useSid:!0}),this.logger=t,this.oracle=n,!this.options.host)throw new s.DriverOptionNotSetError("host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.sid)throw new s.DriverOptionNotSetError("sid");n||this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){var e=this,t=Object.assign({},{user:this.options.username,password:this.options.password,connectString:this.options.host+":"+this.options.port+"/"+this.options.sid},this.options.extra||{});return void 0===this.options.usePool||!0===this.options.usePool?new Promise(function(n,r){e.oracle.createPool(t,function(t,i){if(t)return r(t);e.pool=i,n()})}):new Promise(function(n,r){e.oracle.getConnection(t,function(t,i){if(t)return r(t);e.databaseConnection={id:1,connection:i,isTransactionActive:!1},e.databaseConnection.connection.connect(function(e){return e?r(e):n()})})})},e.prototype.disconnect=function(){var e=this;if(!this.databaseConnection&&!this.pool)throw new n.ConnectionIsNotSetError("oracle");return new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.pool&&(e.pool.close(r),e.pool=void 0,e.databaseConnectionPool=[]),e.databaseConnection&&(e.databaseConnection.connection.close(r),e.databaseConnection=void 0)})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection||this.pool?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("oracle"))];case 1:return e=t.sent(),[2,new o.OracleQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.oracle,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.pool}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),e}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case a.ColumnTypes.BOOLEAN:return!0===e?1:0;case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case a.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case a.ColumnTypes.JSON:return JSON.stringify(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case a.ColumnTypes.BOOLEAN:return!!e;case a.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case a.ColumnTypes.JSON:return JSON.parse(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(this.pool)return new Promise(function(t,n){e.pool.getConnection(function(r,i){if(r)return n(r);var o=e.databaseConnectionPool.find(function(e){return e.connection===i});o||(o={id:e.databaseConnectionPool.length,connection:i,isTransactionActive:!1},o.releaseCallback=function(){return new Promise(function(t,n){i.close(function(r){if(r)return n(r);e.pool&&o&&e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(o),1),t()})})},e.databaseConnectionPool.push(o)),t(o)})});if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("oracle")},e.prototype.loadDependencies=function(){try{this.oracle=c.PlatformTools.load("oracledb")}catch(e){throw new r.DriverPackageNotInstalledError("Oracle","oracledb")}},e}(),e("OracleDriver",l)}}}),System.register("typeorm/query-builder/QueryBuilder",["typeorm/query-builder/alias/Alias","typeorm/query-builder/alias/AliasMap","typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer","typeorm/driver/sqlserver/SqlServerDriver","typeorm/query-runner/QueryRunnerProvider","typeorm/query-builder/error/PessimisticLockTransactionRequiredError","typeorm/query-builder/error/NoVersionOrUpdateDateColumnError","typeorm/query-builder/error/OptimisticLockVersionMismatchError","typeorm/query-builder/error/OptimisticLockCanNotBeUsedError","typeorm/driver/postgres/PostgresDriver","typeorm/driver/mysql/MysqlDriver","typeorm/query-builder/error/LockNotSupportedOnGivenDriverError","typeorm/driver/oracle/OracleDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,m,p,f,y;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){m=e},function(e){p=e},function(e){f=e}],execute:function(){y=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t,this.type="select",this.selects=[],this.joins=[],this.joinRelationIds=[],this.relationCountMetas=[],this.groupBys=[],this.wheres=[],this.havings=[],this.orderBys={},this.parameters={},this.enableQuoting=!0,this.ignoreParentTablesJoins=!1,this.enableRelationIdValues=!1,this.aliasMap=new r.AliasMap(e)}return Object.defineProperty(e.prototype,"alias",{get:function(){return this.aliasMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.disableQuoting=function(){return this.enableQuoting=!1,this},e.prototype.delete=function(){return this.type="delete",this},e.prototype.update=function(e,t){var r=t||e;if(e instanceof Function){var i=e.name,o=new n.Alias(i);o.metadata=this.connection.getMetadata(e),this.aliasMap.addMainAlias(o),this.fromEntity={alias:o}}else"string"==typeof e&&(this.fromTableName=e);return this.type="update",this.updateQuerySet=r,this},e.prototype.select=function(e){return this.type="select",e&&(e instanceof Array?this.selects=e:this.selects=[e]),this},e.prototype.addSelect=function(e){return e instanceof Array?this.selects=this.selects.concat(e):this.selects.push(e),this},e.prototype.setLock=function(e,t){return this.lockMode=e,this.lockVersion=t,this},e.prototype.from=function(e,t){var r=new n.Alias(t);return r.metadata=this.connection.getMetadata(e),this.aliasMap.addMainAlias(r),this.fromEntity={alias:r},this},e.prototype.fromTable=function(e,t){return this.fromTableName=e,this.fromTableAlias=t,this},e.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r)},e.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r)},e.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.join("INNER",e,t,n,r)},e.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.join("LEFT",e,t,n,r)},e.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0)},e.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1)},e.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0)},e.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1)},e.prototype.leftJoinRelationId=function(e,t){return this.joinRelationId("LEFT",void 0,e,t)},e.prototype.innerJoinRelationId=function(e,t){return this.joinRelationId("INNER",void 0,e,t)},e.prototype.leftJoinRelationIdAndMap=function(e,t,n){return void 0===n&&(n=""),this.joinRelationId("INNER",e,t,n)},e.prototype.innerJoinRelationIdAndMap=function(e,t,n){return void 0===n&&(n=""),this.joinRelationId("INNER",e,t,n)},e.prototype.countRelation=function(e,t){void 0===t&&(t="");var r=e.split("."),i=r[0],o=r[1],a=i+"_"+o+"_relation_count",s=new n.Alias(a);this.aliasMap.addAlias(s),s.parentAliasName=i,s.parentPropertyName=o;var u={condition:t,alias:s,entities:[]};return this.relationCountMetas.push(u),this},e.prototype.countRelationAndMap=function(e,t,r){void 0===r&&(r="");var i=t.split("."),o=i[0],a=i[1],s=o+"_"+a+"_relation_count",u=new n.Alias(s);this.aliasMap.addAlias(u),u.parentAliasName=o,u.parentPropertyName=a;var c={mapToProperty:e,condition:r,alias:u,entities:[]};return this.relationCountMetas.push(c),this},e.prototype.where=function(e,t){return this.wheres.push({type:"simple",condition:e}),t&&this.setParameters(t),this},e.prototype.andWhere=function(e,t){return this.wheres.push({type:"and",condition:e}),t&&this.setParameters(t),this},e.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},e.prototype.orWhere=function(e,t){return this.wheres.push({type:"or",condition:e}),t&&this.setParameters(t),this},e.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},e.prototype.having=function(e,t){return this.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},e.prototype.andHaving=function(e,t){return this.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},e.prototype.orHaving=function(e,t){return this.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},e.prototype.groupBy=function(e){return this.groupBys=[e],this},e.prototype.addGroupBy=function(e){return this.groupBys.push(e),this},e.prototype.orderBy=function(e,t){return void 0===t&&(t="ASC"),this.orderBys=(n={},n[e]=t,n),this;var n},e.prototype.addOrderBy=function(e,t){return void 0===t&&(t="ASC"),this.orderBys[e]=t,this},e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setOffset=function(e){return this.offset=e,this},e.prototype.take=function(e){return this.takeNumber=e,this},e.prototype.skip=function(e){return this.skipNumber=e,this},e.prototype.setParameter=function(e,t){return this.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach(function(n){t.parameters[n]=e[n]}),this},e.prototype.addParameters=function(e){var t=this;return Object.keys(e).forEach(function(n){t.parameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.parameters);if(!this.fromTableName){var t=this.connection.getMetadata(this.aliasMap.mainAlias.target);t.hasDiscriminatorColumn&&(e.discriminatorColumnValue=t.discriminatorValue)}return e},e.prototype.getSql=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createJoinRelationIdsExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e+=this.createOffsetExpression(),e+=this.createLockExpression(),e=this.connection.driver.escapeQueryWithParameters(e,this.parameters)[0],e.trim()},e.prototype.getGeneratedQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createJoinRelationIdsExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e+=this.createOffsetExpression(),e+=this.createLockExpression(),e.trim()},e.prototype.getSqlWithParameters=function(e){var t=this.createSelectExpression();return t+=this.createJoinExpression(),t+=this.createJoinRelationIdsExpression(),t+=this.createWhereExpression(),t+=this.createGroupByExpression(),t+=this.createHavingExpression(),e&&e.skipOrderBy||(t+=this.createOrderByExpression()),t+=this.createLimitExpression(),t+=this.createOffsetExpression(),t+=this.createLockExpression(),this.connection.driver.escapeQueryWithParameters(t,this.getParameters())},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getQueryRunner()];case 1:e=i.sent(),t=this.getSqlWithParameters(),n=t[0],r=t[1],i.label=2;case 2:return i.trys.push([2,,4,7]),[4,e.query(n,r)];case 3:return[2,i.sent()];case 4:return this.hasOwnQueryRunner()?[4,e.release()]:[3,6];case 5:i.sent(),i.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.getEntitiesAndRawResults=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,a,c,l,d,m,p,y,h,g,a,c,v=this;return __generator(this,function(b){switch(b.label){case 0:return[4,this.getQueryRunner()];case 1:e=b.sent(),b.label=2;case 2:if(b.trys.push([2,,7,10]),!this.aliasMap.hasMainAlias)throw new Error("Alias is not set. Looks like nothing is selected. Use select*, delete, update method to set an alias.");if(("pessimistic_read"===this.lockMode||"pessimistic_write"===this.lockMode)&&!e.isTransactionActive())throw new s.PessimisticLockTransactionRequiredError;if("optimistic"===this.lockMode&&(t=this.connection.getMetadata(this.aliasMap.mainAlias.target),!t.hasVersionColumn&&!t.hasUpdateDateColumn))throw new u.NoVersionOrUpdateDateColumnError(t.name);return n=this.fromTableName?this.fromTableName:this.aliasMap.mainAlias.name,this.skipNumber||this.takeNumber?(i=this.getSqlWithParameters({skipOrderBy:!0}),a=i[0],c=i[1],l=this.createOrderByCombinedWithSelectExpression("distinctAlias"),d=l[0],m=l[1],p=this.escapeTable("distinctAlias"),y=this.connection.getMetadata(this.fromEntity.alias.target),h="SELECT ",this.connection.driver instanceof f.OracleDriver&&(h+="rownum rn,"),h+=y.primaryColumns.map(function(e,t){var r=v.escapeAlias(n+"_"+e.fullName);return 0===t?"DISTINCT("+p+"."+r+") as ids_"+e.fullName:p+"."+r+") as ids_"+e.fullName}).join(", "),d.length>0&&(h+=", "+d),h+=" FROM ("+a+") "+p,m.length>0?h+=" ORDER BY "+m:h+=' ORDER BY "ids_'+y.firstPrimaryColumn.fullName+'"',this.connection.driver instanceof o.SqlServerDriver?(this.skipNumber||this.takeNumber)&&(h+=" OFFSET "+(this.skipNumber||0)+" ROWS",this.takeNumber&&(h+=" FETCH NEXT "+this.takeNumber+" ROWS ONLY")):this.connection.driver instanceof f.OracleDriver?(this.skipNumber||this.takeNumber)&&(h="SELECT * FROM ("+h+") WHERE rn >= "+(this.skipNumber||0),this.takeNumber&&(h+=" AND rn <= "+(this.skipNumber+this.takeNumber))):(this.takeNumber&&(h+=" LIMIT "+this.takeNumber),this.skipNumber&&(h+=" OFFSET "+this.skipNumber)),[4,e.query(h,c).then(function(t){if(r=t,0===t.length)return[];var i="",o={};if(y.hasMultiplePrimaryKeys)i=t.map(function(e){return y.primaryColumns.map(function(t){return o["ids_"+t.propertyName]=e["ids_"+t.propertyName],n+"."+t.propertyName+"=:ids_"+t.propertyName}).join(" AND ")}).join(" OR ");else{var a=t.map(function(e){return e["ids_"+y.firstPrimaryColumn.propertyName]});a.map(function(e){return"number"==typeof e})?i=n+"."+y.firstPrimaryColumn.propertyName+" IN ("+a.join(", ")+")":(o.ids=a,i=n+"."+y.firstPrimaryColumn.propertyName+" IN (:ids)")}var s=v.clone({queryRunnerProvider:v.queryRunnerProvider}).andWhere(i,o).getSqlWithParameters(),u=s[0],c=s[1];return e.query(u,c)}).then(function(e){return v.rawResultsToEntities(e)}).then(function(t){return v.loadRelationCounts(e,t).then(function(e){return t})}).then(function(e){
return v.fromTableName?e:v.connection.broadcaster.broadcastLoadEventsForAll(v.aliasMap.mainAlias.target,e).then(function(){return e})}).then(function(e){return{entities:e,rawResults:r}})]):[3,4];case 3:return[2,b.sent()];case 4:return g=this.getSqlWithParameters(),a=g[0],c=g[1],[4,e.query(a,c).then(function(e){return r=e,v.rawResultsToEntities(e)}).then(function(t){return v.loadRelationCounts(e,t).then(function(e){return t})}).then(function(e){return v.fromTableName?e:v.connection.broadcaster.broadcastLoadEventsForAll(v.aliasMap.mainAlias.target,e).then(function(){return e})}).then(function(e){return{entities:e,rawResults:r}})];case 5:return[2,b.sent()];case 6:return[3,10];case 7:return this.hasOwnQueryRunner()?[4,e.release()]:[3,9];case 8:b.sent(),b.label=9;case 9:return[7];case 10:return[2]}})})},e.prototype.getCount=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s,u,c,d=this;return __generator(this,function(m){switch(m.label){case 0:if("optimistic"===this.lockMode)throw new l.OptimisticLockCanNotBeUsedError;return[4,this.getQueryRunner()];case 1:e=m.sent(),t=this.fromTableName?this.fromTableName:this.aliasMap.mainAlias.name,n=this.connection.getMetadata(this.fromEntity.alias.target),r=this.escapeAlias(t),i="COUNT("+n.primaryColumnsWithParentIdColumns.map(function(e,t){var n=d.escapeColumn(e.fullName);return 0===t?"DISTINCT("+r+"."+n+")":r+"."+n+")"}).join(", ")+") as cnt",o=this.clone({queryRunnerProvider:this.queryRunnerProvider,skipOrderBys:!0,ignoreParentTablesJoins:!0,skipLimit:!0,skipOffset:!0}).select(i),a=o.getSqlWithParameters(),s=a[0],u=a[1],m.label=2;case 2:return m.trys.push([2,,4,7]),[4,e.query(s,u)];case 3:return c=m.sent(),c&&c[0]&&c[0].cnt&&c[0].CNT?[2,parseInt(c[0].cnt?c[0].cnt:c[0].CNT)]:[2,0];case 4:return this.hasOwnQueryRunner()?[4,e.release()]:[3,6];case 5:m.sent(),m.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.getRawMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if("optimistic"===this.lockMode)throw new l.OptimisticLockCanNotBeUsedError;return[2,this.execute()]})})},e.prototype.getRawOne=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.lockMode)throw new l.OptimisticLockCanNotBeUsedError;return[4,this.execute()];case 1:return e=t.sent(),[2,e[0]]}})})},e.prototype.getManyAndCount=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if("optimistic"===this.lockMode)throw new l.OptimisticLockCanNotBeUsedError;return[2,Promise.all([this.getMany(),this.getCount()])]})})},e.prototype.getMany=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.lockMode)throw new l.OptimisticLockCanNotBeUsedError;return[4,this.getEntitiesAndRawResults()];case 1:return e=t.sent(),[2,e.entities]}})})},e.prototype.getOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getEntitiesAndRawResults()];case 1:if(e=i.sent(),(t=e.entities[0])&&"optimistic"===this.lockMode&&this.lockVersion)if(n=this.connection.getMetadata(this.fromEntity.alias.target),this.lockVersion instanceof Date){if(r=t[n.updateDateColumn.propertyName],this.lockVersion.setMilliseconds(0),r.getTime()!==this.lockVersion.getTime())throw new c.OptimisticLockVersionMismatchError(n.name,this.lockVersion,r)}else if((r=t[n.versionColumn.propertyName])!==this.lockVersion)throw new c.OptimisticLockVersionMismatchError(n.name,this.lockVersion,r);return[2,t]}})})},e.prototype.clone=function(t){var n=this,r=new e(this.connection,t?t.queryRunnerProvider:void 0);switch(t&&t.ignoreParentTablesJoins&&(r.ignoreParentTablesJoins=t.ignoreParentTablesJoins),this.type){case"select":r.select(this.selects);break;case"update":r.update(this.updateQuerySet);break;case"delete":r.delete()}return this.fromEntity&&this.fromEntity.alias&&this.fromEntity.alias.target?r.from(this.fromEntity.alias.target,this.fromEntity.alias.name):this.fromTableName&&r.fromTable(this.fromTableName,this.fromTableAlias),this.joins.forEach(function(e){var t=e.tableName||e.alias.target;e.alias.parentAliasName&&e.alias.parentPropertyName&&(t=e.alias.parentAliasName+"."+e.alias.parentPropertyName),r.join(e.type,t,e.alias.name,e.condition||"",void 0,e.mapToProperty,e.isMappingMany)}),this.groupBys.forEach(function(e){return r.addGroupBy(e)}),this.wheres.forEach(function(e){switch(e.type){case"simple":r.where(e.condition);break;case"and":r.andWhere(e.condition);break;case"or":r.orWhere(e.condition)}}),this.havings.forEach(function(e){switch(e.type){case"simple":r.having(e.condition);break;case"and":r.andHaving(e.condition);break;case"or":r.orHaving(e.condition)}}),t&&t.skipOrderBys||Object.keys(this.orderBys).forEach(function(e){return r.addOrderBy(e,n.orderBys[e])}),Object.keys(this.parameters).forEach(function(e){return r.setParameter(e,n.parameters[e])}),t&&t.skipLimit||r.setLimit(this.limit),t&&t.skipOffset||r.setOffset(this.offset),r.skip(this.skipNumber).take(this.takeNumber),r},e.prototype.escapeAlias=function(e){return this.enableQuoting?this.connection.driver.escapeAliasName(e):e},e.prototype.escapeColumn=function(e){return this.enableQuoting?this.connection.driver.escapeColumnName(e):e},e.prototype.escapeTable=function(e){return this.enableQuoting?this.connection.driver.escapeTableName(e):e},e.prototype.enableOption=function(e){switch(e){case"RELATION_ID_VALUES":this.enableRelationIdValues=!0}return this},e.prototype.loadRelationCounts=function(t,n){var r=this,i=this.relationCountMetas.map(function(t){var n=t.alias.parentAliasName,i=r.aliasMap.findAliasByName(n);if(!i)throw new Error('Alias "'+n+'" was not found');var o=r.aliasMap.getEntityMetadataByAlias(i);if(!o)throw new Error("Cannot get entity metadata for the given alias "+i.name);var a=o.findRelationWithPropertyName(t.alias.parentPropertyName),s=new e(r.connection,r.queryRunnerProvider),u=r.aliasMap.getEntityMetadataByAlias(t.alias);if(!u)throw new Error("Cannot get entity metadata for the given alias "+t.alias.name);var c=(u.table.name,a.junctionEntityMetadata,t.condition&&r.replacePropertyNames(t.condition),t.entities.map(function(e){return e.metadata.getEntityIdMap(e.entity)}).filter(function(e){return void 0!==e}).map(function(e){return e[o.primaryColumn.propertyName]}));return c&&c.length?s.select(o.name+"."+o.primaryColumn.propertyName+" AS id").addSelect("COUNT("+r.escapeAlias(a.propertyName)+"."+r.escapeColumn(a.inverseEntityMetadata.primaryColumn.fullName)+") as cnt").from(o.target,o.name).leftJoin(o.name+"."+a.propertyName,a.propertyName,t.condition).setParameters(r.parameters).where(o.name+"."+o.primaryColumn.propertyName+" IN (:relationCountIds)",{relationCountIds:c}).groupBy(o.name+"."+o.primaryColumn.propertyName).getRawMany().then(function(e){t.entities.forEach(function(n){var i=n.entity[n.metadata.primaryColumn.propertyName],o=e.find(function(e){return i===r.connection.driver.prepareHydratedValue(e.id,n.metadata.primaryColumn)});if(o)if(t.mapToProperty){var s=t.mapToProperty.split("."),u=(s[0],s[1]);n.entity[u]=parseInt(o.cnt)}else a.countField&&(n.entity[a.countField]=parseInt(o.cnt))})}):Promise.resolve()});return Promise.all(i)},e.prototype.rawResultsToEntities=function(e){return new i.RawSqlResultsToEntityTransformer(this.connection.driver,this.aliasMap,this.extractJoinMappings(),this.relationCountMetas,this.enableRelationIdValues).transform(e)},e.prototype.buildEscapedEntityColumnSelects=function(e){var t=this;return(this.selects.some(function(t){return t===e.name})?e.metadata.columns:e.metadata.columns.filter(function(n){return t.selects.some(function(t){return t===e.name+"."+n.propertyName})})).map(function(n){return t.escapeAlias(e.name)+"."+t.escapeColumn(n.fullName)+" AS "+t.escapeAlias(e.name+"_"+n.fullName)})},e.prototype.findEntityColumnSelects=function(e){var t=this.selects.find(function(t){return t===e.name});return t?[t]:this.selects.filter(function(t){return e.metadata.columns.some(function(n){return t===e.name+"."+n.propertyName})})},e.prototype.createSelectExpression=function(){var e,t=this,n="",r=[],i=[];if(this.fromTableName)e=this.fromTableName,n=this.fromTableAlias;else{if(!this.fromEntity)throw new Error("No from given");if(!this.fromEntity.alias.metadata)throw new Error("Cannot get entity metadata for the given alias "+this.fromEntity.alias.name);e=this.fromEntity.alias.metadata.table.name,n=this.fromEntity.alias.name,r.push.apply(r,this.buildEscapedEntityColumnSelects(this.aliasMap.mainAlias)),i.push.apply(i,this.findEntityColumnSelects(this.aliasMap.mainAlias))}if(this.joins.forEach(function(e){if(e.alias.metadata)r.push.apply(r,t.buildEscapedEntityColumnSelects(e.alias)),i.push.apply(i,t.findEntityColumnSelects(e.alias));else{t.selects.some(function(t){return t===e.alias.name})&&(r.push(t.escapeAlias(e.alias.name)+".*"),i.push(e.alias.name))}}),!this.ignoreParentTablesJoins&&!this.fromTableName&&this.aliasMap.mainAlias.metadata.parentEntityMetadata&&this.aliasMap.mainAlias.metadata.parentIdColumns){var a="parentIdColumn_"+this.escapeAlias(this.aliasMap.mainAlias.metadata.parentEntityMetadata.table.name);this.aliasMap.mainAlias.metadata.parentEntityMetadata.columns.forEach(function(e){r.push(a+"."+t.escapeColumn(e.fullName)+" AS "+a+"_"+t.escapeAlias(e.fullName))})}this.joinRelationIds.forEach(function(e){var n=e.alias.parentAliasName,i=t.aliasMap.findAliasByName(n);if(!i)throw new Error('Alias "'+n+'" was not found');if(!i.metadata)throw new Error("Cannot get entity metadata for the given alias "+i.name);i.metadata.findRelationWithPropertyName(e.alias.parentPropertyName).junctionEntityMetadata.columns.forEach(function(n){r.push(t.escapeAlias(e.alias.name)+"."+t.escapeColumn(n.fullName)+" AS "+t.escapeAlias(e.alias.name+"_"+n.fullName))})}),this.selects.filter(function(e){return-1===i.indexOf(e)}).forEach(function(e){return r.push(t.replacePropertyNames(e))}),0===r.length&&r.push("*");var s="";if(this.connection.driver instanceof o.SqlServerDriver)switch(this.lockMode){case"pessimistic_read":s=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":s=" WITH (UPDLOCK, ROWLOCK)"}switch(this.type){case"select":return"SELECT "+r.join(", ")+" FROM "+this.escapeTable(e)+" "+this.escapeAlias(n)+s;case"delete":return"DELETE FROM "+this.escapeTable(e);case"update":var u=Object.keys(this.updateQuerySet).map(function(e){return e+"=:updateQuerySet_"+e}),c=Object.keys(this.updateQuerySet).reduce(function(e,n){return e["updateQuerySet_"+n]=t.updateQuerySet[n],e},{});return this.setParameters(c),"UPDATE "+e+" "+(n?this.escapeAlias(n):"")+" SET "+u}throw new Error("No query builder type is specified.")},e.prototype.createHavingExpression=function(){var e=this;if(!this.havings||!this.havings.length)return"";var t=this.havings.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");return t.length?" HAVING "+t:""},e.prototype.createWhereExpression=function(){var e=this,t=this.wheres.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");if(!this.fromTableName){var n=this.connection.getMetadata(this.aliasMap.mainAlias.target);if(n.hasDiscriminatorColumn)return" WHERE "+(t.length?"("+t+") AND":"")+" "+n.discriminatorColumn.fullName+"=:discriminatorColumnValue"}return t.length?" WHERE "+t:""},e.prototype.replacePropertyNames=function(e){var t=this;return this.aliasMap.aliases.forEach(function(n){n.metadata&&(n.metadata.embeddeds.forEach(function(r){r.columns.forEach(function(i){var o=n.name+"\\."+r.propertyName+"\\."+i.propertyName+"([ =]|.{0}$)";e=e.replace(new RegExp(o,"gm"),t.escapeAlias(n.name)+"."+t.escapeColumn(i.fullName)+"$1")})}),n.metadata.columns.filter(function(e){return!e.isInEmbedded}).forEach(function(r){var i=n.name+"\\."+r.propertyName+"([ =]|.{0}$)";e=e.replace(new RegExp(i,"gm"),t.escapeAlias(n.name)+"."+t.escapeColumn(r.fullName)+"$1")}),n.metadata.relationsWithJoinColumns.forEach(function(r){var i=n.name+"\\."+r.propertyName+"([ =]|.{0}$)";e=e.replace(new RegExp(i,"gm"),t.escapeAlias(n.name)+"."+t.escapeColumn(r.name)+"$1")}))}),e},e.prototype.createJoinRelationIdsExpression=function(){var e=this;return this.joinRelationIds.map(function(t){var n=t.alias.parentAliasName,r=e.aliasMap.findAliasByName(n);if(!r)throw new Error('Alias "'+n+'" was not found');var i=e.aliasMap.getEntityMetadataByAlias(r);if(!i)throw new Error("Cannot get entity metadata for the given alias "+r.name);var o=i.findRelationWithPropertyName(t.alias.parentPropertyName),a=o.junctionEntityMetadata,s=a.table.name,u=t.alias.name,c=o.isOwning?o.joinTable:o.inverseRelation.joinTable,l=c.referencedColumn.fullName,d="";return d=o.isOwning?e.escapeAlias(u)+"."+e.escapeColumn(a.columns[0].fullName)+"="+e.escapeAlias(n)+"."+e.escapeColumn(l):e.escapeAlias(u)+"."+e.escapeColumn(a.columns[1].fullName)+"="+e.escapeAlias(n)+"."+e.escapeColumn(l)," "+t.type+" JOIN "+s+" "+e.escapeAlias(u)+" ON "+d})},e.prototype.createJoinExpression=function(){var e=this,t=this.joins.map(function(t){var n=t.type,r=t.tableName;if(!r){if(!t.alias.metadata)throw new Error("Cannot get entity metadata for the given alias "+t.alias.name);r=t.alias.metadata.table.name}var i=t.alias.parentAliasName;if(!i)return" "+n+" JOIN "+e.escapeTable(r)+" "+e.escapeAlias(t.alias.name)+" "+(t.condition?"ON "+e.replacePropertyNames(t.condition):"");var o=e.aliasMap.findAliasByName(i);if(!o)throw new Error('Alias "'+i+'" was not found');var a=e.aliasMap.getEntityMetadataByAlias(o);if(!a)throw new Error("Cannot get entity metadata for the given alias "+o.name);var s=a.findRelationWithPropertyName(t.alias.parentPropertyName),u=s.junctionEntityMetadata,c=t.condition?" AND "+e.replacePropertyNames(t.condition):"";if(s.isManyToMany){var l=u.table.name,d=t.alias.parentAliasName+"_"+t.alias.name,m=t.alias.name,p=s.isOwning?s.joinTable:s.inverseRelation.joinTable,f=s.isOwning?p.referencedColumn.fullName:p.inverseReferencedColumn.fullName,y=s.isOwning?p.inverseReferencedColumn.fullName:p.referencedColumn.fullName,h="",g="";return s.isOwning?(h=e.escapeAlias(d)+"."+e.escapeColumn(u.columns[0].fullName)+"="+e.escapeAlias(i)+"."+e.escapeColumn(f),g=e.escapeAlias(m)+"."+e.escapeColumn(y)+"="+e.escapeAlias(d)+"."+e.escapeColumn(u.columns[1].fullName)):(h=e.escapeAlias(d)+"."+e.escapeColumn(u.columns[1].fullName)+"="+e.escapeAlias(i)+"."+e.escapeColumn(f),g=e.escapeAlias(m)+"."+e.escapeColumn(y)+"="+e.escapeAlias(d)+"."+e.escapeColumn(u.columns[0].fullName))," "+n+" JOIN "+e.escapeTable(l)+" "+e.escapeAlias(d)+" ON "+h+" "+n+" JOIN "+e.escapeTable(r)+" "+e.escapeAlias(m)+" ON "+g+c}if(s.isManyToOne||s.isOneToOne&&s.isOwning){var f=s.joinColumn.referencedColumn.fullName,v=e.escapeAlias(t.alias.name)+"."+e.escapeColumn(f)+"="+e.escapeAlias(i)+"."+e.escapeColumn(s.name);return" "+n+" JOIN "+e.escapeTable(r)+" "+e.escapeAlias(t.alias.name)+" ON "+v+c}if(s.isOneToMany||s.isOneToOne&&!s.isOwning){var f=s.inverseRelation.joinColumn.referencedColumn.fullName,v=e.escapeAlias(t.alias.name)+"."+e.escapeColumn(s.inverseRelation.name)+"="+e.escapeAlias(i)+"."+e.escapeColumn(f);return" "+n+" JOIN "+e.escapeTable(r)+" "+e.escapeAlias(t.alias.name)+" ON "+v+c}throw new Error("Unexpected relation type")}).join(" ");if(!this.ignoreParentTablesJoins&&!this.fromTableName){var n=this.connection.getMetadata(this.aliasMap.mainAlias.target);if(n.parentEntityMetadata&&n.parentIdColumns){var r=this.escapeAlias("parentIdColumn_"+n.parentEntityMetadata.table.name);t+=" JOIN "+this.escapeTable(n.parentEntityMetadata.table.name)+" "+r+" ON ",t+=n.parentIdColumns.map(function(t){return e.aliasMap.mainAlias.name+"."+t.fullName+"="+r+"."+t.propertyName})}}return t},e.prototype.createGroupByExpression=function(){return this.groupBys&&this.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.groupBys.join(", ")):""},e.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.orderBys;if(!Object.keys(n).length&&!this.fromTableName){n=this.connection.getMetadata(this.aliasMap.mainAlias.target).table.orderBy||{}}return[Object.keys(n).map(function(n){var r=n.split("."),i=r[0],o=r[1],a=r.slice(2);return t.escapeAlias(e)+"."+t.escapeColumn(i+"_"+o+a.join("_"))}).join(", "),Object.keys(n).map(function(n){var r=n.split("."),i=r[0],o=r[1],a=r.slice(2);return t.escapeAlias(e)+"."+t.escapeColumn(i+"_"+o+a.join("_"))+" "+t.orderBys[n]}).join(", ")]},e.prototype.createOrderByExpression=function(){var e=this,t=this.orderBys;if(!Object.keys(t).length&&!this.fromTableName){t=this.connection.getMetadata(this.aliasMap.mainAlias.target).table.orderBy||{}}return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(t){return e.replacePropertyNames(t)+" "+e.orderBys[t]}).join(", "):""},e.prototype.createLimitExpression=function(){return this.limit?" LIMIT "+this.limit:""},e.prototype.createOffsetExpression=function(){return this.offset?" OFFSET "+this.offset:""},e.prototype.createLockExpression=function(){switch(this.lockMode){case"pessimistic_read":if(this.connection.driver instanceof m.MysqlDriver)return" LOCK IN SHARE MODE";if(this.connection.driver instanceof d.PostgresDriver)return" FOR SHARE";if(this.connection.driver instanceof o.SqlServerDriver)return"";throw new p.LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(this.connection.driver instanceof m.MysqlDriver||this.connection.driver instanceof d.PostgresDriver)return" FOR UPDATE";if(this.connection.driver instanceof o.SqlServerDriver)return"";throw new p.LockNotSupportedOnGivenDriverError;default:return""}},e.prototype.extractJoinMappings=function(){var e=[];return this.joins.filter(function(e){return!!e.mapToProperty}).forEach(function(t){var n=t.mapToProperty.split("."),r=n[0],i=n[1];e.push({type:"join",alias:t.alias,parentName:r,propertyName:i,isMany:t.isMappingMany})}),this.joinRelationIds.filter(function(e){return!!e.mapToProperty}).forEach(function(t){var n=t.mapToProperty.split("."),r=n[0],i=n[1];e.push({type:"relationId",alias:t.alias,parentName:r,propertyName:i,isMany:!1})}),e},e.prototype.join=function(e,t,r,i,o,a,s){void 0===i&&(i=""),void 0===s&&(s=!1);var u="",c=new n.Alias(r);if(this.aliasMap.addAlias(c),t instanceof Function)c.metadata=this.connection.getMetadata(t);else if(this.isPropertyAlias(t)){f=t.split("."),c.parentAliasName=f[0],c.parentPropertyName=f[1];var l=this.aliasMap.findAliasByName(c.parentAliasName),d=l.metadata.findRelationWithPropertyName(c.parentPropertyName);c.metadata=d.inverseEntityMetadata}else if("string"==typeof t){var m=this.connection.entityMetadatas.find(function(e){return e.table.name===t});m?c.metadata=m:u=t,a||(a=t)}var p={type:e,alias:c,tableName:u,condition:i,options:o,mapToProperty:a,isMappingMany:s};return this.joins.push(p),this;var f},e.prototype.joinRelationId=function(e,t,r,i){if(!this.isPropertyAlias(r))throw new Error("Only entity relations are allowed in the leftJoinRelationId operation");var o=r.split("."),a=o[0],s=o[1],u=a+"_"+s+"_relation_id",c=new n.Alias(u);return this.aliasMap.addAlias(c),c.parentAliasName=a,c.parentPropertyName=s,this.joinRelationIds.push({type:e,mapToProperty:t,alias:c,condition:i}),this},e.prototype.isPropertyAlias=function(e){if("string"!=typeof e)return!1;if(-1===e.indexOf("."))return!1;var t=e.split(".")[0],n=e.split(".")[1];if(!t||!n)return!1;var r=/^[a-zA-Z0-9_-]+$/,i=r;return!(!r.test(t)||!i.test(n))},e.prototype.createWhereIdsExpression=function(e){var t=this,n=this.connection.getMetadata(this.aliasMap.mainAlias.target),r=function(e){return t.escapeAlias(e)},i=function(e){return t.escapeColumn(e)},o=this.aliasMap.mainAlias.name,a={},s=e.map(function(e,t){var s=[];return n.hasMultiplePrimaryKeys?(n.primaryColumns.forEach(function(n,u){s.push(r(o)+"."+i(n.fullName)+"=:id_"+t+"_"+u),a["id_"+t+"_"+u]=e[n.fullName]}),n.parentIdColumns.forEach(function(n,u){s.push(r(o)+"."+i(e[n.fullName])+"=:parentId_"+t+"_"+u),a["parentId_"+t+"_"+u]=e[n.propertyName]})):n.primaryColumns.length>0?(s.push(r(o)+"."+i(n.firstPrimaryColumn.fullName)+"=:id_"+t),a["id_"+t]=e):n.parentIdColumns.length>0&&(s.push(r(o)+"."+i(n.parentIdColumns[0].fullName)+"=:parentId_"+t),a["parentId_"+t]=e),s.join(" AND ")});return[s.length>1?"("+s.join(" OR ")+")":s[0],a]},e.prototype.getQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.queryRunnerProvider instanceof a.QueryRunnerProvider?[2,this.queryRunnerProvider.provide()]:[2,this.connection.driver.createQueryRunner()]})})},e.prototype.hasOwnQueryRunner=function(){return!this.queryRunnerProvider},e}(),e("QueryBuilder",y)}}}),System.register("typeorm/lazy-loading/LazyRelationsWrapper",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.wrap=function(e,t){var r=this.connection,i="__"+t.propertyName+"__",o="__promise__"+t.propertyName+"__",a="__has__"+t.propertyName+"__";Object.defineProperty(e,t.propertyName,{get:function(){var e=this;if(!0===this[a])return Promise.resolve(this[i]);if(this[o])return this[o];var s=function(e){return r.driver.escapeAliasName(e)},u=function(e){return r.driver.escapeColumnName(e)},c=new n.QueryBuilder(r);return t.isManyToMany?(t.isManyToManyOwner?c.select(t.propertyName).from(t.type,t.propertyName).innerJoin(t.junctionEntityMetadata.table.name,t.junctionEntityMetadata.table.name,s(t.junctionEntityMetadata.table.name)+"."+u(t.joinTable.joinColumnName)+"=:"+t.propertyName+"Id AND "+s(t.junctionEntityMetadata.table.name)+"."+u(t.joinTable.inverseJoinColumnName)+"="+s(t.propertyName)+"."+u(t.joinTable.referencedColumn.propertyName)).setParameter(t.propertyName+"Id",this[t.referencedColumn.propertyName]):c.select(t.propertyName).from(t.type,t.propertyName).innerJoin(t.junctionEntityMetadata.table.name,t.junctionEntityMetadata.table.name,s(t.junctionEntityMetadata.table.name)+"."+u(t.inverseRelation.joinTable.inverseJoinColumnName)+"=:"+t.propertyName+"Id AND "+s(t.junctionEntityMetadata.table.name)+"."+u(t.inverseRelation.joinTable.joinColumnName)+"="+s(t.propertyName)+"."+u(t.inverseRelation.joinTable.referencedColumn.propertyName)).setParameter(t.propertyName+"Id",this[t.inverseRelation.referencedColumn.propertyName]),this[o]=c.getMany().then(function(t){return e[i]=t,e[a]=!0,delete e[o],e[i]}).catch(function(e){throw e}),this[o]):t.isOneToMany?(c.select(t.propertyName).from(t.inverseRelation.entityMetadata.target,t.propertyName).innerJoin(t.propertyName+"."+t.inverseRelation.propertyName,t.entityMetadata.targetName).where(t.entityMetadata.targetName+"."+t.inverseEntityMetadata.firstPrimaryColumn.propertyName+"=:id",{id:t.entityMetadata.getEntityIdMixedMap(this)}),this[o]=c.getMany().then(function(t){return e[i]=t,e[a]=!0,delete e[o],e[i]}).catch(function(e){throw e}),this[o]):(t.hasInverseSide?c.select(t.propertyName).from(t.inverseRelation.entityMetadata.target,t.propertyName).innerJoin(t.propertyName+"."+t.inverseRelation.propertyName,t.entityMetadata.targetName).where(t.entityMetadata.targetName+"."+t.joinColumn.referencedColumn.fullName+"=:id",{id:t.entityMetadata.getEntityIdMixedMap(this)}):c.select(t.propertyName).from(t.type,t.propertyName).innerJoin(t.entityMetadata.target,t.entityMetadata.name,s(t.entityMetadata.name)+"."+u(t.propertyName)+"="+s(t.propertyName)+"."+u(t.referencedColumn.propertyName)).where(t.entityMetadata.name+"."+t.joinColumn.referencedColumn.fullName+"=:id",{id:t.entityMetadata.getEntityIdMixedMap(this)}),this[o]=c.getOne().then(function(t){return e[i]=t,e[a]=!0,delete e[o],e[i]}).catch(function(e){throw e}),this[o])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[i]=e,t[a]=!0}):(this[i]=e,this[a]=!0)},configurable:!0})},e}(),e("LazyRelationsWrapper",r)}}}),System.register("typeorm/metadata/EntityMetadata",["typeorm/metadata/types/RelationTypes"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){var n=this;this.lazyRelationsWrapper=t,this.foreignKeys=[],this.target=e.target,this.junction=e.junction,this.tablesPrefix=e.tablesPrefix,this.namingStrategy=e.namingStrategy,this.table=e.tableMetadata,this._columns=e.columnMetadatas||[],this.relations=e.relationMetadatas||[],this.indices=e.indexMetadatas||[],this.foreignKeys=e.foreignKeyMetadatas||[],this.embeddeds=e.embeddedMetadatas||[],this.discriminatorValue=e.discriminatorValue,this.inheritanceType=e.inheritanceType,this.table.entityMetadata=this,this._columns.forEach(function(e){return e.entityMetadata=n}),this.relations.forEach(function(e){return e.entityMetadata=n}),this.foreignKeys.forEach(function(e){return e.entityMetadata=n}),this.indices.forEach(function(e){return e.entityMetadata=n});var r=function(e){e.forEach(function(e){e.entityMetadata=n,e.columns.forEach(function(e){return e.entityMetadata=n}),r(e.embeddeds)})};r(this.embeddeds)}return Object.defineProperty(e.prototype,"name",{get:function(){if(!this.table)throw new Error("No table target set to the entity metadata.");return this.targetName?this.targetName:this.table.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){var e=[].concat(this._columns);return this.embeddeds.forEach(function(t){e=e.concat(t.columns)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnsWithoutEmbeddeds",{get:function(){return this._columns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allColumns",{get:function(){var e=this.columns;return this.parentEntityMetadata&&(e=e.concat(this.parentEntityMetadata.columns)),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allRelations",{get:function(){var e=this.relations;return this.parentEntityMetadata&&(e=e.concat(this.parentEntityMetadata.relations)),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetName",{get:function(){return"string"==typeof this.target?this.target:this.target instanceof Function?this.target.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMultiplePrimaryKeys",{get:function(){return this.primaryColumns.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryColumn",{get:function(){var e=this.primaryColumns[0];if(!e)throw new Error("Primary key is not set for the "+this.name+" entity.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeneratedColumn",{get:function(){return!!this.generatedColumnIfExist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"generatedColumn",{get:function(){var e=this.generatedColumnIfExist;if(!e)throw new Error("Generated column was not found");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"generatedColumnIfExist",{get:function(){return this._columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstPrimaryColumn",{get:function(){if(this.hasMultiplePrimaryKeys)throw new Error("Entity "+this.name+" has multiple primary keys. This operation is not supported on entities with multiple primary keys");return this.primaryColumns[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryColumns",{get:function(){return this._columns.filter(function(e){return e.isPrimary})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryColumnsWithParentIdColumns",{get:function(){return this.primaryColumns.concat(this.parentIdColumns)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allPrimaryColumns",{get:function(){return this.primaryColumns.concat(this.parentPrimaryColumns)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentPrimaryColumns",{get:function(){return this.parentEntityMetadata?this.parentEntityMetadata.primaryColumns:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownPimaryColumns",{get:function(){return this._columns.filter(function(e){return e.isPrimary})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasCreateDateColumn",{get:function(){return!!this._columns.find(function(e){return"createDate"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createDateColumn",{get:function(){var e=this._columns.find(function(e){return"createDate"===e.mode});if(!e)throw new Error("CreateDateColumn was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasUpdateDateColumn",{get:function(){return!!this._columns.find(function(e){return"updateDate"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateDateColumn",{get:function(){var e=this._columns.find(function(e){return"updateDate"===e.mode});if(!e)throw new Error("UpdateDateColumn was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasVersionColumn",{get:function(){return!!this._columns.find(function(e){return"version"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"versionColumn",{get:function(){var e=this._columns.find(function(e){return"version"===e.mode});if(!e)throw new Error("VersionColumn was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDiscriminatorColumn",{get:function(){return!!this._columns.find(function(e){return"discriminator"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"discriminatorColumn",{get:function(){var e=this._columns.find(function(e){return"discriminator"===e.mode});if(!e)throw new Error("DiscriminatorColumn was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTreeLevelColumn",{get:function(){return!!this._columns.find(function(e){return"treeLevel"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeLevelColumn",{get:function(){var e=this._columns.find(function(e){return"treeLevel"===e.mode});if(!e)throw new Error("TreeLevelColumn was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasParentIdColumn",{get:function(){return!!this._columns.find(function(e){return"parentId"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentIdColumn",{get:function(){var e=this._columns.find(function(e){return"parentId"===e.mode});if(!e)throw new Error("Parent id column was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentIdColumns",{get:function(){return this._columns.filter(function(e){return"parentId"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasObjectIdColumn",{get:function(){return!!this._columns.find(function(e){return"objectId"===e.mode})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectIdColumn",{get:function(){var e=this._columns.find(function(e){return"objectId"===e.mode});if(!e)throw new Error("ObjectId was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"singleValueRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.ONE_TO_ONE||e.relationType===n.RelationTypes.ONE_TO_MANY})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiValueRelations",{get:function(){
return this.relations.filter(function(e){return e.relationType===n.RelationTypes.ONE_TO_ONE||e.relationType===n.RelationTypes.ONE_TO_MANY})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oneToOneRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.ONE_TO_ONE})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerOneToOneRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.ONE_TO_ONE&&e.isOwning})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oneToManyRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.ONE_TO_MANY})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manyToOneRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.MANY_TO_ONE})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manyToManyRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.MANY_TO_MANY})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerManyToManyRelations",{get:function(){return this.relations.filter(function(e){return e.relationType===n.RelationTypes.MANY_TO_MANY&&e.isOwning})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationsWithJoinColumns",{get:function(){return this.ownerOneToOneRelations.concat(this.manyToOneRelations)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTreeParentRelation",{get:function(){return!!this.relations.find(function(e){return e.isTreeParent})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeParentRelation",{get:function(){var e=this.relations.find(function(e){return e.isTreeParent});if(!e)throw new Error("TreeParent relation was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTreeChildrenRelation",{get:function(){return!!this.relations.find(function(e){return e.isTreeChildren})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeChildrenRelation",{get:function(){var e=this.relations.find(function(e){return e.isTreeChildren});if(!e)throw new Error("TreeParent relation was not found in entity "+this.name);return e},enumerable:!0,configurable:!0}),e.prototype.create=function(){var e=this;if(this.target instanceof Function)return new this.target;var t={};return this.relations.filter(function(e){return e.isLazy}).forEach(function(n){return e.lazyRelationsWrapper.wrap(t,n)}),t},e.prototype.createPropertiesMap=function(){var e={};return this._columns.forEach(function(t){return e[t.propertyName]=t.propertyName}),this.relations.forEach(function(t){return e[t.propertyName]=t.propertyName}),e},e.prototype.computePropertyName=function(e){return"string"==typeof e?e:e(this.createPropertiesMap())},e.prototype.getEntityIdMap=function(e){var t=this;if(e){var n={};return this.parentEntityMetadata?this.primaryColumnsWithParentIdColumns.forEach(function(r){var i=e[r.propertyName];if(null!==i&&void 0!==i){var o=t.relations.find(function(e){return e.propertyName===r.propertyName});o&&o.joinColumn?n[r.propertyName]=i[o.joinColumn.referencedColumn.propertyName]:o&&o.inverseRelation.joinColumn?n[r.propertyName]=i[o.inverseRelation.joinColumn.referencedColumn.propertyName]:n[r.propertyName]=i}}):this.primaryColumns.forEach(function(r){var i=e[r.propertyName];if(null!==i&&void 0!==i){var o=t.relations.find(function(e){return e.propertyName===r.propertyName});o&&o.joinColumn?n[r.propertyName]=i[o.joinColumn.referencedColumn.propertyName]:o&&o.inverseRelation.joinColumn?n[r.propertyName]=i[o.inverseRelation.joinColumn.referencedColumn.propertyName]:n[r.propertyName]=i}}),Object.keys(n).length>0?n:void 0}},e.prototype.getDatabaseEntityIdMap=function(e){var t=this,n={};return this.parentEntityMetadata?this.primaryColumnsWithParentIdColumns.forEach(function(r){var i=e[r.propertyName];if(null!==i&&void 0!==i){var o=t.relations.find(function(e){return e.propertyName===r.propertyName});o&&o.joinColumn?n[r.fullName]=i[o.joinColumn.referencedColumn.propertyName]:o&&o.inverseRelation.joinColumn?n[r.fullName]=i[o.inverseRelation.joinColumn.referencedColumn.propertyName]:n[r.fullName]=i}}):this.primaryColumns.forEach(function(r){var i=e[r.propertyName];if(null!==i&&void 0!==i){var o=t.relations.find(function(e){return e.propertyName===r.propertyName});o&&o.joinColumn?n[r.fullName]=i[o.joinColumn.referencedColumn.propertyName]:o&&o.inverseRelation.joinColumn?n[r.fullName]=i[o.inverseRelation.joinColumn.referencedColumn.propertyName]:n[r.fullName]=i}}),Object.keys(n).every(function(e){return void 0!==n[e]&&null!==n[e]})?n:void 0},e.prototype.getEntityIdMixedMap=function(e){if(e){var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?t[this.firstPrimaryColumn.propertyName]:t}},e.prototype.getEntityIdColumnMap=function(e){return this.transformIdMapToColumnNames(this.getEntityIdMap(e))},e.prototype.transformIdMapToColumnNames=function(e){var t=this;if(!e)return e;var n={};return Object.keys(e).forEach(function(r){var i=t.getColumnByPropertyName(r);i&&(n[i.fullName]=e[r])}),n},e.prototype.getColumnByPropertyName=function(e){return this._columns.find(function(t){return t.propertyName===e})},e.prototype.hasColumnWithPropertyName=function(e){return!!this._columns.find(function(t){return t.propertyName===e})},e.prototype.hasColumnWithDbName=function(e){return!!this._columns.find(function(t){return t.fullName===e})},e.prototype.hasRelationWithPropertyName=function(e){return!!this.relations.find(function(t){return t.propertyName===e})},e.prototype.findRelationWithPropertyName=function(e){var t=this.relations.find(function(t){return t.propertyName===e});if(!t)throw new Error("Relation with property name "+e+" in "+this.name+" entity was not found.");return t},e.prototype.hasRelationWithDbName=function(e){return!!this.relationsWithJoinColumns.find(function(t){return t.name===e})},e.prototype.findRelationWithDbName=function(e){var t=this.relationsWithJoinColumns.find(function(t){return t.name===e});if(!t)throw new Error("Relation with name "+e+" in "+this.name+" entity was not found.");return t},e.prototype.addColumn=function(e){this._columns.push(e),e.entityMetadata=this},e.prototype.extractNonEmptyColumns=function(e){return this.columns.filter(function(t){return!!e[t.propertyName]})},e.prototype.extractNonEmptySingleValueRelations=function(e){return this.relations.filter(function(t){return(t.relationType===n.RelationTypes.ONE_TO_ONE||t.relationType===n.RelationTypes.MANY_TO_ONE)&&!!e[t.propertyName]})},e.prototype.extractNonEmptyMultiValueRelations=function(e){return this.relations.filter(function(t){return(t.relationType===n.RelationTypes.MANY_TO_MANY||t.relationType===n.RelationTypes.ONE_TO_MANY)&&!!e[t.propertyName]})},e.prototype.extractExistSingleValueRelations=function(e){return this.relations.filter(function(t){return(t.relationType===n.RelationTypes.ONE_TO_ONE||t.relationType===n.RelationTypes.MANY_TO_ONE)&&e.hasOwnProperty(t.propertyName)})},e.prototype.extractExistMultiValueRelations=function(e){return this.relations.filter(function(t){return(t.relationType===n.RelationTypes.MANY_TO_MANY||t.relationType===n.RelationTypes.ONE_TO_MANY)&&e.hasOwnProperty(t.propertyName)})},e.prototype.checkIfObjectContainsAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){return e.hasOwnProperty(t.propertyName)})},e.prototype.compareEntities=function(e,t){var n=this.getEntityIdMap(e),r=this.getEntityIdMap(t);return this.compareIds(n,r)},e.prototype.compareIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&Object.keys(e).every(function(n){return e[n]instanceof Object&&t[n]instanceof Object?e[n].equals(t[n]):e[n]===t[n]})},e.prototype.compareEntityMixedIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&(this.hasMultiplePrimaryKeys?Object.keys(e).every(function(n){return e[n]===t[n]}):e===t)},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=[];return t.forEach(function(t){var r=t.getEntityValue(e);r instanceof Array?r.forEach(function(e){return n.push([t,e,t.inverseEntityMetadata])}):r&&n.push([t,r,t.inverseEntityMetadata])}),n},e.prototype.hasId=function(e){return this.primaryColumns.every(function(t){var n=t.propertyName;return!!e&&e.hasOwnProperty(n)&&null!==e[n]&&void 0!==e[n]&&""!==e[n]})},Object.defineProperty(e.prototype,"hasNonNullableColumns",{get:function(){return this.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})},enumerable:!0,configurable:!0}),e}(),e("EntityMetadata",r)}}}),System.register("typeorm/metadata/ColumnMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isUnique=!1,this.isNullable=!1,this.comment="",this.target=e.target,this.propertyName=e.propertyName,e.mode&&(this.mode=e.mode),e.options.name&&(this._name=e.options.name),e.options.type&&(this.type=e.options.type),e.options.length&&(this.length=String(e.options.length)),e.options.primary&&(this.isPrimary=e.options.primary),e.options.generated&&(this.isGenerated=e.options.generated),e.options.unique&&(this.isUnique=e.options.unique),e.options.nullable&&(this.isNullable=e.options.nullable),e.options.comment&&(this.comment=e.options.comment),void 0!==e.options.default&&null!==e.options.default&&(this.default=e.options.default),e.options.scale&&(this.scale=e.options.scale),e.options.precision&&(this.precision=e.options.precision),e.options.timezone&&(this.timezone=e.options.timezone),e.options.localTimezone&&(this.localTimezone=e.options.localTimezone),e.options.fixedLength&&(this.fixedLength=e.options.fixedLength)}return Object.defineProperty(e.prototype,"entityTarget",{get:function(){return this.entityMetadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.entityMetadata.namingStrategy.columnName(this.propertyName,this._name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullName",{get:function(){if(this.embeddedMetadata){var e=[],t=function(n){n.parentEmbeddedMetadata&&t(n.parentEmbeddedMetadata),e.push(n.prefix)};return t(this.embeddedMetadata),this.entityMetadata.namingStrategy.embeddedColumnName(e,this.propertyName,this._name)}if(this.entityMetadata)return this.entityMetadata.namingStrategy.columnName(this.propertyName,this._name);throw new Error("Column "+(this._name?this._name+" ":"")+"is not attached to any entity or embedded.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInEmbedded",{get:function(){return!!this.embeddedMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVirtual",{get:function(){return"virtual"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isArray",{get:function(){return"array"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isParentId",{get:function(){return"parentId"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDiscriminator",{get:function(){return"discriminator"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCreateDate",{get:function(){return"createDate"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUpdateDate",{get:function(){return"updateDate"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVersion",{get:function(){return"version"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isObjectId",{get:function(){return"objectId"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"referencedColumn",{get:function(){var e=this,t=this.entityMetadata.foreignKeys.find(function(t){return-1!==t.columns.indexOf(e)});if(t)return t.referencedColumns[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"embeddedProperty",{get:function(){if(!this.embeddedMetadata)throw new Error("This column"+(this._name?this._name+" ":"")+" is not in embedded entity.");return this.embeddedMetadata.propertyName},enumerable:!0,configurable:!0}),e.prototype.hasEntityValue=function(e){return!!e&&(this.isInEmbedded?void 0!==e[this.embeddedProperty]&&null!==e[this.embeddedProperty]&&void 0!==e[this.embeddedProperty][this.propertyName]&&null!==e[this.embeddedProperty][this.propertyName]:void 0!==e[this.propertyName]&&null!==e[this.propertyName])},e.prototype.getEntityValue=function(e){if(this.isInEmbedded){if(void 0===e[this.embeddedProperty]||null===e[this.embeddedProperty])return;return e[this.embeddedProperty][this.propertyName]}return e[this.propertyName]},e}(),e("ColumnMetadata",n)}}}),System.register("typeorm/schema-builder/schema/ColumnSchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,e&&(this.name=e.name||"",this.type=e.type||"",this.default=e.default,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.comment=e.comment)}return e.prototype.clone=function(){var t=new e;return t.name=this.name,t.type=this.type,t.default=this.default,t.isNullable=this.isNullable,t.isGenerated=this.isGenerated,t.isPrimary=this.isPrimary,t.isUnique=this.isUnique,t.comment=this.comment,t},e.create=function(t,n){var r=new e;return r.name=t.fullName,r.default=t.default,r.comment=t.comment,r.isGenerated=t.isGenerated,r.isNullable=t.isNullable,r.type=n,r.isPrimary=t.isPrimary,r.isUnique=t.isUnique,r},e}(),e("ColumnSchema",n)}}}),System.register("typeorm/query-runner/QueryRunner",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/Driver",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.transform=function(e,t,n){return this.groupAndTransform(e,t,n),e},e.prototype.groupAndTransform=function(e,t,n){var r=this;n.allColumns.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(n){return e[n.propertyName]=t[n.propertyName]}),n.allRelations.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(i){var o=i.inverseEntityMetadata;if(!o)throw new Error("Relation metadata for the relation "+n.name+"#"+i.propertyName+" is missing");if(i.isManyToMany||i.isOneToMany)t[i.propertyName]instanceof Array?e[i.propertyName]=t[i.propertyName].map(function(t){var n=o.create();if(e[i.propertyName]instanceof Array){var a=e[i.propertyName].find(function(e){return e[i.referencedColumnName]===t[i.referencedColumnName]});a&&r.groupAndTransform(n,a,o)}return r.groupAndTransform(n,t,o),n}):e[i.propertyName]=t[i.propertyName];else if(t[i.propertyName]){var a=o.create();e[i.propertyName]&&r.groupAndTransform(a,e[i.propertyName],o),r.groupAndTransform(a,t[i.propertyName],o),e[i.propertyName]=a}else e[i.propertyName]=t[i.propertyName]})},e}(),e("PlainObjectToNewEntityTransformer",n)}}}),System.register("typeorm/find-options/FindOneOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindManyOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/ObjectType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/TreeRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findTrees=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.findDescendantsTree(e)];case 1:return t.sent(),[2]}})})}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this.metadata.treeParentRelation.propertyName;return this.createQueryBuilder("treeEntity").where("treeEntity."+e+" IS NULL").getMany()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.connection.driver.escapeAliasName(e)},o=function(e){return r.connection.driver.escapeColumnName(e)},a=i(e)+"."+o(this.metadata.firstPrimaryColumn.fullName)+"="+i(t)+"."+o("descendant");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.table.name,t,a).where(i(t)+"."+o("ancestor")+"="+this.metadata.getEntityIdMap(n)[this.metadata.firstPrimaryColumn.propertyName])},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getEntitiesAndRawResults().then(function(n){var r=t.createRelationMaps("treeEntity",n.rawResults);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.connection.driver.escapeAliasName(e)},o=function(e){return r.connection.driver.escapeColumnName(e)},a=i(e)+"."+o(this.metadata.firstPrimaryColumn.fullName)+"="+i(t)+"."+o("ancestor");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.table.name,t,a).where(i(t)+"."+o("descendant")+"="+this.metadata.getEntityIdMap(n)[this.metadata.firstPrimaryColumn.propertyName])},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getEntitiesAndRawResults().then(function(n){var r=t.createRelationMaps("treeEntity",n.rawResults);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){return{id:t[e+"_"+n.metadata.firstPrimaryColumn.fullName],parentId:t[e+"_"+n.metadata.treeParentRelation.name]}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,o=e[this.metadata.firstPrimaryColumn.propertyName],a=n.filter(function(e){return e.parentId===o}),s=a.map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==s.indexOf(e[r.metadata.firstPrimaryColumn.propertyName])}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,o=e[this.metadata.firstPrimaryColumn.propertyName],a=n.find(function(e){return e.id===o}),s=t.find(function(e){return!!a&&e[r.metadata.firstPrimaryColumn.propertyName]===a.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(n.Repository),e("TreeRepository",r)}}}),System.register("typeorm/persistence/Subject",["typeorm/metadata/types/ColumnTypes","typeorm/util/DataTransformationUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e,t,n){this.date=new Date,this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.diffColumns=[],this.diffRelations=[],this.relationUpdates=[],this.junctionInserts=[],this.junctionRemoves=[],this.metadata=e,this._persistEntity=t,this._databaseEntity=n}return Object.defineProperty(e.prototype,"entity",{get:function(){if(!this._persistEntity)throw new Error("Persistence entity is not set for the given subject.");return this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasEntity",{get:function(){return!!this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"databaseEntity",{get:function(){if(!this._databaseEntity)throw new Error("Database entity is not set for the given subject.");return this._databaseEntity},set:function(e){this._databaseEntity=e,this.recompute()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDatabaseEntity",{get:function(){return!!this._databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityTarget",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.hasDatabaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&(this.diffColumns.length>0||this.diffRelations.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRelationUpdates",{get:function(){return this.relationUpdates.length>0},enumerable:!0,configurable:!0}),e.prototype.validate=function(){if(this.mustBeInserted&&this.mustBeRemoved)throw new Error("Removed entity "+this.metadata.name+" is also scheduled for insert operation. This looks like ORM problem. Please report a github issue.");if(this.mustBeUpdated&&this.mustBeRemoved)throw new Error('Removed entity "'+this.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).');if(this.mustBeInserted&&this.mustBeUpdated)throw new Error("Inserted entity "+this.metadata.name+" is also scheduled for updated operation. This looks like ORM problem. Please report a github issue.")},e.prototype.recompute=function(){this.hasEntity&&this._databaseEntity&&(this.computeDiffColumns(),this.computeDiffRelationalColumns())},e.prototype.computeDiffColumns=function(){var e=this;this.diffColumns=this.metadata.allColumns.filter(function(t){var i=t.getEntityValue(e.entity),o=t.getEntityValue(e.databaseEntity);if(null!==i&&void 0!==i&&(t.type===n.ColumnTypes.DATE?i=r.DataTransformationUtils.mixedDateToDateString(i):t.type===n.ColumnTypes.TIME?i=r.DataTransformationUtils.mixedDateToTimeString(i):t.type===n.ColumnTypes.DATETIME?(i=r.DataTransformationUtils.mixedDateToUtcDatetimeString(i),o=r.DataTransformationUtils.mixedDateToUtcDatetimeString(o)):t.type===n.ColumnTypes.JSON?(i=JSON.stringify(i),null!==o&&void 0!==o&&(o=JSON.stringify(o))):t.type===n.ColumnTypes.SIMPLE_ARRAY&&(i=r.DataTransformationUtils.simpleArrayToString(i),o=r.DataTransformationUtils.simpleArrayToString(o))),!t.isInEmbedded&&void 0===e.entity[t.propertyName])return!1;if(t.isInEmbedded&&(void 0===e.entity[t.embeddedProperty]||void 0===e.entity[t.embeddedProperty][t.propertyName]))return!1;if(t.isVirtual||t.isParentId||t.isDiscriminator||t.isUpdateDate||t.isVersion||t.isCreateDate||i===o)return!1;if(!t.isInEmbedded&&e.metadata.hasRelationWithDbName(t.propertyName)){var a=e.metadata.findRelationWithDbName(t.propertyName);if(null!==e.entity[a.propertyName]&&void 0!==e.entity[a.propertyName])return!1}return!0})},e.prototype.computeDiffRelationalColumns=function(){var e=this;this.diffRelations=this.metadata.allRelations.filter(function(t){if(!(t.isManyToOne||t.isOneToOne&&t.isOwning))return!1;var n=e.entity[t.propertyName]instanceof Object?t.inverseEntityMetadata.getEntityIdMixedMap(e.entity[t.propertyName]):e.entity[t.propertyName],r=e.databaseEntity[t.name];return void 0!==n&&((void 0!==n&&null!==n||void 0!==r&&null!==r)&&n!==r)})},e}(),e("Subject",i)}}}),System.register("typeorm/repository/SpecificRepository",["typeorm/query-runner/QueryRunnerProvider","typeorm/persistence/Subject","typeorm/metadata/RelationMetadata","typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e,t,n){this.connection=e,this.metadata=t,this.queryRunnerProvider=n}return e.prototype.setRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:if(i=this.metadata.computePropertyName(e),!this.metadata.hasRelationWithPropertyName(i))throw new Error("Relation "+i+" was not found in the "+this.metadata.name+" entity.");if(o=this.metadata.findRelationWithPropertyName(i),o.isManyToMany)throw new Error("Many-to-many relation is not supported for this operation. Use #addToRelation method for many-to-many relations.");return s={},u={},o.isOwning?(a=o.entityMetadata.table.name,s[o.name]=r,u[o.joinColumn.referencedColumn.fullName]=t):(a=o.inverseEntityMetadata.table.name,s[o.inverseRelation.name]=r,u[o.inverseRelation.joinColumn.referencedColumn.fullName]=t),c=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,c.provide()];case 1:return l=d.sent(),[4,l.update(a,s,u)];case 2:return d.sent(),this.queryRunnerProvider?[3,4]:[4,c.release(l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},e.prototype.setInverseRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:if(i=this.metadata.computePropertyName(e),!this.metadata.hasRelationWithPropertyName(i))throw new Error("Relation "+i+" was not found in the "+this.metadata.name+" entity.");if(o=this.metadata.findRelationWithPropertyName(i),o.isManyToMany)throw new Error("Many-to-many relation is not supported for this operation. Use #addToRelation method for many-to-many relations.");return s={},u={},o.isOwning?(a=o.inverseEntityMetadata.table.name,s[o.inverseRelation.name]=t,u[o.inverseRelation.joinColumn.referencedColumn.fullName]=r):(a=o.entityMetadata.table.name,s[o.name]=t,u[o.joinColumn.referencedColumn.fullName]=r),c=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,c.provide()];case 1:return l=d.sent(),[4,l.update(a,s,u)];case 2:return d.sent(),this.queryRunnerProvider?[3,4]:[4,c.release(l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},e.prototype.addToRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(i=this.metadata.computePropertyName(e),!this.metadata.hasRelationWithPropertyName(i))throw new Error("Relation "+i+" was not found in the "+this.metadata.name+" entity.");if(o=this.metadata.findRelationWithPropertyName(i),!o.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+i+" relation type is "+o.relationType);return a=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,a.provide()];case 1:return s=c.sent(),u=r.map(function(e){var n={};return o.isOwning?(n[o.junctionEntityMetadata.columns[0].fullName]=t,n[o.junctionEntityMetadata.columns[1].fullName]=e):(n[o.junctionEntityMetadata.columns[1].fullName]=t,n[o.junctionEntityMetadata.columns[0].fullName]=e),s.insert(o.junctionEntityMetadata.table.name,n)}),[4,Promise.all(u)];case 2:return c.sent(),this.queryRunnerProvider?[3,4]:[4,a.release(s)];case 3:c.sent(),c.label=4;case 4:return[2]}})})},e.prototype.addToInverseRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(i=this.metadata.computePropertyName(e),!this.metadata.hasRelationWithPropertyName(i))throw new Error("Relation "+i+" was not found in the "+this.metadata.name+" entity.");if(o=this.metadata.findRelationWithPropertyName(i),!o.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+i+" relation type is "+o.relationType);return a=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,a.provide()];case 1:s=c.sent(),c.label=2;case 2:return c.trys.push([2,,4,7]),u=r.map(function(e){var n={};return o.isOwning?(n[o.junctionEntityMetadata.columns[0].fullName]=e,n[o.junctionEntityMetadata.columns[1].fullName]=t):(n[o.junctionEntityMetadata.columns[1].fullName]=e,n[o.junctionEntityMetadata.columns[0].fullName]=t),s.insert(o.junctionEntityMetadata.table.name,n)}),[4,Promise.all(u)];case 3:return c.sent(),[3,7];case 4:return this.queryRunnerProvider?[3,6]:[4,a.release(s)];case 5:c.sent(),c.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.removeFromRelation=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(r=this.metadata.computePropertyName(e),!this.metadata.hasRelationWithPropertyName(r))throw new Error("Relation "+r+" was not found in the "+this.metadata.name+" entity.");if(i=this.metadata.findRelationWithPropertyName(r),!i.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+r+" relation type is "+i.relationType);return n&&n.length?(a=new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().fromTable(i.junctionEntityMetadata.table.name,"junctionEntity"),s=this.connection.driver.escapeColumnName(i.isOwning?i.junctionEntityMetadata.columns[0].fullName:i.junctionEntityMetadata.columns[1].fullName),u=this.connection.driver.escapeColumnName(i.isOwning?i.junctionEntityMetadata.columns[1].fullName:i.junctionEntityMetadata.columns[0].fullName),n.forEach(function(e,t){a.orWhere("("+s+"=:entityId AND "+u+"=:relatedEntity_"+t+")").setParameter("relatedEntity_"+t,e)}),[4,a.setParameter("entityId",t).execute()]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})},e.prototype.removeFromInverseRelation=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(r=this.metadata.computePropertyName(e),!this.metadata.hasRelationWithPropertyName(r))throw new Error("Relation "+r+" was not found in the "+this.metadata.name+" entity.");if(i=this.metadata.findRelationWithPropertyName(r),!i.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+r+" relation type is "+i.relationType);return n&&n.length?(a=new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().from(i.junctionEntityMetadata.table.name,"junctionEntity"),s=i.isOwning?i.junctionEntityMetadata.columns[1].fullName:i.junctionEntityMetadata.columns[0].fullName,u=i.isOwning?i.junctionEntityMetadata.columns[0].fullName:i.junctionEntityMetadata.columns[1].fullName,n.forEach(function(e,t){a.orWhere("("+s+"=:relatedEntityId AND "+u+"=:entity_"+t+")").setParameter("entity_"+t,e)}),[4,a.setParameter("relatedEntityId",t).execute()]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})},e.prototype.addAndRemoveFromRelation=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.addToRelation(e,t,n),this.removeFromRelation(e,t,r)])];case 1:return i.sent(),[2]}})})},e.prototype.addAndRemoveFromInverseRelation=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:
return[4,Promise.all([this.addToInverseRelation(e,t,n),this.removeFromInverseRelation(e,t,r)])];case 1:return i.sent(),[2]}})})},e.prototype.removeById=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t=this.metadata.table.name,n={},r="",this.metadata.hasMultiplePrimaryKeys?r=this.metadata.primaryColumns.map(function(r){return n[r.propertyName]=e[r.propertyName],t+"."+r.propertyName+"=:"+r.propertyName}).join(" AND "):(r=t+"."+this.metadata.firstPrimaryColumn.propertyName+"=:id",n.id=e),[4,new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().from(this.metadata.target,t).where(r,n).execute()];case 1:return i.sent(),[2]}})})},e.prototype.removeByIds=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return t=this.metadata.table.name,n={},r="",this.metadata.hasMultiplePrimaryKeys?r=e.map(function(e,r){i.metadata.primaryColumns.map(function(i){return n[i.propertyName+"_"+r]=e[i.propertyName],t+"."+i.propertyName+"=:"+i.propertyName+"_"+r}).join(" AND ")}).join(" OR "):(r=t+"."+this.metadata.firstPrimaryColumn.propertyName+" IN (:ids)",n.ids=e),[4,new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().from(this.metadata.target,t).where(r,n).execute()];case 1:return a.sent(),[2]}})})},e.prototype.findRelationIds=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,a,s,u,c,l,d,m,p,f=this;return __generator(this,function(y){switch(y.label){case 0:return i=this.convertMixedRelationToMetadata(e),(t instanceof Array||(t=[t]),a=i.isOwning?i.joinTable.referencedColumn:i.inverseRelation.joinTable.inverseReferencedColumn,s=i.isOwning?i.junctionEntityMetadata.columns[0]:i.junctionEntityMetadata.columns[1],u=i.isOwning?i.junctionEntityMetadata.columns[1]:i.junctionEntityMetadata.columns[0],c=this.convertEntityOrEntitiesToIdOrIds(a,t),c instanceof Array||(c=[c]),c=c.filter(function(e){return null!==e&&void 0!==e}),0===c.length)?[2,[]]:(l=function(e){return f.connection.driver.escapeAliasName(e)},d=function(e){return f.connection.driver.escapeColumnName(e)},m=[],p=c.map(function(e){var t=new o.QueryBuilder(f.connection,f.queryRunnerProvider).select(l("junction")+"."+d(u.fullName)+" AS "+d("id")).fromTable(i.junctionEntityMetadata.table.name,"junction").andWhere(l("junction")+"."+d(s.fullName)+"=:entityId",{entityId:e});return n&&n.length>0&&t.andWhere(l("junction")+"."+d(u.fullName)+" IN (:inIds)",{inIds:n}),r&&r.length>0&&t.andWhere(l("junction")+"."+d(u.fullName)+" NOT IN (:notInIds)",{notInIds:r}),t.getRawMany().then(function(e){e.forEach(function(e){return m.push(e.id)})})}),[4,Promise.all(p)]);case 1:return y.sent(),[2,m]}})})},e.prototype.convertEntityOrEntitiesToIdOrIds=function(e,t){var n=this;return t instanceof Array?t.map(function(t){return n.convertEntityOrEntitiesToIdOrIds(e,t)}):t instanceof Object?t[e.propertyName]:t},e.prototype.convertMixedRelationToMetadata=function(e){if(e instanceof i.RelationMetadata)return e;var t=e instanceof Function?e(this.metadata.createPropertiesMap()):e;return this.metadata.findRelationWithPropertyName(t)},e.prototype.extractObjectsById=function(e,t,n){var i=this;void 0===n&&(n=[]);var o=t.relations.map(function(t){var r=t.inverseEntityMetadata,o=t.isLazy?e["__"+t.propertyName+"__"]:e[t.propertyName];if(o){if(o instanceof Array){var a=o.map(function(e){return i.extractObjectsById(e,r,n)});return Promise.all(a)}return i.extractObjectsById(o,r,n)}});return Promise.all(o.filter(function(e){return!!e})).then(function(){if(!n.find(function(t){return t.entity===e})){var i=new r.Subject(t,e);n.push(i)}return n})},e}(),e("SpecificRepository",a)}}}),System.register("typeorm/driver/mongodb/MongoQueryRunner",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n}return e.prototype.cursor=function(e,t){return this.getCollection(e).find(t||{})},e.prototype.aggregate=function(e,t,n){return this.getCollection(e).aggregate(t,n)},e.prototype.bulkWrite=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).bulkWrite(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.count=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).count(t||{},n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).createIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndexes=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).createIndexes(t)];case 1:return[2,n.sent()]}})})},e.prototype.deleteMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.deleteOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.distinct=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).distinct(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.dropCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).dropIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.dropCollectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).dropIndexes()];case 1:return[2,t.sent()]}})})},e.prototype.findOneAndDelete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).findOneAndDelete(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.findOneAndReplace=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndReplace(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.findOneAndUpdate=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndUpdate(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoHaystackSearch=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoHaystackSearch(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoNear=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoNear(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.group=function(e,t,n,r,i,o,a,s){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(u){switch(u.label){case 0:return[4,this.getCollection(e).group(t,n,r,i,o,a,s)];case 1:return[2,u.sent()]}})})},e.prototype.collectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).indexes()];case 1:return[2,t.sent()]}})})},e.prototype.collectionIndexExists=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexExists(t)];case 1:return[2,n.sent()]}})})},e.prototype.collectionIndexInformation=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexInformation(t)];case 1:return[2,n.sent()]}})})},e.prototype.initializeOrderedBulkOp=function(e,t){return this.getCollection(e).initializeOrderedBulkOp(t)},e.prototype.initializeUnorderedBulkOp=function(e,t){return this.getCollection(e).initializeUnorderedBulkOp(t)},e.prototype.insertMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.insertOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.isCapped=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).isCapped()];case 1:return[2,t.sent()]}})})},e.prototype.listCollectionIndexes=function(e,t){return this.getCollection(e).listIndexes(t)},e.prototype.mapReduce=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).mapReduce(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.parallelCollectionScan=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).parallelCollectionScan(t)];case 1:return[2,n.sent()]}})})},e.prototype.reIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).reIndex()];case 1:return[2,t.sent()]}})})},e.prototype.rename=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).rename(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.replaceOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).replaceOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.stats=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).stats(t)];case 1:return[2,n.sent()]}})})},e.prototype.updateMany=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateMany(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.updateOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.connection.dropDatabase()];case 1:return e.sent(),[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){throw new Error("Executing SQL query is not supported by MongoDB driver.")},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.connection.collection(e).insertOne(t)];case 1:return n=r.sent(),[2,n.insertedId]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.connection.collection(e).updateOne(n,t)];case 1:return r.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:if("string"==typeof t)throw new Error("String condition is not supported by MongoDB driver.");return[4,this.databaseConnection.connection.collection(e).deleteOne(t)];case 1:return n.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.normalizeType=function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")},e.prototype.compareDefaultValues=function(e,t){throw new Error("Schema update queries are not supported by MongoDB driver.")},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.databaseConnection.connection.dropCollection(e)];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.getCollection=function(e){return this.databaseConnection.connection.collection(e)},e}(),e("MongoQueryRunner",n)}}}),System.register("typeorm/driver/mongodb/MongoDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/mongodb/MongoQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e,t,n){this.validateOptions(e),n||(n=this.loadDependencies()),this.options=e,this.logger=t,this.mongodb=n}return e.prototype.connect=function(){var e=this;return new Promise(function(t,n){e.mongodb.MongoClient.connect(e.buildConnectionUrl(),e.options.extra,function(r,o){if(r)return n(r);e.pool=o;var a={id:1,connection:e.pool,isTransactionActive:!1};e.queryRunner=new i.MongoQueryRunner(a,e,e.logger),t()})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(!this.pool)throw new n.ConnectionIsNotSetError("mongodb");return[2,new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.pool.close(r),e.pool=void 0})]})})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.pool?[2,this.queryRunner]:[2,Promise.reject(new n.ConnectionIsNotSetError("mongodb"))]})})},e.prototype.nativeInterface=function(){return{driver:this.mongodb,connection:this.pool}},e.prototype.escapeQueryWithParameters=function(e,t){throw new Error("This operation is not supported by Mongodb driver.")},e.prototype.escapeColumnName=function(e){return e},e.prototype.escapeAliasName=function(e){return e},e.prototype.escapeTableName=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?null:(t.type,e)},e.prototype.prepareHydratedValue=function(e,t){return t.type,e},e.prototype.syncSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.createQueryRunner()];case 1:return t=r.sent(),n=[],[4,Promise.all(e.map(function(e){e.indices.forEach(function(r){var i=r.buildColumnsAsMap(1),o={name:r.name};n.push(t.createCollectionIndex(e.table.name,i,o))})}))];case 2:return r.sent(),[4,Promise.all(n)];case 3:return r.sent(),[2]}})})},e.prototype.validateOptions=function(e){if(!e.url&&!e.database)throw new o.DriverOptionNotSetError("database")},e.prototype.loadDependencies=function(){try{return a.PlatformTools.load("mongodb")}catch(e){throw new r.DriverPackageNotInstalledError("MongoDB","mongodb")}},e.prototype.buildConnectionUrl=function(){return this.options.url?this.options.url:"mongodb://"+(this.options.host||"127.0.0.1")+":"+(this.options.port||"27017")+"/"+this.options.database},e}(),e("MongoDriver",s)}}}),System.register("typeorm/query-builder/transformer/DocumentToEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){void 0===e&&(e=!1),this.enableRelationIdValues=e}return e.prototype.transformAll=function(e,t){var n=this;return e.map(function(e){return n.transform(e,t)})},e.prototype.transform=function(e,t){var n=t.create(),r=!1;t.hasObjectIdColumn&&e[t.objectIdColumn.name]&&(n[t.objectIdColumn.propertyName]=e[t.objectIdColumn.name],r=!0),this.enableRelationIdValues&&t.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(t){var i=e[t.name];void 0!==i&&null!==i&&t.propertyName&&(n[t.propertyName]=i,r=!0)}),t.columnsWithoutEmbeddeds.forEach(function(t){var i=e[t.name];void 0===i||null===i||!t.propertyName||t.isVirtual||t.isParentId||t.isDiscriminator||(n[t.propertyName]=i,r=!0)});var i=function(e,t,n){n.forEach(function(n){t[n.prefix]&&(n.isArray?e[n.propertyName]=t[n.prefix].map(function(e){var t=n.create();return n.columns.forEach(function(n){t[n.propertyName]=e[n.name]}),t}):n.columns.forEach(function(r){var i=t[n.prefix][r.name];i&&(e[n.propertyName]||(e[n.propertyName]=n.create()),e[n.propertyName][r.propertyName]=i)}),i(e[n.propertyName],t[n.prefix],n.embeddeds))})};return i(n,e,t.embeddeds),r?n:null},e}(),e("DocumentToEntityTransformer",n)}}}),System.register("typeorm/find-options/FindOptionsUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.where instanceof Object||t.join instanceof Object||t.order instanceof Object)},e.isFindManyOptions=function(e){var t=e;return t&&(t.where instanceof Object||t.join instanceof Object||t.order instanceof Object||"number"==typeof t.skip||"number"==typeof t.take)},e.extractFindOneOptionsAlias=function(e){if(this.isFindOneOptions(e)&&e.join)return e.join.alias},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindOneOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindOneOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?this.applyConditions(e,t):e},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?this.applyConditions(e,t):e},e.applyOptionsToQueryBuilder=function(e,t){return t&&this.isFindOneOptions(t)?(t.where&&this.applyConditions(e,t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(n){e.addOrderBy(e.alias+"."+n,t.order[n])}),t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),e):e},e.applyConditions=function(e,t){return Object.keys(t).forEach(function(n,r){if(null===t[n])e.andWhere(e.alias+"."+n+" IS NULL");else{var i="where_"+r;e.andWhere(e.alias+"."+n+"=:"+i).setParameter(i,t[n])}}),e},e}(),e("FindOptionsUtils",n)}}}),System.register("typeorm/common/DeepPartial",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/MongoRepository",["typeorm/repository/Repository","typeorm/query-builder/transformer/DocumentToEntityTransformer","typeorm/find-options/FindOptionsUtils","mongodb"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.transaction=function(e){throw new Error("Transactions aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.find=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=this.convertFindManyOptionsOrConditionsToMongodbQuery(e),[4,this.createEntityCursor(t)];case 1:return n=r.sent(),i.FindOptionsUtils.isFindManyOptions(e)&&(e.skip&&n.skip(e.skip),e.take&&n.limit(e.take),e.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(e.order))),[2,n.toArray()]}})})},t.prototype.findAndCount=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a;return __generator(this,function(s){switch(s.label){case 0:return t=this.convertFindManyOptionsOrConditionsToMongodbQuery(e),[4,this.createEntityCursor(t)];case 1:return n=s.sent(),i.FindOptionsUtils.isFindManyOptions(e)&&(e.skip&&n.skip(e.skip),e.take&&n.limit(e.take),e.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(e.order))),[4,Promise.all([n.toArray(),this.queryRunner.count(this.metadata.table.name,t)])];case 2:return r=s.sent(),o=r[0],a=r[1],[2,[o,parseInt(a)]]}})})},t.prototype.findByIds=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t)||{},n._id={$in:e},[4,this.createEntityCursor(n)];case 1:return r=o.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[4,r.toArray()];case 2:return[2,o.sent()]}})})},t.prototype.findOne=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(o){switch(o.label){case 0:return t=this.convertFindOneOptionsOrConditionsToMongodbQuery(e),[4,this.createEntityCursor(t)];case 1:return n=o.sent(),i.FindOptionsUtils.isFindOneOptions(e)&&e.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(e.order)),[4,n.limit(1).toArray()];case 2:return r=o.sent(),[2,r.length>0?r[0]:void 0]}})})},t.prototype.findOneById=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:return n=this.convertFindOneOptionsOrConditionsToMongodbQuery(t)||{},n._id=e,[4,this.createEntityCursor(n)];case 1:return r=a.sent(),i.FindOptionsUtils.isFindOneOptions(t)&&t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order)),[4,r.limit(1).toArray()];case 2:return o=a.sent(),[2,o.length>0?o[0]:void 0]}})})},t.prototype.createCursor=function(e){return this.queryRunner.cursor(this.metadata.table.name,e)},t.prototype.createEntityCursor=function(e){var t=this.createCursor(e),n=this;return t.toArray=function(e){if(!e)return o.Cursor.prototype.toArray.call(this).then(function(e){return(new r.DocumentToEntityTransformer).transformAll(e,n.metadata)});o.Cursor.prototype.toArray.call(this,function(t,i){if(t)return void e(t,i);var o=new r.DocumentToEntityTransformer;return e(t,o.transformAll(i,n.metadata))})},t.next=function(e){if(!e)return o.Cursor.prototype.next.call(this).then(function(e){return e?(new r.DocumentToEntityTransformer).transform(e,n.metadata):e});o.Cursor.prototype.next.call(this,function(t,i){if(t||!i)return void e(t,i);var o=new r.DocumentToEntityTransformer;return e(t,o.transform(i,n.metadata))})},t},t.prototype.aggregate=function(e,t){return this.queryRunner.aggregate(this.metadata.table.name,e,t)},t.prototype.bulkWrite=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.bulkWrite(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.count=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.count(this.metadata.table.name,e||{},t)];case 1:return[2,n.sent()]}})})},t.prototype.createCollectionIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.createCollectionIndex(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.createCollectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.createCollectionIndexes(this.metadata.table.name,e)];case 1:return[2,t.sent()]}})})},t.prototype.deleteMany=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.deleteMany(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.deleteOne=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.deleteOne(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.distinct=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.distinct(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.dropCollectionIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.dropCollectionIndex(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.dropCollectionIndexes=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.queryRunner.dropCollectionIndexes(this.metadata.table.name)];case 1:return[2,e.sent()]}})})},t.prototype.findOneAndDelete=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.findOneAndDelete(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.findOneAndReplace=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.findOneAndReplace(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.findOneAndUpdate=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.findOneAndUpdate(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.geoHaystackSearch=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.geoHaystackSearch(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.geoNear=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.geoNear(this.metadata.table.name,e,t,n)];case 1:
return[2,r.sent()]}})})},t.prototype.group=function(e,t,n,r,i,o,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(s){switch(s.label){case 0:return[4,this.queryRunner.group(this.metadata.table.name,e,t,n,r,i,o,a)];case 1:return[2,s.sent()]}})})},t.prototype.collectionIndexes=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.queryRunner.collectionIndexes(this.metadata.table.name)];case 1:return[2,e.sent()]}})})},t.prototype.collectionIndexExists=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.collectionIndexExists(this.metadata.table.name,e)];case 1:return[2,t.sent()]}})})},t.prototype.collectionIndexInformation=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.collectionIndexInformation(this.metadata.table.name,e)];case 1:return[2,t.sent()]}})})},t.prototype.initializeOrderedBulkOp=function(e){return this.queryRunner.initializeOrderedBulkOp(this.metadata.table.name,e)},t.prototype.initializeUnorderedBulkOp=function(e){return this.queryRunner.initializeUnorderedBulkOp(this.metadata.table.name,e)},t.prototype.insertMany=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.insertMany(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.insertOne=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.insertOne(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.isCapped=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.queryRunner.isCapped(this.metadata.table.name)];case 1:return[2,e.sent()]}})})},t.prototype.listCollectionIndexes=function(e){return this.queryRunner.listCollectionIndexes(this.metadata.table.name,e)},t.prototype.mapReduce=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.mapReduce(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.parallelCollectionScan=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.parallelCollectionScan(this.metadata.table.name,e)];case 1:return[2,t.sent()]}})})},t.prototype.reIndex=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.queryRunner.reIndex(this.metadata.table.name)];case 1:return[2,e.sent()]}})})},t.prototype.rename=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunner.rename(this.metadata.table.name,e,t)];case 1:return[2,n.sent()]}})})},t.prototype.replaceOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.replaceOne(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.stats=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.stats(this.metadata.table.name,e)];case 1:return[2,t.sent()]}})})},t.prototype.updateMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.updateMany(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.updateOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.queryRunner.updateOne(this.metadata.table.name,e,t,n)];case 1:return[2,r.sent()]}})})},Object.defineProperty(t.prototype,"queryRunner",{get:function(){return this.connection.driver.queryRunner},enumerable:!0,configurable:!0}),t.prototype.convertFindManyOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindManyOptions(e)?e.where:e},t.prototype.convertFindOneOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindOneOptions(e)?e.where:e},t.prototype.convertFindOptionsOrderToOrderCriteria=function(e){var t={};return Object.keys(e).forEach(function(n){return t[n]=[n,e[n].toLowerCase()]}),t},t}(n.Repository),e("MongoRepository",a)}}}),System.register("typeorm/repository/RepositoryFactory",["typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/repository/SpecificRepository","typeorm/driver/mongodb/MongoDriver","typeorm/repository/MongoRepository"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.createRepository=function(e,t,n){var i;return i=e.driver instanceof o.MongoDriver?new a.MongoRepository:new r.Repository,i.connection=e,i.metadata=t,i.queryRunnerProvider=n,i},e.prototype.createTreeRepository=function(e,t,r){var i=new n.TreeRepository;return i.connection=e,i.metadata=t,i.queryRunnerProvider=r,i},e.prototype.createSpecificRepository=function(e,t,n){return new i.SpecificRepository(e,t,n)},e}(),e("RepositoryFactory",s)}}}),System.register("typeorm/container",[],function(e,t){"use strict";function n(e,t){o=e,a=t}function r(e){if(o)try{var t=o.get(e);if(t)return t;if(!a||!a.fallback)return t}catch(e){if(!a||!a.fallbackOnErrors)throw e}return i.get(e)}t&&t.id;e("useContainer",n),e("getFromContainer",r);var i,o,a;return{setters:[],execute:function(){e("defaultContainer",i=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}()))}}}),System.register("typeorm/repository/RepositoryAggregator",["typeorm/repository/RepositoryFactory","typeorm/container"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e,t,i){this.metadata=t;var o=r.getFromContainer(n.RepositoryFactory);t.table.isClosure?this.repository=this.treeRepository=o.createTreeRepository(e,t,i):this.repository=o.createRepository(e,t,i),this.specificRepository=o.createSpecificRepository(e,t,i)}return e}(),e("RepositoryAggregator",i)}}}),System.register("typeorm/connection/error/RepositoryNotTreeError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name="RepositoryNotTreeError";var r="function"==typeof t&&t.name?t.name:t;return n.message='Repository of the "'+r+'" class is not a TreeRepository. Try to use @ClosureTable decorator instead of @Table.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("RepositoryNotTreeError",n)}}}),System.register("typeorm/entity-manager/error/NoNeedToReleaseEntityManagerError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="NoNeedToReleaseEntityManagerError",t.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("NoNeedToReleaseEntityManagerError",n)}}}),System.register("typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerProviderAlreadyReleasedError",t.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("QueryRunnerProviderAlreadyReleasedError",n)}}}),System.register("typeorm/entity-manager/BaseEntityManager",["typeorm/repository/RepositoryAggregator","typeorm/connection/error/RepositoryNotTreeError","typeorm/entity-manager/error/NoNeedToReleaseEntityManagerError","typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t,this.repositoryAggregators=[]}return e.prototype.getRepository=function(e){return this.queryRunnerProvider?this.obtainRepositoryAggregator(e).repository:this.connection.getRepository(e)},e.prototype.getTreeRepository=function(e){if(this.queryRunnerProvider){var t=this.obtainRepositoryAggregator(e).treeRepository;if(!t)throw new r.RepositoryNotTreeError(e);return t}return this.connection.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){return this.queryRunnerProvider?this.obtainRepositoryAggregator(e).repository:this.connection.getMongoRepository(e)},e.prototype.getSpecificRepository=function(e){return this.queryRunnerProvider?this.obtainRepositoryAggregator(e).specificRepository:this.connection.getSpecificRepository(e)},e.prototype.getCustomRepository=function(e){return this.connection.getCustomRepository(e)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.getRepository(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.getRepository(n).getId(r)},e.prototype.createQueryBuilder=function(e,t){return this.getRepository(e).createQueryBuilder(t)},e.prototype.create=function(e,t){return t instanceof Array?this.getRepository(e).create(t):t?this.getRepository(e).create(t):this.getRepository(e).create()},e.prototype.preload=function(e,t){return this.getRepository(e).preload(t)},e.prototype.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return(i=this.getRepository(e)).merge.apply(i,[t].concat(n));var i},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.queryRunnerProvider)throw new i.NoNeedToReleaseEntityManagerError;return[2,this.queryRunnerProvider.releaseReused()]})})},e.prototype.obtainRepositoryAggregator=function(e){if(this.queryRunnerProvider&&this.queryRunnerProvider.isReleased)throw new o.QueryRunnerProviderAlreadyReleasedError;var t=this.connection.getMetadata(e),r=this.repositoryAggregators.find(function(e){return e.metadata===t});return r||(r=new n.RepositoryAggregator(this.connection,this.connection.getMetadata(e),this.queryRunnerProvider),this.repositoryAggregators.push(r)),r},e}(),e("BaseEntityManager",a)}}}),System.register("typeorm/repository/RemoveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/PersistOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-manager/EntityManager",["typeorm/entity-manager/BaseEntityManager","typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError","typeorm/query-runner/QueryRunnerProvider"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.data={},r}return __extends(t,e),t.prototype.getData=function(e){return this.data[e]},t.prototype.setData=function(e,t){this.data[e]=t},t.prototype.persist=function(e,t,n){var r=this,i=2===arguments.length?t:e,o=2===arguments.length?t:e;return Promise.resolve().then(function(){return"string"==typeof i?r.getRepository(i).persist(o,n):i instanceof Array?0===i.length?Promise.resolve(i):Promise.all(i.map(function(e,t){return r.getRepository(e.constructor).persist(o[t],n)})):r.getRepository(i.constructor).persist(o,n)})},t.prototype.update=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return[2,this.getRepository(e).update(t,n,r)]})})},t.prototype.updateById=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return[2,this.getRepository(e).updateById(t,n,r)]})})},t.prototype.remove=function(e,t,n){var r=this,i=2===arguments.length?t:e,o=2===arguments.length?t:e;return"string"==typeof i?this.getRepository(i).remove(o,n):i instanceof Array?Promise.all(i.map(function(e,t){return r.getRepository(e.constructor).remove(o[t],n)})):this.getRepository(i.constructor).remove(o,n)},t.prototype.removeById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.getRepository(e).removeById(t,n)]})})},t.prototype.count=function(e,t){return this.getRepository(e).count(t)},t.prototype.find=function(e,t){return this.getRepository(e).find(t)},t.prototype.findAndCount=function(e,t){return this.getRepository(e).findAndCount(t)},t.prototype.findOne=function(e,t){return this.getRepository(e).findOne(t)},t.prototype.findByIds=function(e,t,n){return this.getRepository(e).findByIds(t,n)},t.prototype.findOneById=function(e,t,n){return this.getRepository(e).findOneById(t,n)},t.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(a){switch(a.label){case 0:if(this.queryRunnerProvider&&this.queryRunnerProvider.isReleased)throw new r.QueryRunnerProviderAlreadyReleasedError;return n=this.queryRunnerProvider||new i.QueryRunnerProvider(this.connection.driver),[4,n.provide()];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,,4,6]),[4,o.query(e,t)];case 3:return[2,a.sent()];case 4:return[4,n.release(o)];case 5:return a.sent(),[7];case 6:return[2]}})})},t.prototype.transaction=function(e){return __awaiter(this,void 0,void 0,function(){var n,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.queryRunnerProvider&&this.queryRunnerProvider.isReleased)throw new r.QueryRunnerProviderAlreadyReleasedError;return n=this.queryRunnerProvider||new i.QueryRunnerProvider(this.connection.driver,!0),[4,n.provide()];case 1:o=c.sent(),a=new t(this.connection,n),c.label=2;case 2:return c.trys.push([2,6,8,12]),[4,o.beginTransaction()];case 3:return c.sent(),[4,e(a)];case 4:return s=c.sent(),[4,o.commitTransaction()];case 5:return c.sent(),[2,s];case 6:return u=c.sent(),[4,o.rollbackTransaction()];case 7:throw c.sent(),u;case 8:return[4,n.release(o)];case 9:return c.sent(),this.queryRunnerProvider?[3,11]:[4,n.releaseReused()];case 10:c.sent(),c.label=11;case 11:return[7];case 12:return[2]}})})},t.prototype.clear=function(e){return this.getRepository(e).clear()},t}(n.BaseEntityManager),e("EntityManager",o)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer",[],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e.prototype.compareEntities=function(e,t){return this.metadata.compareEntities(e,t)},e}(),r=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),i=function(){function e(e){this.entityManager=e}return e.prototype.transform=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t.checkIfObjectContainsAllPrimaryKeys(e)?(i=new r,o=function(e,r,a,s){var u=new n(e,r,a,s);i.addLoadMap(u),r.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!==e&&void 0!==e}).forEach(function(e){var t=e[0],n=e[1],r=e[2];return o(n,r,u,t)})},o(e,t),[4,Promise.all(i.groupByTargetIds().map(function(e){return a.entityManager.findByIds(e.target,e.ids).then(function(t){return i.fillEntities(e.target,t)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return s.sent(),i.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,i.mainLoadMapItem?i.mainLoadMapItem.entity:void 0]}})})},e}(),e("PlainObjectToDatabaseEntityTransformer",i)}}}),System.register("typeorm/util/PromiseUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.runInSequence=function(e,t){var n=[];return e.reduce(function(e,r){return e.then(function(){return t(r)}).then(function(e){n.push(e)})},Promise.resolve()).then(function(){return n})},e}(),e("PromiseUtils",n)}}}),System.register("typeorm/persistence/SubjectOperationExecutor",["typeorm/util/OrmUtils","typeorm/util/PromiseUtils","typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e,t,n){this.connection=e,this.transactionEntityManager=t,this.queryRunnerProvider=n}return e.prototype.execute=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(e.forEach(function(e){return e.validate()}),this.allSubjects=e,this.insertSubjects=e.filter(function(e){return e.mustBeInserted}),this.updateSubjects=e.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=e.filter(function(e){return e.mustBeRemoved}),this.relationUpdateSubjects=e.filter(function(e){return e.hasRelationUpdates}),!this.insertSubjects.length&&!this.updateSubjects.length&&!this.removeSubjects.length&&!this.relationUpdateSubjects.length&&e.every(function(e){return!e.junctionInserts.length})&&e.every(function(e){return!e.junctionRemoves.length}))return[2];t=!1,o.label=1;case 1:return o.trys.push([1,17,,22]),n=this,[4,this.queryRunnerProvider.provide()];case 2:return n.queryRunner=o.sent(),this.queryRunner.isTransactionActive()?[3,4]:(t=!0,[4,this.queryRunner.beginTransaction()]);case 3:o.sent(),o.label=4;case 4:return[4,this.connection.broadcaster.broadcastBeforeEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 5:return o.sent(),this.updateSubjects.forEach(function(e){return e.recompute()}),[4,this.executeInsertOperations()];case 6:return o.sent(),[4,this.executeInsertClosureTableOperations()];case 7:return o.sent(),[4,this.executeInsertJunctionsOperations()];case 8:return o.sent(),[4,this.executeRemoveJunctionsOperations()];case 9:return o.sent(),[4,this.executeUpdateOperations()];case 10:return o.sent(),[4,this.executeUpdateRelations()];case 11:return o.sent(),[4,this.executeRemoveOperations()];case 12:return o.sent(),!0!==t?[3,14]:[4,this.queryRunner.commitTransaction()];case 13:o.sent(),o.label=14;case 14:return[4,this.updateSpecialColumnsInPersistedEntities()];case 15:return o.sent(),[4,this.connection.broadcaster.broadcastAfterEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 16:return o.sent(),[3,22];case 17:if(r=o.sent(),!t)return[3,21];o.label=18;case 18:return o.trys.push([18,20,,21]),[4,this.queryRunner.rollbackTransaction()];case 19:return o.sent(),[3,21];case 20:return i=o.sent(),[3,21];case 21:throw r;case 22:return[2]}})})},e.prototype.executeInsertOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return e=this.insertSubjects.filter(function(e){return!e.metadata.hasNonNullableColumns}),t=this.insertSubjects.filter(function(e){return e.metadata.hasNonNullableColumns}),[4,Promise.all(e.map(function(e){return r.insert(e,[])}))];case 1:return i.sent(),[4,Promise.all(t.map(function(t){return r.insert(t,e)}))];case 2:return i.sent(),n=[],e.forEach(function(e){var t={};if(e.metadata.relationsWithJoinColumns.forEach(function(n){var i=n.joinColumn.referencedColumn,o=n.getEntityValue(e.entity);if(o){var a,s=n.inverseEntityMetadata.relations.find(function(e){return e.propertyName===n.joinColumn.referencedColumn.propertyName});if(s){var u=r.insertSubjects.find(function(e){return e.entity===o[i.propertyName]});u&&((a=o[i.propertyName][s.propertyName])||(i.isGenerated?a=u.newlyGeneratedId:i.isObjectId&&(a=u.generatedObjectId)))}else{var u=r.insertSubjects.find(function(e){return e.entity===o});u&&((a=o[i.propertyName])||(i.isGenerated?a=u.newlyGeneratedId:i.isObjectId&&(a=u.generatedObjectId)))}a&&(t[n.name]=a)}}),Object.keys(t).length>0){var i=e.metadata.parentEntityMetadata?e.metadata.primaryColumnsWithParentIdColumns:e.metadata.primaryColumns,o={};if(i.forEach(function(t){var n=e.entity[t.propertyName],i=e.metadata.relations.find(function(e){return e.propertyName===t.propertyName});if(n&&i&&i.joinColumn){var a=n[i.joinColumn.referencedColumn.propertyName];if(!a){var s=r.insertSubjects.find(function(e){return e.entity===n});s&&(i.joinColumn.referencedColumn.isGenerated?a=s.newlyGeneratedId:i.joinColumn.referencedColumn.isObjectId&&(a=s.generatedObjectId))}a&&(o[t.fullName]=a)}else n?o[t.fullName]=n:e.newlyGeneratedId?o[t.fullName]=e.newlyGeneratedId:e.generatedObjectId&&(o[t.fullName]=e.generatedObjectId)}),!Object.keys(o).length)return;var a=r.queryRunner.update(e.metadata.table.name,t,o);n.push(a)}var s=e.metadata.oneToManyRelations.concat(e.metadata.oneToOneRelations.filter(function(e){return!e.isOwning}));e.metadata.extractRelationValuesFromEntity(e.entity,s).forEach(function(t){var i=t[0],o=t[1],a=t[2],s=i.inverseRelation.joinColumn.referencedColumn,u=a.parentEntityMetadata?a.primaryColumnsWithParentIdColumns:a.primaryColumns,c={};if(u.forEach(function(e){var t=o[e.propertyName],n=a.relations.find(function(t){return t.propertyName===e.propertyName});if(t&&n&&n.joinColumn){var i=t[n.joinColumn.referencedColumn.propertyName];if(!i){var s=r.insertSubjects.find(function(e){return e.entity===t});s&&(n.joinColumn.referencedColumn.isGenerated?i=s.newlyGeneratedId:n.joinColumn.referencedColumn.isObjectId&&(i=s.generatedObjectId))}i&&(c[e.fullName]=i)}else{var s=r.insertSubjects.find(function(e){return e.entity===o});t?c[e.fullName]=t:s&&s.newlyGeneratedId?c[e.fullName]=s.newlyGeneratedId:s&&s.generatedObjectId&&(c[e.fullName]=s.generatedObjectId)}}),Object.keys(c).length){var l={},d=i.inverseEntityMetadata.relations.find(function(e){return e.propertyName===s.propertyName});if(d){var m=e.entity[s.propertyName][d.propertyName];if(!m){var p=r.insertSubjects.find(function(e){return e.entity===e.entity[s.propertyName]});p&&(p.newlyGeneratedId?m=p.newlyGeneratedId:p.generatedObjectId&&(m=p.generatedObjectId))}l[i.inverseRelation.joinColumn.name]=m}else l[i.inverseRelation.joinColumn.name]=e.entity[s.propertyName]||e.newlyGeneratedId||o.generatedObjectId;var f=r.queryRunner.update(i.inverseEntityMetadata.table.name,l,c);n.push(f)}})}),[4,Promise.all(n)];case 3:return i.sent(),[2]}})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:return n=e.metadata.parentEntityMetadata,(r=e.metadata,i=e.entity,r.table.isClassTableChild)?(s=this.collectColumnsAndValues(n,i,e.date,void 0,r.discriminatorValue,t),[4,this.queryRunner.insert(n.table.name,s,n.generatedColumnIfExist)]):[3,3];case 1:return o=a=d.sent(),u=this.collectColumnsAndValues(r,i,e.date,o,void 0,t),[4,this.queryRunner.insert(r.table.name,u,r.generatedColumnIfExist)];case 2:return c=d.sent(),!o&&c&&(o=c),[3,5];case 3:return l=this.collectColumnsAndValues(r,i,e.date,void 0,void 0,t),[4,this.queryRunner.insert(r.table.name,l,r.generatedColumnIfExist)];case 4:o=d.sent(),d.label=5;case 5:return a&&(e.parentGeneratedId=a),o&&(r.hasGeneratedColumn?e.newlyGeneratedId=o:r.hasObjectIdColumn&&(e.generatedObjectId=o)),[2]}})})},e.prototype.collectColumnsAndValues=function(e,t,r,o,a,s){var u=this,c=[],l=[],d={};e.columnsWithoutEmbeddeds.filter(function(e){return!e.isVirtual&&!e.isParentId&&!e.isDiscriminator&&e.hasEntityValue(t)}).forEach(function(e){var n=u.connection.driver.preparePersistentValue(t[e.propertyName],e);c.push(e.fullName),l.push(n),d[e.name]=n});var m=function(e,t,n){n.forEach(function(n){e[n.propertyName]&&(n.isArray?t[n.propertyName]=e[n.propertyName].map(function(e){var t={};return n.columns.forEach(function(n){var r=u.connection.driver.preparePersistentValue(e[n.propertyName],n);c.push(n.fullName),l.push(r),t[n.propertyName]=r}),t}):(t[n.propertyName]={},n.columns.forEach(function(r){var i=u.connection.driver.preparePersistentValue(e[n.propertyName][r.propertyName],r);c.push(r.fullName),l.push(i),t[n.propertyName][r.propertyName]=i})),m(e[n.propertyName],t[n.propertyName],n.embeddeds))})};if(m(t,d,e.embeddeds),e.relationsWithJoinColumns.forEach(function(e){var n,r=e.getEntityValue(t);if(r){var i=e.getInverseEntityRelationId(r);i&&(n=i);var o=s.find(function(e){return e.entity===r});if(o){var a=e.joinColumn.referencedColumn;a.referencedColumn&&a.referencedColumn.isGenerated&&a.isParentId&&(n=o.parentGeneratedId),a.isGenerated&&(n=o.newlyGeneratedId),a.isObjectId&&(n=o.generatedObjectId),(a.isCreateDate||a.isUpdateDate)&&(n=u.connection.driver.preparePersistentValue(o.date,a)),a.isVersion&&(n=u.connection.driver.preparePersistentValue(1,a))}}else if(e.hasInverseSide){var m=u.allSubjects.find(function(n){if(!n.hasEntity||n.entityTarget!==e.inverseRelation.target)return!1;var r=n.entity[e.inverseRelation.propertyName];return r?r instanceof Array?r.find(function(e){return e===e}):r===t:void 0});m&&m.entity[e.joinColumn.referencedColumn.propertyName]&&(n=m.entity[e.joinColumn.referencedColumn.propertyName])}n&&(c.push(e.name),l.push(n),d[e.propertyName]=t[e.name])}),e.hasCreateDateColumn){var p=this.connection.driver.preparePersistentValue(r,e.createDateColumn);c.push(e.createDateColumn.fullName),l.push(p),d[e.createDateColumn.fullName]=p}if(e.hasUpdateDateColumn){var p=this.connection.driver.preparePersistentValue(r,e.updateDateColumn);c.push(e.updateDateColumn.fullName),l.push(p),d[e.updateDateColumn.fullName]=p}if(e.hasVersionColumn){var p=this.connection.driver.preparePersistentValue(1,e.versionColumn);c.push(e.versionColumn.fullName),l.push(p),d[e.versionColumn.fullName]=p}if(e.hasDiscriminatorColumn){var p=this.connection.driver.preparePersistentValue(a||e.discriminatorValue,e.discriminatorColumn);c.push(e.discriminatorColumn.fullName),l.push(p),d[e.discriminatorColumn.fullName]=p}if(e.hasTreeLevelColumn&&e.hasTreeParentRelation){var f=t[e.treeParentRelation.propertyName],y=f?f[e.treeLevelColumn.propertyName]||0:0;c.push(e.treeLevelColumn.fullName),l.push(y+1)}return e.parentEntityMetadata&&e.hasParentIdColumn&&(c.push(e.parentIdColumn.fullName),l.push(o||t[e.parentEntityMetadata.firstPrimaryColumn.propertyName])),this.connection.driver instanceof i.MongoDriver?d:n.OrmUtils.zipObject(c,l)},e.prototype.executeInsertClosureTableOperations=function(){var e=this,t=this.insertSubjects.filter(function(e){return e.metadata.table.isClosure}).map(function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.insertClosureTableValues(t)];case 1:return e.sent(),[2]}})})});return Promise.all(t)},e.prototype.insertClosureTableValues=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,d;return __generator(this,function(m){switch(m.label){case 0:return t=e.metadata.closureJunctionTable.table.name,n=e.metadata.treeParentRelation.joinColumn.referencedColumn,r=e.entity[n.propertyName],!r&&n.isGenerated&&(r=e.newlyGeneratedId),i=e.entity[e.metadata.treeParentRelation.propertyName],o=0,i&&!(o=i[n.propertyName])&&n.isGenerated&&(a=this.insertSubjects.find(function(e){return e.entity===i}),o=a.newlyGeneratedId),o||(s=this.allSubjects.find(function(t){if(!t.hasEntity||!t.metadata.table.isClosure||!t.metadata.hasTreeChildrenRelation)return!1;var n=t.entity[e.metadata.treeChildrenRelation.propertyName];return n instanceof Array&&-1!==n.indexOf(e.entity)}))&&!(o=s.entity[n.propertyName])&&s.newlyGeneratedId&&(o=s.newlyGeneratedId),u=e,[4,this.queryRunner.insertIntoClosureTable(t,r,o,e.metadata.hasTreeLevelColumn)];case 1:return u.treeLevel=m.sent(),e.metadata.hasTreeLevelColumn?(l={},l[e.metadata.treeLevelColumn.fullName]=e.treeLevel,c=l,[4,this.queryRunner.update(e.metadata.table.name,c,(d={},d[n.fullName]=r,d))]):[3,3];case 2:m.sent(),m.label=3;case 3:return[2]}})})},e.prototype.executeUpdateOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return e.update(t)}))];case 1:return t.sent(),[2]}})})},e.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,s,s,s,s,u=this;return __generator(this,function(c){switch(c.label){case 0:if(t=e.entity,this.connection.driver instanceof i.MongoDriver){if(!(n=e.metadata.getDatabaseEntityIdMap(t)))throw new Error("Internal error. Cannot get id of the updating entity.");return r=function(e,t,n){n.forEach(function(n){e[n.propertyName]&&(n.isArray?t[n.prefix]=e[n.propertyName].map(function(e){var t={};return n.columns.forEach(function(n){t[n.name]=e[n.propertyName]}),t}):n.columns.forEach(function(r){t[n.prefix]||(t[n.prefix]={}),t[n.prefix][r.name]=e[n.propertyName][r.propertyName]}),r(e[n.propertyName],t[n.prefix],n.embeddeds))})},(o={},e.metadata.columnsWithoutEmbeddeds.forEach(function(e){void 0!==t[e.propertyName]&&(o[e.fullName]=t[e.propertyName])}),r(t,o,e.metadata.embeddeds),0===Object.keys(o).length)?[2]:(e.metadata.hasUpdateDateColumn&&(o[e.metadata.updateDateColumn.fullName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.hasVersionColumn&&(o[e.metadata.versionColumn.fullName]=this.connection.driver.preparePersistentValue(t[e.metadata.versionColumn.propertyName]+1,e.metadata.versionColumn)),[2,this.queryRunner.update(e.metadata.table.name,o,n)])}return a=[],(e.diffColumns.forEach(function(e){if(e.entityTarget){var n=u.connection.getMetadata(e.entityTarget),r=a.find(function(e){return e.tableName===n.table.name});r||(r={tableName:n.table.name,metadata:n,values:{}},a.push(r)),
r.values[e.fullName]=u.connection.driver.preparePersistentValue(e.getEntityValue(t),e)}}),e.diffRelations.forEach(function(e){var n=u.connection.getMetadata(e.entityTarget),r=a.find(function(e){return e.tableName===n.table.name});r||(r={tableName:n.table.name,metadata:n,values:{}},a.push(r));var i=e.getEntityValue(t);r.values[e.name]=null!==i&&void 0!==i?i[e.inverseEntityMetadata.firstPrimaryColumn.propertyName]:null}),0===Object.keys(a).length)?[2]:(e.metadata.hasUpdateDateColumn&&(s=a.find(function(t){return t.tableName===e.metadata.table.name}),s||(s={tableName:e.metadata.table.name,metadata:e.metadata,values:{}},a.push(s)),s.values[e.metadata.updateDateColumn.fullName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.hasVersionColumn&&(s=a.find(function(t){return t.tableName===e.metadata.table.name}),s||(s={tableName:e.metadata.table.name,metadata:e.metadata,values:{}},a.push(s)),s.values[e.metadata.versionColumn.fullName]=this.connection.driver.preparePersistentValue(t[e.metadata.versionColumn.propertyName]+1,e.metadata.versionColumn)),e.metadata.parentEntityMetadata&&(e.metadata.parentEntityMetadata.hasUpdateDateColumn&&(s=a.find(function(t){return t.tableName===e.metadata.parentEntityMetadata.table.name}),s||(s={tableName:e.metadata.parentEntityMetadata.table.name,metadata:e.metadata.parentEntityMetadata,values:{}},a.push(s)),s.values[e.metadata.parentEntityMetadata.updateDateColumn.fullName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.parentEntityMetadata.updateDateColumn)),e.metadata.parentEntityMetadata.hasVersionColumn&&(s=a.find(function(t){return t.tableName===e.metadata.parentEntityMetadata.table.name}),s||(s={tableName:e.metadata.parentEntityMetadata.table.name,metadata:e.metadata.parentEntityMetadata,values:{}},a.push(s)),s.values[e.metadata.parentEntityMetadata.versionColumn.fullName]=this.connection.driver.preparePersistentValue(t[e.metadata.parentEntityMetadata.versionColumn.propertyName]+1,e.metadata.parentEntityMetadata.versionColumn))),[4,Promise.all(a.map(function(e){var n=e.metadata.getDatabaseEntityIdMap(t);if(!n)throw new Error("Internal error. Cannot get id of the updating entity.");return u.queryRunner.update(e.tableName,e.values,n)}))]);case 1:return c.sent(),[2]}})})},e.prototype.executeUpdateRelations=function(){var e=this;return Promise.all(this.relationUpdateSubjects.map(function(t){return e.updateRelations(t)}))},e.prototype.updateRelations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){if(t={},e.relationUpdates.forEach(function(e){var n=e.value?e.value[e.relation.joinColumn.referencedColumn.propertyName]:null;t[e.relation.name]=n}),!(n=e.metadata.getDatabaseEntityIdMap(e.databaseEntity)))throw new Error("Internal error. Cannot get id of the updating entity.");return[2,this.queryRunner.update(e.metadata.table.name,t,n)]})})},e.prototype.executeRemoveOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,r.PromiseUtils.runInSequence(this.removeSubjects,function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.remove(t)];case 1:return[2,e.sent()]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return e.metadata.parentEntityMetadata?(t={},e.metadata.parentPrimaryColumns.forEach(function(n){t[n.fullName]=e.databaseEntity[n.propertyName]}),[4,this.queryRunner.delete(e.metadata.parentEntityMetadata.table.name,t)]):[3,3];case 1:return r.sent(),n={},e.metadata.primaryColumnsWithParentIdColumns.forEach(function(t){n[t.fullName]=e.databaseEntity[t.propertyName]}),[4,this.queryRunner.delete(e.metadata.table.name,n)];case 2:return r.sent(),[3,5];case 3:return[4,this.queryRunner.delete(e.metadata.table.name,e.metadata.getEntityIdColumnMap(e.databaseEntity))];case 4:r.sent(),r.label=5;case 5:return[2]}})})},e.prototype.executeInsertJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionInserts.forEach(function(r){e.push(t.insertJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.insertJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(l){switch(l.label){case 0:if(r=t.relation,i=r.isOwning?r.joinTable:r.inverseRelation.joinTable,o=r.isOwning?i.referencedColumn:i.inverseReferencedColumn,a=r.isOwning?i.inverseReferencedColumn:i.referencedColumn,s=r.getOwnEntityRelationId(e.entity),s||(o.isGenerated?s=e.newlyGeneratedId:o.isObjectId&&(s=e.generatedObjectId)),!s)throw new Error("Cannot insert object of "+e.entityTarget+" type. Looks like its not persisted yet, or cascades are not set on the relation.");return u=t.junctionEntities.map(function(e){var t;if(r.isManyToManyOwner?t=e[r.joinTable.inverseReferencedColumn.propertyName]:r.isManyToManyNotOwner&&(t=e[r.inverseRelation.joinTable.referencedColumn.propertyName]),!t){var i=c.insertSubjects.find(function(t){return t.entity===e});i&&(a.isGenerated?t=i.newlyGeneratedId:a.isObjectId&&(t=i.generatedObjectId))}if(!t)throw new Error("Cannot insert object of "+e.constructor.name+" type. Looks like its not persisted yet, or cascades are not set on the relation.");var o=r.junctionEntityMetadata.columnsWithoutEmbeddeds.map(function(e){return e.fullName}),u=r.isOwning?[s,t]:[t,s];return c.queryRunner.insert(r.junctionEntityMetadata.table.name,n.OrmUtils.zipObject(o,u))}),[4,Promise.all(u)];case 1:return l.sent(),[2]}})})},e.prototype.executeRemoveJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionRemoves.forEach(function(r){e.push(t.removeJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.removeJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return n=t.relation.junctionEntityMetadata,r=e.hasEntity?e.entity:e.databaseEntity,i=t.relation.getOwnEntityRelationId(r),o=t.relation.isOwning?n.columns[0]:n.columns[1],a=t.relation.isOwning?n.columns[1]:n.columns[0],s=t.junctionRelationIds.map(function(e){return u.queryRunner.delete(n.table.name,(t={},t[o.fullName]=i,t[a.fullName]=e,t));var t}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){this.insertSubjects.forEach(function(e){e.generatedObjectId&&e.metadata.hasObjectIdColumn&&(e.entity[e.metadata.objectIdColumn.propertyName]=e.generatedObjectId),e.metadata.primaryColumns.forEach(function(t){e.newlyGeneratedId&&(e.entity[t.propertyName]=e.newlyGeneratedId)}),e.metadata.parentPrimaryColumns.forEach(function(t){e.parentGeneratedId&&(e.entity[t.propertyName]=e.parentGeneratedId)}),e.metadata.hasUpdateDateColumn&&(e.entity[e.metadata.updateDateColumn.propertyName]=e.date),e.metadata.hasCreateDateColumn&&(e.entity[e.metadata.createDateColumn.propertyName]=e.date),e.metadata.hasVersionColumn&&(e.entity[e.metadata.versionColumn.propertyName]=1),e.metadata.hasTreeLevelColumn&&(e.entity[e.metadata.treeLevelColumn.propertyName]=e.treeLevel)}),this.updateSubjects.forEach(function(e){e.metadata.hasUpdateDateColumn&&(e.entity[e.metadata.updateDateColumn.propertyName]=e.date),e.metadata.hasVersionColumn&&e.entity[e.metadata.versionColumn.propertyName]++}),this.removeSubjects.filter(function(e){return e.hasEntity}).forEach(function(e){e.metadata.primaryColumns.forEach(function(t){e.entity[t.propertyName]=void 0})})},e}(),e("SubjectOperationExecutor",o)}}}),System.register("typeorm/persistence/SubjectBuilder",["typeorm/persistence/Subject","typeorm/repository/SpecificRepository","typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t,this.operateSubjects=[]}return e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.canBeInserted=!0,r.canBeUpdated=!0,this.operateSubjects.push(r),this.buildCascadeUpdateAndInsertOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!0,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.mustBeRemoved=!0,this.operateSubjects.push(r),this.buildCascadeRemoveOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!1,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.buildCascadeUpdateAndInsertOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&(t.isCascadeInsert||t.isCascadeUpdate)}).forEach(function(e){var r=e[0],i=e[1],o=e[2],a=t.findByEntityLike(o.target,i);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===r.isCascadeInsert),void(!1===a.canBeUpdated&&(a.canBeUpdated=!0===r.isCascadeUpdate));var s=new n.Subject(o,i);s.canBeInserted=!0===r.isCascadeInsert,s.canBeUpdated=!0===r.isCascadeUpdate,t.operateSubjects.push(s),t.buildCascadeUpdateAndInsertOperateSubjects(s)})},e.prototype.buildCascadeRemoveOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&t.isCascadeRemove}).forEach(function(e){var r=(e[0],e[1]),i=e[2],o=t.findByEntityLike(i.target,r);if(o)return void(o.mustBeRemoved=!0);var a=new n.Subject(i,r);a.mustBeRemoved=!0,t.operateSubjects.push(a),t.buildCascadeRemoveOperateSubjects(a)})},e.prototype.loadOperateSubjectsDatabaseEntities=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=this.groupByEntityTargets().map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.subjects.filter(function(e){return!e.hasDatabaseEntity}).map(function(e){return e.metadata.getEntityIdMixedMap(e.entity)}).filter(function(e){return e instanceof Object?Object.keys(e).every(function(t){return void 0!==e[t]&&null!==e[t]&&""!==e[t]}):void 0!==e&&null!==e&&""!==e}),t.length?this.connection.driver instanceof i.MongoDriver?[4,this.connection.getMongoRepository(e.target).findByIds(t)]:[3,2]:[2];case 1:return n=o.sent(),[3,4];case 2:return[4,this.connection.getRepository(e.target).createQueryBuilder("operateSubject",this.queryRunnerProvider).andWhereInIds(t).enableOption("RELATION_ID_VALUES").getMany()];case 3:n=o.sent(),o.label=4;case 4:return n.forEach(function(t){var n=r.findByEntityLike(e.target,t);n&&(n.databaseEntity=t)}),[2]}})})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.buildCascadeRemovedAndRelationUpdateOperateSubjects=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(i){switch(i.label){case 0:return t=e.metadata.relations.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,i,o,a,s,u,c,a,s,l,u,c,d,m,p,f,y,h,h,h,g,v,b=this;return __generator(this,function(E){switch(E.label){case 0:return r=t.inverseEntityMetadata,(i=r.table.name,e.hasDatabaseEntity)?t.isOneToOneOwner||t.isManyToOne?t.isCascadeRemove?null===(o=e.databaseEntity[t.joinColumn.propertyName])||void 0===o?[2]:(a=void 0,e.hasEntity&&(s=t.getEntityValue(e.entity),null===s&&(a=null),s&&(a=s[t.joinColumn.referencedColumn.propertyName]),void 0===a)?[2]:null!==a&&a===o?[2]:(u=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&e.databaseEntity[t.joinColumn.referencedColumn.propertyName]===o}),u?[3,2]:[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).where(i+"."+t.joinColumn.referencedColumn.propertyName+"=:id").setParameter("id",o).enableOption("RELATION_ID_VALUES").getOne()])):[2]:[3,4]:[2];case 1:c=E.sent(),c&&(u=new n.Subject(r,void 0,c),this.operateSubjects.push(u)),E.label=2;case 2:return u?u.mustBeRemoved?[2]:(u.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(u)]):[3,4];case 3:E.sent(),E.label=4;case 4:return t.isOneToOneNotOwner?t.isCascadeRemove?(a=void 0,e.hasEntity&&!e.mustBeRemoved&&(s=t.getEntityValue(e.entity),s&&(a=s[t.inverseRelation.joinColumn.propertyName]),void 0===a)?[2]:null===(l=e.databaseEntity[t.inverseRelation.joinColumn.referencedColumn.propertyName])||void 0===l?[2]:(u=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&e.databaseEntity[t.inverseRelation.joinColumn.propertyName]===l}),u?[3,6]:[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).where(i+"."+t.inverseSideProperty+"=:id").setParameter("id",l).enableOption("RELATION_ID_VALUES").getOne()])):[2]:[3,8];case 5:c=E.sent(),u=new n.Subject(r,void 0,c),this.operateSubjects.push(u),E.label=6;case 6:return u&&u.hasDatabaseEntity?(d=u.databaseEntity[t.inverseRelation.joinColumn.propertyName],a&&a===d?[2]:u.mustBeRemoved?[2]:(u.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(u)])):[3,8];case 7:E.sent(),E.label=8;case 8:return t.isOneToMany||t.isManyToMany?(m=void 0,e.hasEntity&&void 0===(m=t.getEntityValue(e.entity))?[2]:(p=[],f=function(e){return b.connection.driver.escapeAliasName(e)},y=function(e){return b.connection.driver.escapeColumnName(e)},t.isManyToManyOwner?(h=e.databaseEntity[t.joinTable.referencedColumn.propertyName],t.isCascadeRemove?[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).innerJoin(t.junctionEntityMetadata.table.name,"persistenceJoinedRelation",f("persistenceJoinedRelation")+"."+y(t.joinTable.inverseJoinColumnName)+"="+f(i)+"."+y(t.joinTable.inverseReferencedColumn.fullName)+" AND "+f("persistenceJoinedRelation")+"."+y(t.joinTable.joinColumnName)+"=:id").setParameter("id",h).enableOption("RELATION_ID_VALUES").getMany()]:[2]):[3,10])):[3,18];case 9:return p=E.sent(),[3,14];case 10:return t.isManyToManyNotOwner?(h=e.databaseEntity[t.inverseRelation.joinTable.inverseReferencedColumn.propertyName],t.isCascadeRemove?[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).innerJoin(t.junctionEntityMetadata.table.name,"persistenceJoinedRelation",f("persistenceJoinedRelation")+"."+y(t.joinTable.joinColumnName)+"="+f(i)+"."+y(t.joinTable.referencedColumn.fullName)+" AND "+f("persistenceJoinedRelation")+"."+y(t.inverseRelation.joinTable.inverseJoinColumnName)+"=:id").setParameter("id",h).enableOption("RELATION_ID_VALUES").getMany()]:[2]):[3,12];case 11:return p=E.sent(),[3,14];case 12:return h=e.databaseEntity[t.inverseRelation.joinColumn.referencedColumn.propertyName],[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).where(i+"."+t.inverseSideProperty+"=:id").setParameter("id",h).enableOption("RELATION_ID_VALUES").getMany()];case 13:p=E.sent(),E.label=14;case 14:return p.forEach(function(e){var t=b.findByEntityLike(r.target,e);if(t&&!t.hasDatabaseEntity)t.databaseEntity=e;else if(!t){var i=new n.Subject(r,void 0,e);b.operateSubjects.push(i)}}),t.isOneToMany&&m?(g=m.map(function(o){return __awaiter(b,void 0,void 0,function(){var a,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return(a=p.find(function(e){return r.compareEntities(o,e)}))?[3,3]:(s=this.findByDatabaseEntityLike(r.target,o))?[3,2]:(u=r.getEntityIdMixedMap(o),u?[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).andWhereInIds([u]).enableOption("RELATION_ID_VALUES").getOne()]:[3,2]);case 1:c=l.sent(),c&&(s=new n.Subject(r,void 0,c),this.operateSubjects.push(s)),l.label=2;case 2:s&&s.relationUpdates.push({relation:t.inverseRelation,value:e.entity}),l.label=3;case 3:return[2]}})})}),[4,Promise.all(g)]):[3,16];case 15:E.sent(),E.label=16;case 16:return v=p.map(function(e){return __awaiter(b,void 0,void 0,function(){var n,i;return __generator(this,function(o){switch(o.label){case 0:return(n=this.findByDatabaseEntityLike(r.target,e))?n.mustBeRemoved?[2]:(i=(m||[]).find(function(e){return r.compareEntities(n.databaseEntity,e)}),null!==m&&i?[3,3]:t.isCascadeRemove?(n.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(n)]):[3,2]):[2];case 1:return o.sent(),[3,3];case 2:t.isOneToMany&&t.inverseRelation&&n.relationUpdates.push({relation:t.inverseRelation,value:null}),o.label=3;case 3:return[2]}})})}),[4,Promise.all(v)];case 17:E.sent(),E.label=18;case 18:return[2]}})})}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e.prototype.buildJunctionOperations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(i){switch(i.label){case 0:return t=this.operateSubjects.filter(function(e){return e.hasEntity}).map(function(t){var i=t.metadata.manyToManyRelations.map(function(i){return __awaiter(n,void 0,void 0,function(){var n,o,a,s,n,u,c,l;return __generator(this,function(d){switch(d.label){case 0:return t.mustBeRemoved&&e.remove?(n=new r.SpecificRepository(this.connection,t.metadata,this.queryRunnerProvider),[4,n.findRelationIds(i,t.databaseEntity)]):[3,2];case 1:return o=d.sent(),o.length>0&&t.junctionRemoves.push({relation:i,junctionRelationIds:o}),[2];case 2:return t.hasEntity&&(a=i.getEntityValue(t.entity))instanceof Array?(s=[],t.hasDatabaseEntity?(n=new r.SpecificRepository(this.connection,t.metadata,this.queryRunnerProvider),[4,n.findRelationIds(i,t.databaseEntity)]):[3,4]):[2];case 3:s=d.sent(),d.label=4;case 4:return u=a.map(function(e){return i.isManyToManyOwner?e[i.joinTable.inverseReferencedColumn.propertyName]:e[i.inverseRelation.joinTable.referencedColumn.propertyName]}).filter(function(e){return void 0!==e&&null!==e}),c=s.filter(function(e){return!u.find(function(t){return t===e})}),l=a.filter(function(e){var t=i.isManyToManyOwner?e[i.joinTable.inverseReferencedColumn.propertyName]:e[i.inverseRelation.joinTable.referencedColumn.propertyName];return!s.find(function(e){return t===e})}),l.length>0&&e.insert&&t.junctionInserts.push({relation:i,junctionEntities:l}),c.length>0&&e.remove&&t.junctionRemoves.push({relation:i,junctionRelationIds:c}),[2]}})})});return Promise.all(i)}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e.prototype.findByEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasEntity&&(n.entity===t||n.entityTarget===e&&n.metadata.compareEntities(n.entity,t))})},e.prototype.findByDatabaseEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasDatabaseEntity&&(n.entityTarget===e&&n.metadata.compareEntities(n.databaseEntity,t))})},e.prototype.groupByEntityTargets=function(){return this.operateSubjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.entityTarget});return n||(n={target:t.entityTarget,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),e("SubjectBuilder",o)}}}),System.register("typeorm/repository/Repository",["typeorm/query-builder/QueryBuilder","typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer","typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer","typeorm/find-options/FindOptionsUtils","typeorm/query-runner/QueryRunnerProvider","typeorm/persistence/SubjectOperationExecutor","typeorm/persistence/SubjectBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(){}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.metadata.hasId(e)},e.prototype.getId=function(e){return this.metadata.getEntityIdMixedMap(e)},e.prototype.createQueryBuilder=function(e,t){return new n.QueryBuilder(this.connection,t||this.queryRunnerProvider).select(e).from(this.metadata.target,e)},e.prototype.create=function(e){var t=this;return e?e instanceof Array?e.map(function(e){return t.create(e)}):this.merge(this.metadata.create(),e):this.metadata.create()},e.prototype.merge=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=new r.PlainObjectToNewEntityTransformer;return n.forEach(function(n){return o.transform(e,n,t.metadata)}),e},e.prototype.preload=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=new i.PlainObjectToDatabaseEntityTransformer(this.connection.entityManager),[4,t.transform(e,this.metadata)];case 1:return n=r.sent(),n?[2,this.merge(n,e)]:[2,void 0]}})})},e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(c){switch(c.label){case 0:if(!e)return[2,e];if(e instanceof Array)return[2,Promise.all(e.map(function(e){return o.persist(e)}))];t=this.queryRunnerProvider||new a.QueryRunnerProvider(this.connection.driver,!0),c.label=1;case 1:return c.trys.push([1,,4,7]),n=this.connection.createEntityManagerWithSingleDatabaseConnection(t),r=new u.SubjectBuilder(this.connection,t),[4,r.persist(e,this.metadata)];case 2:return c.sent(),i=new s.SubjectOperationExecutor(this.connection,n,t),[4,i.execute(r.operateSubjects)];case 3:return c.sent(),[2,e];case 4:return this.queryRunnerProvider?[3,6]:[4,t.releaseReused()];case 5:c.sent(),c.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOne(e)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to update by a given criteria");return Object.assign(r,t),[4,this.persist(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.updateById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOneById(e)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to update by a id");return Object.assign(r,t),[4,this.persist(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(c){switch(c.label){case 0:if(!e)return[2,e];if(e instanceof Array)return[2,Promise.all(e.map(function(e){return o.remove(e)}))];t=this.queryRunnerProvider||new a.QueryRunnerProvider(this.connection.driver,!0),c.label=1;case 1:return c.trys.push([1,,4,7]),n=this.connection.createEntityManagerWithSingleDatabaseConnection(t),r=new u.SubjectBuilder(this.connection,t),[4,r.remove(e,this.metadata)];case 2:return c.sent(),i=new s.SubjectOperationExecutor(this.connection,n,t),[4,i.execute(r.operateSubjects)];case 3:return c.sent(),[2,e];case 4:return this.queryRunnerProvider?[3,6]:[4,t.releaseReused()];case 5:c.sent(),c.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.removeById=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.findOneById(e)];case 1:if(!(n=r.sent()))throw new Error("Cannot find entity to remove by a given id");return[4,this.remove(n,t)];case 2:return r.sent(),[2]}})})},e.prototype.count=function(e){var t=this.createQueryBuilder(o.FindOptionsUtils.extractFindManyOptionsAlias(e)||this.metadata.table.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(t,e).getCount()},e.prototype.find=function(e){var t=this.createQueryBuilder(o.FindOptionsUtils.extractFindManyOptionsAlias(e)||this.metadata.table.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(t,e).getMany()},e.prototype.findAndCount=function(e){var t=this.createQueryBuilder(o.FindOptionsUtils.extractFindManyOptionsAlias(e)||this.metadata.table.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(t,e).getManyAndCount()},e.prototype.findByIds=function(e,t){var n=this.createQueryBuilder(o.FindOptionsUtils.extractFindManyOptionsAlias(t)||this.metadata.table.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,t).andWhereInIds(e).getMany()},e.prototype.findOne=function(e){var t=this.createQueryBuilder(o.FindOptionsUtils.extractFindOneOptionsAlias(e)||this.metadata.table.name);return o.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(t,e).getOne()},e.prototype.findOneById=function(e,t){var n=this.createQueryBuilder(o.FindOptionsUtils.extractFindOneOptionsAlias(t)||this.metadata.table.name);return o.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(n,t).andWhereInIds([e]).getOne()},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=this.queryRunnerProvider||new a.QueryRunnerProvider(this.connection.driver),[4,n.provide()];case 1:r=i.sent(),i.label=2;case 2:return i.trys.push([2,,4,6]),[4,r.query(e,t)];case 3:return[2,i.sent()];case 4:return[4,n.release(r)];case 5:return i.sent(),[7];case 6:return[2]}})})},e.prototype.transaction=function(t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.queryRunnerProvider||new a.QueryRunnerProvider(this.connection.driver,!0),[4,n.provide()];case 1:r=u.sent(),i=new e,i.connection=this.connection,i.metadata=this.metadata,i.queryRunnerProvider=n,u.label=2;case 2:return u.trys.push([2,6,8,12]),[4,r.beginTransaction()];case 3:return u.sent(),[4,t(i)];case 4:return o=u.sent(),[4,r.commitTransaction()];case 5:return u.sent(),[2,o];case 6:return s=u.sent(),[4,r.rollbackTransaction()];case 7:throw u.sent(),s;case 8:return[4,n.release(r)];case 9:return u.sent(),this.queryRunnerProvider?[3,11]:[4,n.releaseReused()];case 10:u.sent(),u.label=11;case 11:return[7];case 12:return[2]}})})},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=this.queryRunnerProvider||new a.QueryRunnerProvider(this.connection.driver),[4,e.provide()];case 1:t=n.sent(),n.label=2;case 2:return n.trys.push([2,,4,6]),[4,t.truncate(this.metadata.table.name)];case 3:return[2,n.sent()];case 4:return[4,e.release(t)];case 5:return n.sent(),[7];case 6:return[2]}})})},e}(),e("Repository",c)}}}),System.register("typeorm/subscriber/event/UpdateEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/RemoveEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/InsertEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/EntitySubscriberInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/RepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name="RepositoryNotFoundError";var i="function"==typeof n&&n.name?n.name:n;return r.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+t+'" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("RepositoryNotFoundError",n)}}}),System.register("typeorm/metadata/types/EventListenerTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e}(),n.AFTER_LOAD="after-load",n.BEFORE_INSERT="before-insert",n.AFTER_INSERT="after-insert",n.BEFORE_UPDATE="before-update",n.AFTER_UPDATE="after-update",n.BEFORE_REMOVE="before-remove",n.AFTER_REMOVE="after-remove",e("EventListenerTypes",n)}}}),System.register("typeorm/metadata-args/EntityListenerMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityListenerMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this.propertyName=e.propertyName,this.type=e.type}return e}(),e("EntityListenerMetadata",n)}}}),System.register("typeorm/util/DirectoryExportedClassesLoader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";function n(e,t){function n(e,t){return e instanceof Function?t.push(e):e instanceof Object?Object.keys(e).forEach(function(r){return n(e[r],t)}):e instanceof Array&&e.forEach(function(e){return n(e,t)}),t}return void 0===t&&(t=[".js",".ts"]),n(e.reduce(function(e,t){return e.concat(i.PlatformTools.load("glob").sync(i.PlatformTools.pathNormilize(t)))},[]).filter(function(e){var n=e.substring(e.length-5,e.length);return-1!==t.indexOf(i.PlatformTools.pathExtname(e))&&".d.ts"!==n}).map(function(e){return i.PlatformTools.load(i.PlatformTools.pathResolve(e))}),[])}function r(e,t){return void 0===t&&(t=".json"),e.reduce(function(e,t){return e.concat(i.PlatformTools.load("glob").sync(i.PlatformTools.pathNormilize(t)))},[]).filter(function(e){return i.PlatformTools.pathExtname(e)===t}).map(function(e){return i.PlatformTools.load(i.PlatformTools.pathResolve(e))})}t&&t.id;e("importClassesFromDirectories",n),e("importJsonsFromDirectories",r);var i;return{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/metadata-builder/error/UsingJoinTableIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinTableIsNotAllowedError",r.message="Using JoinTable on "+t.name+"#"+n.propertyName+" is wrong. "+t.name+"#"+n.propertyName+" has "+n.relationType+" relation, however you can use JoinTable only on many-to-many relations.",r}return __extends(t,e),t}(Error),e("UsingJoinTableIsNotAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinTableOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinTableOnlyOnOneSideAllowedError",r.message="Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.",r}return __extends(t,e),t}(Error),e("UsingJoinTableOnlyOnOneSideAllowedError",n)}}}),
System.register("typeorm/metadata-builder/error/UsingJoinColumnIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinColumnIsNotAllowedError",r.message="Using JoinColumn on "+t.name+"#"+n.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.",r}return __extends(t,e),t}(Error),e("UsingJoinColumnIsNotAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinColumnOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinColumnOnlyOnOneSideAllowedError",r.message="Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.",r}return __extends(t,e),t}(Error),e("UsingJoinColumnOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/MissingJoinColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MissingJoinColumnError",n.hasInverseSide?r.message="JoinColumn is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":r.message="JoinColumn is missing on "+t.name+"#"+n.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",r}return __extends(t,e),t}(Error),e("MissingJoinColumnError",n)}}}),System.register("typeorm/metadata-builder/error/MissingJoinTableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MissingJoinTableError",n.hasInverseSide?r.message="JoinTable is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":r.message="JoinTable is missing on "+t.name+"#"+n.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",r}return __extends(t,e),t}(Error),e("MissingJoinTableError",n)}}}),System.register("typeorm/metadata-builder/error/MissingPrimaryColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="MissingPrimaryColumnError",n.message='Entity "'+t.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',n}return __extends(t,e),t}(Error),e("MissingPrimaryColumnError",n)}}}),System.register("typeorm/metadata-builder/error/CircularRelationsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Circular relations detected: "+t+". To resolve this issue you need to set nullable: false somewhere in this dependency structure.")||this;return n.name="CircularRelationsError",n}return __extends(t,e),t}(Error),e("CircularRelationsError",n)}}}),System.register("typeorm/util/DepGraph",[],function(e,t){"use strict";function n(e,t,n){var r=[],i={};return function o(a){i[a]=!0,r.push(a),e[a].forEach(function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error("Dependency Cycle Found: "+r.join(" -> "))}else o(e)}),r.pop(),t&&0!==e[a].length||-1!==n.indexOf(a)||n.push(a)}}var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.outgoingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.incomingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,r=[],i=Object.keys(this.nodes);if(0===i.length)return r;var o=n(this.outgoingEdges,!1,[]);i.forEach(function(e){o(e)});var a=n(this.outgoingEdges,e,r);return i.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),r},e}(),e("DepGraph",r)}}}),System.register("typeorm/metadata-builder/EntityMetadataValidator",["typeorm/metadata-builder/error/UsingJoinTableIsNotAllowedError","typeorm/metadata-builder/error/UsingJoinTableOnlyOnOneSideAllowedError","typeorm/metadata-builder/error/UsingJoinColumnIsNotAllowedError","typeorm/metadata-builder/error/UsingJoinColumnOnlyOnOneSideAllowedError","typeorm/metadata-builder/error/MissingJoinColumnError","typeorm/metadata-builder/error/MissingJoinTableError","typeorm/metadata-builder/error/MissingPrimaryColumnError","typeorm/metadata-builder/error/CircularRelationsError","typeorm/util/DepGraph"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(){}return e.prototype.validateMany=function(e){var t=this;e.forEach(function(n){return t.validate(n,e)}),this.validateDependencies(e)},e.prototype.validate=function(e,t){if(!e.table.isClassTableChild&&!e.primaryColumns.length&&!e.junction)throw new u.MissingPrimaryColumnError(e);if("single-table"===e.inheritanceType){if(!e.hasDiscriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put @DiscriminatorColumn decorator?");if(-1!==["",void 0,null].indexOf(e.discriminatorValue))throw new Error("Entity "+e.name+" has empty discriminator value. Discriminator value should not be empty.");var c=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(c)throw new Error("Entities "+e.name+" and "+c.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}e.relations.forEach(function(t){if(t.joinTable){if(!t.isManyToMany)throw new n.UsingJoinTableIsNotAllowedError(e,t);if(t.hasInverseSide&&t.inverseRelation.joinTable)throw new r.UsingJoinTableOnlyOnOneSideAllowedError(e,t)}if(t.joinColumn){if(!t.isOneToOne&&!t.isManyToOne)throw new i.UsingJoinColumnIsNotAllowedError(e,t);if(t.hasInverseSide&&t.inverseRelation.joinColumn&&t.isOneToOne)throw new o.UsingJoinColumnOnlyOnOneSideAllowedError(e,t);if(t.joinColumn&&!t.joinColumn.referencedColumn)throw new Error("Join column does not have referenced column set")}if(!t.joinColumn&&t.isOneToOne&&(!t.hasInverseSide||!t.inverseRelation.joinColumn))throw new a.MissingJoinColumnError(e,t);if(!t.joinTable&&t.isManyToMany&&(!t.hasInverseSide||!t.inverseRelation.joinTable))throw new s.MissingJoinTableError(e,t)}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.hasInverseSide&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")})},e.prototype.validateDependencies=function(e){var t=new l.DepGraph;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new c.CircularRelationsError(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e}(),e("EntityMetadataValidator",d)}}}),System.register("typeorm/metadata-builder/JunctionEntityMetadataBuilder",["typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/TableMetadata","typeorm/metadata/IndexMetadata","typeorm/metadata/EntityMetadata"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.build=function(e,t,s){var u=s.joinTable.referencedColumn,c=s.joinTable.inverseReferencedColumn,l=new i.TableMetadata({target:"",name:s.joinTable.name,type:"junction"}),d=new n.ColumnMetadata({target:"__virtual__",propertyName:s.joinTable.joinColumnName,mode:"virtual",options:{length:u.length,type:u.type,name:s.joinTable.joinColumnName,nullable:!1,primary:!0}}),m=new n.ColumnMetadata({target:"__virtual__",propertyName:s.joinTable.inverseJoinColumnName,mode:"virtual",options:{length:c.length,type:c.type,name:s.joinTable.inverseJoinColumnName,nullable:!1,primary:!0}}),p=new a.EntityMetadata({junction:!0,target:"__virtual__",tablesPrefix:e.options.tablesPrefix,namingStrategy:s.namingStrategy,tableMetadata:l,columnMetadatas:[d,m],foreignKeyMetadatas:[new r.ForeignKeyMetadata([d],s.firstTable,[u]),new r.ForeignKeyMetadata([m],s.secondTable,[c])],indexMetadatas:[new o.IndexMetadata({columns:[s.joinTable.joinColumnName],unique:!1}),new o.IndexMetadata({columns:[s.joinTable.inverseJoinColumnName],unique:!1})]},t);return p.columns[0].entityMetadata=p,p.columns[1].entityMetadata=p,p},e}(),e("JunctionEntityMetadataBuilder",s)}}}),System.register("typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/TableMetadata","typeorm/metadata/types/ColumnTypes"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.build=function(e,t,s){var u=[new r.ColumnMetadata({target:"__virtual__",propertyName:"__virtual__",propertyType:s.primaryColumn.type,mode:"virtual",options:{length:s.primaryColumn.length,type:s.primaryColumn.type,name:"ancestor"}}),new r.ColumnMetadata({target:"__virtual__",propertyName:"__virtual__",propertyType:s.primaryColumn.type,mode:"virtual",options:{length:s.primaryColumn.length,type:s.primaryColumn.type,name:"descendant"}})];s.hasTreeLevelColumn&&u.push(new r.ColumnMetadata({target:"__virtual__",propertyName:"__virtual__",propertyType:a.ColumnTypes.INTEGER,mode:"virtual",options:{type:a.ColumnTypes.INTEGER,name:"level"}}));var c=new o.TableMetadata({target:"__virtual__",name:s.table.name,type:"closure-junction"});return new n.EntityMetadata({junction:!0,target:"__virtual__",tablesPrefix:e.options.tablesPrefix,namingStrategy:s.namingStrategy,tableMetadata:c,columnMetadatas:u,foreignKeyMetadatas:[new i.ForeignKeyMetadata([u[0]],s.table,[s.primaryColumn]),new i.ForeignKeyMetadata([u[1]],s.table,[s.primaryColumn])]},t)},e}(),e("ClosureJunctionEntityMetadataBuilder",s)}}}),System.register("typeorm/entity-schema/EntitySchema",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-builder/error/MetadataAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name="MetadataAlreadyExistsError",i.message=t+" metadata already exists for the class constructor "+JSON.stringify(n)+(r?" on property "+r:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."),i}return __extends(t,e),t}(Error),e("MetadataAlreadyExistsError",n)}}}),System.register("typeorm/metadata-args/collection/TargetMetadataArgsCollection",["typeorm/metadata-builder/error/MetadataAlreadyExistsError"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){this.items=[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.filter=function(e,t){var n=new this.constructor;return this.items.filter(e).forEach(function(e){return n.add(e)}),n},e.prototype.filterByTarget=function(e){return e?this.filterByTargets([e]):new this.constructor},e.prototype.filterByTargets=function(e){return this.filter(function(t){return!!t.target&&-1!==e.indexOf(t.target)})},e.prototype.add=function(e,t){if(void 0===t&&(t=!1),t){if(!(e.target&&e.target instanceof Function))throw new Error("Target is not set in the given metadata.");if(this.hasWithTarget(e.target))throw new n.MetadataAlreadyExistsError(e.constructor.name,e.target)}this.items.push(e)},e.prototype.toArray=function(){return this.items.map(function(e){return e})},e.prototype.hasWithTarget=function(e){return!!this.items.find(function(t){return t.target===e})},e}(),e("TargetMetadataArgsCollection",r)}}}),System.register("typeorm/metadata-args/collection/PropertyMetadataArgsCollection",["typeorm/metadata-args/collection/TargetMetadataArgsCollection"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.filterRepeatedMetadatas=function(e){return this.filter(function(t){return!e.find(function(e){return e.propertyName===t.propertyName})})},t.prototype.findByProperty=function(e){return this.items.find(function(t){return t.propertyName===e})},t.prototype.hasWithProperty=function(e){return!!this.findByProperty(e)},t}(n.TargetMetadataArgsCollection),e("PropertyMetadataArgsCollection",r)}}}),System.register("typeorm/metadata-args/RelationCountMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/NamingStrategyMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntitySubscriberMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/RelationIdMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/InheritanceMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/DiscriminatorValueMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntityRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionEntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/MetadataArgsStorage",["typeorm/metadata-args/collection/TargetMetadataArgsCollection","typeorm/metadata-args/collection/PropertyMetadataArgsCollection"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){this.tables=new n.TargetMetadataArgsCollection,this.entityRepositories=new n.TargetMetadataArgsCollection,this.transactionEntityManagers=new n.TargetMetadataArgsCollection,this.namingStrategies=new n.TargetMetadataArgsCollection,this.entitySubscribers=new n.TargetMetadataArgsCollection,this.indices=new r.PropertyMetadataArgsCollection,this.columns=new r.PropertyMetadataArgsCollection,this.relations=new r.PropertyMetadataArgsCollection,this.joinColumns=new r.PropertyMetadataArgsCollection,this.joinTables=new r.PropertyMetadataArgsCollection,this.entityListeners=new r.PropertyMetadataArgsCollection,this.relationCounts=new r.PropertyMetadataArgsCollection,this.relationIds=new r.PropertyMetadataArgsCollection,this.embeddeds=new r.PropertyMetadataArgsCollection,this.inheritances=new n.TargetMetadataArgsCollection,this.discriminatorValues=new n.TargetMetadataArgsCollection}return e.prototype.getMergedTableMetadatas=function(e){var t=this,n=e?this.tables.filterByTargets(e):this.tables;return n.filter(function(e){return"regular"===e.type||"closure"===e.type||"class-table-child"===e.type}).toArray().map(function(e){return t.mergeWithAbstract(n,e)})},e.prototype.getMergedEmbeddableTableMetadatas=function(e){var t=this,n=e?this.tables.filterByTargets(e):this.tables,r=n.filter(function(e){return"embeddable"===e.type});return r.toArray().map(function(e){return t.mergeWithEmbeddable(r,e)})},e.prototype.mergeWithAbstract=function(e,t){var n=this,r=this.indices.filterByTarget(t.target),i=this.columns.filterByTarget(t.target),o=this.relations.filterByTarget(t.target),a=this.joinColumns.filterByTarget(t.target),s=this.joinTables.filterByTarget(t.target),u=this.entityListeners.filterByTarget(t.target),c=this.relationCounts.filterByTarget(t.target),l=this.relationIds.filterByTarget(t.target),d=this.embeddeds.filterByTarget(t.target),m=this.inheritances.filterByTarget(t.target),p=m.length>0?m.toArray()[0]:void 0,f=[],y=void 0;e.toArray().forEach(function(m){if("single-table-child"!==t.type&&t.target&&m.target&&t.target instanceof Function&&m.target instanceof Function&&n.isInherited(t.target,m.target)){if(n.inheritances.filterByTarget(m.target).toArray().find(function(e){return"class-table"===e.type}))return void(y=m);var p=n.mergeWithAbstract(e,m);p.indices.toArray().filter(function(e){return!e.name||!r.toArray().find(function(t){return t.name===e.name})}).forEach(function(e){return r.add(e)}),p.columns.filterRepeatedMetadatas(i.toArray()).toArray().forEach(function(e){return i.add(e)}),p.relations.filterRepeatedMetadatas(o.toArray()).toArray().forEach(function(e){return o.add(e)}),p.joinColumns.filterRepeatedMetadatas(a.toArray()).toArray().forEach(function(e){return a.add(e)}),p.joinTables.filterRepeatedMetadatas(s.toArray()).toArray().forEach(function(e){return s.add(e)}),p.entityListeners.filterRepeatedMetadatas(u.toArray()).toArray().forEach(function(e){return u.add(e)}),p.relationCounts.filterRepeatedMetadatas(c.toArray()).toArray().forEach(function(e){return c.add(e)}),p.relationIds.filterRepeatedMetadatas(l.toArray()).toArray().forEach(function(e){return l.add(e)}),p.embeddeds.filterRepeatedMetadatas(d.toArray()).toArray().forEach(function(e){return d.add(e)})}});var h=[];return p&&"single-table"===p.type&&e.toArray().forEach(function(m){if("single-table-child"===m.type&&m.target&&t.target&&m.target instanceof Function&&t.target instanceof Function&&n.isInherited(m.target,t.target)&&(h.push(m),n.discriminatorValues.filterByTarget(m.target).toArray().forEach(function(e){return f.push(e)}),"single-table"===p.type)){var y=n.mergeWithAbstract(e,m);y.indices.toArray().filter(function(e){return!r.toArray().find(function(t){return t.name===e.name})}).forEach(function(e){return r.add(e)}),y.columns.filterRepeatedMetadatas(i.toArray()).toArray().forEach(function(e){return i.add(e)}),y.relations.filterRepeatedMetadatas(o.toArray()).toArray().forEach(function(e){return o.add(e)}),y.joinColumns.filterRepeatedMetadatas(a.toArray()).toArray().forEach(function(e){return a.add(e)}),y.joinTables.filterRepeatedMetadatas(s.toArray()).toArray().forEach(function(e){return s.add(e)}),y.entityListeners.filterRepeatedMetadatas(u.toArray()).toArray().forEach(function(e){return u.add(e)}),y.relationCounts.filterRepeatedMetadatas(c.toArray()).toArray().forEach(function(e){return c.add(e)}),y.relationIds.filterRepeatedMetadatas(l.toArray()).toArray().forEach(function(e){return l.add(e)}),y.embeddeds.filterRepeatedMetadatas(d.toArray()).toArray().forEach(function(e){return d.add(e)}),y.children.forEach(function(e){return h.push(e)})}}),{table:t,parent:y,inheritance:p,children:h,indices:r,columns:i,relations:o,joinColumns:a,joinTables:s,entityListeners:u,relationCounts:c,relationIds:l,embeddeds:d,discriminatorValues:f}},e.prototype.mergeWithEmbeddable=function(e,t){var n=this,r=this.columns.filterByTarget(t.target),i=this.embeddeds.filterByTarget(t.target);return e.filter(function(e){return!(!t.target||!e.target)&&(t.target instanceof Function&&e.target instanceof Function&&n.isInherited(t.target,e.target))}).toArray().forEach(function(t){var o=n.mergeWithEmbeddable(e,t);o.columns.filterRepeatedMetadatas(r.toArray()).toArray().forEach(function(e){return r.add(e)}),o.embeddeds.filterRepeatedMetadatas(i.toArray()).toArray().forEach(function(e){return i.add(e)})}),{table:t,columns:r,embeddeds:i}},e.prototype.isInherited=function(e,t){return Object.getPrototypeOf(e.prototype).constructor===t},e}(),e("MetadataArgsStorage",i)}}}),System.register("typeorm/metadata-builder/EntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata-builder/EntityMetadataValidator","typeorm/metadata/IndexMetadata","typeorm/metadata/JoinColumnMetadata","typeorm/metadata/TableMetadata","typeorm/index","typeorm/metadata/RelationMetadata","typeorm/metadata/JoinTableMetadata","typeorm/metadata-builder/JunctionEntityMetadataBuilder","typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder","typeorm/metadata/EmbeddedMetadata","typeorm/metadata-args/MetadataArgsStorage"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,m,p,f,y,h;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){m=e},function(e){p=e},function(e){f=e},function(e){y=e}],execute:function(){h=function(){function e(){}return e.prototype.buildFromSchemas=function(e,t,n,r){var i=new y.MetadataArgsStorage;return r.forEach(function(e){var t=e.table||{},n={target:e.target||e.name,name:t.name,type:t.type||"regular",orderBy:t.orderBy};i.tables.add(n),Object.keys(e.columns).forEach(function(t){var n=e.columns[t],r="regular";n.createDate&&(r="createDate"),n.updateDate&&(r="updateDate"),n.version&&(r="version"),n.treeChildrenCount&&(r="treeChildrenCount"),n.treeLevel&&(r="treeLevel");var o={target:e.target||e.name,mode:r,propertyName:t,options:{type:n.type,name:n.name,length:n.length,primary:n.primary,generated:n.generated,unique:n.unique,nullable:n.nullable,comment:n.comment,default:n.default,precision:n.precision,scale:n.scale}};i.columns.add(o)}),e.relations&&Object.keys(e.relations).forEach(function(t){var n=e.relations[t],r={target:e.target||e.name,propertyName:t,relationType:n.type,isLazy:n.isLazy||!1,type:n.target,inverseSideProperty:n.inverseSide,isTreeParent:n.isTreeParent,isTreeChildren:n.isTreeChildren,options:{cascadeAll:n.cascadeAll,cascadeInsert:n.cascadeInsert,cascadeUpdate:n.cascadeUpdate,cascadeRemove:n.cascadeRemove,nullable:n.nullable,onDelete:n.onDelete}};if(i.relations.add(r),n.joinColumn)if("boolean"==typeof n.joinColumn){var o={target:e.target||e.name,propertyName:t};i.joinColumns.add(o)}else{var o={target:e.target||e.name,propertyName:t,name:n.joinColumn.name,referencedColumnName:n.joinColumn.referencedColumnName};i.joinColumns.add(o)}if(n.joinTable)if("boolean"==typeof n.joinTable){var a={target:e.target||e.name,propertyName:t};i.joinTables.add(a)}else{var a={target:e.target||e.name,propertyName:t,name:n.joinTable.name,joinColumn:n.joinTable.joinColumn,inverseJoinColumn:n.joinTable.inverseJoinColumn};i.joinTables.add(a)}})}),this.build(e,t,i,n)},e.prototype.buildFromMetadataArgsStorage=function(e,t,n,r){return this.build(e,t,c.getMetadataArgsStorage(),n,r)},e.prototype.build=function(e,t,y,h,g){var v=y.getMergedEmbeddableTableMetadatas(g),b=[],E=y.getMergedTableMetadatas(g);return E.forEach(function(i){[i.table].concat(i.children).forEach(function(o){var c=function(e){var t=[];return e.forEach(function(e){var n=v.find(function(t){return t.table.target===e.type()});if(n){var i=new u.TableMetadata(n.table),o=n.columns.toArray().map(function(e){return new r.ColumnMetadata(e)}),a=c(n.embeddeds.toArray());t.push(new f.EmbeddedMetadata(i,o,a,e))}}),t},m=c(i.embeddeds.toArray()),p=i.inheritance&&"single-table"===i.inheritance.type?i.table:o,y=new u.TableMetadata(p),g=i.columns.toArray().map(function(e){return i.inheritance&&"single-table"===i.inheritance.type&&e.target!==i.table.target&&i.children.find(function(t){return t.target===e.target})&&(e.options.nullable=!0),new r.ColumnMetadata(e)}),E=i.relations.toArray().map(function(e){return new l.RelationMetadata(e)}),_=i.indices.toArray().map(function(e){return new a.IndexMetadata(e)}),T=i.discriminatorValues.find(function(e){return e.target===o.target}),C=new n.EntityMetadata({junction:!1,target:o.target,tablesPrefix:e.options.tablesPrefix,namingStrategy:h,tableMetadata:y,columnMetadatas:g,relationMetadatas:E,indexMetadatas:_,embeddedMetadatas:m,inheritanceType:i.inheritance?i.inheritance.type:void 0,discriminatorValue:T?T.value:o.target.name},t);b.push(C),C.manyToManyRelations.forEach(function(e){var t=i.joinTables.findByProperty(e.propertyName);if(t){var n=new d.JoinTableMetadata(t);e.joinTable=n,n.relation=e}}),C.oneToOneRelations.concat(C.manyToOneRelations).forEach(function(e){var t=i.joinColumns.findByProperty(e.propertyName);if(!t&&e.isManyToOne&&(t={target:e.entityMetadata.target,propertyName:e.propertyName}),t){var n=new s.JoinColumnMetadata(t);e.joinColumn=n,n.relation=e}}),C.relations.forEach(function(e){var t=i.relationIds.toArray().find(function(t){return t.relation instanceof Function?e.propertyName===t.relation(C.createPropertiesMap()):e.propertyName===t.relation});if(t){if(e.isOneToOneNotOwner||e.isOneToMany)throw new Error("RelationId cannot be used for the one-to-one without join column or one-to-many relations.");e.idField=t.propertyName}}),C.relations.forEach(function(e){var t=i.relationCounts.toArray().find(function(t){return t.relation instanceof Function?e.propertyName===t.relation(C.createPropertiesMap()):e.propertyName===t.relation});t&&(e.countField=t.propertyName)}),C.target instanceof Function&&C.relations.filter(function(e){return e.isLazy}).forEach(function(e){t.wrap(C.target.prototype,e)})})}),b.forEach(function(e){e.relations.forEach(function(t){var n=b.find(function(e){return e.target===t.type||"string"==typeof t.type&&e.targetName===t.type});if(!n)throw new Error("Entity metadata for "+e.name+"#"+t.propertyName+" was not found.");t.inverseEntityMetadata=n})}),b.forEach(function(e){var t=E.find(function(t){return t.table.target===e.target});if(t&&t.parent){var n=b.find(function(e){return e.table.target===t.parent.target});n&&(e.parentEntityMetadata=n)}}),b.filter(function(e){return"single-table"===e.inheritanceType&&e.hasDiscriminatorColumn}).forEach(function(e){var t=new a.IndexMetadata({target:e.target,columns:[e.discriminatorColumn.fullName],unique:!1});t.entityMetadata=e,e.indices.push(t);var n=new a.IndexMetadata({target:e.target,columns:[e.firstPrimaryColumn.propertyName,e.discriminatorColumn.propertyName],unique:!1});n.entityMetadata=e,e.indices.push(n)}),b.filter(function(e){return!!e.parentEntityMetadata}).forEach(function(e){var t=e.parentEntityMetadata.firstPrimaryColumn,n=h.classTableInheritanceParentColumnName(e.parentEntityMetadata.table.name,t.propertyName),o=new r.ColumnMetadata({target:e.parentEntityMetadata.table.target,propertyName:t.propertyName,mode:"parentId",options:{name:n,type:t.type,unique:!0,nullable:!1,primary:!1}});e.addColumn(o);var a=new i.ForeignKeyMetadata([o],e.parentEntityMetadata.table,[t],"CASCADE");a.entityMetadata=e,e.foreignKeys.push(a)}),b.forEach(function(e){e.relationsWithJoinColumns.forEach(function(t){var n=t.joinColumn.referencedColumn,o=e.columns.find(function(e){return e.fullName===t.name});o||(o=new r.ColumnMetadata({target:e.target,propertyName:t.name,mode:"virtual",options:{type:n.type,nullable:t.isNullable,primary:t.isPrimary}}),o.relationMetadata=t,e.addColumn(o));var a=new i.ForeignKeyMetadata([o],t.inverseEntityMetadata.table,[n],t.onDelete);a.entityMetadata=e,e.foreignKeys.push(a)})}),b.forEach(function(n){if(n.table.isClosure){if(n.primaryColumns.length>1)throw new Error("Cannot use given entity "+n.name+" as a closure table, because it have multiple primary keys. Entities with multiple primary keys are not supported in closure tables.");var r=c.getFromContainer(p.ClosureJunctionEntityMetadataBuilder).build(e,t,{namingStrategy:h,table:n.table,primaryColumn:n.firstPrimaryColumn,hasTreeLevelColumn:n.hasTreeLevelColumn});n.closureJunctionTable=r,b.push(r)}}),b.forEach(function(n){n.ownerManyToManyRelations.forEach(function(r){var i=c.getFromContainer(m.JunctionEntityMetadataBuilder).build(e,t,{namingStrategy:h,firstTable:n.table,secondTable:r.inverseEntityMetadata.table,joinTable:r.joinTable});r.junctionEntityMetadata=i,r.hasInverseSide&&(r.inverseRelation.junctionEntityMetadata=i),b.push(i)})}),c.getFromContainer(o.EntityMetadataValidator).validateMany(b),b},e}(),e("EntityMetadataBuilder",h)}}}),System.register("typeorm/util/RandomGenerator",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.sha1=function(e){var t,n,r,i,o,a,s,u,c,l=function(e,t){return e<<t|e>>>32-t},d=function(e){var t,n,r="";for(t=7;t>=0;t--)n=e>>>4*t&15,r+=n.toString(16);return r},m=new Array(80),p=1732584193,f=4023233417,y=2562383102,h=271733878,g=3285377520;e=encodeURIComponent(e);var v=e.length,b=[];for(n=0;n<v-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(v%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(v-1)<<24|8388608;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)m[n]=b[t+n];for(n=16;n<=79;n++)m[n]=l(m[n-3]^m[n-8]^m[n-14]^m[n-16],1);for(i=p,o=f,a=y,s=h,u=g,n=0;n<=19;n++)c=l(i,5)+(o&a|~o&s)+u+m[n]+1518500249&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(o^a^s)+u+m[n]+1859775393&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(o&a|o&s|a&s)+u+m[n]+2400959708&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(o^a^s)+u+m[n]+3395469782&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;p=p+i&4294967295,f=f+o&4294967295,y=y+a&4294967295,h=h+s&4294967295,
g=g+u&4294967295}return c=d(p)+d(f)+d(y)+d(h)+d(g),c.toLowerCase()},e}(),e("RandomGenerator",n)}}}),System.register("typeorm/util/StringUtils",[],function(e,t){"use strict";function n(e){return e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,t,n,r){return n?n.toUpperCase():t.toLowerCase()})}function r(e){return e.replace(/(?:^|\.?)([A-Z])/g,function(e,t){return"_"+t.toLowerCase()}).replace(/^_/,"")}t&&t.id;return e("camelCase",n),e("snakeCase",r),{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/DefaultNamingStrategy",["typeorm/util/RandomGenerator","typeorm/util/StringUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.tableName=function(e,t){return t||r.snakeCase(e)},e.prototype.columnName=function(e,t){return t||e},e.prototype.embeddedColumnName=function(e,t,n){e=e.filter(function(e){return!!e});var i=e.length?e.join("_")+"_":"";return r.camelCase(i+(n||t))},e.prototype.relationName=function(e){return e},e.prototype.indexName=function(e,t,r){if(e)return e;var i="ind_"+t+"_"+r.join("_");return"ind_"+n.RandomGenerator.sha1(i).substr(0,26)},e.prototype.joinColumnInverseSideName=function(e,t){return e||t},e.prototype.joinTableName=function(e,t,n,i,o,a){return r.snakeCase(e+"_"+n+"_"+t+"_"+a)},e.prototype.joinTableColumnName=function(e,t,n,i){var o=r.camelCase(e+"_"+t);return o===r.camelCase(n+"_"+i)?o+"_1":o},e.prototype.joinTableInverseColumnName=function(e,t,n,i){var o=r.camelCase(e+"_"+t);return o===r.camelCase(n+"_"+i)?o+"_2":o},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.foreignKeyName=function(e,t,r,i){var o=e+"_"+t.join("_")+"_"+r+"_"+i.join("_");return"fk_"+n.RandomGenerator.sha1(o).substr(0,27)},e.prototype.classTableInheritanceParentColumnName=function(e,t){return r.camelCase(e+"_"+t)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),e("DefaultNamingStrategy",i)}}}),System.register("typeorm/connection/error/CannotImportAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="CannotImportAlreadyConnected",r.message="Cannot import "+t+' for "'+n+'" connection because connection to the database already established.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotImportAlreadyConnectedError",n)}}}),System.register("typeorm/connection/error/CannotCloseNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotCloseNotConnectedError",n.message='Cannot close "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotCloseNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotConnectAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotConnectAlreadyConnectedError",n.message='Cannot create a "'+t+'" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotConnectAlreadyConnectedError",n)}}}),System.register("typeorm/connection/error/NamingStrategyNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name="NamingStrategyNotFoundError";var i=t instanceof Function?t.name:t;return r.message='Naming strategy "'+i+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+n+'" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("NamingStrategyNotFoundError",n)}}}),System.register("typeorm/connection/error/CannotSyncNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotSyncNotConnectedError",n.message='Cannot sync schema of the "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotSyncNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotUseNamingStrategyNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotUseNamingStrategyNotConnectedError",n.message='Cannot use a given naming strategy for "'+t+'" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotUseNamingStrategyNotConnectedError",n)}}}),System.register("typeorm/subscriber/Broadcaster",["typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.connection=e,this.subscriberMetadatas=t,this.entityListeners=n}return e.prototype.broadcastBeforeEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastBeforeInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastBeforeUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastBeforeRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastAfterEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastAfterInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastAfterUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastAfterRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastBeforeInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_INSERT&&o.isAllowedListener(e,t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeInsert}).map(function(n){return n.beforeInsert({entityManager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_UPDATE&&o.isAllowedListener(e,t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeUpdate}).map(function(n){return n.beforeUpdate({entityManager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_REMOVE&&o.isAllowedListener(e,t.entity)}).map(function(e){return t.databaseEntity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeRemove}).map(function(n){return n.beforeRemove({entityManager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_INSERT&&o.isAllowedListener(e,t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterInsert}).map(function(n){return n.afterInsert({entityManager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_UPDATE&&o.isAllowedListener(e,t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterUpdate}).map(function(n){return n.afterUpdate({entityManager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_REMOVE&&o.isAllowedListener(e,t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterRemove}).map(function(n){return n.afterRemove({entityManager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastLoadEventsForAll=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.broadcastLoadEvents(e,t)}))];case 1:return r.sent(),[2]}})})},e.prototype.broadcastLoadEvents=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t instanceof Promise?[2]:(r=this.connection.getMetadata(e).relations.reduce(function(e,n){if(!t.hasOwnProperty(n.propertyName))return e;var r=n.getEntityValue(t);return r instanceof Array?e=e.concat(a.broadcastLoadEventsForAll(n.inverseEntityMetadata.target,r)):r&&e.push(a.broadcastLoadEvents(n.inverseEntityMetadata.target,r)),e},[]),i=this.entityListeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_LOAD&&a.isAllowedListener(e,t)}).map(function(e){return t[e.propertyName]()}),o=this.subscriberMetadatas.filter(function(t){return a.isAllowedSubscriber(t,e)&&t.afterLoad}).map(function(e){return e.afterLoad(t)}),[4,Promise.all(r.concat(i.concat(o)))]);case 1:return s.sent(),[2]}})})},e.prototype.isAllowedListener=function(e,t){return e.target===t.constructor||e.target instanceof Function&&t.constructor.prototype instanceof e.target},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t},e}(),e("Broadcaster",r)}}}),System.register("typeorm/schema-builder/SchemaBuilder",["typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e,t,n){this.driver=e,this.logger=t,this.entityMetadatas=n}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:return e=this,[4,this.driver.createQueryRunner()];case 1:return e.queryRunner=r.sent(),t=this,[4,this.loadTableSchemas()];case 2:return t.tableSchemas=r.sent(),[4,this.queryRunner.beginTransaction()];case 3:r.sent(),r.label=4;case 4:return r.trys.push([4,14,16,18]),[4,this.dropOldForeignKeys()];case 5:return r.sent(),[4,this.createNewTables()];case 6:return r.sent(),[4,this.dropRemovedColumns()];case 7:return r.sent(),[4,this.addNewColumns()];case 8:return r.sent(),[4,this.updateExistColumns()];case 9:return r.sent(),[4,this.updatePrimaryKeys()];case 10:return r.sent(),[4,this.createForeignKeys()];case 11:return r.sent(),[4,this.createIndices()];case 12:return r.sent(),[4,this.queryRunner.commitTransaction()];case 13:return r.sent(),[3,18];case 14:return n=r.sent(),[4,this.queryRunner.rollbackTransaction()];case 15:throw r.sent(),n;case 16:return[4,this.queryRunner.release()];case 17:return r.sent(),[7];case 18:return[2]}})})},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.entityMetadatas.filter(function(e){return!e.table.skipSchemaSync})},enumerable:!0,configurable:!0}),e.prototype.loadTableSchemas=function(){var e=this.entityToSyncMetadatas.map(function(e){return e.table.name});return this.queryRunner.loadTableSchemas(e)},e.prototype.dropOldForeignKeys=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?(n=e.foreignKeys.filter(function(e){return!t.foreignKeys.find(function(t){return t.name===e.name})}),0===n.length?[2]:(this.logger.logSchemaBuild("dropping old foreign keys of "+e.name+": "+n.map(function(e){return e.name}).join(", ")),e.removeForeignKeys(n),[4,this.queryRunner.dropForeignKeys(e,n)])):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewTables=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?[2]:(this.logger.logSchemaBuild("creating a new table: "+t.table.name),r=new n.TableSchema(t.table.name,this.metadataColumnsToColumnSchemas(t.columns),!0),this.tableSchemas.push(r),[4,this.queryRunner.createTable(r)]);case 1:return i.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?(n=e.columns.filter(function(e){return!t.columns.find(function(t){return t.fullName===e.name})}),0===n.length?[2]:[4,Promise.all(n.map(function(e){return r.dropColumnReferencedForeignKeys(t.table.name,e.name)}))]):[2];case 1:return i.sent(),[4,Promise.all(n.map(function(e){return r.dropColumnReferencedIndices(t.table.name,e.name)}))];case 2:return i.sent(),this.logger.logSchemaBuild("columns dropped in "+e.name+": "+n.map(function(e){return e.name}).join(", ")),e.removeColumns(n),e.removePrimaryKeysOfColumns(n),[4,this.queryRunner.dropColumns(e,n)];case 3:return i.sent(),[2]}})})})},e.prototype.addNewColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?(n=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.fullName})}),0===n.length?[2]:(this.logger.logSchemaBuild("new columns added: "+n.map(function(e){return e.fullName}).join(", ")),r=this.metadataColumnsToColumnSchemas(n),[4,this.queryRunner.addColumns(e,r)])):[2];case 1:return i.sent(),e.addColumns(r),[2]}})})})},e.prototype.updateExistColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?(n=e.findChangedColumns(this.queryRunner,t.columns),0===n.length?[2]:(this.logger.logSchemaBuild("columns changed in "+e.name+". updating: "+n.map(function(e){return e.name}).join(", ")),i=n.filter(function(e){return!!t.columns.find(function(t){return t.fullName===e.name})}).map(function(e){return s.dropColumnReferencedForeignKeys(t.table.name,e.name)}),[4,Promise.all(i)])):[2];case 1:return u.sent(),o=n.filter(function(e){return!!t.columns.find(function(t){return t.fullName===e.name})}).map(function(e){return s.dropColumnReferencedIndices(t.table.name,e.name)}),[4,Promise.all(o)];case 2:return u.sent(),a=n.map(function(n){var i=t.columns.find(function(e){return e.fullName===n.name}),o=r.ColumnSchema.create(i,s.queryRunner.normalizeType(i));return e.replaceColumn(n,o),{newColumn:o,oldColumn:n}}),[2,this.queryRunner.changeColumns(e,a)]}})})})},e.prototype.updatePrimaryKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name&&!e.justCreated}))?(n=t.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r=n.filter(function(t){return!e.primaryKeysWithoutGenerated.find(function(e){return e.columnName===t.fullName})}).map(function(e){return new a.PrimaryKeySchema("",e.fullName)}),i=e.primaryKeysWithoutGenerated.filter(function(e){return!n.find(function(t){return t.fullName===e.columnName})}),0===r.length&&0===i.length?[2]:(this.logger.logSchemaBuild("primary keys of "+e.name+" has changed: dropped - "+(i.map(function(e){return e.columnName}).join(", ")||"nothing")+"; added - "+(r.map(function(e){return e.columnName}).join(", ")||"nothing")),e.addPrimaryKeys(r),e.removePrimaryKeys(i),[4,this.queryRunner.updatePrimaryKeys(e)])):[2];case 1:return o.sent(),[2]}})})})},e.prototype.createForeignKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?(n=t.foreignKeys.filter(function(t){return!e.foreignKeys.find(function(e){return e.name===t.name})}),0===n.length?[2]:(r=n.map(function(e){return i.ForeignKeySchema.create(e)}),this.logger.logSchemaBuild("creating a foreign keys: "+n.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.createForeignKeys(e,r)])):[2];case 1:return o.sent(),e.addForeignKeys(r),[2]}})})})},e.prototype.createIndices=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.table.name}))?(n=e.indices.filter(function(e){return!t.indices.find(function(t){return t.name===e.name})}).map(function(n){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.logger.logSchemaBuild("dropping an index: "+n.name),e.removeIndex(n),[4,this.queryRunner.dropIndex(t.table.name,n.name)];case 1:return r.sent(),[2]}})})}),r=t.indices.filter(function(t){return!e.indices.find(function(e){return e.name===t.name})}).map(function(t){return __awaiter(i,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=o.IndexSchema.create(t),e.indices.push(n),this.logger.logSchemaBuild("adding new index: "+n.name),[4,this.queryRunner.createIndex(n.tableName,n)];case 1:return r.sent(),[2]}})})}),[4,Promise.all(n.concat(r))]):[2];case 1:return a.sent(),[2]}})})})},e.prototype.dropColumnReferencedIndices=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return n=this.entityMetadatas.reduce(function(e,t){return e.concat(t.indices)},[]),(r=this.tableSchemas.find(function(t){return t.name===e}))?(i=n.filter(function(n){return n.tableName===e&&-1!==n.columns.indexOf(t)}),i.length?(o=r.indices.filter(function(e){return!!i.find(function(t){return e.name===t.name})}),0===o.length?[2]:(this.logger.logSchemaBuild("dropping related indices of "+e+"#"+t+": "+o.map(function(e){return e.name}).join(", ")),a=o.map(function(e){return r.removeIndex(e),s.queryRunner.dropIndex(r.name,e.name)}),[4,Promise.all(a)])):[2]):[2];case 1:return u.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.entityMetadatas.reduce(function(e,t){return e.concat(t.foreignKeys)},[]),(r=this.tableSchemas.find(function(t){return t.name===e}))?(o=n.filter(function(n){return n.tableName===e?!!n.columns.find(function(e){return e.fullName===t}):n.referencedTableName===e&&!!n.referencedColumns.find(function(e){return e.fullName===t})}),o.length?(a=o.filter(function(e){return!!r.foreignKeys.find(function(t){return t.name===e.name})}),0===a.length?[2]:(this.logger.logSchemaBuild("dropping related foreign keys of "+e+"#"+t+": "+a.map(function(e){return e.name}).join(", ")),s=a.map(function(e){return i.ForeignKeySchema.create(e)}),r.removeForeignKeys(s),[4,this.queryRunner.dropForeignKeys(r,s)])):[2]):[2];case 1:return u.sent(),[2]}})})},e.prototype.metadataColumnsToColumnSchemas=function(e){var t=this;return e.map(function(e){return r.ColumnSchema.create(e,t.queryRunner.normalizeType(e))})},e}(),e("SchemaBuilder",u)}}}),System.register("typeorm/metadata-args/error/EntityMetadataNotFound",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name="EntityMetadataNotFound";var r="function"==typeof t&&t.name?t.name:t;return n.message='No metadata for "'+r+'" was found.',n}return __extends(t,e),t}(Error),e("EntityMetadataNotFound",n)}}}),System.register("typeorm/migration/MigrationInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/migration/Migration",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.timestamp=e,this.name=t,this.instance=n}return e}(),e("Migration",n)}}}),System.register("typeorm/migration/MigrationExecutor",["typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/types/ColumnTypes","typeorm/query-builder/QueryBuilder","typeorm/query-runner/QueryRunnerProvider","typeorm/migration/Migration","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t||new a.QueryRunnerProvider(e.driver,!0)}return e.prototype.executePendingMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s,c=this;return __generator(this,function(l){switch(l.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return e=l.sent(),t=this.connection.createEntityManagerWithSingleDatabaseConnection(this.queryRunnerProvider),[4,this.createMigrationsTableIfNotExist()];case 2:return l.sent(),[4,this.loadExecutedMigrations()];case 3:return n=l.sent(),(r=this.getLatestMigration(n),i=this.getMigrations(),o=i.filter(function(e){if(n.find(function(t){return t.name===e.name}))return!1;if(r&&e.timestamp<r.timestamp)throw new Error("New migration found: "+e.name+", however this migration's timestamp is not valid. Migration's timestamp should not be older then migrations already executed in the database.");return!0}),o.length)?(this.connection.logger.log("info",n.length+" migrations are already loaded in the database."),this.connection.logger.log("info",i.length+" migrations were found in the source code."),r&&this.connection.logger.log("info",r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.log("info",o.length+" migrations are new migrations that needs to be executed."),a=!1,e.isTransactionActive()?[3,5]:[4,e.beginTransaction()]):(this.connection.logger.log("info","No migrations are pending"),[2]);case 4:l.sent(),a=!0,l.label=5;case 5:return l.trys.push([5,9,,12]),[4,u.PromiseUtils.runInSequence(o,function(n){return n.instance.up(e,c.connection,t).then(function(){return c.insertExecutedMigration(n)}).then(function(){c.connection.logger.log("info","Migration "+n.name+" has been executed successfully.")})})];case 6:return l.sent(),a?[4,e.commitTransaction()]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,12];case 9:return s=l.sent(),a?[4,e.rollbackTransaction()]:[3,11];case 10:l.sent(),l.label=11;case 11:throw s;case 12:return[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return e=u.sent(),t=this.connection.createEntityManagerWithSingleDatabaseConnection(this.queryRunnerProvider),[4,this.createMigrationsTableIfNotExist()];case 2:return u.sent(),[4,this.loadExecutedMigrations()];case 3:if(n=u.sent(),!(r=this.getLatestMigration(n)))return this.connection.logger.log("info","No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(o=i.find(function(e){return e.name===r.name})))throw new Error("No migration "+r.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.log("info",n.length+" migrations are already loaded in the database."),this.connection.logger.log("info",r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.log("info","Now reverting it..."),a=!1,e.isTransactionActive()?[3,5]:[4,e.beginTransaction()];case 4:u.sent(),a=!0,u.label=5;case 5:return u.trys.push([5,10,,13]),[4,o.instance.down(e,this.connection,t)];case 6:return u.sent(),[4,this.deleteExecutedMigration(o)];case 7:return u.sent(),this.connection.logger.log("info","Migration "+o.name+" has been reverted successfully."),a?[4,e.commitTransaction()]:[3,9];case 8:u.sent(),u.label=9;case 9:return[3,13];case 10:return s=u.sent(),a?[4,e.rollbackTransaction()]:[3,12];case 11:u.sent(),u.label=12;case 12:throw s;case 13:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(o){switch(o.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return e=o.sent(),[4,e.hasTable("migrations")];case 2:return t=o.sent(),t?[3,4]:[4,e.createTable(new n.TableSchema("migrations",[new r.ColumnSchema({name:"timestamp",type:e.normalizeType({type:i.ColumnTypes.NUMBER}),isPrimary:!0,isNullable:!1}),new r.ColumnSchema({name:"name",type:e.normalizeType({type:i.ColumnTypes.STRING}),isNullable:!1})]))];case 3:o.sent(),o.label=4;case 4:return[2]}})})},e.prototype.loadExecutedMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,new o.QueryBuilder(this.connection,this.queryRunnerProvider).select().fromTable("migrations","migrations").getRawMany()];case 1:return e=t.sent(),[2,e.map(function(e){return new s.Migration(parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.getMigrations().map(function(e){var t=e.constructor.name,n=parseInt(t.substr(-13));if(!n)throw new Error("Migration class name should contain a class name at the end of the file. "+t+" migration name is wrong.");return new s.Migration(n,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return t.length>0?t[0]:void 0},e.prototype.insertExecutedMigration=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return t=n.sent(),[4,t.insert("migrations",{timestamp:e.timestamp,name:e.name})];case 2:return n.sent(),[2]}})})},e.prototype.deleteExecutedMigration=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return t=n.sent(),[4,t.delete("migrations",{timestamp:e.timestamp,name:e.name})];case 2:return n.sent(),[2]}})})},e}(),e("MigrationExecutor",c)}}}),System.register("typeorm/connection/error/CannotRunMigrationNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotRunMigrationNotConnectedError",n.message='Cannot run/revert migrations on "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotRunMigrationNotConnectedError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryDoesNotHaveEntityError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this;return n.name="CustomRepositoryDoesNotHaveEntityError",n}return __extends(t,e),t}(Error),e("CustomRepositoryDoesNotHaveEntityError",n)}}}),System.register("typeorm/repository/AbstractRepository",["typeorm/repository/error/CustomRepositoryDoesNotHaveEntityError"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return Object.defineProperty(e.prototype,"entityManager",{get:function(){return this.connection.entityManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.connection.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.connection.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.connection.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.connection.getTreeRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specificRepository",{
get:function(){var e=this.connection.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.connection.getSpecificRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.connection.getCustomRepositoryTarget(this.constructor);if(!t)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.connection.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.entityManager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.entityManager.getTreeRepository(e)},e.prototype.getSpecificRepositoryFor=function(e){return this.entityManager.getSpecificRepository(e)},e}(),e("AbstractRepository",r)}}}),System.register("typeorm/repository/error/CustomRepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CustomRepositoryNotFoundError",n.message="Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",n}return __extends(t,e),t}(Error),e("CustomRepositoryNotFoundError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryReusedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+" was already used in the different connection. You can't share entity repositories between different connections when useContainer is set to true for the entity repository.")||this;return n.name="CustomRepositoryReusedError",n}return __extends(t,e),t}(Error),e("CustomRepositoryReusedError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryCannotInheritRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this;return n.name="CustomRepositoryCannotInheritRepositoryError",n}return __extends(t,e),t}(Error),e("CustomRepositoryCannotInheritRepositoryError",n)}}}),System.register("typeorm/entity-manager/MongoEntityManager",["typeorm/entity-manager/EntityManager"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.transaction=function(e){throw new Error("Transactions aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t,n){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.createCursor=function(e,t){return this.getMongoRepository(e).createCursor(t)},t.prototype.createEntityCursor=function(e,t){return this.getMongoRepository(e).createEntityCursor(t)},t.prototype.aggregate=function(e,t,n){return this.getMongoRepository(e).aggregate(t,n)},t.prototype.bulkWrite=function(e,t,n){return this.getMongoRepository(e).bulkWrite(t,n)},t.prototype.count=function(e,t,n){return this.getMongoRepository(e).count(t,n)},t.prototype.createCollectionIndex=function(e,t,n){return this.getMongoRepository(e).createCollectionIndex(t,n)},t.prototype.createCollectionIndexes=function(e,t){return this.getMongoRepository(e).createCollectionIndexes(t)},t.prototype.deleteMany=function(e,t,n){return this.getMongoRepository(e).deleteMany(t,n)},t.prototype.deleteOne=function(e,t,n){return this.getMongoRepository(e).deleteOne(t,n)},t.prototype.distinct=function(e,t,n,r){return this.getMongoRepository(e).distinct(t,n,r)},t.prototype.dropCollectionIndex=function(e,t,n){return this.getMongoRepository(e).dropCollectionIndex(t,n)},t.prototype.dropCollectionIndexes=function(e){return this.getMongoRepository(e).dropCollectionIndexes()},t.prototype.findOneAndDelete=function(e,t,n){return this.getMongoRepository(e).findOneAndDelete(t,n)},t.prototype.findOneAndReplace=function(e,t,n,r){return this.getMongoRepository(e).findOneAndReplace(t,n,r)},t.prototype.findOneAndUpdate=function(e,t,n,r){return this.getMongoRepository(e).findOneAndUpdate(t,n,r)},t.prototype.geoHaystackSearch=function(e,t,n,r){return this.getMongoRepository(e).geoHaystackSearch(t,n,r)},t.prototype.geoNear=function(e,t,n,r){return this.getMongoRepository(e).geoNear(t,n,r)},t.prototype.group=function(e,t,n,r,i,o,a,s){return this.getMongoRepository(e).group(t,n,r,i,o,a,s)},t.prototype.collectionIndexes=function(e){return this.getMongoRepository(e).collectionIndexes()},t.prototype.collectionIndexExists=function(e,t){return this.getMongoRepository(e).collectionIndexExists(t)},t.prototype.collectionIndexInformation=function(e,t){return this.getMongoRepository(e).collectionIndexInformation(t)},t.prototype.initializeOrderedBulkOp=function(e,t){return this.getMongoRepository(e).initializeOrderedBulkOp(t)},t.prototype.initializeUnorderedBulkOp=function(e,t){return this.getMongoRepository(e).initializeUnorderedBulkOp(t)},t.prototype.insertMany=function(e,t,n){return this.getMongoRepository(e).insertMany(t,n)},t.prototype.insertOne=function(e,t,n){return this.getMongoRepository(e).insertOne(t,n)},t.prototype.isCapped=function(e){return this.getMongoRepository(e).isCapped()},t.prototype.listCollectionIndexes=function(e,t){return this.getMongoRepository(e).listCollectionIndexes(t)},t.prototype.mapReduce=function(e,t,n,r){return this.getMongoRepository(e).mapReduce(t,n,r)},t.prototype.parallelCollectionScan=function(e,t){return this.getMongoRepository(e).parallelCollectionScan(t)},t.prototype.reIndex=function(e){return this.getMongoRepository(e).reIndex()},t.prototype.rename=function(e,t,n){return this.getMongoRepository(e).rename(t,n)},t.prototype.replaceOne=function(e,t,n,r){return this.getMongoRepository(e).replaceOne(t,n,r)},t.prototype.stats=function(e,t){return this.getMongoRepository(e).stats(t)},t.prototype.updateMany=function(e,t,n,r){return this.getMongoRepository(e).updateMany(t,n,r)},t.prototype.updateOne=function(e,t,n,r){return this.getMongoRepository(e).updateOne(t,n,r)},t}(n.EntityManager),e("MongoEntityManager",r)}}}),System.register("typeorm/connection/Connection",["typeorm/repository/Repository","typeorm/connection/error/RepositoryNotFoundError","typeorm/metadata/EntityListenerMetadata","typeorm/entity-manager/EntityManager","typeorm/util/DirectoryExportedClassesLoader","typeorm/index","typeorm/metadata-builder/EntityMetadataBuilder","typeorm/naming-strategy/DefaultNamingStrategy","typeorm/connection/error/CannotImportAlreadyConnectedError","typeorm/connection/error/CannotCloseNotConnectedError","typeorm/connection/error/CannotConnectAlreadyConnectedError","typeorm/connection/error/NamingStrategyNotFoundError","typeorm/connection/error/RepositoryNotTreeError","typeorm/connection/error/CannotSyncNotConnectedError","typeorm/connection/error/CannotUseNamingStrategyNotConnectedError","typeorm/subscriber/Broadcaster","typeorm/lazy-loading/LazyRelationsWrapper","typeorm/repository/RepositoryAggregator","typeorm/schema-builder/SchemaBuilder","typeorm/query-runner/QueryRunnerProvider","typeorm/metadata-args/error/EntityMetadataNotFound","typeorm/migration/MigrationExecutor","typeorm/connection/error/CannotRunMigrationNotConnectedError","typeorm/platform/PlatformTools","typeorm/repository/AbstractRepository","typeorm/repository/error/CustomRepositoryNotFoundError","typeorm/repository/error/CustomRepositoryReusedError","typeorm/repository/error/CustomRepositoryCannotInheritRepositoryError","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/MongoEntityManager"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,m,p,f,y,h,g,v,b,E,_,T,C,N,w,R,A,M,S,O,P,I;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){m=e},function(e){p=e},function(e){f=e},function(e){y=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e},function(e){_=e},function(e){T=e},function(e){C=e},function(e){N=e},function(e){w=e},function(e){R=e},function(e){A=e},function(e){M=e},function(e){S=e},function(e){O=e},function(e){P=e}],execute:function(){I=function(){function e(e,t,n){this.entityMetadatas=[],this.repositoryAggregators=[],this.entityRepositories=[],this.entityListeners=[],this.entitySubscribers=[],this.entityClasses=[],this.entitySchemas=[],this.subscriberClasses=[],this.namingStrategyClasses=[],this.migrationClasses=[],this._isConnected=!1,this.name=e,this.driver=t,this.logger=n,this._entityManager=this.createEntityManager(),this.broadcaster=this.createBroadcaster()}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityManager",{get:function(){return this._entityManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mongoEntityManager",{get:function(){if(!(this._entityManager instanceof P.MongoEntityManager))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this._entityManager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new m.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:t.sent(),this._isConnected=!0,t.label=2;case 2:return t.trys.push([2,3,,5]),this.buildMetadatas(),[3,5];case 3:return e=t.sent(),[4,this.close()];case 4:throw t.sent(),e;case 5:return[2,this]}})})},e.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new d.CannotCloseNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this._isConnected=!1,[2]}})})},e.prototype.dropDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.driver.createQueryRunner()];case 1:return e=t.sent(),[4,e.clearDatabase()];case 2:return t.sent(),[2]}})})},e.prototype.syncSchema=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isConnected?e?[4,this.dropDatabase()]:[3,2]:[2,Promise.reject(new y.CannotSyncNotConnectedError(this.name))];case 1:t.sent(),t.label=2;case 2:return this.driver instanceof O.MongoDriver?[4,this.driver.syncSchema(this.entityMetadatas)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,this.createSchemaBuilder().build()];case 5:t.sent(),t.label=6;case 6:return[2]}})})},e.prototype.runMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.isConnected?(e=new C.MigrationExecutor(this),[4,e.executePendingMigrations()]):[2,Promise.reject(new N.CannotRunMigrationNotConnectedError(this.name))];case 1:return t.sent(),[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.isConnected?(e=new C.MigrationExecutor(this),[4,e.undoLastMigration()]):[2,Promise.reject(new N.CannotRunMigrationNotConnectedError(this.name))];case 1:return t.sent(),[2]}})})},e.prototype.importEntitiesFromDirectories=function(e){return this.importEntities(a.importClassesFromDirectories(e)),this},e.prototype.importEntitySchemaFromDirectories=function(e){return this.importEntitySchemas(a.importJsonsFromDirectories(e)),this},e.prototype.importSubscribersFromDirectories=function(e){return this.importSubscribers(a.importClassesFromDirectories(e)),this},e.prototype.importNamingStrategiesFromDirectories=function(e){return this.importNamingStrategies(a.importClassesFromDirectories(e)),this},e.prototype.importMigrationsFromDirectories=function(e){return this.importMigrations(a.importClassesFromDirectories(e)),this},e.prototype.importEntities=function(e){var t=this;if(this.isConnected)throw new l.CannotImportAlreadyConnectedError("entities",this.name);return e.forEach(function(e){return t.entityClasses.push(e)}),this},e.prototype.importEntitySchemas=function(e){var t=this;if(this.isConnected)throw new l.CannotImportAlreadyConnectedError("schemas",this.name);return e.forEach(function(e){return t.entitySchemas.push(e)}),this},e.prototype.importSubscribers=function(e){var t=this;if(this.isConnected)throw new l.CannotImportAlreadyConnectedError("entity subscribers",this.name);return e.forEach(function(e){return t.subscriberClasses.push(e)}),this},e.prototype.importNamingStrategies=function(e){var t=this;if(this.isConnected)throw new l.CannotImportAlreadyConnectedError("naming strategies",this.name);return e.forEach(function(e){return t.namingStrategyClasses.push(e)}),this},e.prototype.importMigrations=function(e){var t=this;if(this.isConnected)throw new l.CannotImportAlreadyConnectedError("migrations",this.name);return e.forEach(function(e){return t.migrationClasses.push(e)}),this},e.prototype.useNamingStrategy=function(e){if(this.isConnected)throw new h.CannotUseNamingStrategyNotConnectedError(this.name);return this.usedNamingStrategy=e,this},e.prototype.getMetadata=function(e){var t=this.entityMetadatas.find(function(t){return t.target===e||"string"==typeof e&&t.targetName===e});if(!t)throw new T.EntityMetadataNotFound(e);return t},e.prototype.getRepository=function(e){return this.findRepositoryAggregator(e).repository},e.prototype.getTreeRepository=function(e){var t=this.findRepositoryAggregator(e).treeRepository;if(!t)throw new f.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof O.MongoDriver))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.findRepositoryAggregator(e).repository},e.prototype.getSpecificRepository=function(e){return this.findRepositoryAggregator(e).specificRepository},e.prototype.createEntityManagerWithSingleDatabaseConnection=function(e){return e||(e=new _.QueryRunnerProvider(this.driver,!0)),new o.EntityManager(this,e)},e.prototype.getMigrations=function(){return this.migrationClasses&&this.migrationClasses.length?this.migrationClasses.map(function(e){return s.getFromContainer(e)}):[]},e.prototype.getCustomRepository=function(e){var t=s.getMetadataArgsStorage().entityRepositories.toArray().find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new A.CustomRepositoryNotFoundError(e);var r=this.entityRepositories.find(function(t){return t.constructor===e});if(!r){if(t.useContainer){if(((r=s.getFromContainer(t.target))instanceof R.AbstractRepository||r instanceof n.Repository)&&r.connection&&r.connection!==this)throw new M.CustomRepositoryReusedError(e)}else r=new t.target;if(r instanceof R.AbstractRepository&&(r.connection||(r.connection=this)),r instanceof n.Repository){if(!t.entity)throw new S.CustomRepositoryCannotInheritRepositoryError(e);r.connection=this,r.metadata=this.getMetadata(t.entity)}this.entityRepositories.push(r)}return r},e.prototype.getCustomRepositoryTarget=function(e){var t=s.getMetadataArgsStorage().entityRepositories.toArray().find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new A.CustomRepositoryNotFoundError(e);return t.entity},e.prototype.findRepositoryAggregator=function(e){if(!this.entityMetadatas.find(function(t){return t.target===e||"string"==typeof e&&t.targetName===e}))throw new r.RepositoryNotFoundError(this.name,e);var t=this.getMetadata(e),n=this.repositoryAggregators.find(function(e){return e.metadata===t});if(!n)throw new r.RepositoryNotFoundError(this.name,e);return n},e.prototype.buildMetadatas=function(){var e=this;this.entitySubscribers.length=0,this.entityListeners.length=0,this.repositoryAggregators.length=0,this.entityMetadatas.length=0;var t=this.createNamingStrategy();this.driver.namingStrategy=t;var n=this.createLazyRelationsWrapper();this.subscriberClasses&&this.subscriberClasses.length&&!w.PlatformTools.getEnvVariable("SKIP_SUBSCRIBERS_LOADING")&&s.getMetadataArgsStorage().entitySubscribers.filterByTargets(this.subscriberClasses).toArray().map(function(e){return s.getFromContainer(e.target)}).forEach(function(t){return e.entitySubscribers.push(t)}),this.entityClasses&&this.entityClasses.length&&s.getMetadataArgsStorage().entityListeners.filterByTargets(this.entityClasses).toArray().forEach(function(t){return e.entityListeners.push(new i.EntityListenerMetadata(t))}),this.entityClasses&&this.entityClasses.length&&s.getFromContainer(u.EntityMetadataBuilder).buildFromMetadataArgsStorage(this.driver,n,t,this.entityClasses).forEach(function(t){e.entityMetadatas.push(t),e.repositoryAggregators.push(new b.RepositoryAggregator(e,t))}),this.entitySchemas&&this.entitySchemas.length&&s.getFromContainer(u.EntityMetadataBuilder).buildFromSchemas(this.driver,n,t,this.entitySchemas).forEach(function(t){e.entityMetadatas.push(t),e.repositoryAggregators.push(new b.RepositoryAggregator(e,t))})},e.prototype.createNamingStrategy=function(){var e=this;if(!this.namingStrategyClasses||!this.namingStrategyClasses.length||!this.usedNamingStrategy)return s.getFromContainer(c.DefaultNamingStrategy);var t=s.getMetadataArgsStorage().namingStrategies.filterByTargets(this.namingStrategyClasses).toArray().find(function(t){return"string"==typeof e.usedNamingStrategy?t.name===e.usedNamingStrategy:t.target===e.usedNamingStrategy});if(!t)throw new p.NamingStrategyNotFoundError(this.usedNamingStrategy,this.name);return s.getFromContainer(t.target)},e.prototype.createEntityManager=function(){return this.driver instanceof O.MongoDriver?new P.MongoEntityManager(this):new o.EntityManager(this)},e.prototype.createBroadcaster=function(){return new g.Broadcaster(this,this.entitySubscribers,this.entityListeners)},e.prototype.createSchemaBuilder=function(){return new E.SchemaBuilder(this.driver,this.logger,this.entityMetadatas)},e.prototype.createLazyRelationsWrapper=function(){return new v.LazyRelationsWrapper(this)},e}(),e("Connection",I)}}}),System.register("typeorm/connection/error/ConnectionNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="ConnectionNotFoundError",n.message='Connection "'+t+'" was not found.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("ConnectionNotFoundError",n)}}}),System.register("typeorm/connection/ConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/MissingDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="MissingDriverError",n.message="Wrong driver "+t+' given. Supported drivers are: "mysql", "postgres", "mssql", "oracle", "mariadb", "sqlite".',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("MissingDriverError",n)}}}),System.register("typeorm/connection/error/AlreadyHasActiveConnectionError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="AlreadyHasActiveConnectionError",n.message='Cannot create a new connection named "'+t+'", because connection with such name already exist and it now has an active connection session.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("AlreadyHasActiveConnectionError",n)}}}),System.register("typeorm/driver/sqlite/SqliteQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,m;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e}],execute:function(){m=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return i.sent(),[4,this.beginTransaction()];case 2:i.sent(),i.label=3;case 3:return i.trys.push([3,7,9,12]),e="select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 4:return t=i.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 5:return i.sent(),[4,this.commitTransaction()];case 6:return i.sent(),[3,12];case 7:return n=i.sent(),[4,this.rollbackTransaction()];case 8:throw i.sent(),n;case 9:return[4,this.release()];case 10:return i.sent(),[4,this.query("PRAGMA foreign_keys = ON;")];case 11:return i.sent(),[7];case 12:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.all(e,t,function(o,a){o?(n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o)):r(a)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return u.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES",s=r.map(function(e){return t[e]}),[2,new Promise(function(e,t){u.logger.logQuery(a,s);var r=u;u.databaseConnection.connection.run(a,s,function(i){if(i)r.logger.logFailedQuery(a,s),r.logger.logQueryError(i),t(i);else{if(n)return e(this.lastID);e()}})})]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return n=i.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t,n,r,i,a,d,m,p,f,y,h,g=this;return __generator(this,function(v){switch(v.label){case 0:return t=new s.TableSchema(e.name),[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return n=v.sent(),r=n[0],i=n[1],a=n[2],d=void 0,m=e.sql,-1!==m.indexOf("AUTOINCREMENT")&&(d=m.substr(0,m.indexOf("AUTOINCREMENT")),p=d.lastIndexOf(","),f=d.lastIndexOf("("),-1!==p?(d=d.substr(p),d=d.substr(0,d.lastIndexOf('"')),d=d.substr(d.indexOf('"')+1)):-1!==f&&(d=d.substr(f),d=d.substr(0,d.lastIndexOf('"')),d=d.substr(d.indexOf('"')+1))),t.columns=r.map(function(n){var r=new o.ColumnSchema;r.name=n.name,r.type=n.type.toLowerCase(),r.default=null!==n.dflt_value&&void 0!==n.dflt_value?n.dflt_value:void 0,r.isNullable=0===n.notnull,r.isPrimary=1===n.pk,r.comment="",r.isGenerated=d===n.name;var i=a.filter(function(e){return e.from===n.name}).map(function(t){var n=g.driver.namingStrategy.foreignKeyName(e.name,[t.from],t.table,[t.to]);return new c.ForeignKeySchema(n,[t.from],[t.to],t.table,t.on_delete)});return t.addForeignKeys(i),r}),[4,Promise.all(i.filter(function(e){return"pk"===e.origin}).map(function(e){return __awaiter(g,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.query('PRAGMA index_info("'+e.name+'")')];case 1:return n=i.sent(),r=n.map(function(e){return e.name}),r.forEach(function(n){t.primaryKeys.push(new l.PrimaryKeySchema(e.name,n))}),[2]}})})}))];case 2:return v.sent(),y=i.filter(function(e){return"pk"!==e.origin&&!t.foreignKeys.find(function(t){return t.name===e.name})&&!t.primaryKeys.find(function(t){return t.name===e.name})}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){return __awaiter(g,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:return r=i.find(function(e){return e.name===n}),[4,this.query('PRAGMA index_info("'+r.name+'")')];case 1:return o=s.sent(),a=o.map(function(e){return e.name}),"sqlite_autoindex"===r.name.substr(0,"sqlite_autoindex".length)?(1===r.unique&&a.forEach(function(e){var n=t.columns.find(function(t){return t.name===e});n&&(n.isUnique=!0)}),[2,Promise.resolve(void 0)]):[2,new u.IndexSchema(e.name,r.name,a,"1"===r.unique)]}})})}),[4,Promise.all(y)];case 3:return h=v.sent(),t.indices=h.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info("'+e+'")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof s.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.")
;if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return a=void 0,n instanceof o.ColumnSchema?a=n:(a=i.clone(),a.name=n),[2,this.changeColumn(r,i,a)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return n=void 0,e instanceof s.TableSchema?(n=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:n=i.sent(),i.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(r=void 0,!(r=t instanceof o.ColumnSchema?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=o.sent(),r=n.clone(),i=t.map(function(e){if("string"==typeof e){var t=n.columns.find(function(t){return t.name===e});if(!t)throw new Error('Cannot drop a column - column "'+e+'" was not found in the "'+n.name+'" table.');return t}return e}),r.removeColumns(i),[2,this.recreateTable(r)]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return"character varying("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"boolean";case"integer":case"int":return"integer";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"real";case"double":case"number":return"double precision";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return e.timezone?"time with time zone":"time without time zone";case"datetime":return e.timezone?"timestamp with time zone":"timestamp without time zone";case"json":return"json";case"simple_array":return e.length?"character varying("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"SQLite")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("DELETE FROM "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=$"+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof a.ColumnMetadata?t+=" "+this.normalizeType(e):t+=" "+e.type,!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&(t+=" PRIMARY KEY AUTOINCREMENT"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?t+=" DEFAULT "+e.default:"boolean"==typeof e.default?t+=" DEFAULT "+(!0===e.default?"1":"0"):"function"==typeof e.default?t+=" DEFAULT "+e.default():"string"==typeof e.default?t+=" DEFAULT '"+e.default+"'":t+=" DEFAULT "+e.default),t},e.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,m=this;return __generator(this,function(p){switch(p.label){case 0:return r=e.columns.map(function(e){return m.buildCreateColumnSql(e)}).join(", "),i=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),o='CREATE TABLE "temporary_'+e.name+'" ('+r,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");o+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(o+=" ON DELETE "+e.onDelete)}),a=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),a.length>0&&(o+=", PRIMARY KEY("+a.map(function(e){return""+e.name}).join(", ")+")"),o+=")",[4,this.query(o)];case 1:return p.sent(),(s=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):i,n)?(u='INSERT INTO "temporary_'+e.name+'"('+s+") SELECT "+s+' FROM "'+e.name+'"',[4,this.query(u)]):[3,3];case 2:p.sent(),p.label=3;case 3:return c='DROP TABLE "'+e.name+'"',[4,this.query(c)];case 4:return p.sent(),l='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(l)];case 5:return p.sent(),d=e.indices.map(function(t){return m.createIndex(e.name,t)}),[4,Promise.all(d)];case 6:return p.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof s.TableSchema?[2,e]:[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(t=n.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("SqliteQueryRunner",m)}}}),System.register("typeorm/driver/sqlite/SqliteDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/metadata/types/ColumnTypes","typeorm/driver/sqlite/SqliteQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e,t,n){if(this.options=e,this.logger=t,this.sqlite=n,!this.options.storage)throw new a.DriverOptionNotSetError("storage");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this;return new Promise(function(t,n){var r=new e.sqlite.Database(e.options.storage,function(i){if(i)return n(i);e.databaseConnection={id:1,connection:r,isTransactionActive:!1},r.run("PRAGMA foreign_keys = ON;",function(e,n){t()})})})},e.prototype.disconnect=function(){var e=this;return new Promise(function(t,r){var i=function(e){return e?r(e):t()};if(!e.databaseConnection)return r(new n.ConnectionIsNotSetError("sqlite"));e.databaseConnection.connection.close(i)})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("sqlite"))];case 1:return e=t.sent(),[2,new o.SqliteQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.sqlite,connection:this.databaseConnection?this.databaseConnection.connection:void 0}},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case i.ColumnTypes.BOOLEAN:return!0===e?1:0;case i.ColumnTypes.DATE:return s.DataTransformationUtils.mixedDateToDateString(e);case i.ColumnTypes.TIME:return s.DataTransformationUtils.mixedDateToTimeString(e);case i.ColumnTypes.DATETIME:return t.localTimezone?s.DataTransformationUtils.mixedDateToDatetimeString(e):s.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case i.ColumnTypes.JSON:return JSON.stringify(e);case i.ColumnTypes.SIMPLE_ARRAY:return s.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case i.ColumnTypes.BOOLEAN:return!!e;case i.ColumnTypes.DATETIME:return s.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case i.ColumnTypes.TIME:return s.DataTransformationUtils.mixedTimeToString(e);case i.ColumnTypes.JSON:return JSON.parse(e);case i.ColumnTypes.SIMPLE_ARRAY:return s.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):(n.push(r),"$"+n.length)}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.retrieveDatabaseConnection=function(){if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("sqlite")},e.prototype.loadDependencies=function(){try{this.sqlite=u.PlatformTools.load("sqlite3").verbose()}catch(e){throw new r.DriverPackageNotInstalledError("SQLite","sqlite3")}},e}(),e("SqliteDriver",c)}}}),System.register("typeorm/connection/error/CannotDetermineConnectionOptionsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="CannotDetermineConnectionOptionsError",t.message='Cannot create connection, because connection options are missing. You either need to explicitly pass connection options, either create a ormconfig.json with connection options and "default" connection name, either to set proper environment variables. Also, if you are using environment-specific configurations in your ormconfig.json make sure your are running under correct NODE_ENV.',t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("CannotDetermineConnectionOptionsError",n)}}}),System.register("typeorm/driver/websql/WebsqlQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/TableSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,6,8,10]),e="select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 3:return t=i.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 4:return i.sent(),[4,this.commitTransaction()];case 5:return i.sent(),[3,10];case 6:return n=i.sent(),[4,this.rollbackTransaction()];case 7:throw i.sent(),n;case 8:return[4,this.release()];case 9:return i.sent(),[7];case 10:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return this.databaseConnection.isTransactionActive=!1,[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return this.databaseConnection.isTransactionActive=!1,[2]})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.transaction(function(o){o.executeSql(e,t,function(e,t){var n=Object.keys(t.rows).filter(function(e){return"length"!==e}).map(function(e){return t.rows[e]});r(n)},function(r,o){return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o)})})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,c=this;return __generator(this,function(l){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES",s=r.map(function(e){return t[e]}),[2,new Promise(function(e,t){c.logger.logQuery(a,s),c.databaseConnection.connection.transaction(function(r){r.executeSql(a,s,function(t,r){if(n)return e(r.insertId);e()},function(e,n){return c.logger.logFailedQuery(a,s),c.logger.logQueryError(n),t(n)})})})]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,c;return __generator(this,function(l){switch(l.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),c=a.concat(s),[4,this.query(o,c)];case 1:return l.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return n=i.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new s.TableSchema(e.name),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = "+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info("'+e+'")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof s.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return a=void 0,n instanceof o.ColumnSchema?a=n:(a=i.clone(),a.name=n),[2,this.changeColumn(r,i,a)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return n=void 0,e instanceof s.TableSchema?(n=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:n=i.sent(),i.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(r=void 0,!(r=t instanceof o.ColumnSchema?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=o.sent(),r=n.clone(),i=t.map(function(e){if("string"==typeof e){var t=n.columns.find(function(t){return t.name===e});if(!t)throw new Error('Cannot drop a column - column "'+e+'" was not found in the "'+n.name+'" table.');return t}return e}),r.removeColumns(i),[2,this.recreateTable(r)]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return"character varying("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"boolean";case"integer":case"int":return"integer";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"real";case"double":case"number":return"double precision";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return e.timezone?"time with time zone":"time without time zone";case"datetime":return e.timezone?"timestamp with time zone":"timestamp without time zone";case"json":return"json";case"simple_array":return e.length?"character varying("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"WebSQL")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("DELETE FROM "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=$"+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof a.ColumnMetadata?t+=" "+this.normalizeType(e):t+=" "+e.type,!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&(t+=" PRIMARY KEY AUTOINCREMENT"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?t+=" DEFAULT "+e.default:"boolean"==typeof e.default?t+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?t+=" DEFAULT "+e.default():"string"==typeof e.default?t+=" DEFAULT '"+e.default+"'":t+=" DEFAULT "+e.default),t},e.prototype.recreateTable=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d=this;return __generator(this,function(m){switch(m.label){case 0:return n=e.columns.map(function(e){return d.buildCreateColumnSql(e)}).join(", "),r=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),i='CREATE TABLE "temporary_'+e.name+'" ('+n,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");i+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(i+=" ON DELETE "+e.onDelete)}),o=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),o.length>0&&(i+=", PRIMARY KEY("+o.map(function(e){return""+e.name}).join(", ")+")"),i+=")",[4,this.query(i)];case 1:return m.sent(),a=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):r,s='INSERT INTO "temporary_'+e.name+'"('+a+") SELECT "+a+' FROM "'+e.name+'"',[4,this.query(s)];case 2:return m.sent(),u='DROP TABLE "'+e.name+'"',[4,this.query(u)];case 3:return m.sent(),c='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(c)];case 4:return m.sent(),l=e.indices.map(function(t){return d.createIndex(e.name,t)}),[4,Promise.all(l)];case 5:return m.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof s.TableSchema?[2,e]:[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(t=n.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("WebsqlQueryRunner",c)}}}),System.register("typeorm/driver/websql/WebsqlDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/DriverUtils","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/driver/websql/WebsqlQueryRunner"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e,t){if(this.options=r.DriverUtils.buildDriverOptions(e),this.logger=t,!this.options.database)throw new o.DriverOptionNotSetError("database")}return e.prototype.connect=function(){var e=this,t=Object.assign({},{database:this.options.database},this.options.extra||{});return new Promise(function(n,r){var i=openDatabase(t.database,t.version,t.description,t.size);e.databaseConnection={id:1,connection:i,isTransactionActive:!1},n()})},e.prototype.disconnect=function(){if(!this.databaseConnection)throw new n.ConnectionIsNotSetError("websql");return new Promise(function(e,t){e()})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("websql"))];case 1:return e=t.sent(),[2,new s.WebsqlQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{connection:this.databaseConnection?this.databaseConnection.connection:void 0}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),"?"}),[e,n]},e.prototype.escapeColumnName=function(e){return e},e.prototype.escapeAliasName=function(e){return e},e.prototype.escapeTableName=function(e){return e},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case i.ColumnTypes.BOOLEAN:return!0===e?1:0;case i.ColumnTypes.DATE:return a.DataTransformationUtils.mixedDateToDateString(e);case i.ColumnTypes.TIME:return a.DataTransformationUtils.mixedDateToTimeString(e);case i.ColumnTypes.DATETIME:return t.localTimezone?a.DataTransformationUtils.mixedDateToDatetimeString(e):a.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case i.ColumnTypes.JSON:return JSON.stringify(e);case i.ColumnTypes.SIMPLE_ARRAY:return a.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case i.ColumnTypes.BOOLEAN:return!!e;case i.ColumnTypes.DATETIME:return a.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case i.ColumnTypes.TIME:return a.DataTransformationUtils.mixedTimeToString(e);case i.ColumnTypes.JSON:return JSON.parse(e);case i.ColumnTypes.SIMPLE_ARRAY:return a.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){
if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("websql")},e}(),e("WebsqlDriver",u)}}}),System.register("typeorm/connection/ConnectionManager",["typeorm/connection/Connection","typeorm/connection/error/ConnectionNotFoundError","typeorm/driver/mysql/MysqlDriver","typeorm/connection/error/MissingDriverError","typeorm/driver/postgres/PostgresDriver","typeorm/connection/error/AlreadyHasActiveConnectionError","typeorm/logger/Logger","typeorm/driver/sqlite/SqliteDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/util/OrmUtils","typeorm/connection/error/CannotDetermineConnectionOptionsError","typeorm/platform/PlatformTools","typeorm/driver/websql/WebsqlDriver","typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,m,p,f,y,h,g;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){m=e},function(e){p=e},function(e){f=e},function(e){y=e},function(e){h=e}],execute:function(){g=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new r.ConnectionNotFoundError(e);return t},e.prototype.create=function(e){var t=new u.Logger(e.logging||{}),n=this.createDriver(e.driver,t),r=this.createConnection(e.name||"default",n,t);if(e.entitySchemas){var i=this.splitStringsAndClasses(e.entitySchemas),o=i[0],a=i[1];r.importEntitySchemas(a).importEntitySchemaFromDirectories(o)}if(e.entities){var s=this.splitStringsAndClasses(e.entities),o=s[0],a=s[1];r.importEntities(a).importEntitiesFromDirectories(o)}if(e.subscribers){var c=this.splitStringsAndClasses(e.subscribers),o=c[0],a=c[1];r.importSubscribers(a).importSubscribersFromDirectories(o)}if(e.namingStrategies){var l=this.splitStringsAndClasses(e.namingStrategies),o=l[0],a=l[1];r.importNamingStrategies(a).importNamingStrategiesFromDirectories(o)}if(e.migrations){var d=this.splitStringsAndClasses(e.migrations),o=d[0],a=d[1];r.importMigrations(a).importMigrationsFromDirectories(o)}return e.usedNamingStrategy&&r.useNamingStrategy(e.usedNamingStrategy),r},e.prototype.createAndConnect=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(e&&e instanceof Object)return[2,this.createAndConnectByConnectionOptions(e)];if("string"==typeof e)return[2,this.createFromConfigAndConnect(e||"default",t)];if(this.hasDefaultConfigurationInConfigurationFile())return[2,this.createFromConfigAndConnect("default")];if(this.hasDefaultConfigurationInEnvironmentVariables())return[2,this.createFromEnvAndConnect()];throw new p.CannotDetermineConnectionOptionsError})})},e.prototype.createAndConnectToAll=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return e&&e instanceof Array?[2,Promise.all(e.map(function(e){return t.createAndConnectByConnectionOptions(e)}))]:"string"==typeof e?[2,this.createFromConfigAndConnectToAll(e)]:this.hasOrmConfigurationFile()?[2,this.createFromConfigAndConnectToAll()]:this.hasDefaultConfigurationInEnvironmentVariables()?[4,this.createFromEnvAndConnect()]:[3,2];case 1:return[2,[n.sent()]];case 2:throw new p.CannotDetermineConnectionOptionsError}})})},e.prototype.hasOrmConfigurationFile=function(){var e=f.PlatformTools.load("app-root-path").path+"/ormconfig.json";if(!f.PlatformTools.fileExist(e))return!1;var t=f.PlatformTools.load(e);return t instanceof Array?t.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}).length>0:t instanceof Object&&((!t.environment||t.environment===f.PlatformTools.getEnvVariable("NODE_ENV"))&&Object.keys(t).length>0)},e.prototype.hasDefaultConfigurationInConfigurationFile=function(){var e=f.PlatformTools.load("app-root-path").path+"/ormconfig.json";if(!f.PlatformTools.fileExist(e))return!1;var t=f.PlatformTools.load(e);return t instanceof Array?!!t.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}).find(function(e){return!!e.name||"default"===e.name}):t instanceof Object&&(!(!t.name||"default"!==t.name)&&(!t.environment||t.environment===f.PlatformTools.getEnvVariable("NODE_ENV")))},e.prototype.hasDefaultConfigurationInEnvironmentVariables=function(){return!!f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_TYPE")},e.prototype.createFromEnvAndConnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.createAndConnectByConnectionOptions({driver:{type:f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_TYPE"),url:f.PlatformTools.getEnvVariable("TYPEORM_URL"),host:f.PlatformTools.getEnvVariable("TYPEORM_HOST"),port:f.PlatformTools.getEnvVariable("TYPEORM_PORT"),username:f.PlatformTools.getEnvVariable("TYPEORM_USERNAME"),password:f.PlatformTools.getEnvVariable("TYPEORM_PASSWORD"),database:f.PlatformTools.getEnvVariable("TYPEORM_DATABASE"),sid:f.PlatformTools.getEnvVariable("TYPEORM_SID"),storage:f.PlatformTools.getEnvVariable("TYPEORM_STORAGE"),usePool:void 0!==f.PlatformTools.getEnvVariable("TYPEORM_USE_POOL")?m.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_USE_POOL")):void 0,extra:f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0},autoSchemaSync:m.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_AUTO_SCHEMA_SYNC")),entities:f.PlatformTools.getEnvVariable("TYPEORM_ENTITIES")?f.PlatformTools.getEnvVariable("TYPEORM_ENTITIES").split(","):[],subscribers:f.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS")?f.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS").split(","):[],entitySchemas:f.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS")?f.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS").split(","):[],namingStrategies:f.PlatformTools.getEnvVariable("TYPEORM_NAMING_STRATEGIES")?f.PlatformTools.getEnvVariable("TYPEORM_NAMING_STRATEGIES").split(","):[],usedNamingStrategy:f.PlatformTools.getEnvVariable("TYPEORM_USED_NAMING_STRATEGY"),logging:{logQueries:m.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_LOGGING_QUERIES")),logFailedQueryError:m.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_LOGGING_FAILED_QUERIES")),logOnlyFailedQueries:m.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_LOGGING_ONLY_FAILED_QUERIES"))}})]})})},e.prototype.createFromConfigAndConnectToAll=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){if(!(t=f.PlatformTools.load(e||f.PlatformTools.load("app-root-path").path+"/ormconfig.json")))throw new Error("Configuration "+(e||"ormconfig.json")+" was not found. Add connection configuration inside ormconfig.json file.");return n=t.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}).map(function(e){return r.createAndConnectByConnectionOptions(e)}),[2,Promise.all(n)]})})},e.prototype.createFromConfigAndConnect=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){if(!(n=f.PlatformTools.load(t||f.PlatformTools.load("app-root-path").path+"/ormconfig.json")))throw new Error("Configuration "+(t||"ormconfig.json")+" was not found. Add connection configuration inside ormconfig.json file.");if(r=n.filter(function(t){return(t.name||"default")===e}),i=r.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}),!i.length)throw new Error('Connection "'+e+'" '+(f.PlatformTools.getEnvVariable("NODE_ENV")?"for the environment "+f.PlatformTools.getEnvVariable("NODE_ENV")+" ":"")+"was not found in the json configuration file."+(r.length?" However there are such configurations for other environments: "+r.map(function(e){return e.environment}).join(", ")+".":""));return[2,this.createAndConnectByConnectionOptions(i[0])]})})},e.prototype.createAndConnectByConnectionOptions=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=this.create(e),[4,t.connect()];case 1:return n.sent(),!e.dropSchemaOnConnection||f.PlatformTools.getEnvVariable("SKIP_SCHEMA_CREATION")?[3,3]:[4,t.dropDatabase()];case 2:n.sent(),n.label=3;case 3:return!e.autoSchemaSync||f.PlatformTools.getEnvVariable("SKIP_SCHEMA_CREATION")?[3,5]:[4,t.syncSchema()];case 4:n.sent(),n.label=5;case 5:return!e.autoMigrationsRun||f.PlatformTools.getEnvVariable("SKIP_MIGRATIONS_RUN")?[3,7]:[4,t.runMigrations()];case 6:n.sent(),n.label=7;case 7:return[2,t]}})})},e.prototype.splitStringsAndClasses=function(e){return[e.filter(function(e){return"string"==typeof e}),e.filter(function(e){return"string"!=typeof e})]},e.prototype.createDriver=function(e,t){switch(e.type){case"mysql":return new i.MysqlDriver(e,t,void 0);case"postgres":return new a.PostgresDriver(e,t);case"mariadb":return new i.MysqlDriver(e,t);case"sqlite":return new c.SqliteDriver(e,t);case"oracle":return new l.OracleDriver(e,t);case"mssql":return new d.SqlServerDriver(e,t);case"websql":return new y.WebsqlDriver(e,t);case"mongodb":return new h.MongoDriver(e,t);default:throw new o.MissingDriverError(e.type)}},e.prototype.createConnection=function(e,t,r){var i=this.connections.find(function(t){return t.name===e});if(i){if(i.isConnected)throw new s.AlreadyHasActiveConnectionError(e);this.connections.splice(this.connections.indexOf(i),1)}var o=new n.Connection(e,t,r);return this.connections.push(o),o},e}(),e("ConnectionManager",g)}}}),System.register("typeorm/decorator/error/GeneratedOnlyForPrimaryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="GeneratedOnlyForPrimaryError",r.message="Column for property "+t.constructor.name+"#"+n+" cannot have a generated value because its not a primary column. Try to use @PrimaryColumn decorator.",r}return __extends(t,e),t}(Error),e("GeneratedOnlyForPrimaryError",n)}}}),System.register("typeorm/decorator/columns/Column",["typeorm/decorator/error/GeneratedOnlyForPrimaryError","typeorm/index","typeorm/metadata/types/ColumnTypes"],function(e,t){"use strict";function n(e,t){var n;return"string"==typeof e?n=e:e&&(t=e,n=e.type),function(e,a){if(!n){var s=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,a):void 0;s&&(n=o.ColumnTypes.determineTypeFromFunction(s))}if(t||(t={}),!t.type&&n&&(t=Object.assign({type:n},t)),t.generated)throw new r.GeneratedOnlyForPrimaryError(e,a);var u={target:e.constructor,propertyName:a,mode:"regular",options:t};i.getMetadataArgsStorage().columns.add(u)}}t&&t.id;e("Column",n);var r,i,o;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/CreateDateColumn",["typeorm/metadata/types/ColumnTypes","typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign({type:r.ColumnTypes.DATETIME},e);var o={target:t.constructor,propertyName:n,mode:"createDate",options:e};i.getMetadataArgsStorage().columns.add(o)}}t&&t.id;e("CreateDateColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/DiscriminatorColumn",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={name:e.name,type:e.type},i={target:t,mode:"discriminator",propertyName:e.name,options:n};r.getMetadataArgsStorage().columns.add(i)}}t&&t.id;e("DiscriminatorColumn",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/error/PrimaryColumnCannotBeNullableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="PrimaryColumnCannotBeNullableError",r.message="Primary column "+t.constructor.name+"#"+n+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",r}return __extends(t,e),t}(Error),e("PrimaryColumnCannotBeNullableError",n)}}}),System.register("typeorm/decorator/columns/PrimaryGeneratedColumn",["typeorm/index","typeorm/decorator/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";function n(e){return function(t,n){if(e||(e={}),e.type||(e=Object.assign({type:"int"},e)),e.nullable)throw new i.PrimaryColumnCannotBeNullableError(t,n);e=Object.assign({primary:!0,generated:!0},e);var o={target:t.constructor,propertyName:n,mode:"regular",options:e};r.getMetadataArgsStorage().columns.add(o)}}t&&t.id;e("PrimaryGeneratedColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/error/ColumnTypeUndefinedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="ColumnTypeUndefinedError",r.message="Column type for "+t.constructor.name+"#"+n+" is not defined or cannot be guessed. Try to implicitly provide a column type to @Column decorator.",r}return __extends(t,e),t}(Error),e("ColumnTypeUndefinedError",n)}}}),System.register("typeorm/decorator/columns/PrimaryColumn",["typeorm/metadata/types/ColumnTypes","typeorm/decorator/error/ColumnTypeUndefinedError","typeorm/index","typeorm/decorator/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";function n(e,t){var n;return"string"==typeof e?n=e:t=e,function(e,s){if(!n){var u=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,s):void 0;u&&(n=r.ColumnTypes.determineTypeFromFunction(u))}if(t||(t={}),!t.type&&n&&(t=Object.assign({type:n},t)),!t.type)throw new i.ColumnTypeUndefinedError(e,s);if(t.nullable)throw new a.PrimaryColumnCannotBeNullableError(e,s);t=Object.assign({primary:!0},t);var c={target:e.constructor,propertyName:s,mode:"regular",options:t};o.getMetadataArgsStorage().columns.add(c)}}t&&t.id;e("PrimaryColumn",n);var r,i,o,a;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/UpdateDateColumn",["typeorm/metadata/types/ColumnTypes","typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign({type:r.ColumnTypes.DATETIME},e);var o={target:t.constructor,propertyName:n,mode:"updateDate",options:e};i.getMetadataArgsStorage().columns.add(o)}}t&&t.id;e("UpdateDateColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/VersionColumn",["typeorm/metadata/types/ColumnTypes","typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign({type:r.ColumnTypes.INTEGER},e);var o={target:t.constructor,propertyName:n,mode:"version",options:e};i.getMetadataArgsStorage().columns.add(o)}}t&&t.id;e("VersionColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/ObjectIdColumn",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign(e,{primary:!0,name:e.name?e.name:"_id"});var i={target:t.constructor,propertyName:n,mode:"objectId",options:e};r.getMetadataArgsStorage().columns.add(i)}}t&&t.id;e("ObjectIdColumn",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_INSERT};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("AfterInsert",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterLoad",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_LOAD};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("AfterLoad",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_REMOVE};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("AfterRemove",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_UPDATE};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("AfterUpdate",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_INSERT};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("BeforeInsert",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_REMOVE};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("BeforeRemove",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_UPDATE};r.getMetadataArgsStorage().entityListeners.add(n)}}t&&t.id;e("BeforeUpdate",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/EventSubscriber",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e};r.getMetadataArgsStorage().entitySubscribers.add(t)}}t&&t.id;e("EventSubscriber",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/options/IndexOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinTableOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/EntityOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationCount",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){var i={target:t.constructor,propertyName:n,relation:e};r.getMetadataArgsStorage().relationCounts.add(i)}}t&&t.id;e("RelationCount",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinColumn",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e=e||{};var i={target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName};r.getMetadataArgsStorage().joinColumns.add(i)}}t&&t.id;e("JoinColumn",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinTable",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e=e||{};var i={target:t.constructor,propertyName:n,name:e.name,joinColumn:e.joinColumn,inverseJoinColumn:e.inverseJoinColumn};r.getMetadataArgsStorage().joinTables.add(i)}}t&&t.id;e("JoinTable",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToMany",["typeorm/metadata/types/RelationTypes","typeorm/index"],function(e,t){"use strict";function n(e,t,n){var o;return"object"==typeof t?n=t:o=t,function(t,a){n||(n={});var s=!(!n||!0!==n.lazy);if(!s&&Reflect&&Reflect.getMetadata){var u=Reflect.getMetadata("design:type",t,a);u&&"string"==typeof u.name&&"promise"===u.name.toLowerCase()&&(s=!0)}var c={target:t.constructor,propertyName:a,relationType:r.RelationTypes.MANY_TO_MANY,isLazy:s,type:e,inverseSideProperty:o,options:n};i.getMetadataArgsStorage().relations.add(c)}}t&&t.id;e("ManyToMany",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToOne",["typeorm/metadata/types/RelationTypes","typeorm/index"],function(e,t){"use strict";function n(e,t,n){var o;return"object"==typeof t?n=t:o=t,function(t,a){n||(n={});var s=!(!n||!0!==n.lazy);if(!s&&Reflect&&Reflect.getMetadata){var u=Reflect.getMetadata("design:type",t,a);u&&"string"==typeof u.name&&"promise"===u.name.toLowerCase()&&(s=!0)}var c={target:t.constructor,propertyName:a,relationType:r.RelationTypes.MANY_TO_ONE,isLazy:s,type:e,inverseSideProperty:o,options:n};i.getMetadataArgsStorage().relations.add(c)}}t&&t.id;e("ManyToOne",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToMany",["typeorm/metadata/types/RelationTypes","typeorm/index"],function(e,t){"use strict";function n(e,t,n){return function(o,a){n||(n={});var s=!(!n||!0!==n.lazy);if(!s&&Reflect&&Reflect.getMetadata){var u=Reflect.getMetadata("design:type",o,a);u&&"string"==typeof u.name&&"promise"===u.name.toLowerCase()&&(s=!0)}var c={target:o.constructor,propertyName:a,isLazy:s,relationType:r.RelationTypes.ONE_TO_MANY,type:e,inverseSideProperty:t,options:n};i.getMetadataArgsStorage().relations.add(c)}}t&&t.id;e("OneToMany",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToOne",["typeorm/metadata/types/RelationTypes","typeorm/index"],function(e,t){"use strict";function n(e,t,n){var o;return"object"==typeof t?n=t:o=t,function(t,a){n||(n={});var s=!(!n||!0!==n.lazy);if(!s&&Reflect&&Reflect.getMetadata){var u=Reflect.getMetadata("design:type",t,a);u&&"string"==typeof u.name&&"promise"===u.name.toLowerCase()&&(s=!0)}var c={target:t.constructor,propertyName:a,isLazy:s,relationType:r.RelationTypes.ONE_TO_ONE,type:e,inverseSideProperty:o,options:n};i.getMetadataArgsStorage().relations.add(c)}}t&&t.id;e("OneToOne",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationId",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){var i={target:t.constructor,propertyName:n,relation:e};r.getMetadataArgsStorage().relationIds.add(i)}}t&&t.id;e("RelationId",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/Entity",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n){var i={target:n,name:e,type:"regular",orderBy:t&&t.orderBy?t.orderBy:void 0,engine:t&&t.engine?t.engine:void 0,skipSchemaSync:!(!t||!0!==t.skipSchemaSync)};r.getMetadataArgsStorage().tables.add(i)}}t&&t.id;e("Entity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/AbstractEntity",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e,name:void 0,type:"abstract"};r.getMetadataArgsStorage().tables.add(t)}}t&&t.id;e("AbstractEntity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClassEntityChild",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n){var i={target:n,name:e,type:"class-table-child",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSchemaSync:!(!t||!0!==t.skipSchemaSync)};r.getMetadataArgsStorage().tables.add(i)}}t&&t.id;e("ClassEntityChild",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClosureEntity",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n){var i={target:n,name:e,type:"closure",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSchemaSync:!(!t||!0!==t.skipSchemaSync)};r.getMetadataArgsStorage().tables.add(i)}}t&&t.id;e("ClosureEntity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}});System.register("typeorm/decorator/entity/EmbeddableEntity",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e,type:"embeddable",orderBy:void 0};r.getMetadataArgsStorage().tables.add(t)}}t&&t.id;e("EmbeddableEntity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/SingleEntityChild",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e,name:void 0,type:"single-table-child",orderBy:void 0};r.getMetadataArgsStorage().tables.add(t)}}t&&t.id;e("SingleEntityChild",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/TableInheritance",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={target:t,type:e};r.getMetadataArgsStorage().inheritances.add(n)}}t&&t.id;e("TableInheritance",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/Transaction",["typeorm/index"],function(e,t){"use strict";function n(e){return void 0===e&&(e="default"),function(t,n,i){var o=i.value;i.value=function(){for(var i=this,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return r.getConnection(e).entityManager.transaction(function(e){var s,u=r.getMetadataArgsStorage().transactionEntityManagers.filterByTarget(t.constructor).toArray().filter(function(e){return e.methodName===n}).map(function(e){return e.index});return u.length?(s=a.slice(),u.forEach(function(t){return s.splice(t,0,e)})):s=[e].concat(a),o.apply(i,s)})}}}t&&t.id;e("Transaction",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionEntityManager",["typeorm/index"],function(e,t){"use strict";function n(){return function(e,t,n){var i={target:e.constructor,methodName:t,index:n};r.getMetadataArgsStorage().transactionEntityManagers.add(i)}}t&&t.id;e("TransactionEntityManager",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeLevelColumn",["typeorm/index","typeorm/metadata/types/ColumnTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={type:i.ColumnTypes.INTEGER},o={target:e.constructor,propertyName:t,mode:"treeLevel",options:n};r.getMetadataArgsStorage().columns.add(o)}}t&&t.id;e("TreeLevelColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeParent",["typeorm/index","typeorm/metadata/types/RelationTypes"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={});var o=!(!e||!0!==e.lazy);if(!o&&Reflect&&Reflect.getMetadata){var a=Reflect.getMetadata("design:type",t,n);a&&"string"==typeof a.name&&"promise"===a.name.toLowerCase()&&(o=!0)}var s={isTreeParent:!0,target:t.constructor,propertyName:n,isLazy:o,relationType:i.RelationTypes.MANY_TO_ONE,type:function(){return t.constructor},options:e};r.getMetadataArgsStorage().relations.add(s)}}t&&t.id;e("TreeParent",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeChildren",["typeorm/index","typeorm/metadata/types/RelationTypes"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={});var o=!(!e||!0!==e.lazy);if(!o&&Reflect&&Reflect.getMetadata){var a=Reflect.getMetadata("design:type",t,n);a&&"string"==typeof a.name&&"promise"===a.name.toLowerCase()&&(o=!0)}var s={isTreeChildren:!0,target:t.constructor,propertyName:n,isLazy:o,relationType:i.RelationTypes.ONE_TO_MANY,type:function(){return t.constructor},options:e};r.getMetadataArgsStorage().relations.add(s)}}t&&t.id;e("TreeChildren",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/Index",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){var i="string"==typeof e?e:void 0,o="string"==typeof e?t:e,a="object"!=typeof e||Array.isArray(e)?n:e;return a||(a="object"!=typeof t||Array.isArray(t)?n:e),function(e,t){var n={target:t?e.constructor:e,name:i,columns:t?[t]:o,unique:!(!a||!a.unique)};r.getMetadataArgsStorage().indices.add(n)}}t&&t.id;e("Index",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/NamingStrategy",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n=e||t.name,i={target:t,name:n};r.getMetadataArgsStorage().namingStrategies.add(i)}}t&&t.id;e("NamingStrategy",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/Embedded",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n,i){var o=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,i):void 0,a=!!(o===Array||t&&!0===t.array),s={target:n.constructor,propertyName:i,isArray:a,prefix:t&&void 0!==t.prefix?t.prefix:void 0,type:e};r.getMetadataArgsStorage().embeddeds.add(s)}}t&&t.id;e("Embedded",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/DiscriminatorValue",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={target:t,value:e};r.getMetadataArgsStorage().discriminatorValues.add(n)}}t&&t.id;e("DiscriminatorValue",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/EntityRepository",["typeorm/index"],function(e,t){"use strict";function n(e,t){var n=e instanceof Function?e:void 0,i=e instanceof Function?t:e;return function(e){var t={target:e,entity:n,useContainer:!(!i||!i.useContainer)};r.getMetadataArgsStorage().entityRepositories.add(t)}}t&&t.id;e("EntityRepository",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),
System.register("typeorm/index",["typeorm/connection/ConnectionManager","typeorm/metadata-args/MetadataArgsStorage","typeorm/container","typeorm/platform/PlatformTools","typeorm/decorator/columns/Column","typeorm/decorator/columns/CreateDateColumn","typeorm/decorator/columns/DiscriminatorColumn","typeorm/decorator/columns/PrimaryGeneratedColumn","typeorm/decorator/columns/PrimaryColumn","typeorm/decorator/columns/UpdateDateColumn","typeorm/decorator/columns/VersionColumn","typeorm/decorator/columns/ObjectIdColumn","typeorm/decorator/listeners/AfterInsert","typeorm/decorator/listeners/AfterLoad","typeorm/decorator/listeners/AfterRemove","typeorm/decorator/listeners/AfterUpdate","typeorm/decorator/listeners/BeforeInsert","typeorm/decorator/listeners/BeforeRemove","typeorm/decorator/listeners/BeforeUpdate","typeorm/decorator/listeners/EventSubscriber","typeorm/decorator/relations/RelationCount","typeorm/decorator/relations/JoinColumn","typeorm/decorator/relations/JoinTable","typeorm/decorator/relations/ManyToMany","typeorm/decorator/relations/ManyToOne","typeorm/decorator/relations/OneToMany","typeorm/decorator/relations/OneToOne","typeorm/decorator/relations/RelationId","typeorm/decorator/entity/Entity","typeorm/decorator/entity/AbstractEntity","typeorm/decorator/entity/ClassEntityChild","typeorm/decorator/entity/ClosureEntity","typeorm/decorator/entity/EmbeddableEntity","typeorm/decorator/entity/SingleEntityChild","typeorm/decorator/entity/TableInheritance","typeorm/decorator/transaction/Transaction","typeorm/decorator/transaction/TransactionEntityManager","typeorm/decorator/tree/TreeLevelColumn","typeorm/decorator/tree/TreeParent","typeorm/decorator/tree/TreeChildren","typeorm/decorator/Index","typeorm/decorator/NamingStrategy","typeorm/decorator/Embedded","typeorm/decorator/DiscriminatorValue","typeorm/decorator/EntityRepository","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/TableSchema","typeorm/connection/Connection","typeorm/query-builder/QueryBuilder","typeorm/entity-manager/EntityManager","typeorm/entity-manager/MongoEntityManager","typeorm/naming-strategy/DefaultNamingStrategy","typeorm/repository/Repository","typeorm/repository/TreeRepository","typeorm/repository/SpecificRepository","typeorm/repository/MongoRepository"],function(e,t){"use strict";function n(){var e=y.PlatformTools.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new p.MetadataArgsStorage),e.typeormMetadataArgsStorage}function r(){return f.getFromContainer(m.ConnectionManager)}function i(e,t){return r().createAndConnect(e,t)}function o(e){return r().createAndConnectToAll(e)}function a(e){return void 0===e&&(e="default"),r().get(e)}function s(e){return void 0===e&&(e="default"),r().get(e).entityManager}function u(e,t){return void 0===t&&(t="default"),r().get(t).getRepository(e)}function c(e,t){return void 0===t&&(t="default"),r().get(t).getTreeRepository(e)}function l(e,t){return void 0===t&&(t="default"),r().get(t).getMongoRepository(e)}function d(t){var n={};for(var r in t)"default"===r||h.hasOwnProperty(r)||(n[r]=t[r]);e(n)}t&&t.id;e("getMetadataArgsStorage",n),e("getConnectionManager",r),e("createConnection",i),e("createConnections",o),e("getConnection",a),e("getEntityManager",s),e("getRepository",u),e("getTreeRepository",c),e("getMongoRepository",l);var m,p,f,y,h={getMetadataArgsStorage:!0,getConnectionManager:!0,createConnection:!0,createConnections:!0,getConnection:!0,getEntityManager:!0,getRepository:!0,getTreeRepository:!0,getMongoRepository:!0,Connection:!0,ConnectionManager:!0,QueryBuilder:!0,EntityManager:!0,MongoEntityManager:!0,DefaultNamingStrategy:!0,Repository:!0,TreeRepository:!0,SpecificRepository:!0,MongoRepository:!0};return{setters:[function(t){m=t,e({ConnectionManager:t.ConnectionManager})},function(e){p=e},function(e){f=e,d(e)},function(e){y=e},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e),d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e),d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(t){e({Connection:t.Connection})},function(t){e({QueryBuilder:t.QueryBuilder})},function(t){e({EntityManager:t.EntityManager})},function(t){e({MongoEntityManager:t.MongoEntityManager})},function(t){e({DefaultNamingStrategy:t.DefaultNamingStrategy})},function(t){e({Repository:t.Repository})},function(t){e({TreeRepository:t.TreeRepository})},function(t){e({SpecificRepository:t.SpecificRepository})},function(t){e({MongoRepository:t.MongoRepository})}],execute:function(){}}}),System.register("typeorm",["typeorm/index"],function(e,t){"use strict";function n(t){var n={};for(var r in t)"default"!==r&&(n[r]=t[r]);e(n)}t&&t.id;return{setters:[function(e){n(e)}],execute:function(){}}}),System.register("typeorm/metadata/EntitySubscriberMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target}return e}(),e("EntitySubscriberMetadata",n)}}}),System.register("typeorm/metadata/TargetMetadata",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/PropertyMetadata",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationCountMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this.propertyName=e.propertyName,this.relation=e.relation}return e}(),e("RelationCountMetadata",n)}}}),System.register("typeorm/connection/error/CannotGetEntityManagerNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotGetEntityManagerNotConnectedError",n.message='Cannot get entity manager for "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotGetEntityManagerNotConnectedError",n)}}}),System.register("typeorm/connection/error/NoConnectionForRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="NoConnectionForRepositoryError",n.message='Cannot get a Repository for "'+t+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.",n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("NoConnectionForRepositoryError",n)}}}),System.register("typeorm/driver/error/DriverPackageLoadError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="DriverPackageLoadError",t.message="Cannot load driver dependencies. Try to install all required dependencies.",t}return __extends(t,e),t}(Error),e("DriverPackageLoadError",n)}}}),System.register("typeorm/driver/error/DriverPoolingNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="DriverPoolingNotSupportedError",n.message="Connection pooling is not supported by ("+t+") driver.",n}return __extends(t,e),t}(Error),e("DriverPoolingNotSupportedError",n)}}}),System.register("typeorm/persistence/error/CascadesNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name="CascadesNotAllowedError",i.message="Cascades ("+t+") are not allowed for the given relation "+n.name+"#"+r.name,i}return __extends(t,e),t}(Error),e("CascadesNotAllowedError",n)}}}),System.register("typeorm/persistence/error/PersistedEntityNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="PersistedEntityNotFoundError",t.message="Internal error. Persisted entity was not found in the list of prepared operated entities.",t}return __extends(t,e),t}(Error),e("PersistedEntityNotFoundError",n)}}}),System.register("typeorm/metadata-builder/error/MetadataWithSuchNameAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MetadataWithSuchNameAlreadyExistsError",r.message=t+" metadata with such name "+n+" already exists. Do you apply decorator twice? Or maybe try to change a name?",r}return __extends(t,e),t}(Error),e("MetadataWithSuchNameAlreadyExistsError",n)}}});