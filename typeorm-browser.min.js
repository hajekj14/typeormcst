var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};System.register("typeorm/driver/DriverOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/ColumnTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isTypeSupported=function(e){return-1!==this.supportedTypes.indexOf(e)},Object.defineProperty(e,"supportedTypes",{get:function(){return[this.STRING,this.TEXT,this.NUMBER,this.INTEGER,this.INT,this.SMALLINT,this.BIGINT,this.FLOAT,this.DOUBLE,this.DECIMAL,this.DATE,this.TIME,this.DATETIME,this.BOOLEAN,this.JSON,this.JSONB,this.SIMPLE_ARRAY,this.UUID]},enumerable:!0,configurable:!0}),e.determineTypeFromFunction=function(t){if(t instanceof Date)return e.DATETIME;if(t instanceof Function){switch(t.name.toLowerCase()){case"number":return e.NUMBER;case"boolean":return e.BOOLEAN;case"string":return e.STRING;case"date":return e.DATETIME;case"object":return e.JSON}}else if(t instanceof Object)return e.JSON},e.typeToString=function(e){return e.name.toLowerCase()},e.isNumeric=function(t){return t===e.NUMBER||t===e.INT||t===e.INTEGER||t===e.BIGINT||t===e.SMALLINT||t===e.DOUBLE||t===e.FLOAT},e}(),n.STRING="string",n.TEXT="text",n.NUMBER="number",n.INTEGER="integer",n.INT="int",n.SMALLINT="smallint",n.BIGINT="bigint",n.FLOAT="float",n.DOUBLE="double",n.DECIMAL="decimal",n.DATE="date",n.TIME="time",n.DATETIME="datetime",n.BOOLEAN="boolean",n.JSON="json",n.JSONB="jsonb",n.SIMPLE_ARRAY="simple_array",n.UUID="uuid",e("ColumnTypes",n)}}}),System.register("typeorm/metadata/types/RelationTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/NamingStrategyInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/OnDeleteType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ForeignKeyMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.tableName=this.entityMetadata.tableName,this.referencedTableName=this.referencedEntityMetadata.tableName,this.name=e.foreignKeyName(this.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)},e}(),e("ForeignKeyMetadata",n)}}}),System.register("typeorm/common/ObjectLiteral",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EmbeddedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/QueryBuilderUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=e.split("."),n=t[0],r=t[1];if(!n||!r)return!1;var i=/^[a-zA-Z0-9_-]+$/;return!(!i.test(n)||!i.test(r))},e}(),e("QueryBuilderUtils",n)}}}),System.register("typeorm/query-builder/Alias",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){Object.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),e("Alias",n)}}}),System.register("typeorm/find-options/OrderByCondition",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/JoinAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.joinAttribute=n,Object.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){return this.metadata?this.metadata.tableName:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty)){var e=this.queryExpressionMap.findAliasByName(this.parentAlias),t=e.metadata.parentEntityMetadata?e.metadata.parentEntityMetadata:e.metadata,r=t.findRelationWithPropertyPath(this.relationPropertyPath);if(!r)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return r}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){var e=this;if(this.entityOrProperty instanceof Function)return this.connection.getMetadata(this.entityOrProperty);if(this.relation)return this.relation.inverseEntityMetadata;if("string"==typeof this.entityOrProperty){var t=this.connection.entityMetadatas.find(function(t){return t.name===e.entityOrProperty});return t||this.connection.entityMetadatas.find(function(t){return t.tableName===e.entityOrProperty})}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("JoinAttribute",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.expressionMap=e,this.relationCountAttribute=t,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_count"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split("."),t=e[0],r=e[1],i=this.expressionMap.findAliasByName(t),o=i.metadata.findRelationWithPropertyPath(r);if(!o)throw new Error("Relation with property path "+r+" in entity was not found.");return o},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("RelationCountAttribute",r)}}}),System.register("typeorm/query-builder/SelectQuery",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/QueryExpressionMap",["typeorm/query-builder/Alias","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e,this.aliases=[],this.queryType="select",this.selects=[],this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.parameters={},this.disableEscaping=!0,this.ignoreParentTablesJoins=!1,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition=""}return e.prototype.createMainAlias=function(e){var t=this.createAlias(e);return this.mainAlias&&this.aliases.splice(this.aliases.indexOf(this.mainAlias)),this.mainAlias=t,t},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tableName&&(t=e.tableName),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var r=new n.Alias;return t&&(r.name=t),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tableName&&(r.tableName=e.tableName),this.aliases.push(r),r},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw new Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.clone=function(){var t=this,a=new e(this.connection);return a.queryType=this.queryType,a.selects=this.selects.map(function(e){return e}),this.aliases.forEach(function(e){return a.aliases.push(new n.Alias(e))}),a.mainAlias=this.mainAlias,a.updateSet=this.updateSet,a.joinAttributes=this.joinAttributes.map(function(e){return new r.JoinAttribute(t.connection,t,e)}),a.relationIdAttributes=this.relationIdAttributes.map(function(e){return new i.RelationIdAttribute(t,e)}),a.relationCountAttributes=this.relationCountAttributes.map(function(e){return new o.RelationCountAttribute(t,e)}),a.wheres=this.wheres.map(function(e){return __assign({},e)}),a.havings=this.havings.map(function(e){return __assign({},e)}),a.orderBys=Object.assign({},this.orderBys),a.groupBys=this.groupBys.map(function(e){return e}),a.limit=this.limit,a.offset=this.offset,a.skip=this.skip,a.take=this.take,a.lockMode=this.lockMode,a.lockVersion=this.lockVersion,a.parameters=Object.assign({},this.parameters),a.disableEscaping=this.disableEscaping,a.ignoreParentTablesJoins=this.ignoreParentTablesJoins,a.enableRelationIdValues=this.enableRelationIdValues,a},e}(),e("QueryExpressionMap",a)}}}),System.register("typeorm/query-builder/relation-id/RelationIdAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias),t=e.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!t)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_id"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}(),e("RelationIdAttribute",r)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/util/OrmUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t.length)return e;var r=t.shift();if(this.isObject(e)&&this.isObject(r))for(var i in r)this.isObject(r[i])?(e[i]||Object.assign(e,(o={},o[i]={},o)),this.mergeDeep(e[i],r[i])):Object.assign(e,(a={},a[i]=r[i],a));return this.mergeDeep.apply(this,[e].concat(t));var o,a},e.deepCompare=function(){function e(t,n){var r;if(isNaN(t)&&isNaN(n)&&"number"==typeof t&&"number"==typeof n)return!0;if(t===n)return!0;if(t.equals instanceof Function&&t.equals(n))return!0;if("function"==typeof t&&"function"==typeof n||t instanceof Date&&n instanceof Date||t instanceof RegExp&&n instanceof RegExp||t instanceof String&&n instanceof String||t instanceof Number&&n instanceof Number)return t.toString()===n.toString();if(!(t instanceof Object&&n instanceof Object))return!1;if(t.isPrototypeOf(n)||n.isPrototypeOf(t))return!1;if(t.constructor!==n.constructor)return!1;if(t.prototype!==n.prototype)return!1;if(o.indexOf(t)>-1||a.indexOf(n)>-1)return!1;for(r in n){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof n[r]!=typeof t[r])return!1}for(r in t){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof n[r]!=typeof t[r])return!1;switch(typeof t[r]){case"object":case"function":if(o.push(t),a.push(n),!e(t[r],n[r]))return!1;o.pop(),a.pop();break;default:if(t[r]!==n[r])return!1}}return!0}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,i,o,a;if(arguments.length<1)return!0;for(r=1,i=arguments.length;r<i;r++)if(o=[],a=[],!e(arguments[0],arguments[r]))return!1;return!0},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},e}(),e("OrmUtils",n)}}}),System.register("typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer",["typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n,r){this.driver=e,this.joinAttributes=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r}return e.prototype.transform=function(e,t){var n=this;return this.group(e,t).map(function(e){return n.transformRawResultsGroup(e,t)}).filter(function(e){return!!e})},e.prototype.group=function(e,t){var n=[];return e.forEach(function(e){var r=t.metadata.primaryColumns.map(function(n){return e[t.name+"_"+n.databaseName]}).join("_");if(r){var i=n.find(function(e){return e.id===r});i||(i={id:r,items:[]},n.push(i)),i.items.push(e)}}),n.map(function(e){return e.items})},e.prototype.transformRawResultsGroup=function(e,t){var n=!1,r=!1,i=!1,o=!1,a=t.metadata.create();if(t.metadata.discriminatorColumn){var s=e.map(function(e){return e[t.name+"_"+t.metadata.discriminatorColumn.databaseName]}),u=t.metadata.childEntityMetadatas.find(function(e){return!!s.find(function(t){return t===e.discriminatorValue})});u&&(a=u.create())}return n=this.transformColumns(e,t,a,t.metadata),r=this.transformJoins(e,a,t),i=this.transformRelationIds(e,t,a),o=this.transformRelationCounts(e,t,a),n||r||i||o?a:void 0},e.prototype.transformColumns=function(e,t,n,r){var i=this,o=!1;return r.columns.forEach(function(r){var a=e[0][t.name+"_"+r.databaseName];void 0===a||null===a||r.isVirtual||r.isParentId||r.isDiscriminator||(r.setEntityValue(n,i.driver.prepareHydratedValue(a,r)),o=!0)}),t.metadata.parentEntityMetadata&&t.metadata.parentEntityMetadata.columns.forEach(function(r){var a=e[0]["parentIdColumn_"+t.metadata.parentEntityMetadata.tableName+"_"+r.databaseName];void 0===a||null===a||r.isVirtual||r.isParentId||r.isDiscriminator||(r.setEntityValue(n,i.driver.prepareHydratedValue(a,r)),o=!0)}),o},e.prototype.transformJoins=function(e,t,n){var r=this,i=!1,o="";return n.metadata.discriminatorColumn&&(o=e[0][n.name+"_"+n.metadata.discriminatorColumn.databaseName]),this.joinAttributes.forEach(function(a){if(a.metadata){var s=n.metadata.childEntityMetadatas.find(function(e){return o===e.discriminatorValue});if(!s||!a.relation||s.target===a.relation.target){if(a.mapToProperty){if(a.mapToPropertyParentAlias!==n.name)return}else if(!a.relation||a.parentAlias!==n.name||a.relationPropertyPath!==a.relation.propertyPath)return;var u=r.transform(e,a.alias),c=a.isMany?u:u[0];c&&(a.mapToPropertyPropertyName?t[a.mapToPropertyPropertyName]=c:a.relation.setEntityValue(t,c),i=!0)}}}),i},e.prototype.transformRelationIds=function(e,t,r){var i=this,o=!1;return this.rawRelationIdResults.forEach(function(a){if(a.relationIdAttribute.parentAlias===t.name){var s=a.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,a.relationIdAttribute.parentAlias,e);if(void 0!==u&&null!==u){var c=a.results.map(function(e){var r=i.extractEntityPrimaryIds(s,e);if(t.metadata.compareIds(r,u)){var o;o=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map(function(e){return e}):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map(function(e){return e}):s.isOwning?s.inverseJoinColumns.map(function(e){return e}):s.inverseRelation.joinColumns.map(function(e){return e});var c=o.reduce(function(t,r){return s.isOneToMany||s.isOneToOneNotOwner?n.OrmUtils.mergeDeep(t,r.createValueMap(e[r.databaseName])):n.OrmUtils.mergeDeep(t,r.referencedColumn.createValueMap(e[r.databaseName]))},{});return 1===o.length&&!1===a.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?o[0].getEntityValue(c):o[0].referencedColumn.getEntityValue(c):c}}).filter(function(e){return e}),l=a.relationIdAttribute.mapToPropertyPropertyPath.split("."),d=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void d(e,t[r],n):t};s.isOneToOne||s.isManyToOne?d(l,r,c[0]):d(l,r,c),o=!0}}}),o},e.prototype.transformRelationCounts=function(e,t,n){var r=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(i){var o,a=i.relationCountAttribute.relation;o=a.isOneToMany?a.inverseRelation.joinColumns[0].referencedColumn.databaseName:a.isOwning?a.joinColumns[0].referencedColumn.databaseName:a.inverseRelation.joinColumns[0].referencedColumn.databaseName;var s=e[0][t.name+"_"+o];void 0!==s&&null!==s&&(n[i.relationCountAttribute.mapToPropertyPropertyName]=0,i.results.filter(function(e){return e.parentId===s}).forEach(function(e){n[i.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),r=!0}))}),r},e.prototype.createValueMapFromJoinColumns=function(e,t,n){var r;return r=e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e}),r.reduce(function(r,i){return n.forEach(function(n){e.isManyToOne||e.isOneToOneOwner?r[i.databaseName]=n[t+"_"+i.databaseName]:r[i.databaseName]=n[t+"_"+i.referencedColumn.databaseName]}),r},{})},e.prototype.extractEntityPrimaryIds=function(e,t){var n;return n=e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e}),n.reduce(function(e,n){return e[n.databaseName]=t[n.databaseName],e},{})},e}(),e("RawSqlResultsToEntityTransformer",r)}}}),System.register("typeorm/driver/error/ConnectionIsNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="ConnectionIsNotSetError",n.message="Connection with "+t+" database is not established. Check connection configuration.",n}return __extends(t,e),t}(Error),e("ConnectionIsNotSetError",n)}}}),System.register("typeorm/driver/DatabaseConnection",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/error/DriverPackageNotInstalledError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="DriverPackageNotInstalledError",r.message=t+" package has not been found installed. Try to install it: npm install "+n+" --save",r}return __extends(t,e),t}(Error),e("DriverPackageNotInstalledError",n)}}}),System.register("typeorm/driver/DriverUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url);if(t&&t.useSid){var r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,sid:n.database};return Object.assign(r,e)}var r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return Object.assign(r,e)}return Object.assign({},e)},e.parseConnectionUrl=function(e){var t=e.indexOf("//"),n=e.substr(t+2),r=n.indexOf("/"),i=-1!==r?n.substr(0,r):n,o=-1!==r?n.substr(r+1):void 0,a=i.split("@"),s=a[0],u=a[1],c=s.split(":"),l=c[0],d=c[1],p=u.split(":"),m=p[0],f=p[1];return{host:m,username:l,password:d,port:f?parseInt(f):void 0,database:o||void 0}},e}(),e("DriverUtils",n)}}}),System.register("typeorm/logger/LoggerOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/platform/PlatformTools",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getGlobalVariable=function(){return window},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormilize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.getEnvVariable=function(e){},e}(),n.type="browser",e("PlatformTools",n)}}}),System.register("typeorm/logger/Logger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t){(this.options.logQueries||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("log","executing query: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""))},e.prototype.logFailedQuery=function(e,t){(this.options.logQueries||this.options.logOnlyFailedQueries||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("error","query failed: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""))},e.prototype.logQueryError=function(e){(this.options.logFailedQueryError||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("error","error during executing query:"+e)},e.prototype.logSchemaBuild=function(e){(this.options.logSchemaCreation||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("info",e)},e.prototype.log=function(e,t){if(this.options)if(this.options.logger)this.options.logger(e,t);else switch(e){case"log":console.log(t);break;case"info":console.info(t);break;case"warn":console.warn(t);break;case"error":console.error(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e("Logger",r)}}}),System.register("typeorm/driver/error/TransactionAlreadyStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionAlreadyStartedError",t.message="Transaction already started for the given connection, commit current transaction before starting a new one.",t}return __extends(t,e),t}(Error),e("TransactionAlreadyStartedError",n)}}}),System.register("typeorm/driver/error/TransactionNotStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionNotStartedError",t.message="Transaction is not started yet, start transaction before committing or rolling it back.",t}return __extends(t,e),t}(Error),e("TransactionNotStartedError",n)}}}),System.register("typeorm/driver/error/DataTypeNotSupportedByDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="DataTypeNotSupportedByDriverError",r.message="Specified type ("+t+") is not supported by "+n+" driver.",r}return __extends(t,e),t}(Error),e("DataTypeNotSupportedByDriverError",n)}}}),System.register("typeorm/metadata-args/IndexMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/IndexMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isUnique=!1,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.isUnique=e.args.unique,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.tableName=this.entityMetadata.tableName,this.givenColumnNames){var r=[];if(this.givenColumnNames instanceof Array)r=this.givenColumnNames,r.forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);i instanceof Array?(r=i.map(function(e){return String(e)}),r.forEach(function(e){return n[e]=1})):(r=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}var o=this.entityMetadata.columns.filter(function(e){return-1!==r.indexOf(e.propertyPath)});this.entityMetadata.relations.filter(function(e){return e.isWithJoinColumn&&-1!==r.indexOf(e.propertyName)}).forEach(function(e){return o.push.apply(o,e.joinColumns)});var a=r.filter(function(e){
return!t.entityMetadata.columns.find(function(t){return t.propertyPath===e})&&!t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyPath===e})});if(a.length>0)throw new Error("Index "+(this.givenName?'"'+this.givenName+'" ':"")+"contains columns that are missing in the entity: "+a.join(", "));this.columns=o}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databaseName]=n[r]),e},{}),this.name=e.indexName(this.givenName?this.givenName:void 0,this.entityMetadata.tableName,this.columns.map(function(e){return e.databaseName})),this},e}(),e("IndexMetadata",n)}}}),System.register("typeorm/schema-builder/schema/IndexSchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.tableName=e,this.name=t,this.columnNames=n,this.isUnique=r}return e.prototype.clone=function(){return new e(this.tableName,this.name,this.columnNames.map(function(e){return e}),this.isUnique)},e.create=function(t){return new e(t.entityMetadata.tableName,t.name,t.columns.map(function(e){return e.databaseName}),t.isUnique)},e}(),e("IndexSchema",n)}}}),System.register("typeorm/schema-builder/schema/ForeignKeySchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r,i){this.name=e,this.columnNames=t,this.referencedColumnNames=n,this.referencedTableName=r,this.onDelete=i}return e.prototype.clone=function(){return new e(this.name,this.columnNames,this.referencedColumnNames,this.referencedTableName)},e.create=function(t){return new e(t.name,t.columnNames,t.referencedColumnNames,t.referencedTableName,t.onDelete)},e}(),e("ForeignKeySchema",n)}}}),System.register("typeorm/schema-builder/schema/PrimaryKeySchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.name=e,this.columnName=t}return e.prototype.clone=function(){return new e(this.name,this.columnName)},e}(),e("PrimaryKeySchema",n)}}}),System.register("typeorm/schema-builder/schema/TableSchema",["typeorm/schema-builder/schema/ColumnSchema"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,r){this.columns=[],this.indices=[],this.foreignKeys=[],this.primaryKeys=[],this.justCreated=!1,this.name=e,t&&(this.columns=t.map(function(e){return e instanceof n.ColumnSchema?e:new n.ColumnSchema(e)})),void 0!==r&&(this.justCreated=r)}return Object.defineProperty(e.prototype,"primaryKeysWithoutGenerated",{get:function(){var e=this.columns.find(function(e){return e.isGenerated});return e?this.primaryKeys.filter(function(t){return t.columnName!==e.name}):this.primaryKeys},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeneratedColumn",{get:function(){return!!this.columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.name);return t.columns=this.columns.map(function(e){return e.clone()}),t.indices=this.indices.map(function(e){return e.clone()}),t.foreignKeys=this.foreignKeys.map(function(e){return e.clone()}),t.primaryKeys=this.primaryKeys.map(function(e){return e.clone()}),t},e.prototype.addColumns=function(e){this.columns=this.columns.concat(e)},e.prototype.replaceColumn=function(e,t){this.columns[this.columns.indexOf(e)]=t},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.removeColumns=function(e){var t=this;e.forEach(function(e){return t.removeColumn(e)})},e.prototype.addPrimaryKeys=function(e){var t=this;e.forEach(function(e){return t.primaryKeys.push(e)})},e.prototype.removePrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.splice(t.primaryKeys.indexOf(e),1)})},e.prototype.removePrimaryKeysOfColumns=function(e){this.primaryKeys=this.primaryKeys.filter(function(t){return!e.find(function(e){return e.name===t.columnName})})},e.prototype.addForeignKeys=function(e){this.foreignKeys=this.foreignKeys.concat(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.removeForeignKeys=function(e){var t=this;e.forEach(function(e){return t.removeForeignKey(e)})},e.prototype.removeIndex=function(e){var t=this.indices.find(function(t){return t.name===e.name});t&&this.indices.splice(this.indices.indexOf(t),1)},e.prototype.findChangedColumns=function(e,t){return this.columns.filter(function(n){var r=t.find(function(e){return e.databaseName===n.name});return!!r&&(n.name!==r.databaseName||n.type!==e.normalizeType(r)||n.comment!==r.comment||!n.isGenerated&&!e.compareDefaultValues(r.default,n.default)||n.isNullable!==r.isNullable||n.isUnique!==r.isUnique||n.isGenerated!==r.isGenerated)})},e.create=function(t,r){var i=new e(t.tableName);return t.columns.forEach(function(e){i.columns.push(n.ColumnSchema.create(e,r.normalizeType(e)))}),i},e}(),e("TableSchema",r)}}}),System.register("typeorm/query-runner/error/QueryRunnerAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerAlreadyReleasedError",t.message="Query runner already released. Cannot run queries anymore.",t}return __extends(t,e),t}(Error),e("QueryRunnerAlreadyReleasedError",n)}}}),System.register("typeorm/driver/sqlserver/SqlServerQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,7,9,11]),e="SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE'",[4,this.query(e)];case 3:return t=o.sent(),n=t.map(function(e){return e.TABLE_NAME}),[4,Promise.all(n.map(function(e){return __awaiter(i,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return t="SELECT 'ALTER TABLE ' +  OBJECT_SCHEMA_NAME(parent_object_id) + '.[' + OBJECT_NAME(parent_object_id) + '] DROP CONSTRAINT ' + name as query FROM sys.foreign_keys WHERE referenced_object_id = object_id('"+e+"')",[4,this.query(t)];case 1:return n=i.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return r.query(e)}))]}})})}))];case 4:return o.sent(),[4,Promise.all(n.map(function(e){var t='DROP TABLE "'+e+'"';return i.query(t)}))];case 5:return o.sent(),[4,this.commitTransaction()];case 6:return o.sent(),[3,11];case 7:return r=o.sent(),[4,this.rollbackTransaction()];case 8:throw o.sent(),r;case 9:return[4,this.release()];case 10:return o.sent(),[7];case 11:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return[2,new Promise(function(t,n){e.databaseConnection.isTransactionActive=!0,e.databaseConnection.transaction=e.databaseConnection.connection.transaction(),e.databaseConnection.transaction.begin(function(r){if(r)return e.databaseConnection.isTransactionActive=!1,n(r);t()})})]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.transaction.commit(function(r){if(r)return n(r);e.databaseConnection.isTransactionActive=!1,t()})})]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.transaction.rollback(function(r){if(r)return n(r);e.databaseConnection.isTransactionActive=!1,t()})})]})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t);var o=new n.driver.mssql.Request(n.isTransactionActive()?n.databaseConnection.transaction:n.databaseConnection.connection);t&&t.length&&t.forEach(function(e,n){o.input(n,t[n])}),o.query(e,function(o,a){if(o)return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o);r(a)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(d){switch(d.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"@"+t}).join(","),a=r.map(function(e){return t[e]}),s=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") "+(n?"OUTPUT INSERTED."+n.databaseName+" ":"")+"VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" "+(n?"OUTPUT INSERTED."+n.databaseName+" ":"")+"DEFAULT VALUES ",[4,this.query(s,a)];case 1:return u=d.sent(),[2,n?u instanceof Array?u[0][n.databaseName]:u[n.databaseName]:void 0]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(n).map(function(e){return n[e]}),i=Object.keys(t).map(function(e){return t[e]}),o=i.concat(r),a=this.parametrize(t).join(", "),s=this.parametrize(n,i.length).join(" AND "),u="UPDATE "+this.driver.escapeTableName(e)+" SET "+a+" "+(s?" WHERE "+s:""),[4,this.query(u,o)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,p,m,f,y,h,g,v,b=this;return __generator(this,function(E){switch(E.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME IN ("+t+")",r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_CATALOG = '"+this.dbName+"'",i="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages LEFT JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME WHERE columnUsages.TABLE_CATALOG = '"+this.dbName+"' AND tableConstraints.TABLE_CATALOG = '"+this.dbName+"'",d="SELECT COLUMN_NAME, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_CATALOG = '"+this.dbName+"' AND COLUMNPROPERTY(object_id(TABLE_NAME), COLUMN_NAME, 'IsIdentity') = 1;",p="SELECT TABLE_NAME = t.name, INDEX_NAME = ind.name, IndexId = ind.index_id, ColumnId = ic.index_column_id, COLUMN_NAME = col.name, ind.*, ic.*, col.* FROM sys.indexes ind INNER JOIN sys.index_columns ic ON ind.object_id = ic.object_id and ind.index_id = ic.index_id INNER JOIN sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id INNER JOIN sys.tables t ON ind.object_id = t.object_id WHERE ind.is_primary_key = 0 AND ind.is_unique = 0 AND ind.is_unique_constraint = 0 AND t.is_ms_shipped = 0 ORDER BY t.name, ind.name, ind.index_id, ic.index_column_id",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(d),this.query(p)])]):[2,[]];case 1:return m=E.sent(),f=m[0],y=m[1],h=m[2],g=m[3],v=m[4],f.length?[2,Promise.all(f.map(function(e){return __awaiter(b,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new a.TableSchema(e.TABLE_NAME),t.columns=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!h.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&"PRIMARY KEY"===n.CONSTRAINT_TYPE}),r=!!g.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),i=!!h.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&"UNIQUE"===n.CONSTRAINT_TYPE}),a=new o.ColumnSchema;return a.name=e.COLUMN_NAME,a.type=e.DATA_TYPE.toLowerCase()+(e.CHARACTER_MAXIMUM_LENGTH?"("+e.CHARACTER_MAXIMUM_LENGTH+")":""),a.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,a.isNullable="YES"===e.IS_NULLABLE,a.isPrimary=n,a.isGenerated=r,a.isUnique=i,a.comment="",a}),t.primaryKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&"PRIMARY KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new u.PrimaryKeySchema(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&"FOREIGN KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new s.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=v.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=v.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}).map(function(e){return e.COLUMN_NAME});return new c.IndexSchema(e.TABLE_NAME,n,r,!1)}),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){return', CONSTRAINT "uk_'+e.name+"_"+t.name+'" UNIQUE ("'+t.name+'")'}).join(" "),r=e.columns.filter(function(e){return e.isPrimary}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return n.isGenerated===i.isGenerated?[3,6]:[4,this.query('ALTER TABLE "'+r.name+'" DROP COLUMN "'+n.name+'"')];case 4:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ADD '+this.buildCreateColumnSql(n))];case 5:u.sent(),u.label=6;case 6:return s='ALTER TABLE "'+r.name+'" ALTER COLUMN '+this.buildCreateColumnSql(n,!0),[4,this.query(s)];case 7:return u.sent(),n.isUnique===i.isUnique?[3,11]:!0!==n.isUnique?[3,9]:[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "uk_'+n.name+'" UNIQUE ("'+n.name+'")')];case 8:return u.sent(),[3,11];case 9:return!1!==n.isUnique?[3,11]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "uk_'+n.name+'"')];case 10:u.sent(),u.label=11;case 11:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query('ALTER TABLE "'+n+'" DROP COLUMN "'+r+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages\nLEFT JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME AND tableConstraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\nWHERE columnUsages.TABLE_CATALOG = '"+this.dbName+"' AND tableConstraints.TABLE_CATALOG = '"+this.dbName+"'",[4,this.query(t)];case 1:return n=i.sent(),n.length>0?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n[0].CONSTRAINT_NAME+'"')]:[3,3];case 2:i.sent(),i.label=3;case 3:return r=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),r.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+r.join(", ")+")")]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(s){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),o='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.query(o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n='DROP INDEX "'+e+'"."'+t+'"',[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"nchar("+(e.length?e.length:255)+")":"nvarchar("+(e.length?e.length:255)+")";case"text":return"ntext";case"boolean":return"bit";case"integer":case"int":return"int";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"float";case"double":case"number":return"real";case"decimal":return"decimal";case"date":return"date";case"time":return"time";case"datetime":return"datetime";case"json":return"text";case"simple_array":return e.length?"nvarchar("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"SQLServer")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=@"+(t+r)})},e.prototype.buildCreateColumnSql=function(e,t){void 0===t&&(t=!1);var n='"'+e.name+'" '+e.type;return!0!==e.isNullable&&(n+=" NOT NULL"),!0!==e.isGenerated||t||(n+=" IDENTITY(1,1)"),e.comment&&(n+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?n+=" DEFAULT "+e.default:"boolean"==typeof e.default?n+=" DEFAULT "+(!0===e.default?"1":"0"):"function"==typeof e.default?n+=" DEFAULT "+e.default():"string"==typeof e.default?n+=" DEFAULT '"+e.default+"'":n+=" DEFAULT "+e.default),n},e}(),e("SqlServerQueryRunner",d)}}}),System.register("typeorm/driver/error/DriverOptionNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="DriverOptionNotSetError",n.message="Driver option ("+t+") is not set. Please set it to perform connection to the database.",n}return __extends(t,e),t}(Error),e("DriverOptionNotSetError",n)}}}),System.register("typeorm/util/DataTransformationUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.normalizeHydratedDate=function(e,t){if(!e)return e;var n="string"==typeof e?new Date(e):e;if(!t){var r=new Date;return r.setUTCFullYear(n.getFullYear(),n.getMonth(),n.getDate()),r.setUTCHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),r}return n},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToTimeString=function(e){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds()):e},e.mixedTimeToString=function(e){return e=e instanceof Date?e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e,"string"==typeof e?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds()):e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.split(","):e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e}(),e("DataTransformationUtils",n)}}}),System.register("typeorm/lazy-loading/LazyRelationsWrapper",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.wrap=function(e,t){var n=this,r="__"+t.propertyName+"__",i="__promise_"+t.propertyName+"__",o="__has_"+t.propertyName+"__";Object.defineProperty(e,t.propertyName,{get:function(){var e=this;return!0===this[o]?Promise.resolve(this[r]):this[i]?this[i]:(this[i]=n.loadRelationResults(t,this).then(function(t){return e[r]=t,e[o]=!0,delete e[i],e[r]}),this[i])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[r]=e,t[o]=!0}):(this[r]=e,this[o]=!0)},configurable:!0})},e.prototype.loadRelationResults=function(e,t){return e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t):e.isManyToManyOwner?this.loadManyToManyOwner(e,t):this.loadManyToManyNotOwner(e,t)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t){var r=e.isOwning?e.joinColumns:e.inverseRelation.joinColumns,i=r.map(function(t){return e.entityMetadata.name+"."+e.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName}).join(" AND "),o=new n.QueryBuilder(this.connection).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,e.entityMetadata.name,i);return r.forEach(function(n){o.andWhere(e.entityMetadata.name+"."+n.referencedColumn.databaseName+" = :"+n.referencedColumn.databaseName).setParameter(""+n.referencedColumn.databaseName,n.referencedColumn.getEntityValue(t))}),o.getOne()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t){var r=new n.QueryBuilder(this.connection).select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName);return e.inverseRelation.joinColumns.forEach(function(n){r.andWhere(e.propertyName+"."+n.propertyName+" = :"+n.referencedColumn.propertyName).setParameter(""+n.referencedColumn.propertyName,n.referencedColumn.getEntityValue(t))}),e.isOneToMany?r.getMany():r.getOne()},e.prototype.loadManyToManyOwner=function(e,t){var r=e.propertyName,i=e.junctionEntityMetadata.tableName,o=e.joinColumns.map(function(e){return i+"."+e.propertyName+" = :"+e.propertyName}),a=e.inverseJoinColumns.map(function(e){return i+"."+e.propertyName+"="+r+"."+e.referencedColumn.propertyName}),s=e.joinColumns.reduce(function(e,n){return e[n.propertyName]=n.referencedColumn.getEntityValue(t),e},{});return new n.QueryBuilder(this.connection).select(r).from(e.type,r).innerJoin(i,i,o.concat(a).join(" AND ")).setParameters(s).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t){
var r=e.propertyName,i=e.junctionEntityMetadata.tableName,o=e.inverseRelation.joinColumns.map(function(e){return i+"."+e.propertyName+" = "+r+"."+e.referencedColumn.propertyName}),a=e.inverseRelation.inverseJoinColumns.map(function(e){return i+"."+e.propertyName+" = :"+e.propertyName}),s=e.inverseRelation.inverseJoinColumns.reduce(function(e,n){return e[n.propertyName]=n.referencedColumn.getEntityValue(t),e},{});return new n.QueryBuilder(this.connection).select(r).from(e.type,r).innerJoin(i,i,o.concat(a).join(" AND ")).setParameters(s).getMany()},e}(),e("LazyRelationsWrapper",r)}}}),System.register("typeorm/driver/sqlserver/SqlServerDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/sqlserver/SqlServerQueryRunner","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e),this.logger=t,this.mssql=n,!this.options.host)throw new s.DriverOptionNotSetError("host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.database)throw new s.DriverOptionNotSetError("database");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{server:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return t.options?t.options.useUTC||(t.options.useUTC=!1):t.options={useUTC:!1},new Promise(function(n,r){var i=new e.mssql.Connection(t).connect(function(t){if(t)return r(t);e.connection=i,!1===e.options.usePool&&(e.databaseConnection={id:1,connection:new e.mssql.Request(i),isTransactionActive:!1}),n()})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.connection)throw new n.ConnectionIsNotSetError("mssql");return this.connection.close(),this.connection=void 0,this.databaseConnection=void 0,this.databaseConnectionPool=[],[2]})})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.connection?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("mssql"))];case 1:return e=t.sent(),[2,new o.SqlServerQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.mssql,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.connection}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"@"+(n.length-1)}).join(", "):(n.push(r),"@"+(n.length-1))}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case a.ColumnTypes.BOOLEAN:return!0===e?1:0;case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case a.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case a.ColumnTypes.JSON:return JSON.stringify(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case a.ColumnTypes.BOOLEAN:return!!e;case a.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case a.ColumnTypes.JSON:return JSON.parse(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(!this.connection)throw new n.ConnectionIsNotSetError("mssql");return new Promise(function(t,n){if(e.databaseConnection)return t(e.databaseConnection);var r={id:e.databaseConnectionPool.length,connection:e.connection,isTransactionActive:!1};r.releaseCallback=function(){return e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(r),1),Promise.resolve()},e.databaseConnectionPool.push(r),t(r)})},e.prototype.loadDependencies=function(){try{this.mssql=c.PlatformTools.load("mssql")}catch(e){throw new r.DriverPackageNotInstalledError("SQL Server","mssql")}},e}(),e("SqlServerDriver",l)}}}),System.register("typeorm/query-runner/QueryRunnerProvider",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){void 0===t&&(t=!1),this.driver=e,this.useSingleQueryRunner=t}return Object.defineProperty(e.prototype,"isReleased",{get:function(){return this._isReleased},enumerable:!0,configurable:!0}),e.prototype.provide=function(){var e=this;return this.useSingleQueryRunner?this.reusableQueryRunner?Promise.resolve(this.reusableQueryRunner):(this.reusableQueryRunnerPromise||(this.reusableQueryRunnerPromise=this.driver.createQueryRunner().then(function(t){return e.reusableQueryRunner=t,t})),this.reusableQueryRunnerPromise):this.driver.createQueryRunner()},e.prototype.release=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return e===this.reusableQueryRunner?[2]:[2,e.release()]})})},e.prototype.releaseReused=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._isReleased=!0,this.reusableQueryRunner?[2,this.reusableQueryRunner.release()]:[2]})})},e}(),e("QueryRunnerProvider",n)}}}),System.register("typeorm/query-builder/error/PessimisticLockTransactionRequiredError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return __extends(t,e),t}(Error),e("PessimisticLockTransactionRequiredError",n)}}}),System.register("typeorm/query-builder/error/NoVersionOrUpdateDateColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return __extends(t,e),t}(Error),e("NoVersionOrUpdateDateColumnError",n)}}}),System.register("typeorm/query-builder/error/OptimisticLockVersionMismatchError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n,r,i){var o=e.call(this)||this;return o.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(o,t.prototype),o.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",o}return __extends(t,e),t}(Error),e("OptimisticLockVersionMismatchError",n)}}}),System.register("typeorm/query-builder/error/OptimisticLockCanNotBeUsedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return __extends(t,e),t}(Error),e("OptimisticLockCanNotBeUsedError",n)}}}),System.register("typeorm/driver/postgres/PostgresQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1,this.schemaName=t.schemaName||"public"}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,6,8,10]),e="SELECT 'DROP TABLE IF EXISTS \"' || tablename || '\" CASCADE;' as query FROM pg_tables WHERE schemaname = '"+this.schemaName+"'",[4,this.query(e)];case 3:return t=i.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 4:return i.sent(),[4,this.commitTransaction()];case 5:return i.sent(),[3,10];case 6:return n=i.sent(),[4,this.rollbackTransaction()];case 7:throw i.sent(),n;case 8:return[4,this.release()];case 9:return i.sent(),[7];case 10:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.query(e,t,function(o,a){o?(n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o)):r(a.rows)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(d){switch(d.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+") "+(n?" RETURNING "+this.driver.escapeColumnName(n.databaseName):""):"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES "+(n?" RETURNING "+this.driver.escapeColumnName(n.databaseName):""),s=r.map(function(e){return t[e]}),[4,this.query(a,s)];case 1:return u=d.sent(),n?[2,u[0][n.databaseName]]:[2,u]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,p,m,f,y,h,g,v,b,E;return __generator(this,function(_){switch(_.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM information_schema.tables WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name IN ("+t+")",r="SELECT * FROM information_schema.columns WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"'",i="SELECT t.relname AS table_name, i.relname AS index_name, a.attname AS column_name  FROM pg_class t, pg_class i, pg_index ix, pg_attribute a, pg_namespace ns\nWHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid\nAND a.attnum = ANY(ix.indkey) AND t.relkind = 'r' AND t.relname IN ("+t+") AND t.relnamespace = ns.OID AND ns.nspname ='"+this.schemaName+"' ORDER BY t.relname, i.relname",d="SELECT table_name, constraint_name FROM information_schema.table_constraints WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND constraint_type = 'FOREIGN KEY'",p="SELECT * FROM information_schema.table_constraints WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND constraint_type = 'UNIQUE'",m="SELECT c.column_name, tc.table_name, tc.constraint_name FROM information_schema.table_constraints tc\nJOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_name)\nJOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name\nwhere constraint_type = 'PRIMARY KEY' AND c.table_schema = '"+this.schemaName+"' and tc.table_catalog = '"+this.dbName+"'",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(d),this.query(p),this.query(m)])]):[2,[]];case 1:return f=_.sent(),y=f[0],h=f[1],g=f[2],v=f[3],b=f[4],E=f[5],y.length?[2,y.map(function(e){var t=new a.TableSchema(e.table_name);return t.columns=h.filter(function(e){return e.table_name===t.name}).map(function(e){var t=e.data_type.toLowerCase()+(void 0!==e.character_maximum_length&&null!==e.character_maximum_length?"("+e.character_maximum_length+")":""),n=e.column_default==="nextval('"+e.table_name+"_id_seq'::regclass)"||e.column_default==="nextval('\""+e.table_name+"_id_seq\"'::regclass)"||/^uuid\_generate\_v\d\(\)/.test(e.column_default),r=new o.ColumnSchema;return r.name=e.column_name,r.type=t,r.default=null!==e.column_default&&void 0!==e.column_default?e.column_default:void 0,r.isNullable="YES"===e.is_nullable,r.isGenerated=n,r.comment="",r.isUnique=!!b.find(function(t){return t.constraint_name==="uk_"+e.table_name+"_"+e.column_name}),r}),t.primaryKeys=E.filter(function(e){return e.table_name===t.name}).map(function(e){return new c.PrimaryKeySchema(e.constraint_name,e.column_name)}),t.foreignKeys=v.filter(function(e){return e.table_name===t.name}).map(function(e){return new u.ForeignKeySchema(e.constraint_name,[],[],"","")}),t.indices=g.filter(function(e){return e.table_name===t.name&&!t.foreignKeys.find(function(t){return t.name===e.index_name})&&!t.primaryKeys.find(function(t){return t.name===e.index_name})&&!b.find(function(t){return t.constraint_name===e.index_name})}).map(function(e){return e.index_name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=g.filter(function(e){return e.table_name===t.name&&e.index_name===n}).map(function(e){return e.column_name});return new s.IndexSchema(e.TABLE_NAME,n,r,!1)}),t})]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM information_schema.tables WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),[4,this.query('CREATE SCHEMA IF NOT EXISTS "'+this.schemaName+'"')];case 1:return o.sent(),n='CREATE TABLE "'+e.name+'" ('+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){return', CONSTRAINT "uk_'+e.name+"_"+t.name+'" UNIQUE ("'+t.name+'")'}).join(" "),r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 2:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM information_schema.columns WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name = '"+e+"' AND column_name = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t,!1),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s,s;return __generator(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return i.type===n.type&&i.name===n.name?[3,5]:(s='ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'"',i.type!==n.type&&(s+=" TYPE "+n.type),i.name!==n.name&&(s+=" RENAME TO "+n.name),[4,this.query(s)]);case 4:u.sent(),u.label=5;case 5:return i.isNullable===n.isNullable?[3,7]:(s='ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'"',n.isNullable?s+=" DROP NOT NULL":s+=" SET NOT NULL",[4,this.query(s)]);case 6:u.sent(),u.label=7;case 7:return i.isGenerated===n.isGenerated?[3,13]:i.isGenerated||"uuid"===n.type?[3,10]:[4,this.query('CREATE SEQUENCE "'+r.name+'_id_seq" OWNED BY "'+r.name+'"."'+i.name+'"')];case 8:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'" SET DEFAULT nextval(\'"'+r.name+"_id_seq\"')")];case 9:return u.sent(),[3,13];case 10:return[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+i.name+'" DROP DEFAULT')];case 11:return u.sent(),[4,this.query('DROP SEQUENCE "'+r.name+'_id_seq"')];case 12:u.sent(),u.label=13;case 13:return i.comment===n.comment?[3,15]:[4,this.query('COMMENT ON COLUMN "'+r.name+'"."'+i.name+"\" is '"+n.comment+"'")];case 14:u.sent(),u.label=15;case 15:return i.isUnique===n.isUnique?[3,19]:!0!==n.isUnique?[3,17]:[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "uk_'+n.name+'" UNIQUE ("'+n.name+'")')];case 16:return u.sent(),[3,19];case 17:return!1!==n.isUnique?[3,19]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "uk_'+n.name+'"')];case 18:u.sent(),u.label=19;case 19:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query('ALTER TABLE "'+n+'" DROP "'+r+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT IF EXISTS "'+e.name+'_pkey"')];case 1:return n.sent(),[4,this.query('DROP INDEX IF EXISTS "'+e.name+'_pkey"')];case 2:return n.sent(),t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ("'+t.columnNames.join('", "')+'") REFERENCES "'+t.referencedTableName+'"("'+t.referencedColumnNames.join('", "')+'")',t.onDelete&&(r+=" ON DELETE "+t.onDelete),[2,this.query(r)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t,n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n?[4,this.query('ALTER SEQUENCE "'+e+'_id_seq" OWNED BY NONE')]:[3,2];case 1:i.sent(),i.label=2;case 2:return r='DROP INDEX "'+t+'"',[4,this.query(r)];case 3:return i.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"character("+(e.length?e.length:255)+")":"character varying("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"boolean";case"integer":case"int":return"integer";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"real";case"double":case"number":return"double precision";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return e.timezone?"time with time zone":"time without time zone";case"datetime":return e.timezone?"timestamp with time zone":"timestamp without time zone";case"json":return"json";case"jsonb":return"jsonb";case"simple_array":return e.length?"character varying("+e.length+")":"text";case"uuid":return"uuid"}throw new i.DataTypeNotSupportedByDriverError(e.type,"Postgres")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=$"+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return!0===e.isGenerated&&"uuid"!==e.type&&(n+=" SERIAL"),e.isGenerated&&"uuid"!==e.type||(n+=" "+e.type),!0!==e.isNullable&&(n+=" NOT NULL"),e.isGenerated&&(n+=" PRIMARY KEY"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?n+=" DEFAULT "+e.default:"boolean"==typeof e.default?n+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?n+=" DEFAULT "+e.default():"string"==typeof e.default?n+=" DEFAULT '"+e.default+"'":n+=" DEFAULT "+e.default),e.isGenerated&&"uuid"===e.type&&!e.default&&(n+=" DEFAULT uuid_generate_v4()"),n},e}(),e("PostgresQueryRunner",d)}}}),System.register("typeorm/driver/postgres/PostgresDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/metadata/types/ColumnTypes","typeorm/driver/postgres/PostgresQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e),this.logger=t,this.postgres=n,this.schemaName=e.schemaName||"public",!this.options.host)throw new s.DriverOptionNotSetError("host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.database)throw new s.DriverOptionNotSetError("database");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{host:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return void 0===this.options.usePool||!0===this.options.usePool?(this.pool=new this.postgres.Pool(t),Promise.resolve()):new Promise(function(n,r){e.databaseConnection={id:1,connection:new e.postgres.Client(t),isTransactionActive:!1},e.databaseConnection.connection.connect(function(t){t?r(t):e.databaseConnection.connection.query("SET search_path TO '"+e.schemaName+"', 'public';",function(t,i){t?(e.logger.logFailedQuery("SET search_path TO '"+e.schemaName+"', 'public';"),e.logger.logQueryError(t),r(t)):n()})})})},e.prototype.disconnect=function(){var e=this;if(!this.databaseConnection&&!this.pool)throw new n.ConnectionIsNotSetError("postgres");return new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.databaseConnection&&(e.databaseConnection.connection.end(),e.databaseConnection=void 0),e.pool&&(e.databaseConnectionPool.forEach(function(e){e&&e.releaseCallback&&e.releaseCallback()}),e.pool.end(r),e.pool=void 0,e.databaseConnectionPool=[]),t()})},
e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection||this.pool?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("postgres"))];case 1:return e=t.sent(),[2,new a.PostgresQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.postgres,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.pool}},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case o.ColumnTypes.BOOLEAN:return!0===e?1:0;case o.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case o.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case o.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case o.ColumnTypes.JSON:case o.ColumnTypes.JSONB:return JSON.stringify(e);case o.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case o.ColumnTypes.BOOLEAN:return!!e;case o.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case o.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case o.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case o.ColumnTypes.JSON:case o.ColumnTypes.JSONB:return e;case o.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):(n.push(r),"$"+n.length)}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(this.pool)return new Promise(function(t,n){e.pool.connect(function(r,i,o){if(r)return void n(r);var a=e.databaseConnectionPool.find(function(e){return e.connection===i});a||(a={id:e.databaseConnectionPool.length,connection:i,isTransactionActive:!1},e.databaseConnectionPool.push(a)),a.releaseCallback=function(){return a&&e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(a),1),o(),Promise.resolve()},a.connection.query("SET search_path TO '"+e.schemaName+"', 'public';",function(r){r?(e.logger.logFailedQuery("SET search_path TO '"+e.schemaName+"', 'public';"),e.logger.logQueryError(r),n(r)):t(a)})})});if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("postgres")},e.prototype.loadDependencies=function(){try{this.postgres=c.PlatformTools.load("pg")}catch(e){throw new r.DriverPackageNotInstalledError("Postgres","pg")}},e}(),e("PostgresDriver",l)}}}),System.register("typeorm/driver/mysql/MysqlQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,8,10,12]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS ', table_name, ';') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return a.sent(),[4,this.query(t)];case 4:return r=a.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 5:return a.sent(),[4,this.query(n)];case 6:return a.sent(),[4,this.commitTransaction()];case 7:return a.sent(),[3,12];case 8:return i=a.sent(),[4,this.rollbackTransaction()];case 9:throw a.sent(),i;case 10:return[4,this.release()];case 11:return a.sent(),[7];case 12:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.query(e,t,function(o,a){if(o)return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o);r(a)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c=this;return __generator(this,function(d){switch(d.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e){return"?"}).join(","),a=r.map(function(e){return t[e]}),s="INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")",[4,this.query(s,a)];case 1:return u=d.sent(),[2,n?u.insertId:void 0]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,p,m,f,y,h,g=this;return __generator(this,function(v){switch(v.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME IN ("+t+")",r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"'",i="SELECT * FROM INFORMATION_SCHEMA.STATISTICS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND INDEX_NAME != 'PRIMARY'",d="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '"+this.dbName+"' AND REFERENCED_COLUMN_NAME IS NOT NULL",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(d)])]):[2,[]];case 1:return p=v.sent(),m=p[0],f=p[1],y=p[2],h=p[3],m.length?[2,Promise.all(m.map(function(e){return __awaiter(g,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=new a.TableSchema(e.TABLE_NAME),[4,this.query("SHOW INDEX FROM `"+e.TABLE_NAME+"` WHERE Key_name = 'PRIMARY'")];case 1:return n=r.sent(),t.columns=f.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var t=new o.ColumnSchema;return t.name=e.COLUMN_NAME,t.type=e.COLUMN_TYPE.toLowerCase(),t.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,t.isNullable="YES"===e.IS_NULLABLE,t.isPrimary=-1!==e.COLUMN_KEY.indexOf("PRI"),t.isUnique=-1!==e.COLUMN_KEY.indexOf("UNI"),t.isGenerated=-1!==e.EXTRA.indexOf("auto_increment"),t.comment=e.COLUMN_COMMENT,t}),t.primaryKeys=n.map(function(e){return new u.PrimaryKeySchema(e.Key_name,e.Column_name)}),t.foreignKeys=h.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new s.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=y.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=y.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}),i=r.map(function(e){return e.COLUMN_NAME});if(1===r.length&&0===r[0].NON_UNIQUE){var o=t.columns.find(function(e){return e.name===r[0].INDEX_NAME&&e.name===r[0].COLUMN_NAME});if(o)return void(o.isUnique=!0)}return new c.IndexSchema(e.TABLE_NAME,n,i,!1)}).filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),n="CREATE TABLE `"+e.name+"` ("+t,r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return"`"+e.name+"`"}).join(", ")+")"),n+=") ENGINE=InnoDB;",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t="DROP TABLE `"+e+"`",[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r="ALTER TABLE `"+n+"` ADD "+this.buildCreateColumnSql(t,!1),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(s){switch(s.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=s.sent(),s.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return!1!==n.isUnique||!0!==i.isUnique?[3,5]:[4,this.query("ALTER TABLE `"+r.name+"` DROP INDEX `"+i.name+"`")];case 4:s.sent(),s.label=5;case 5:return[2,this.query("ALTER TABLE `"+r.name+"` CHANGE `"+i.name+"` "+this.buildCreateColumnSql(n,i.isPrimary))]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query("ALTER TABLE `"+n+"` DROP `"+r+"`")]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e.hasGeneratedColumn?[3,2]:[4,this.query("ALTER TABLE `"+e.name+"` DROP PRIMARY KEY")];case 1:n.sent(),n.label=2;case 2:return t=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}).map(function(e){return"`"+e.name+"`"}),t.length>0?[4,this.query("ALTER TABLE `"+e.name+"` ADD PRIMARY KEY ("+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(s){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),i=t.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),o="ALTER TABLE `"+n+"` ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+r+") REFERENCES `"+t.referencedTableName+"`("+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.query(o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,[2,this.query("ALTER TABLE `"+n+"` DROP FOREIGN KEY `"+t.name+"`")]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE ":"")+"INDEX `"+t.name+"` ON `"+e+"`("+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n="ALTER TABLE `"+e+"` DROP INDEX `"+t+"`",[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"char("+(e.length?e.length:255)+")":"varchar("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"tinyint(1)";case"integer":case"int":return"int("+(e.length?e.length:11)+")";case"smallint":return"smallint("+(e.length?e.length:11)+")";case"bigint":return"bigint("+(e.length?e.length:11)+")";case"float":return"float";case"double":case"number":return"double";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return"time";case"datetime":return"datetime";case"json":return"text";case"simple_array":return e.length?"varchar("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"MySQL/MariaDB")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){var t=this;return Object.keys(e).map(function(e){return t.driver.escapeColumnName(e)+"=?"})},e.prototype.buildCreateColumnSql=function(e,t){var n="`"+e.name+"` "+e.type;return!0!==e.isNullable&&(n+=" NOT NULL"),!0===e.isUnique&&(n+=" UNIQUE"),e.isGenerated&&e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&(n+=" AUTO_INCREMENT"),e.comment&&(n+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?n+=" DEFAULT "+e.default:"boolean"==typeof e.default?n+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?n+=" DEFAULT "+e.default():"string"==typeof e.default?n+=" DEFAULT '"+e.default+"'":n+=" DEFAULT "+e.default),n},e}(),e("MysqlQueryRunner",d)}}}),System.register("typeorm/driver/mysql/MysqlDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/mysql/MysqlQueryRunner","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e),this.logger=t,this.mysql=n,!(this.options.host||this.options.extra&&this.options.extra.socketPath))throw new s.DriverOptionNotSetError("socketPath and host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.database)throw new s.DriverOptionNotSetError("database");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{host:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return void 0===this.options.usePool||!0===this.options.usePool?(this.pool=this.mysql.createPool(t),Promise.resolve()):new Promise(function(n,r){var i=e.mysql.createConnection(t);e.databaseConnection={id:1,connection:i,isTransactionActive:!1},e.databaseConnection.connection.connect(function(e){return e?r(e):n()})})},e.prototype.disconnect=function(){var e=this;if(!this.databaseConnection&&!this.pool)throw new n.ConnectionIsNotSetError("mysql");return new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.pool&&(e.pool.end(r),e.pool=void 0,e.databaseConnectionPool=[]),e.databaseConnection&&(e.databaseConnection.connection.end(r),e.databaseConnection=void 0)})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection||this.pool?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("mysql"))];case 1:return e=t.sent(),[2,new o.MysqlQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.mysql,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.pool}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),"?"}),[e,n]},e.prototype.escapeColumnName=function(e){return"`"+e+"`"},e.prototype.escapeAliasName=function(e){return"`"+e+"`"},e.prototype.escapeTableName=function(e){return"`"+e+"`"},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case a.ColumnTypes.BOOLEAN:return!0===e?1:0;case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case a.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case a.ColumnTypes.JSON:return JSON.stringify(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case a.ColumnTypes.BOOLEAN:return!!e;case a.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case a.ColumnTypes.JSON:return JSON.parse(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(this.pool)return new Promise(function(t,n){e.pool.getConnection(function(r,i){if(r)return n(r);var o=e.databaseConnectionPool.find(function(e){return e.connection===i});o||(o={id:e.databaseConnectionPool.length,connection:i,isTransactionActive:!1},o.releaseCallback=function(){return e.pool&&o&&(i.release(),e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(o),1)),Promise.resolve()},e.databaseConnectionPool.push(o)),t(o)})});if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("mysql")},e.prototype.loadDependencies=function(){try{this.mysql=c.PlatformTools.load("mysql")}catch(e){try{this.mysql=c.PlatformTools.load("mysql2")}catch(e){throw new r.DriverPackageNotInstalledError("Mysql","mysql")}}},e}(),e("MysqlDriver",l)}}}),System.register("typeorm/query-builder/error/LockNotSupportedOnGivenDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on giver driver.",n}return __extends(t,e),t}(Error),e("LockNotSupportedOnGivenDriverError",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoader",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.connection=e,this.queryRunnerProvider=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(i){return t=this.relationIdAttributes.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,p,i,m,f,y,h,g,v,b,E,_,C,l,T,N;return __generator(this,function(w){switch(w.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return r=e.map(function(e){var n={};return t.relation.joinColumns.forEach(function(r){n[r.databaseName]=e[t.parentAlias+"_"+r.databaseName]}),t.relation.entityMetadata.primaryColumns.forEach(function(r){n[r.databaseName]=e[t.parentAlias+"_"+r.databaseName]}),n}),[2,{relationIdAttribute:t,results:r}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(i=t.relation,o=i.isOwning?i.joinColumns:i.inverseRelation.joinColumns,a=i.inverseEntityMetadata.target,s=i.inverseEntityMetadata.tableName,u=t.alias||s,c={},(l=e.map(function(e,n){return o.map(function(r){var i=r.databaseName+n;return c[i]=e[t.parentAlias+"_"+r.referencedColumn.databaseName],u+"."+r.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "))?(d=new n.QueryBuilder(this.connection,this.queryRunnerProvider),o.forEach(function(e){d.addSelect(u+"."+e.propertyPath,e.databaseName)}),i.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){d.addSelect(u+"."+e.propertyPath,e.databaseName)}),d.from(a,u).where("("+l+")").setParameters(c),t.queryBuilderFactory&&t.queryBuilderFactory(d),p={relationIdAttribute:t},[4,d.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return[2,(p.results=w.sent(),p)];case 3:return i=t.relation,(m=i.isOwning?i.joinColumns:i.inverseRelation.inverseJoinColumns,f=i.isOwning?i.inverseJoinColumns:i.inverseRelation.joinColumns,y=t.junctionAlias,h=t.joinInverseSideMetadata.tableName,g=t.alias||h,v=i.junctionEntityMetadata.tableName,b=e.map(function(e){return m.reduce(function(n,r){return n[r.propertyPath]=e[t.parentAlias+"_"+r.referencedColumn.databaseName],n},{})}),0===b.length)?[2,{relationIdAttribute:t,results:[]}]:(E={},_=b.map(function(e,t){return Object.keys(e).map(function(n){var r=n+t;return E[r]=e[n],y+"."+n+" = :"+r}).join(" AND ")}),C=f.map(function(e){return y+"."+e.propertyPath+" = "+g+"."+e.referencedColumn.propertyPath}).join(" AND "),l=_.map(function(e){return"("+e+" AND "+C+")"}).join(" OR "),T=new n.QueryBuilder(this.connection,this.queryRunnerProvider),f.forEach(function(e){T.addSelect(y+"."+e.propertyPath,e.databaseName).addOrderBy(y+"."+e.propertyPath)}),m.forEach(function(e){T.addSelect(y+"."+e.propertyPath,e.databaseName).addOrderBy(y+"."+e.propertyPath)}),T.fromTable(h,g).innerJoin(v,y,l).setParameters(E),t.queryBuilderFactory&&t.queryBuilderFactory(T),N={relationIdAttribute:t},[4,T.getRawMany()]);case 4:return[2,(N.results=w.sent(),N)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationIdLoader",r)}}}),System.register("typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer",["typeorm/query-builder/relation-id/RelationIdAttribute"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationIdAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationIdMetadataToAttributeTransformer",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoader",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.connection=e,this.queryRunnerProvider=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(i){return t=this.relationCountAttributes.map(function(t){
return __awaiter(r,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,p,m,f,y,h,l,g,s,u,v,b,d,E;return __generator(this,function(_){switch(_.label){case 0:return t.relation.isOneToMany?(r=t.relation,i=r.inverseRelation,o=i.joinColumns[0].referencedColumn.propertyName,a=r.inverseEntityMetadata.target,s=r.inverseEntityMetadata.tableName,u=t.alias||s,c=i.propertyName,l=e.map(function(e){return e[t.parentAlias+"_"+o]}).filter(function(e){return!!e}),0===l.length?[2,{relationCountAttribute:t,results:[]}]:(d=new n.QueryBuilder(this.connection,this.queryRunnerProvider),d.select(u+"."+c,"parentId").addSelect("COUNT("+d.escapeAlias(u)+"."+d.escapeColumn(o)+")","cnt").from(a,u).where(u+"."+c+" IN (:ids)").addGroupBy(u+"."+c).setParameter("ids",l),t.queryBuilderFactory&&t.queryBuilderFactory(d),p={relationCountAttribute:t},[4,d.getRawMany()])):[3,2];case 1:return[2,(p.results=_.sent(),p)];case 2:return f=void 0,(y=void 0,h=void 0,t.relation.isOwning?(m=t.relation.joinColumns[0].referencedColumn.databaseName,f=t.relation.inverseJoinColumns[0].referencedColumn.databaseName,y=t.relation.junctionEntityMetadata.columns[0],h=t.relation.junctionEntityMetadata.columns[1]):(m=t.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,f=t.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,y=t.relation.junctionEntityMetadata.columns[1],h=t.relation.junctionEntityMetadata.columns[0]),l=e.map(function(e){return e[t.parentAlias+"_"+m]}).filter(function(e){return e}),0===l.length)?[2,{relationCountAttribute:t,results:[]}]:(g=t.junctionAlias,s=t.joinInverseSideMetadata.tableName,u=t.alias||s,v=t.relation.junctionEntityMetadata.tableName,b=g+"."+y.propertyName+" IN ("+l+") AND "+g+"."+h.propertyName+" = "+u+"."+f,d=new n.QueryBuilder(this.connection,this.queryRunnerProvider),d.select(g+"."+y.propertyName,"parentId").addSelect("COUNT("+d.escapeAlias(u)+"."+d.escapeColumn(f)+")","cnt").fromTable(s,u).innerJoin(v,g,b).addGroupBy(g+"."+y.propertyName),t.queryBuilderFactory&&t.queryBuilderFactory(d),E={relationCountAttribute:t},[4,d.getRawMany()]);case 3:return[2,(E.results=_.sent(),E)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationCountLoader",r)}}}),System.register("typeorm/metadata-args/RelationCountMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationCountMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),e("RelationCountMetadata",n)}}}),System.register("typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer",["typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationCountAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationCountMetadataToAttributeTransformer",r)}}}),System.register("typeorm/driver/oracle/OracleQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){d=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,8,10,12]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS ', table_name, ';') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return a.sent(),[4,this.query(t)];case 4:return r=a.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 5:return a.sent(),[4,this.query(n)];case 6:return a.sent(),[4,this.commitTransaction()];case 7:return a.sent(),[3,12];case 8:return i=a.sent(),[4,this.rollbackTransaction()];case 9:throw a.sent(),i;case 10:return[4,this.release()];case 11:return a.sent(),[7];case 12:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t);var o=function(o,a){if(o)return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o);r(a.rows||a.outBinds)},a={autoCommit:!n.databaseConnection.isTransactionActive};n.databaseConnection.connection.execute(e,t||{},a,o)})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c,d=this;return __generator(this,function(p){switch(p.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),(i=r.map(function(e){return d.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e){return":"+e}).join(", "),a=r.map(function(e){return t[e]}),s=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES",n)?(u="declare lastId number; begin "+s+' returning "id" into lastId; dbms_output.enable; dbms_output.put_line(lastId); dbms_output.get_line(:ln, :st); end;',[4,this.query(u,a.concat([{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.STRING,maxSize:32767},{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.NUMBER}]))]):[3,2];case 1:return c=p.sent(),[2,parseInt(c[0])];case 2:return[2,this.query(s,a)]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,d,p,m,f,y,h,g,v;return __generator(this,function(b){switch(b.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME IN ("+t+")",r="SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, IDENTITY_COLUMN FROM all_tab_cols WHERE TABLE_NAME IN ("+t+")",i="SELECT ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS, LISTAGG(cols.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY cols.COLUMN_NAME) AS COLUMN_NAMES\n                                FROM USER_INDEXES ind, USER_IND_COLUMNS cols \n                                WHERE ind.INDEX_NAME = cols.INDEX_NAME AND ind.TABLE_NAME IN ("+t+")\n                                GROUP BY ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS",d="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '"+this.dbName+"' AND REFERENCED_COLUMN_NAME IS NOT NULL",p="SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND CONSTRAINT_TYPE = 'UNIQUE'",m="SELECT cols.table_name, cols.column_name, cols.position, cons.constraint_type, cons.constraint_name\nFROM all_constraints cons, all_cons_columns cols WHERE cols.table_name IN ("+t+") \nAND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner ORDER BY cols.table_name, cols.position",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(m)])]):[2,[]];case 1:return f=b.sent(),y=f[0],h=f[1],g=f[2],v=f[3],y.length?[2,y.map(function(e){var t=new a.TableSchema(e.TABLE_NAME);return t.columns=h.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!v.find(function(n){return n.TABLE_NAME===t.name&&"P"===n.CONSTRAINT_TYPE&&n.COLUMN_NAME===e.COLUMN_NAME}),r=e.DATA_TYPE.toLowerCase();"varchar2"===e.DATA_TYPE.toLowerCase()&&null!==e.DATA_LENGTH?r+="("+e.DATA_LENGTH+")":null!==e.DATA_PRECISION&&null!==e.DATA_SCALE?r+="("+e.DATA_PRECISION+","+e.DATA_SCALE+")":null!==e.DATA_SCALE?r+="(0,"+e.DATA_SCALE+")":null!==e.DATA_PRECISION&&(r+="("+e.DATA_PRECISION+")");var i=new o.ColumnSchema;return i.name=e.COLUMN_NAME,i.type=r,i.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,i.isNullable="N"!==e.NULLABLE,i.isPrimary=n,i.isGenerated="YES"===e.IDENTITY_COLUMN,i.comment="",i}),t.primaryKeys=v.filter(function(e){return e.TABLE_NAME===t.name&&"P"===e.CONSTRAINT_TYPE}).map(function(e){return new u.PrimaryKeySchema(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=v.filter(function(e){return e.TABLE_NAME===t.name&&"R"===e.CONSTRAINT_TYPE}).map(function(e){return new s.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=g.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(t){return new c.IndexSchema(e.TABLE_NAME,t.INDEX_NAME,t.COLUMN_NAMES,!("UNIQUE"!==t.COLUMN_NAMES))}),t})]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,r=e.columns.filter(function(e){return e.isPrimary}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT COLUMN_NAME FROM all_tab_cols WHERE TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof o.ColumnSchema?s=n:(s=i.clone(),s.name=n),[2,this.changeColumn(r,i,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,s,u,c,d,d,d;return __generator(this,function(p){switch(p.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=p.sent(),p.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return n.isGenerated===i.isGenerated?[3,10]:n.isGenerated?r.primaryKeys.length>0&&i.isPrimary?(s='ALTER TABLE "'+r.name+'" DROP CONSTRAINT "'+r.primaryKeys[0].name+'"',[4,this.query(s)]):[3,5]:[3,8];case 4:p.sent(),p.label=5;case 5:return u='ALTER TABLE "'+r.name+'" DROP COLUMN "'+n.name+'"',[4,this.query(u)];case 6:return p.sent(),c='ALTER TABLE "'+r.name+'" ADD '+this.buildCreateColumnSql(n),[4,this.query(c)];case 7:return p.sent(),[3,10];case 8:return d='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" DROP IDENTITY',[4,this.query(d)];case 9:p.sent(),p.label=10;case 10:return n.isNullable===i.isNullable?[3,12]:(d='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" '+n.type+" "+(n.isNullable?"NULL":"NOT NULL"),[4,this.query(d)]);case 11:return p.sent(),[3,14];case 12:return n.type===i.type?[3,14]:(d='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" '+n.type,[4,this.query(d)]);case 13:p.sent(),p.label=14;case 14:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof a.TableSchema?e.name:e,r=t instanceof o.ColumnSchema?t.name:t,[2,this.query('ALTER TABLE "'+n+'" DROP COLUMN "'+r+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),e.primaryKeys.length>0&&e.primaryKeys[0].name?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+e.primaryKeys[0].name+'"')]:[3,2];case 1:n.sent(),n.label=2;case 2:return t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(s){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),o='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.query(o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=e instanceof a.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE":"")+' INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return n='ALTER TABLE "'+e+'" DROP INDEX "'+t+'"',[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return e.fixedLength?"char("+(e.length?e.length:255)+")":"varchar2("+(e.length?e.length:255)+")";case"text":return"clob";case"boolean":return"number(1)";case"integer":case"int":return e.precision&&e.scale?"number("+e.precision+","+e.scale+")":e.precision?"number("+e.precision+",0)":e.scale?"number(0,"+e.scale+")":"number(10,0)";case"smallint":return"number(5)";case"bigint":return"number(20)";case"float":return e.precision&&e.scale?"float("+e.precision+","+e.scale+")":e.precision?"float("+e.precision+",0)":e.scale?"float(0,"+e.scale+")":"float(126)";case"double":case"number":return"float(126)";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal(0,"+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":case"time":return"date";case"datetime":return"timestamp(0)";case"json":return"clob";case"simple_array":return e.length?"varchar2("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"Oracle")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.schemaName},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){var t=this;return Object.keys(e).map(function(e){return t.driver.escapeColumnName(e)+"=:"+e})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+e.type;return!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&(t+=" GENERATED BY DEFAULT ON NULL AS IDENTITY"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?t+=" DEFAULT "+e.default:"boolean"==typeof e.default?t+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?t+=" DEFAULT "+e.default():"string"==typeof e.default?t+=" DEFAULT '"+e.default+"'":t+=" DEFAULT "+e.default),t},e}(),e("OracleQueryRunner",d)}}}),System.register("typeorm/driver/oracle/OracleDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/oracle/OracleQueryRunner","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,n){if(this.databaseConnectionPool=[],this.options=i.DriverUtils.buildDriverOptions(e,{useSid:!0}),this.logger=t,this.oracle=n,!this.options.host)throw new s.DriverOptionNotSetError("host");if(!this.options.username)throw new s.DriverOptionNotSetError("username");if(!this.options.sid)throw new s.DriverOptionNotSetError("sid");n||this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){var e=this,t=Object.assign({},{user:this.options.username,password:this.options.password,connectString:this.options.host+":"+this.options.port+"/"+this.options.sid},this.options.extra||{});return void 0===this.options.usePool||!0===this.options.usePool?new Promise(function(n,r){e.oracle.createPool(t,function(t,i){if(t)return r(t);e.pool=i,n()})}):new Promise(function(n,r){e.oracle.getConnection(t,function(t,i){if(t)return r(t);e.databaseConnection={id:1,connection:i,isTransactionActive:!1},e.databaseConnection.connection.connect(function(e){return e?r(e):n()})})})},e.prototype.disconnect=function(){var e=this;if(!this.databaseConnection&&!this.pool)throw new n.ConnectionIsNotSetError("oracle");return new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.pool&&(e.pool.close(r),e.pool=void 0,e.databaseConnectionPool=[]),e.databaseConnection&&(e.databaseConnection.connection.close(r),e.databaseConnection=void 0)})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection||this.pool?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("oracle"))];case 1:return e=t.sent(),[2,new o.OracleQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.oracle,connection:this.databaseConnection?this.databaseConnection.connection:void 0,pool:this.pool}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),e}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case a.ColumnTypes.BOOLEAN:return!0===e?1:0;case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedDateToTimeString(e);case a.ColumnTypes.DATETIME:return t.localTimezone?u.DataTransformationUtils.mixedDateToDatetimeString(e):u.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case a.ColumnTypes.JSON:return JSON.stringify(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case a.ColumnTypes.BOOLEAN:return!!e;case a.ColumnTypes.DATETIME:return u.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case a.ColumnTypes.DATE:return u.DataTransformationUtils.mixedDateToDateString(e);case a.ColumnTypes.TIME:return u.DataTransformationUtils.mixedTimeToString(e);case a.ColumnTypes.JSON:return JSON.parse(e);case a.ColumnTypes.SIMPLE_ARRAY:return u.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){var e=this;if(this.pool)return new Promise(function(t,n){e.pool.getConnection(function(r,i){if(r)return n(r);var o=e.databaseConnectionPool.find(function(e){return e.connection===i});o||(o={id:e.databaseConnectionPool.length,connection:i,isTransactionActive:!1},o.releaseCallback=function(){return new Promise(function(t,n){i.close(function(r){if(r)return n(r);e.pool&&o&&e.databaseConnectionPool.splice(e.databaseConnectionPool.indexOf(o),1),t()})})},e.databaseConnectionPool.push(o)),t(o)})});if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("oracle")},e.prototype.loadDependencies=function(){try{this.oracle=c.PlatformTools.load("oracledb")}catch(e){throw new r.DriverPackageNotInstalledError("Oracle","oracledb")}},e}(),e("OracleDriver",l)}}}),System.register("typeorm/query-builder/QueryBuilder",["typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer","typeorm/driver/sqlserver/SqlServerDriver","typeorm/query-runner/QueryRunnerProvider","typeorm/query-builder/error/PessimisticLockTransactionRequiredError","typeorm/query-builder/error/NoVersionOrUpdateDateColumnError","typeorm/query-builder/error/OptimisticLockVersionMismatchError","typeorm/query-builder/error/OptimisticLockCanNotBeUsedError","typeorm/driver/postgres/PostgresDriver","typeorm/driver/mysql/MysqlDriver","typeorm/query-builder/error/LockNotSupportedOnGivenDriverError","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute","typeorm/query-builder/QueryExpressionMap","typeorm/query-builder/relation-id/RelationIdLoader","typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer","typeorm/query-builder/relation-count/RelationCountLoader","typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer","typeorm/driver/oracle/OracleDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b,E,_;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e}],execute:function(){_=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t,this.expressionMap=new y.QueryExpressionMap(e)}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){return this.expressionMap.queryType="select",e instanceof Array?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]),this},e.prototype.addSelect=function(e,t){return e instanceof Array?this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}})):this.expressionMap.selects.push({selection:e,aliasName:t}),this},e.prototype.update=function(e,t){var n=t||e;return e instanceof Function?this.expressionMap.createMainAlias({target:e}):"string"==typeof e&&this.expressionMap.createMainAlias({tableName:e}),this.expressionMap.queryType="update",this.expressionMap.updateSet=n,this},
e.prototype.delete=function(){return this.expressionMap.queryType="delete",this},e.prototype.from=function(e,t){return this.expressionMap.createMainAlias({name:t,target:e}),this},e.prototype.fromTable=function(e,t){var n=this.connection.entityMetadatas.find(function(t){return t.tableName===e});return n?this.expressionMap.createMainAlias({name:t,metadata:n}):this.expressionMap.createMainAlias({name:t,tableName:e}),this},e.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},e.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},e.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},e.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},e.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},e.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},e.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},e.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},e.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new m.RelationIdAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},e.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new f.RelationCountAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},e.prototype.where=function(e,t){return this.expressionMap.wheres.push({type:"simple",condition:e}),t&&this.setParameters(t),this},e.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:e}),t&&this.setParameters(t),this},e.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:e}),t&&this.setParameters(t),this},e.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},e.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},e.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},e.prototype.groupBy=function(e){return this.expressionMap.groupBys=[e],this},e.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},e.prototype.orderBy=function(e,t){return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?(n={},n[e]=t,n):{},this;var n},e.prototype.addOrderBy=function(e,t){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=t,this},e.prototype.setLimit=function(e){return this.expressionMap.limit=e,this},e.prototype.setOffset=function(e){return this.expressionMap.offset=e,this},e.prototype.take=function(e){return this.expressionMap.take=e,this},e.prototype.skip=function(e){return this.expressionMap.skip=e,this},e.prototype.setMaxResults=function(e){return this.expressionMap.take=e,this},e.prototype.setFirstResult=function(e){return this.expressionMap.skip=e,this},e.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach(function(n){t.expressionMap.parameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.getSql=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e+=this.createOffsetExpression(),e+=this.createLockExpression(),e=this.createLimitOffsetSpecificExpression(e),e=this.connection.driver.escapeQueryWithParameters(e,this.expressionMap.parameters)[0],e.trim()},e.prototype.getGeneratedQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e+=this.createOffsetExpression(),e+=this.createLockExpression(),e=this.createLimitOffsetSpecificExpression(e),e.trim()},e.prototype.getSqlWithParameters=function(e){var t=this.createSelectExpression();return t+=this.createJoinExpression(),t+=this.createWhereExpression(),t+=this.createGroupByExpression(),t+=this.createHavingExpression(),e&&e.skipOrderBy||(t+=this.createOrderByExpression()),t+=this.createLimitExpression(),t+=this.createOffsetExpression(),t+=this.createLockExpression(),t=this.createLimitOffsetSpecificExpression(t),this.connection.driver.escapeQueryWithParameters(t,this.getParameters())},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getQueryRunner()];case 1:e=i.sent(),t=this.getSqlWithParameters(),n=t[0],r=t[1],i.label=2;case 2:return i.trys.push([2,,4,7]),[4,e.query(n,r)];case 3:return[2,i.sent()];case 4:return this.hasOwnQueryRunner()?[4,e.release()]:[3,6];case 5:i.sent(),i.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.getEntitiesAndRawResults=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,s,u,c,l,d,p,m,f,y,E,_,C,T,N,w,R,M,A,S,O,P,I,x,D,L,d,p,N,x,D,T,j=this;return __generator(this,function(q){switch(q.label){case 0:return[4,this.getQueryRunner()];case 1:e=q.sent(),t=new h.RelationIdLoader(this.connection,this.queryRunnerProvider,this.expressionMap.relationIdAttributes),n=new v.RelationCountLoader(this.connection,this.queryRunnerProvider,this.expressionMap.relationCountAttributes),i=new g.RelationIdMetadataToAttributeTransformer(this.expressionMap),i.transform(),s=new b.RelationCountMetadataToAttributeTransformer(this.expressionMap),s.transform(),q.label=2;case 2:if(q.trys.push([2,,16,19]),!this.expressionMap.mainAlias)throw new Error("Alias is not set. Looks like nothing is selected. Use select*, delete, update method to set an alias.");if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode)&&!e.isTransactionActive())throw new o.PessimisticLockTransactionRequiredError;if("optimistic"===this.expressionMap.lockMode&&(u=this.expressionMap.mainAlias.metadata,!u.versionColumn&&!u.updateDateColumn))throw new a.NoVersionOrUpdateDateColumnError(u.name);return c=this.expressionMap.mainAlias.name,this.expressionMap.skip||this.expressionMap.take?(l=this.getSqlWithParameters({skipOrderBy:!0}),d=l[0],p=l[1],m=this.createOrderByCombinedWithSelectExpression("distinctAlias"),f=m[0],y=m[1],E=this.escapeTable("distinctAlias"),_=this.expressionMap.mainAlias.metadata,C="SELECT ",C+=_.primaryColumns.map(function(e,t){var n=j.escapeAlias(c+"_"+e.databaseName);return 0===t?"DISTINCT("+E+"."+n+") as ids_"+e.databaseName:E+"."+n+") as ids_"+e.databaseName}).join(", "),f.length>0&&(C+=", "+f),C+=" FROM ("+d+") "+E,y.length>0?C+=" ORDER BY "+y:C+=' ORDER BY "ids_'+_.primaryColumns[0].databaseName+'"',this.connection.driver instanceof r.SqlServerDriver?(this.expressionMap.skip||this.expressionMap.take)&&(C+=" OFFSET "+(this.expressionMap.skip||0)+" ROWS",this.expressionMap.take&&(C+=" FETCH NEXT "+this.expressionMap.take+" ROWS ONLY")):(this.expressionMap.take&&(C+=" LIMIT "+this.expressionMap.take),this.expressionMap.skip&&(C+=" OFFSET "+this.expressionMap.skip)),T=[],[4,e.query(C,p)]):[3,9];case 3:return N=q.sent(),N.length>0?(w="",R={},_.hasMultiplePrimaryKeys?w=N.map(function(e){return _.primaryColumns.map(function(t){return R["ids_"+t.propertyName]=e["ids_"+t.propertyName],c+"."+t.propertyName+"=:ids_"+t.propertyName}).join(" AND ")}).join(" OR "):(M=N.map(function(e){return e["ids_"+_.primaryColumns[0].propertyName]}),A=M.every(function(e){return"number"==typeof e}),A?w=c+"."+_.primaryColumns[0].propertyName+" IN ("+M.join(", ")+")":(R.ids=M,w=c+"."+_.primaryColumns[0].propertyName+" IN (:ids)")),S=this.clone({queryRunnerProvider:this.queryRunnerProvider}),S.expressionMap.extraAppendedAndWhereCondition=w,O=S.setParameters(R).getSqlWithParameters(),P=O[0],I=O[1],[4,e.query(P,I)]):[3,8];case 4:return N=q.sent(),[4,t.load(N)];case 5:return x=q.sent(),[4,n.load(N)];case 6:return D=q.sent(),T=this.rawResultsToEntities(N,x,D),this.expressionMap.mainAlias.hasMetadata?[4,this.connection.broadcaster.broadcastLoadEventsForAll(this.expressionMap.mainAlias.target,N)]:[3,8];case 7:q.sent(),q.label=8;case 8:return[2,{entities:T,rawResults:N}];case 9:return L=this.getSqlWithParameters(),d=L[0],p=L[1],[4,e.query(d,p)];case 10:return N=q.sent(),[4,t.load(N)];case 11:return x=q.sent(),[4,n.load(N)];case 12:return D=q.sent(),T=this.rawResultsToEntities(N,x,D),this.expressionMap.mainAlias.hasMetadata?[4,this.connection.broadcaster.broadcastLoadEventsForAll(this.expressionMap.mainAlias.target,N)]:[3,14];case 13:q.sent(),q.label=14;case 14:return[2,{entities:T,rawResults:N}];case 15:return[3,19];case 16:return this.hasOwnQueryRunner()?[4,e.release()]:[3,18];case 17:q.sent(),q.label=18;case 18:return[7];case 19:return[2]}})})},e.prototype.getCount=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s,c,l,d=this;return __generator(this,function(p){switch(p.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new u.OptimisticLockCanNotBeUsedError;return[4,this.getQueryRunner()];case 1:e=p.sent(),t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata,r=this.escapeAlias(t),i="COUNT("+n.primaryColumns.map(function(e,t){var n=d.escapeColumn(e.databaseName);return 0===t?"DISTINCT("+r+"."+n+")":r+"."+n+")"}).join(", ")+') as "cnt"',o=this.clone({queryRunnerProvider:this.queryRunnerProvider}).orderBy(void 0).setOffset(void 0).setLimit(void 0).select(i),o.expressionMap.ignoreParentTablesJoins=!0,a=o.getSqlWithParameters(),s=a[0],c=a[1],p.label=2;case 2:return p.trys.push([2,,4,7]),[4,e.query(s,c)];case 3:return l=p.sent(),l&&l[0]&&l[0].cnt?[2,parseInt(l[0].cnt)]:[2,0];case 4:return this.hasOwnQueryRunner()?[4,e.release()]:[3,6];case 5:p.sent(),p.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.getRawMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if("optimistic"===this.expressionMap.lockMode)throw new u.OptimisticLockCanNotBeUsedError;return[2,this.execute()]})})},e.prototype.getRawOne=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new u.OptimisticLockCanNotBeUsedError;return[4,this.execute()];case 1:return e=t.sent(),[2,e[0]]}})})},e.prototype.getManyAndCount=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if("optimistic"===this.expressionMap.lockMode)throw new u.OptimisticLockCanNotBeUsedError;return[2,Promise.all([this.getMany(),this.getCount()])]})})},e.prototype.getMany=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new u.OptimisticLockCanNotBeUsedError;return[4,this.getEntitiesAndRawResults()];case 1:return e=t.sent(),[2,e.entities]}})})},e.prototype.getOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getEntitiesAndRawResults()];case 1:if(e=i.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if(r=t[n.updateDateColumn.propertyName],this.expressionMap.lockVersion.setMilliseconds(0),r.getTime()!==this.expressionMap.lockVersion.getTime())throw new s.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,r)}else if((r=t[n.versionColumn.propertyName])!==this.expressionMap.lockVersion)throw new s.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,r);return[2,t]}})})},e.prototype.clone=function(t){var n=new e(this.connection,t?t.queryRunnerProvider:void 0);return n.expressionMap=this.expressionMap.clone(),n},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escapeAlias=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escapeAliasName(e):e},e.prototype.escapeColumn=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escapeColumnName(e):e},e.prototype.escapeTable=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escapeTableName(e):e},e.prototype.enableAutoRelationIdsLoad=function(){var e=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(t){e.loadRelationIdAndMap(e.expressionMap.mainAlias.name+"."+t.propertyPath,e.expressionMap.mainAlias.name+"."+t.propertyPath,{disableMixedMap:!0})}),this},e.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},e.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},e.prototype.join=function(e,t,n,r,i,o,a){var s=new p.JoinAttribute(this.connection,this.expressionMap);s.direction=e,s.mapToProperty=o,s.options=i,s.isMappingMany=a,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.alias=this.expressionMap.createAlias({name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata})},e.prototype.rawResultsToEntities=function(e,t,r){return new n.RawSqlResultsToEntityTransformer(this.connection.driver,this.expressionMap.joinAttributes,t,r).transform(e,this.expressionMap.mainAlias)},e.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this;return(this.expressionMap.selects.some(function(t){return t.selection===e})?t.columns:t.columns.filter(function(t){return n.expressionMap.selects.some(function(n){return n.selection===e+"."+t.propertyName})})).map(function(t){var r=n.expressionMap.selects.find(function(n){return n.selection===e+"."+t.propertyName});return{selection:n.escapeAlias(e)+"."+n.escapeColumn(t.databaseName),aliasName:r&&r.aliasName?r.aliasName:e+"_"+t.databaseName}})},e.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find(function(t){return t.selection===e});return n?[n]:this.expressionMap.selects.filter(function(n){return t.columns.some(function(t){return n.selection===e+"."+t.propertyName})})},e.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var t,n=function(t){return e.escapeAlias(t)},i=function(t){return e.escapeColumn(t)},o=[],a=[],s=this.expressionMap.mainAlias.name;if(this.expressionMap.mainAlias.hasMetadata){var u=this.expressionMap.mainAlias.metadata;t=u.tableName,o.push.apply(o,this.buildEscapedEntityColumnSelects(s,u)),a.push.apply(a,this.findEntityColumnSelects(s,u))}else t=this.expressionMap.mainAlias.tableName;if(this.expressionMap.joinAttributes.forEach(function(t){if(t.metadata)o.push.apply(o,e.buildEscapedEntityColumnSelects(t.alias.name,t.metadata)),a.push.apply(a,e.findEntityColumnSelects(t.alias.name,t.metadata));else{e.expressionMap.selects.some(function(e){return e.selection===t.alias.name})&&(o.push({selection:n(t.alias.name)+".*"}),a.push({selection:n(t.alias.name)}))}}),!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var u=this.expressionMap.mainAlias.metadata;if(u.parentEntityMetadata&&"class-table"===u.parentEntityMetadata.inheritanceType&&u.parentIdColumns){var c="parentIdColumn_"+u.parentEntityMetadata.tableName;u.parentEntityMetadata.columns.forEach(function(e){o.push({selection:n(c)+"."+i(e.databaseName),aliasName:c+"_"+e.databaseName})})}}this.expressionMap.selects.filter(function(e){return-1===a.indexOf(e)}).forEach(function(t){return o.push({selection:e.replacePropertyNames(t.selection),aliasName:t.aliasName})}),0===o.length&&o.push({selection:"*"});var l="";if(this.connection.driver instanceof r.SqlServerDriver)switch(this.expressionMap.lockMode){case"pessimistic_read":l=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":l=" WITH (UPDLOCK, ROWLOCK)"}switch(this.expressionMap.queryType){case"select":var d=o.map(function(e){return e.selection+(e.aliasName?" AS "+n(e.aliasName):"")}).join(", ");return(this.expressionMap.limit||this.expressionMap.offset)&&this.connection.driver instanceof E.OracleDriver?'SELECT ROWNUM "RN",'+d+" FROM "+this.escapeTable(t)+" "+n(s)+l:"SELECT "+d+" FROM "+this.escapeTable(t)+" "+n(s)+l;case"delete":return"DELETE FROM "+function(t){return e.escapeTable(t)}(t);case"update":var p=Object.keys(this.expressionMap.updateSet).map(function(e){return e+"=:updateSet__"+e}),m=Object.keys(this.expressionMap.updateSet).reduce(function(t,n){return t["updateSet_"+n]=e.expressionMap.updateSet[n],t},{});return this.setParameters(m),"UPDATE "+t+" "+(s?n(s):"")+" SET "+p}throw new Error("No query builder type is specified.")},e.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");return t.length?" HAVING "+t:""},e.prototype.createWhereExpression=function(){var e=this,t=this.expressionMap.wheres.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");if(this.expressionMap.mainAlias.hasMetadata){var n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){var r=this.replacePropertyNames(this.expressionMap.mainAlias.name+"."+n.discriminatorColumn.databaseName)+" IN (:discriminatorColumnValues)";return" WHERE "+(t.length?"("+t+") AND":"")+" "+r}}return t.length?this.expressionMap.extraAppendedAndWhereCondition?" WHERE ("+t+") AND "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):" WHERE "+t:this.expressionMap.extraAppendedAndWhereCondition?" WHERE "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):""},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach(function(n){n.hasMetadata&&(n.metadata.columns.forEach(function(r){var i="([ =(]|^.{0})"+n.name+"\\."+r.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(i,"gm"),"$1"+t.escapeAlias(n.name)+"."+t.escapeColumn(r.databaseName)+"$2");var o="([ =(]|^.{0})"+n.name+"\\."+r.propertyName+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+t.escapeAlias(n.name)+"."+t.escapeColumn(r.databaseName)+"$2")}),n.metadata.relations.forEach(function(r){if(r.joinColumns.concat(r.inverseJoinColumns).forEach(function(i){var o="([ =(]|^.{0})"+n.name+"\\."+r.propertyPath+"\\."+i.referencedColumn.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+t.escapeAlias(n.name)+"."+t.escapeColumn(i.databaseName)+"$2")}),r.joinColumns.length>0){var i="([ =(]|^.{0})"+n.name+"\\."+r.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(i,"gm"),"$1"+t.escapeAlias(n.name)+"."+t.escapeColumn(r.joinColumns[0].databaseName)+"$2")}}))}),e},e.prototype.createJoinExpression=function(){var e=this,t=function(t){return e.escapeTable(t)},n=function(t){return e.escapeAlias(t)},r=this.expressionMap.joinAttributes.map(function(r){var i=r.relation,o=r.tableName,a=r.alias.name,s=r.condition?" AND ("+r.condition+")":"",u=r.parentAlias;if(!u||!i)return" "+r.direction+" JOIN "+t(o)+" "+n(a)+(r.condition?" ON "+e.replacePropertyNames(r.condition):"");if(i.isManyToOne||i.isOneToOneOwner){var c=i.joinColumns.map(function(e){return a+"."+e.referencedColumn.propertyPath+"="+u+"."+i.propertyPath+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+r.direction+" JOIN "+t(o)+" "+n(a)+" ON "+e.replacePropertyNames(c+s)}if(i.isOneToMany||i.isOneToOneNotOwner){var c=i.inverseRelation.joinColumns.map(function(e){return a+"."+i.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+u+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+r.direction+" JOIN "+t(o)+" "+n(a)+" ON "+e.replacePropertyNames(c+s)}var l=i.junctionEntityMetadata.tableName,d=r.junctionAlias,p="",m="";return i.isOwning?(p=i.joinColumns.map(function(e){return d+"."+e.propertyPath+"="+u+"."+e.referencedColumn.propertyPath}).join(" AND "),m=i.inverseJoinColumns.map(function(e){return a+"."+e.referencedColumn.propertyPath+"="+d+"."+e.propertyPath}).join(" AND ")):(p=i.inverseRelation.inverseJoinColumns.map(function(e){return d+"."+e.propertyPath+"="+u+"."+e.referencedColumn.propertyPath}).join(" AND "),m=i.inverseRelation.joinColumns.map(function(e){return a+"."+e.referencedColumn.propertyPath+"="+d+"."+e.propertyPath}).join(" AND "))," "+r.direction+" JOIN "+t(l)+" "+n(d)+" ON "+e.replacePropertyNames(p)+" "+r.direction+" JOIN "+t(o)+" "+n(a)+" ON "+e.replacePropertyNames(m+s)});if(!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var i=this.expressionMap.mainAlias.metadata;if(i.parentEntityMetadata&&"class-table"===i.parentEntityMetadata.inheritanceType&&i.parentIdColumns){var o="parentIdColumn_"+i.parentEntityMetadata.tableName,a=i.parentIdColumns.map(function(t){return e.expressionMap.mainAlias.name+"."+t.propertyPath+" = "+o+"."+t.referencedColumn.propertyPath}).join(" AND "),s=" JOIN "+t(i.parentEntityMetadata.tableName)+" "+n(o)+" ON "+this.replacePropertyNames(a);r.push(s)}}return r.join(" ")},e.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},e.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.orderBys;return!Object.keys(n).length&&this.expressionMap.mainAlias.hasMetadata&&(n=this.expressionMap.mainAlias.metadata.orderBy||{}),[Object.keys(n).map(function(n){var r=n.split("."),i=r[0],o=r[1],a=r.slice(2);return t.escapeAlias(e)+"."+t.escapeColumn(i+"_"+o+a.join("_"))}).join(", "),Object.keys(n).map(function(n){var r=n.split("."),i=r[0],o=r[1],a=r.slice(2);return t.escapeAlias(e)+"."+t.escapeColumn(i+"_"+o+a.join("_"))+" "+t.expressionMap.orderBys[n]}).join(", ")]},e.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return!Object.keys(t).length&&this.expressionMap.mainAlias.hasMetadata&&(t=this.expressionMap.mainAlias.metadata.orderBy||{}),Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(t){return e.replacePropertyNames(t)+" "+e.expressionMap.orderBys[t]}).join(", "):""},e.prototype.createLimitOffsetSpecificExpression=function(e){return(this.expressionMap.offset||this.expressionMap.limit)&&this.connection.driver instanceof E.OracleDriver&&(e="SELECT * FROM ("+e+") WHERE ",this.expressionMap.offset&&(e+=this.escapeAlias("RN")+" >= "+this.expressionMap.offset),this.expressionMap.limit&&(e+=(this.expressionMap.offset?" AND ":"")+this.escapeAlias("RN")+" <= "+((this.expressionMap.offset||0)+this.expressionMap.limit))),e},e.prototype.createLimitExpression=function(){return!this.expressionMap.limit||this.connection.driver instanceof E.OracleDriver?"":" LIMIT "+this.expressionMap.limit},e.prototype.createOffsetExpression=function(){return!this.expressionMap.offset||this.connection.driver instanceof E.OracleDriver?"":" OFFSET "+this.expressionMap.offset},e.prototype.createLockExpression=function(){switch(this.expressionMap.lockMode){case"pessimistic_read":if(this.connection.driver instanceof l.MysqlDriver)return" LOCK IN SHARE MODE";if(this.connection.driver instanceof c.PostgresDriver)return" FOR SHARE";if(this.connection.driver instanceof r.SqlServerDriver)return"";throw new d.LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(this.connection.driver instanceof l.MysqlDriver||this.connection.driver instanceof c.PostgresDriver)return" FOR UPDATE";if(this.connection.driver instanceof r.SqlServerDriver)return"";throw new d.LockNotSupportedOnGivenDriverError;default:return""}},e.prototype.createWhereIdsExpression=function(e){var t=this,n=this.expressionMap.mainAlias.metadata,r=function(e){return t.escapeAlias(e)},i=function(e){return t.escapeColumn(e)},o=this.expressionMap.mainAlias.name,a={},s=e.map(function(e,t){var s=[];return n.primaryColumns.forEach(function(n,u){s.push(r(o)+"."+i(n.databaseName)+"=:id_"+t+"_"+u),a["id_"+t+"_"+u]=n.getEntityValue(e)}),n.parentIdColumns.forEach(function(n,u){s.push(r(o)+"."+i(n.databaseName)+"=:parentId_"+t+"_"+u),a["parentId_"+t+"_"+u]=n.getEntityValue(e)}),s.join(" AND ")});return[s.length>1?"("+s.join(" OR ")+")":s[0],a]},e.prototype.getQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.queryRunnerProvider instanceof i.QueryRunnerProvider?[2,this.queryRunnerProvider.provide()]:[2,this.connection.driver.createQueryRunner()]})})},e.prototype.hasOwnQueryRunner=function(){return!this.queryRunnerProvider},e}(),e("QueryBuilder",_)}}}),System.register("typeorm/metadata-args/RelationIdMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationIdMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),e("RelationIdMetadata",n)}}}),System.register("typeorm/metadata/EmbeddedMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.columns=[],this.relations=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(),this.parentPropertyNames=this.buildParentPropertyNames(),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this},e.prototype.buildPrefix=function(){var e=[];return this.parentEmbeddedMetadata&&e.push(this.parentEmbeddedMetadata.buildPrefix()),void 0===this.customPrefix?e.push(this.propertyName):"string"==typeof this.customPrefix&&e.push(this.customPrefix),e.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e}(),e("EmbeddedMetadata",n)}}}),System.register("typeorm/decorator/options/RelationOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/PropertyTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/RelationMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=t.options.cascadeInsert||t.options.cascadeAll||!1,this.isCascadeUpdate=t.options.cascadeUpdate||t.options.cascadeAll||!1,this.isCascadeRemove=t.options.cascadeRemove||t.options.cascadeAll||!1,this.isNullable=!1!==t.options.nullable,this.onDelete=t.options.onDelete,this.isPrimary=t.options.primary||!1,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getEntityValue=function(e){if(this.embeddedMetadata){var t=this.embeddedMetadata.parentPropertyNames.slice(),n=function(e,t){
var r=e.shift();return r?n(e,t[r]):t},r=n(t,e);return r?r[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return e[this.isLazy?"__"+this.propertyName+"__":this.propertyName]},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var r=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),r(e,i[o.propertyName]),i):(i[n]=t,i)};return r(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[n]=t},e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(n,i){var o=n.shift();return o?(i[o]={},r(n,i[o]),i):(i[t.propertyName]=e,i)};return r(n,{})}return i={},i[this.propertyName]=e,i;var i},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(n=this.foreignKeys).push.apply(n,e),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner;var n},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),e("RelationMetadata",n)}}}),System.register("typeorm/metadata/types/TableTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e}(),n.REGULAR="regular",n.ABSTRACT="abstract",n.JUNCTION="junction",n.CLOSURE="closure",n.CLOSURE_JUNCTION="closure-junction",n.EMBEDDABLE="embeddable",n.SINGLE_TABLE_CHILD="single-table-child",n.CLASS_TABLE_CHILD="class-table-child",e("TableTypes",n)}}}),System.register("typeorm/metadata-args/TableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/EventListenerTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e}(),n.AFTER_LOAD="after-load",n.BEFORE_INSERT="before-insert",n.AFTER_INSERT="after-insert",n.BEFORE_UPDATE="before-update",n.AFTER_UPDATE="after-update",n.BEFORE_REMOVE="before-remove",n.AFTER_REMOVE="after-remove",e("EventListenerTypes",n)}}}),System.register("typeorm/metadata-args/EntityListenerMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityListenerMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this.propertyName=e.propertyName,this.type=e.type}return e.prototype.isAllowed=function(e){return this.target===e.constructor||this.target instanceof Function&&e.constructor.prototype instanceof this.target},e}(),e("EntityListenerMetadata",n)}}}),System.register("typeorm/metadata/EntityMetadata",["typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.childEntityMetadatas=[],this.tableType="regular",this.isJunction=!1,this.ownColumns=[],this.ownRelations=[],this.relations=[],this.columns=[],this.relationIds=[],this.relationCounts=[],this.indices=[],this.foreignKeys=[],this.embeddeds=[],this.listeners=[],this.primaryColumns=[],this.parentIdColumns=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[];var t=e.connection.driver.namingStrategy,n=e.connection.driver.options.tablesPrefix;this.lazyRelationsWrapper=e.connection.driver.lazyRelationsWrapper,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.target=e.args.target,this.tableType=e.args.type,this.engine=e.args.engine,this.givenTableName=e.args.name,this.skipSchemaSync=e.args.skipSchemaSync||!1,this.targetName=e.args.target instanceof Function?e.args.target.name:e.args.target,this.tableNameWithoutPrefix="closure-junction"===this.tableType?t.closureJunctionTableName(this.givenTableName):t.tableName(this.targetName,this.givenTableName),this.tableName=n?t.prefixTableName(n,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.isClassTableChild="class-table-child"===this.tableType,this.isSingleTableChild="single-table-child"===this.tableType,this.isEmbeddable="embeddable"===this.tableType,this.isJunction="closure-junction"===this.tableType||"junction"===this.tableType,this.isClosureJunction="closure-junction"===this.tableType,this.isClosure="closure"===this.tableType,this.isAbstract="abstract"===this.tableType,this.isRegular="regular"===this.tableType,this.orderBy=e.args.orderBy instanceof Function?e.args.orderBy(this.propertiesMap):e.args.orderBy}return e.prototype.create=function(){var e=this;if(this.target instanceof Function)return new this.target;var t={};return this.relations.filter(function(e){return e.isLazy}).forEach(function(n){return e.lazyRelationsWrapper.wrap(t,n)}),t},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n&&""!==n})},e.prototype.compareIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&n.OrmUtils.deepCompare(e,t)},e.prototype.compareEntities=function(e,t){var n=this.isEntityMapEmpty(e),r=this.isEntityMapEmpty(t);if(n||r)return!1;var i=this.getEntityIdMap(e),o=this.getEntityIdMap(t);return this.compareIds(i,o)},e.prototype.findRelationWithDbName=function(e){return this.relationsWithJoinColumns.find(function(t){return!!t.joinColumns.find(function(t){return t.databaseName===e})})},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.computePropertyPath=function(e){return"string"==typeof e?e:e(this.propertiesMap)},e.prototype.createEntityIdMap=function(e){return(this.parentEntityMetadata,this.primaryColumns).reduce(function(t,n,r){return Object.assign(t,n.createValueMap(e[r]))},{})},e.prototype.isEntityMapEmpty=function(e){return!(this.parentEntityMetadata,this.primaryColumns).every(function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n})},e.prototype.getEntityIdMap=function(e){if(e){var t=(this.parentEntityMetadata,this.primaryColumns),r=t.reduce(function(t,r){return r.isObjectId?Object.assign(t,r.getEntityValueMap(e)):n.OrmUtils.mergeDeep(t,r.getEntityValueMap(e))},{});return Object.keys(r).length>0?r:void 0}},e.prototype.getDatabaseEntityIdMap=function(e){var t={};return(this.parentEntityMetadata,this.primaryColumns).forEach(function(n){var r=n.getEntityValue(e);null!==r&&void 0!==r&&(t[n.databaseName]=r)}),Object.keys(t).every(function(e){return void 0!==t[e]&&null!==t[e]})?t:void 0},e.prototype.getEntityIdMixedMap=function(e){if(e){var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?t[this.primaryColumns[0].propertyName]:t}},e.prototype.checkIfObjectContainsAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){return e.hasOwnProperty(t.propertyName)})},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=[];return t.forEach(function(t){var r=t.getEntityValue(e);r instanceof Array?r.forEach(function(e){return n.push([t,e,t.inverseEntityMetadata])}):r&&n.push([t,r,t.inverseEntityMetadata])}),n},e.prototype.registerColumn=function(e){this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.parentIdColumns=this.columns.filter(function(e){return e.isParentId}),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.propertiesMap=this.createPropertiesMap()},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return n.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return n.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e}(),e("EntityMetadata",r)}}}),System.register("typeorm/decorator/options/ColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/types/ColumnMode",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/ColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ColumnMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isUnique=!1,this.isNullable=!1,this.comment="",this.timezone=!1,this.localTimezone=!1,this.fixedLength=!1,this.isVirtual=!1,this.isParentId=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isVersion=!1,this.isObjectId=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=String(e.args.options.length)),e.args.options.primary&&(this.isPrimary=e.args.options.primary),e.args.options.generated&&(this.isGenerated=e.args.options.generated),e.args.options.unique&&(this.isUnique=e.args.options.unique),e.args.options.nullable&&(this.isNullable=e.args.options.nullable),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.timezone&&(this.timezone=e.args.options.timezone),e.args.options.localTimezone&&(this.localTimezone=e.args.options.localTimezone),e.args.options.fixedLength&&(this.fixedLength=e.args.options.fixedLength),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isParentId="parentId"===e.args.mode,this.isDiscriminator="discriminator"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode)}return e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(n,i){var o=n.shift();return o?(i[o]={},r(n,i[o]),i):(i[t.propertyName]=e,i)};return r(n,{})}return i={},i[this.propertyName]=e,i;var i},e.prototype.getEntityValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,n,i){var o=e.shift();return o?(i[o]={},r(e,n?n[o]:void 0,i[o]),i):(i[t.propertyName]=n?n[t.propertyName]:void 0,i)};return r(n,e,{})}return i={},i[this.propertyName]=e[this.propertyName],i;var i},e.prototype.getEntityValue=function(e){if(!this.embeddedMetadata){if(this.relationMetadata&&this.referencedColumn&&this.isVirtual){var t=this.relationMetadata.getEntityValue(e);return t?this.referencedColumn.getEntityValue(t):void 0}return e[this.propertyName]}var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,t){var n=e.shift();return n?r(e,t[n]):t},i=r(n,e);if(i){if(this.relationMetadata&&this.referencedColumn&&this.isVirtual){var t=this.relationMetadata.getEntityValue(i);return t?this.referencedColumn.getEntityValue(t):void 0}return i[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var r=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),r(e,i[o.propertyName]),i):(i[n.propertyName]=t,i)};return r(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.databaseName=this.buildDatabaseName(e),this.databaseNameWithoutPrefixes=e.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+=this.referencedColumn.propertyName+"."),e+this.propertyName},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPropertyNames:[];return e.columnName(this.propertyName,this.givenDatabaseName,t)},e}(),e("ColumnMetadata",n)}}}),System.register("typeorm/schema-builder/schema/ColumnSchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,e&&(this.name=e.name||"",this.type=e.type||"",this.default=e.default,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.comment=e.comment)}return e.prototype.clone=function(){var t=new e;return t.name=this.name,t.type=this.type,t.default=this.default,t.isNullable=this.isNullable,t.isGenerated=this.isGenerated,t.isPrimary=this.isPrimary,t.isUnique=this.isUnique,t.comment=this.comment,t},e.create=function(t,n){var r=new e;return r.name=t.databaseName,r.default=t.default,r.comment=t.comment,r.isGenerated=t.isGenerated,r.isNullable=t.isNullable,r.type=n,r.isPrimary=t.isPrimary,r.isUnique=t.isUnique,r},e}(),e("ColumnSchema",n)}}}),System.register("typeorm/query-runner/QueryRunner",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/Driver",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindOneOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindManyOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/DeepPartial",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/SaveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/RemoveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/ObjectType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerProviderAlreadyReleasedError",t.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("QueryRunnerProviderAlreadyReleasedError",n)}}}),System.register("typeorm/persistence/Subject",["typeorm/metadata/types/ColumnTypes","typeorm/util/DataTransformationUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e,t,n){this.date=new Date,this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.diffColumns=[],this.diffRelations=[],this.relationUpdates=[],this.junctionInserts=[],this.junctionRemoves=[],this.metadata=e,this._persistEntity=t,this._databaseEntity=n}return Object.defineProperty(e.prototype,"entity",{get:function(){if(!this._persistEntity)throw new Error("Persistence entity is not set for the given subject.");return this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasEntity",{get:function(){return!!this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"databaseEntity",{get:function(){if(!this._databaseEntity)throw new Error("Database entity is not set for the given subject.");return this._databaseEntity},set:function(e){this._databaseEntity=e,this.recompute()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDatabaseEntity",{get:function(){return!!this._databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityTarget",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.hasDatabaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&(this.diffColumns.length>0||this.diffRelations.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRelationUpdates",{get:function(){return this.relationUpdates.length>0},enumerable:!0,configurable:!0}),e.prototype.validate=function(){if(this.mustBeInserted&&this.mustBeRemoved)throw new Error("Removed entity "+this.metadata.name+" is also scheduled for insert operation. This looks like ORM problem. Please report a github issue.");if(this.mustBeUpdated&&this.mustBeRemoved)throw new Error('Removed entity "'+this.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).');if(this.mustBeInserted&&this.mustBeUpdated)throw new Error("Inserted entity "+this.metadata.name+" is also scheduled for updated operation. This looks like ORM problem. Please report a github issue.")},e.prototype.recompute=function(){this.hasEntity&&this._databaseEntity&&(this.computeDiffColumns(),this.computeDiffRelationalColumns())},e.prototype.computeDiffColumns=function(){var e=this;this.diffColumns=this.metadata.columns.filter(function(t){var i=t.getEntityValue(e.entity),o=t.getEntityValue(e.databaseEntity);if(void 0===i)return!1;if(null!==i&&void 0!==i&&(t.type===n.ColumnTypes.DATE?i=r.DataTransformationUtils.mixedDateToDateString(i):t.type===n.ColumnTypes.TIME?i=r.DataTransformationUtils.mixedDateToTimeString(i):t.type===n.ColumnTypes.DATETIME?(i=r.DataTransformationUtils.mixedDateToUtcDatetimeString(i),o=r.DataTransformationUtils.mixedDateToUtcDatetimeString(o)):t.type===n.ColumnTypes.JSON?(i=JSON.stringify(i),null!==o&&void 0!==o&&(o=JSON.stringify(o))):t.type===n.ColumnTypes.SIMPLE_ARRAY&&(i=r.DataTransformationUtils.simpleArrayToString(i),o=r.DataTransformationUtils.simpleArrayToString(o))),t.isVirtual||t.isParentId||t.isDiscriminator||t.isUpdateDate||t.isVersion||t.isCreateDate||i===o)return!1;var a=e.metadata.findRelationWithDbName(t.databaseName);if(a){var s=a.getEntityValue(e.entity);if(null!==s&&void 0!==s)return!1}return!0})},e.prototype.computeDiffRelationalColumns=function(){var e=this;this.diffRelations=this.metadata.relations.filter(function(t){if(!(t.isManyToOne||t.isOneToOne&&t.isOwning))return!1;var n=t.getEntityValue(e.entity),r=n instanceof Object?t.inverseEntityMetadata.getEntityIdMixedMap(n):n,i=t.getEntityValue(e.databaseEntity);return void 0!==r&&((void 0!==r&&null!==r||void 0!==i&&null!==i)&&r!==i)})},e}(),e("Subject",i)}}}),System.register("typeorm/repository/SpecificRepository",["typeorm/query-runner/QueryRunnerProvider","typeorm/persistence/Subject","typeorm/metadata/RelationMetadata","typeorm/query-builder/QueryBuilder","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e,t,n){this.connection=e,this.metadata=t,this.queryRunnerProvider=n}return e.prototype.setRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:if(i=this.metadata.computePropertyPath(e),!(o=this.metadata.findRelationWithPropertyPath(i)))throw new Error("Relation with property path "+i+" in entity was not found.");if(o.isManyToMany)throw new Error("Many-to-many relation is not supported for this operation. Use #addToRelation method for many-to-many relations.");return s={},u={},o.isOwning?(a=o.entityMetadata.tableName,s[o.joinColumns[0].referencedColumn.databaseName]=r,u[o.joinColumns[0].referencedColumn.databaseName]=t):(a=o.inverseEntityMetadata.tableName,s[o.inverseRelation.joinColumns[0].referencedColumn.databaseName]=r,u[o.inverseRelation.joinColumns[0].referencedColumn.databaseName]=t),c=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,c.provide()];case 1:return l=d.sent(),[4,l.update(a,s,u)];case 2:return d.sent(),this.queryRunnerProvider?[3,4]:[4,c.release(l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},e.prototype.setInverseRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:if(i=this.metadata.computePropertyPath(e),!(o=this.metadata.findRelationWithPropertyPath(i)))throw new Error("Relation with property path "+i+" in entity was not found.");if(o.isManyToMany)throw new Error("Many-to-many relation is not supported for this operation. Use #addToRelation method for many-to-many relations.");return s={},u={},o.isOwning?(a=o.inverseEntityMetadata.tableName,s[o.inverseRelation.joinColumns[0].databaseName]=t,u[o.inverseRelation.joinColumns[0].referencedColumn.databaseName]=r):(a=o.entityMetadata.tableName,s[o.joinColumns[0].databaseName]=t,u[o.joinColumns[0].referencedColumn.databaseName]=r),c=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,c.provide()];case 1:return l=d.sent(),[4,l.update(a,s,u)];case 2:return d.sent(),this.queryRunnerProvider?[3,4]:[4,c.release(l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},e.prototype.addToRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(i=this.metadata.computePropertyPath(e),!(o=this.metadata.findRelationWithPropertyPath(i)))throw new Error("Relation with property path "+i+" in entity was not found.");if(!o.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+i+" relation type is "+o.relationType);return a=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,a.provide()];case 1:return s=c.sent(),u=r.map(function(e){var n={};return o.isOwning?(n[o.junctionEntityMetadata.columns[0].databaseName]=t,n[o.junctionEntityMetadata.columns[1].databaseName]=e):(n[o.junctionEntityMetadata.columns[1].databaseName]=t,n[o.junctionEntityMetadata.columns[0].databaseName]=e),s.insert(o.junctionEntityMetadata.tableName,n)}),[4,Promise.all(u)];case 2:return c.sent(),this.queryRunnerProvider?[3,4]:[4,a.release(s)];case 3:c.sent(),c.label=4;case 4:return[2]}})})},e.prototype.addToInverseRelation=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(i=this.metadata.computePropertyPath(e),!(o=this.metadata.findRelationWithPropertyPath(i)))throw new Error("Relation with property path "+i+" in entity was not found.");if(!o.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+i+" relation type is "+o.relationType);return a=this.queryRunnerProvider?this.queryRunnerProvider:new n.QueryRunnerProvider(this.connection.driver),[4,a.provide()];case 1:s=c.sent(),c.label=2;case 2:return c.trys.push([2,,4,7]),u=r.map(function(e){var n={};return o.isOwning?(n[o.junctionEntityMetadata.columns[0].databaseName]=e,n[o.junctionEntityMetadata.columns[1].databaseName]=t):(n[o.junctionEntityMetadata.columns[1].databaseName]=e,n[o.junctionEntityMetadata.columns[0].databaseName]=t),s.insert(o.junctionEntityMetadata.tableName,n)}),[4,Promise.all(u)];case 3:return c.sent(),[3,7];case 4:return this.queryRunnerProvider?[3,6]:[4,a.release(s)];case 5:c.sent(),c.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.removeFromRelation=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(r=this.metadata.computePropertyPath(e),!(i=this.metadata.findRelationWithPropertyPath(r)))throw new Error("Relation with property path "+r+" in entity was not found.");if(!i.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+r+" relation type is "+i.relationType);return n&&n.length?(a=new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().fromTable(i.junctionEntityMetadata.tableName,"junctionEntity"),s=this.connection.driver.escapeColumnName(i.isOwning?i.junctionEntityMetadata.columns[0].databaseName:i.junctionEntityMetadata.columns[1].databaseName),u=this.connection.driver.escapeColumnName(i.isOwning?i.junctionEntityMetadata.columns[1].databaseName:i.junctionEntityMetadata.columns[0].databaseName),n.forEach(function(e,t){a.orWhere("("+s+"=:entityId AND "+u+"=:relatedEntity_"+t+")").setParameter("relatedEntity_"+t,e)}),[4,a.setParameter("entityId",t).execute()]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})},e.prototype.removeFromInverseRelation=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(r=this.metadata.computePropertyPath(e),!(i=this.metadata.findRelationWithPropertyPath(r)))throw new Error("Relation with property path "+r+" in entity was not found.");if(!i.isManyToMany)throw new Error("Only many-to-many relation supported for this operation. However "+this.metadata.name+"#"+r+" relation type is "+i.relationType);return n&&n.length?(a=new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().from(i.junctionEntityMetadata.tableName,"junctionEntity"),s=i.isOwning?i.junctionEntityMetadata.columns[1].databaseName:i.junctionEntityMetadata.columns[0].databaseName,u=i.isOwning?i.junctionEntityMetadata.columns[0].databaseName:i.junctionEntityMetadata.columns[1].databaseName,n.forEach(function(e,t){a.orWhere("("+s+"=:relatedEntityId AND "+u+"=:entity_"+t+")").setParameter("entity_"+t,e)}),[4,a.setParameter("relatedEntityId",t).execute()]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})},e.prototype.addAndRemoveFromRelation=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.addToRelation(e,t,n),this.removeFromRelation(e,t,r)])];case 1:return i.sent(),[2]}})})},e.prototype.addAndRemoveFromInverseRelation=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.addToInverseRelation(e,t,n),this.removeFromInverseRelation(e,t,r)])];case 1:return i.sent(),[2]}})})},e.prototype.removeById=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t=this.metadata.tableName,n={},r="",this.metadata.hasMultiplePrimaryKeys?r=this.metadata.primaryColumns.map(function(r){return n[r.propertyName]=e[r.propertyName],t+"."+r.propertyName+"=:"+r.propertyName}).join(" AND "):(r=t+"."+this.metadata.primaryColumns[0].propertyName+"=:id",n.id=e),[4,new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().from(this.metadata.target,t).where(r,n).execute()];case 1:return i.sent(),[2]}})})},e.prototype.removeByIds=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return t=this.metadata.tableName,n={},r="",this.metadata.hasMultiplePrimaryKeys?r=e.map(function(e,r){i.metadata.primaryColumns.map(function(i){return n[i.propertyName+"_"+r]=e[i.propertyName],t+"."+i.propertyName+"=:"+i.propertyName+"_"+r}).join(" AND ")}).join(" OR "):(r=t+"."+this.metadata.primaryColumns[0].propertyName+" IN (:ids)",n.ids=e),[4,new o.QueryBuilder(this.connection,this.queryRunnerProvider).delete().from(this.metadata.target,t).where(r,n).execute()];case 1:return a.sent(),[2]}})})},e.prototype.findRelationIds=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var n,r,i,s,u,c,l,d,p,m,f=this;return __generator(this,function(y){switch(y.label){case 0:return n=this.convertMixedRelationToMetadata(e),(t instanceof Array||(t=[t]),r=n.isOwning?n.joinColumns.map(function(e){return e.referencedColumn}):n.inverseRelation.inverseJoinColumns.map(function(e){return e.referencedColumn}),i=n.isOwning?n.joinColumns:n.inverseRelation.inverseJoinColumns,s=n.isOwning?n.inverseJoinColumns:n.inverseRelation.joinColumns,u=n.isOwning?n.inverseJoinColumns.map(function(e){return e.databaseName}):n.inverseRelation.joinColumns.map(function(e){return e.databaseName}),c=this.convertEntityOrEntitiesToIdOrIds(r,t),c instanceof Array||(c=[c]),c=c.filter(function(e){return null!==e&&void 0!==e}),0===c.length)?[2,[]]:(l=function(e){return f.connection.driver.escapeAliasName(e)},d=function(e){return f.connection.driver.escapeColumnName(e)},p=[],m=c.map(function(e){var t=new o.QueryBuilder(f.connection,f.queryRunnerProvider);return u.forEach(function(e){t.select(l("junction")+"."+d(e)+" AS "+l(e))}),t.fromTable(n.junctionEntityMetadata.tableName,"junction"),Object.keys(e).forEach(function(n){var r=i.find(function(e){return e.referencedColumn.databaseName===n});t.andWhere(l("junction")+"."+d(r.databaseName)+"=:"+r.databaseName+"_entityId",(o={},o[r.databaseName+"_entityId"]=e[n],o));var o}),t.getRawMany().then(function(e){e.forEach(function(e){p.push(Object.keys(e).reduce(function(t,n){var r=s.find(function(e){return e.databaseName===n});return a.OrmUtils.mergeDeep(t,r.referencedColumn.createValueMap(e[n])),t},{}))})})}),[4,Promise.all(m)]);case 1:return y.sent(),[2,p]}})})},e.prototype.convertEntityOrEntitiesToIdOrIds=function(e,t){var n=this;return t instanceof Array?t.map(function(t){return n.convertEntityOrEntitiesToIdOrIds(e,t)}):t instanceof Object?e.reduce(function(e,n){
return e[n.databaseName]=n.getEntityValue(t),e},{}):t},e.prototype.convertMixedRelationToMetadata=function(e){if(e instanceof i.RelationMetadata)return e;var t=e instanceof Function?e(this.metadata.propertiesMap):e,n=this.metadata.findRelationWithPropertyPath(t);if(!n)throw new Error("Relation with property path "+t+" in entity was not found.");return n},e.prototype.extractObjectsById=function(e,t,n){var i=this;void 0===n&&(n=[]);var o=t.relations.map(function(t){var r=t.inverseEntityMetadata,o=t.getEntityValue(e);if(o){if(o instanceof Array){var a=o.map(function(e){return i.extractObjectsById(e,r,n)});return Promise.all(a)}return i.extractObjectsById(o,r,n)}});return Promise.all(o.filter(function(e){return!!e})).then(function(){if(!n.find(function(t){return t.entity===e})){var i=new r.Subject(t,e);n.push(i)}return n})},e}(),e("SpecificRepository",s)}}}),System.register("typeorm/repository/TreeRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findTrees=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.findDescendantsTree(e)];case 1:return t.sent(),[2]}})})}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this.metadata.treeParentRelation.propertyName;return this.createQueryBuilder("treeEntity").where("treeEntity."+e+" IS NULL").getMany()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escapeAliasName(e)},o=function(e){return r.manager.connection.driver.escapeColumnName(e)},a=i(e)+"."+o(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+o("descendant");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+"."+o("ancestor")+"="+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getEntitiesAndRawResults().then(function(n){var r=t.createRelationMaps("treeEntity",n.rawResults);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escapeAliasName(e)},o=function(e){return r.manager.connection.driver.escapeColumnName(e)},a=i(e)+"."+o(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+o("ancestor");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+"."+o("descendant")+"="+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getEntitiesAndRawResults().then(function(n){var r=t.createRelationMaps("treeEntity",n.rawResults);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){return{id:t[e+"_"+n.metadata.primaryColumns[0].databaseName],parentId:t[e+"_"+n.metadata.treeParentRelation.joinColumns[0].referencedColumn.databaseName]}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.filter(function(e){return e.parentId===o}),s=a.map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==s.indexOf(r.metadata.primaryColumns[0].getEntityValue(e))}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.find(function(e){return e.id===o}),s=t.find(function(e){return!!a&&e[r.metadata.primaryColumns[0].propertyName]===a.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(n.Repository),e("TreeRepository",r)}}}),System.register("typeorm/driver/mongodb/typings",["events","stream"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoQueryRunner",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n}return e.prototype.cursor=function(e,t){return this.getCollection(e).find(t||{})},e.prototype.aggregate=function(e,t,n){return this.getCollection(e).aggregate(t,n)},e.prototype.bulkWrite=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).bulkWrite(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.count=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).count(t||{},n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).createIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndexes=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).createIndexes(t)];case 1:return[2,n.sent()]}})})},e.prototype.deleteMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.deleteOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.distinct=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).distinct(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.dropCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).dropIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.dropCollectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).dropIndexes()];case 1:return[2,t.sent()]}})})},e.prototype.findOneAndDelete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).findOneAndDelete(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.findOneAndReplace=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndReplace(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.findOneAndUpdate=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndUpdate(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoHaystackSearch=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoHaystackSearch(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoNear=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoNear(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.group=function(e,t,n,r,i,o,a,s){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(u){switch(u.label){case 0:return[4,this.getCollection(e).group(t,n,r,i,o,a,s)];case 1:return[2,u.sent()]}})})},e.prototype.collectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).indexes()];case 1:return[2,t.sent()]}})})},e.prototype.collectionIndexExists=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexExists(t)];case 1:return[2,n.sent()]}})})},e.prototype.collectionIndexInformation=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexInformation(t)];case 1:return[2,n.sent()]}})})},e.prototype.initializeOrderedBulkOp=function(e,t){return this.getCollection(e).initializeOrderedBulkOp(t)},e.prototype.initializeUnorderedBulkOp=function(e,t){return this.getCollection(e).initializeUnorderedBulkOp(t)},e.prototype.insertMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.insertOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.isCapped=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).isCapped()];case 1:return[2,t.sent()]}})})},e.prototype.listCollectionIndexes=function(e,t){return this.getCollection(e).listIndexes(t)},e.prototype.mapReduce=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).mapReduce(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.parallelCollectionScan=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).parallelCollectionScan(t)];case 1:return[2,n.sent()]}})})},e.prototype.reIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).reIndex()];case 1:return[2,t.sent()]}})})},e.prototype.rename=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).rename(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.replaceOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).replaceOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.stats=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).stats(t)];case 1:return[2,n.sent()]}})})},e.prototype.updateMany=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateMany(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.updateOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.connection.dropDatabase()];case 1:return e.sent(),[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){throw new Error("Executing SQL query is not supported by MongoDB driver.")},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.connection.collection(e).insertOne(t)];case 1:return n=r.sent(),[2,n.insertedId]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.connection.collection(e).updateOne(n,t)];case 1:return r.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:if("string"==typeof t)throw new Error("String condition is not supported by MongoDB driver.");return[4,this.databaseConnection.connection.collection(e).deleteOne(t)];case 1:return n.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.normalizeType=function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")},e.prototype.compareDefaultValues=function(e,t){throw new Error("Schema update queries are not supported by MongoDB driver.")},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.databaseConnection.connection.dropCollection(e)];case 1:return t.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.getCollection=function(e){return this.databaseConnection.connection.collection(e)},e}(),e("MongoQueryRunner",n)}}}),System.register("typeorm/driver/mongodb/MongoDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/mongodb/MongoQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e,t,n){this.validateOptions(e),n||(n=this.loadDependencies()),this.options=e,this.logger=t,this.mongodb=n}return e.prototype.connect=function(){var e=this;return new Promise(function(t,n){e.mongodb.MongoClient.connect(e.buildConnectionUrl(),e.options.extra,function(r,o){if(r)return n(r);e.pool=o;var a={id:1,connection:e.pool,isTransactionActive:!1};e.queryRunner=new i.MongoQueryRunner(a,e,e.logger),t()})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(!this.pool)throw new n.ConnectionIsNotSetError("mongodb");return[2,new Promise(function(t,n){var r=function(e){return e?n(e):t()};e.pool.close(r),e.pool=void 0})]})})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.pool?[2,this.queryRunner]:[2,Promise.reject(new n.ConnectionIsNotSetError("mongodb"))]})})},e.prototype.nativeInterface=function(){return{driver:this.mongodb,connection:this.pool}},e.prototype.escapeQueryWithParameters=function(e,t){throw new Error("This operation is not supported by Mongodb driver.")},e.prototype.escapeColumnName=function(e){return e},e.prototype.escapeAliasName=function(e){return e},e.prototype.escapeTableName=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?null:(t.type,e)},e.prototype.prepareHydratedValue=function(e,t){return t.type,e},e.prototype.syncSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.createQueryRunner()];case 1:return t=r.sent(),n=[],[4,Promise.all(e.map(function(e){e.indices.forEach(function(r){var i={name:r.name};n.push(t.createCollectionIndex(e.tableName,r.columnNamesWithOrderingMap,i))})}))];case 2:return r.sent(),[4,Promise.all(n)];case 3:return r.sent(),[2]}})})},e.prototype.validateOptions=function(e){if(!e.url&&!e.database)throw new o.DriverOptionNotSetError("database")},e.prototype.loadDependencies=function(){try{return a.PlatformTools.load("mongodb")}catch(e){throw new r.DriverPackageNotInstalledError("MongoDB","mongodb")}},e.prototype.buildConnectionUrl=function(){return this.options.url?this.options.url:"mongodb://"+(this.options.host||"127.0.0.1")+":"+(this.options.port||"27017")+"/"+this.options.database},e}(),e("MongoDriver",s)}}}),System.register("typeorm/query-builder/transformer/DocumentToEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){void 0===e&&(e=!1),this.enableRelationIdValues=e}return e.prototype.transformAll=function(e,t){var n=this;return e.map(function(e){return n.transform(e,t)})},e.prototype.transform=function(e,t){var n=t.create(),r=!1;t.objectIdColumn&&e[t.objectIdColumn.databaseNameWithoutPrefixes]&&(n[t.objectIdColumn.propertyName]=e[t.objectIdColumn.databaseNameWithoutPrefixes],r=!0),this.enableRelationIdValues&&t.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0!==i&&null!==i&&t.propertyName&&(n[t.propertyName]=i,r=!0)}),t.ownColumns.forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0===i||null===i||!t.propertyName||t.isVirtual||t.isParentId||t.isDiscriminator||(n[t.propertyName]=i,r=!0)});var i=function(e,t,n){n.forEach(function(n){t[n.prefix]&&(n.isArray?e[n.propertyName]=t[n.prefix].map(function(e){var t=n.create();return n.columns.forEach(function(n){t[n.propertyName]=e[n.databaseNameWithoutPrefixes]}),t}):n.columns.forEach(function(r){var i=t[n.prefix][r.databaseNameWithoutPrefixes];i&&(e[n.propertyName]||(e[n.propertyName]=n.create()),e[n.propertyName][r.propertyName]=i)}),i(e[n.propertyName],t[n.prefix],n.embeddeds))})};return i(n,e,t.embeddeds),r?n:null},e}(),e("DocumentToEntityTransformer",n)}}}),System.register("typeorm/find-options/FindOptionsUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.where instanceof Object||t.join instanceof Object||t.order instanceof Object)},e.isFindManyOptions=function(e){var t=e;return t&&(t.where instanceof Object||t.join instanceof Object||t.order instanceof Object||"number"==typeof t.skip||"number"==typeof t.take)},e.extractFindOneOptionsAlias=function(e){if(this.isFindOneOptions(e)&&e.join)return e.join.alias},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindOneOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindOneOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?this.applyConditions(e,t):e},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?this.applyConditions(e,t):e},e.applyOptionsToQueryBuilder=function(e,t){return t&&this.isFindOneOptions(t)?(t.where&&this.applyConditions(e,t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(n){e.addOrderBy(e.alias+"."+n,t.order[n])}),t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),e):e},e.applyConditions=function(e,t){return Object.keys(t).forEach(function(n,r){if(null===t[n])e.andWhere(e.alias+"."+n+" IS NULL");else{var i="where_"+r;e.andWhere(e.alias+"."+n+"=:"+i).setParameter(i,t[n])}}),e},e}(),e("FindOptionsUtils",n)}}}),System.register("typeorm/entity-manager/MongoEntityManager",["typeorm/entity-manager/EntityManager","typeorm/query-builder/transformer/DocumentToEntityTransformer","typeorm/find-options/FindOptionsUtils"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.transaction=function(e){throw new Error("Transactions aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t,n){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.find=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=o.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[2,r.toArray()]}})})},t.prototype.findAndCount=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=u.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[4,Promise.all([r.toArray(),this.count(e,n)])];case 2:return o=u.sent(),a=o[0],s=o[1],[2,[a,parseInt(s)]]}})})},t.prototype.findByIds=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=this.connection.getMetadata(e),o=this.convertFindManyOptionsOrConditionsToMongodbQuery(n)||{},a=require("mongodb").ObjectID,o._id={$in:t.map(function(e){return e instanceof a?e:e[r.objectIdColumn.propertyName]})},[4,this.createEntityCursor(e,o)];case 1:return s=u.sent(),i.FindOptionsUtils.isFindManyOptions(n)&&(n.skip&&s.skip(n.skip),n.take&&s.limit(n.take),n.order&&s.sort(this.convertFindOptionsOrderToOrderCriteria(n.order))),[4,s.toArray()];case 2:return[2,u.sent()]}})})},t.prototype.findOne=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:return n=this.convertFindOneOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=a.sent(),i.FindOptionsUtils.isFindOneOptions(t)&&t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order)),[4,r.limit(1).toArray()];case 2:return o=a.sent(),[2,o.length>0?o[0]:void 0]}})})},t.prototype.findOneById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:return r=this.convertFindOneOptionsOrConditionsToMongodbQuery(n)||{},r._id=t,[4,this.createEntityCursor(e,r)];case 1:return o=s.sent(),i.FindOptionsUtils.isFindOneOptions(n)&&n.order&&o.sort(this.convertFindOptionsOrderToOrderCriteria(n.order)),[4,o.limit(1).toArray()];case 2:return a=s.sent(),[2,a.length>0?a[0]:void 0]}})})},t.prototype.createCursor=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.cursor(n.tableName,t)},t.prototype.createEntityCursor=function(e,t){var n=this.connection.getMetadata(e),i=this.createCursor(e,t),o=require("mongodb").Cursor;return i.toArray=function(e){if(!e)return o.prototype.toArray.call(this).then(function(e){return(new r.DocumentToEntityTransformer).transformAll(e,n)});o.prototype.toArray.call(this,function(t,i){if(t)return void e(t,i);var o=new r.DocumentToEntityTransformer;return e(t,o.transformAll(i,n))})},i.next=function(e){if(!e)return o.prototype.next.call(this).then(function(e){return e?(new r.DocumentToEntityTransformer).transform(e,n):e});o.prototype.next.call(this,function(t,i){if(t||!i)return void e(t,i);var o=new r.DocumentToEntityTransformer;return e(t,o.transform(i,n))})},i},t.prototype.aggregate=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.aggregate(r.tableName,t,n)},t.prototype.bulkWrite=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.bulkWrite(r.tableName,t,n)},t.prototype.count=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.count(r.tableName,t,n)},t.prototype.createCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndex(r.tableName,t,n)},t.prototype.createCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndexes(n.tableName,t)},t.prototype.deleteMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteMany(r.tableName,t,n)},t.prototype.deleteOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteOne(r.tableName,t,n)},t.prototype.distinct=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.distinct(i.tableName,t,n,r)},t.prototype.dropCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndex(r.tableName,t,n)},t.prototype.dropCollectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndexes(t.tableName)},t.prototype.findOneAndDelete=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.findOneAndDelete(r.tableName,t,n)},t.prototype.findOneAndReplace=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndReplace(i.tableName,t,n,r)},t.prototype.findOneAndUpdate=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndUpdate(i.tableName,t,n,r)},t.prototype.geoHaystackSearch=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoHaystackSearch(i.tableName,t,n,r)},t.prototype.geoNear=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoNear(i.tableName,t,n,r)},t.prototype.group=function(e,t,n,r,i,o,a,s){var u=this.connection.getMetadata(e);return this.queryRunner.group(u.tableName,t,n,r,i,o,a,s)},
t.prototype.collectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.collectionIndexes(t.tableName)},t.prototype.collectionIndexExists=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexExists(n.tableName,t)},t.prototype.collectionIndexInformation=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexInformation(n.tableName,t)},t.prototype.initializeOrderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeOrderedBulkOp(n.tableName,t)},t.prototype.initializeUnorderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeUnorderedBulkOp(n.tableName,t)},t.prototype.insertMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertMany(r.tableName,t,n)},t.prototype.insertOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertOne(r.tableName,t,n)},t.prototype.isCapped=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.isCapped(t.tableName)},t.prototype.listCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.listCollectionIndexes(n.tableName,t)},t.prototype.mapReduce=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.mapReduce(i.tableName,t,n,r)},t.prototype.parallelCollectionScan=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.parallelCollectionScan(n.tableName,t)},t.prototype.reIndex=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.reIndex(t.tableName)},t.prototype.rename=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.rename(r.tableName,t,n)},t.prototype.replaceOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.replaceOne(i.tableName,t,n,r)},t.prototype.stats=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.stats(n.tableName,t)},t.prototype.updateMany=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateMany(i.tableName,t,n,r)},t.prototype.updateOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateOne(i.tableName,t,n,r)},Object.defineProperty(t.prototype,"queryRunner",{get:function(){return this.connection.driver.queryRunner},enumerable:!0,configurable:!0}),t.prototype.convertFindManyOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindManyOptions(e)?e.where:e},t.prototype.convertFindOneOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindOneOptions(e)?e.where:e},t.prototype.convertFindOptionsOrderToOrderCriteria=function(e){var t={};return Object.keys(e).forEach(function(n){return t[n]=[n,e[n].toLowerCase()]}),t},t}(n.EntityManager),e("MongoEntityManager",o)}}}),System.register("typeorm/repository/MongoRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},t.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},t.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},t.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},t.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},t.prototype.createCursor=function(e){return this.manager.createCursor(this.metadata.target,e)},t.prototype.createEntityCursor=function(e){return this.manager.createEntityCursor(this.metadata.target,e)},t.prototype.aggregate=function(e,t){return this.manager.aggregate(this.metadata.target,e,t)},t.prototype.bulkWrite=function(e,t){return this.manager.bulkWrite(this.metadata.target,e,t)},t.prototype.count=function(e,t){return this.manager.count(this.metadata.target,e||{},t)},t.prototype.createCollectionIndex=function(e,t){return this.manager.createCollectionIndex(this.metadata.target,e,t)},t.prototype.createCollectionIndexes=function(e){return this.manager.createCollectionIndexes(this.metadata.target,e)},t.prototype.deleteMany=function(e,t){return this.manager.deleteMany(this.metadata.tableName,e,t)},t.prototype.deleteOne=function(e,t){return this.manager.deleteOne(this.metadata.tableName,e,t)},t.prototype.distinct=function(e,t,n){return this.manager.distinct(this.metadata.tableName,e,t,n)},t.prototype.dropCollectionIndex=function(e,t){return this.manager.dropCollectionIndex(this.metadata.tableName,e,t)},t.prototype.dropCollectionIndexes=function(){return this.manager.dropCollectionIndexes(this.metadata.tableName)},t.prototype.findOneAndDelete=function(e,t){return this.manager.findOneAndDelete(this.metadata.tableName,e,t)},t.prototype.findOneAndReplace=function(e,t,n){return this.manager.findOneAndReplace(this.metadata.tableName,e,t,n)},t.prototype.findOneAndUpdate=function(e,t,n){return this.manager.findOneAndUpdate(this.metadata.tableName,e,t,n)},t.prototype.geoHaystackSearch=function(e,t,n){return this.manager.geoHaystackSearch(this.metadata.tableName,e,t,n)},t.prototype.geoNear=function(e,t,n){return this.manager.geoNear(this.metadata.tableName,e,t,n)},t.prototype.group=function(e,t,n,r,i,o,a){return this.manager.group(this.metadata.tableName,e,t,n,r,i,o,a)},t.prototype.collectionIndexes=function(){return this.manager.collectionIndexes(this.metadata.tableName)},t.prototype.collectionIndexExists=function(e){return this.manager.collectionIndexExists(this.metadata.tableName,e)},t.prototype.collectionIndexInformation=function(e){return this.manager.collectionIndexInformation(this.metadata.tableName,e)},t.prototype.initializeOrderedBulkOp=function(e){return this.manager.initializeOrderedBulkOp(this.metadata.tableName,e)},t.prototype.initializeUnorderedBulkOp=function(e){return this.manager.initializeUnorderedBulkOp(this.metadata.tableName,e)},t.prototype.insertMany=function(e,t){return this.manager.insertMany(this.metadata.tableName,e,t)},t.prototype.insertOne=function(e,t){return this.manager.insertOne(this.metadata.tableName,e,t)},t.prototype.isCapped=function(){return this.manager.isCapped(this.metadata.tableName)},t.prototype.listCollectionIndexes=function(e){return this.manager.listCollectionIndexes(this.metadata.tableName,e)},t.prototype.mapReduce=function(e,t,n){return this.manager.mapReduce(this.metadata.tableName,e,t,n)},t.prototype.parallelCollectionScan=function(e){return this.manager.parallelCollectionScan(this.metadata.tableName,e)},t.prototype.reIndex=function(){return this.manager.reIndex(this.metadata.tableName)},t.prototype.rename=function(e,t){return this.manager.rename(this.metadata.tableName,e,t)},t.prototype.replaceOne=function(e,t,n){return this.manager.replaceOne(this.metadata.tableName,e,t,n)},t.prototype.stats=function(e){return this.manager.stats(this.metadata.tableName,e)},t.prototype.updateMany=function(e,t,n){return this.manager.updateMany(this.metadata.tableName,e,t,n)},t.prototype.updateOne=function(e,t,n){return this.manager.updateOne(this.metadata.tableName,e,t,n)},t}(n.Repository),e("MongoRepository",r)}}}),System.register("typeorm/repository/RepositoryFactory",["typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/repository/SpecificRepository","typeorm/driver/mongodb/MongoDriver","typeorm/repository/MongoRepository"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.createRepository=function(e,t,n){var i;return i=e.connection.driver instanceof o.MongoDriver?new a.MongoRepository:new r.Repository,i.manager=e,i.metadata=t,i.queryRunnerProvider=n,i},e.prototype.createTreeRepository=function(e,t,r){var i=new n.TreeRepository;return i.manager=e,i.metadata=t,i.queryRunnerProvider=r,i},e.prototype.createSpecificRepository=function(e,t,n){return new i.SpecificRepository(e,t,n)},e}(),e("RepositoryFactory",s)}}}),System.register("typeorm/container",[],function(e,t){"use strict";function n(e,t){o=e,a=t}function r(e){if(o)try{var t=o.get(e);if(t)return t;if(!a||!a.fallback)return t}catch(e){if(!a||!a.fallbackOnErrors)throw e}return i.get(e)}t&&t.id;e("useContainer",n),e("getFromContainer",r);var i,o,a;return{setters:[],execute:function(){e("defaultContainer",i=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}()))}}}),System.register("typeorm/repository/RepositoryAggregator",["typeorm/repository/RepositoryFactory","typeorm/container"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e,t,i){this.metadata=t;var o=r.getFromContainer(n.RepositoryFactory);t.isClosure?this.repository=this.treeRepository=o.createTreeRepository(e.manager,t,i):this.repository=o.createRepository(e.manager,t,i),this.specificRepository=o.createSpecificRepository(e,t,i)}return e}(),e("RepositoryAggregator",i)}}}),System.register("typeorm/entity-manager/error/NoNeedToReleaseEntityManagerError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="NoNeedToReleaseEntityManagerError",t.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("NoNeedToReleaseEntityManagerError",n)}}}),System.register("typeorm/connection/error/RepositoryNotTreeError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name="RepositoryNotTreeError";var r="function"==typeof t&&t.name?t.name:t;return n.message='Repository of the "'+r+'" class is not a TreeRepository. Try to use @ClosureTable decorator instead of @Table.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("RepositoryNotTreeError",n)}}}),System.register("typeorm/persistence/SubjectBuilder",["typeorm/persistence/Subject","typeorm/driver/mongodb/MongoDriver","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t,this.operateSubjects=[]}return e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.canBeInserted=!0,r.canBeUpdated=!0,this.operateSubjects.push(r),this.buildCascadeUpdateAndInsertOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!0,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.mustBeRemoved=!0,this.operateSubjects.push(r),this.buildCascadeRemoveOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!1,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.buildCascadeUpdateAndInsertOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&(t.isCascadeInsert||t.isCascadeUpdate)}).forEach(function(e){var r=e[0],i=e[1],o=e[2],a=t.findByEntityLike(o.target,i);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===r.isCascadeInsert),void(!1===a.canBeUpdated&&(a.canBeUpdated=!0===r.isCascadeUpdate));var s=new n.Subject(o,i);s.canBeInserted=!0===r.isCascadeInsert,s.canBeUpdated=!0===r.isCascadeUpdate,t.operateSubjects.push(s),t.buildCascadeUpdateAndInsertOperateSubjects(s)})},e.prototype.buildCascadeRemoveOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&t.isCascadeRemove}).forEach(function(e){var r=(e[0],e[1]),i=e[2],o=t.findByEntityLike(i.target,r);if(o)return void(o.mustBeRemoved=!0);var a=new n.Subject(i,r);a.mustBeRemoved=!0,t.operateSubjects.push(a),t.buildCascadeRemoveOperateSubjects(a)})},e.prototype.loadOperateSubjectsDatabaseEntities=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=this.groupByEntityTargets().map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.subjects.filter(function(e){return!e.hasDatabaseEntity}).filter(function(e){return!e.metadata.isEntityMapEmpty(e.entity)}).map(function(e){return e.metadata.getEntityIdMap(e.entity)}),t.length?this.connection.driver instanceof r.MongoDriver?[4,this.connection.getMongoRepository(e.target).findByIds(t)]:[3,2]:[2];case 1:return n=o.sent(),[3,4];case 2:return[4,this.connection.getRepository(e.target).createQueryBuilder("operateSubject",this.queryRunnerProvider).andWhereInIds(t).enableAutoRelationIdsLoad().getMany()];case 3:n=o.sent(),o.label=4;case 4:return n.forEach(function(t){var n=i.findByEntityLike(e.target,t);n&&(n.databaseEntity=t)}),[2]}})})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.buildCascadeRemovedAndRelationUpdateOperateSubjects=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(i){switch(i.label){case 0:return t=e.metadata.relations.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,p,a,m,f,u,p,y,h,g,v,b,E,_,C,T,d,N,_,C,T,d,w,R,M,A=this;return __generator(this,function(S){switch(S.label){case 0:return r=t.inverseEntityMetadata,(i=r.tableName,e.hasDatabaseEntity)?t.isOneToOneOwner||t.isManyToOne?t.isCascadeRemove?null===(o=t.getEntityValue(e.databaseEntity))||void 0===o?[2]:(a=void 0,s=void 0,e.hasEntity&&(s=t.getEntityValue(e.entity),null===s&&(a=null),s&&(a=t.joinColumns.reduce(function(e,t){return t.referencedColumn.getEntityValueMap(s)},{})),void 0===a)?[2]:null!==a&&t.entityMetadata.compareIds(o,s)?[2]:(u=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&t.entityMetadata.compareIds(o,t.getEntityValue(e.databaseEntity))}))?[3,2]:(c=this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).enableAutoRelationIdsLoad(),l=t.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+" = :"+e.databaseName}).join(" AND "),d=t.joinColumns.reduce(function(e,t){return e[t.databaseName]=t.referencedColumn.getEntityValue(o),e},{}),c.where(l).setParameters(d),[4,c.getOne()])):[2]:[3,4]:[2];case 1:p=S.sent(),p&&(u=new n.Subject(r,void 0,p),this.operateSubjects.push(u)),S.label=2;case 2:return u?u.mustBeRemoved?[2]:(u.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(u)]):[3,4];case 3:S.sent(),S.label=4;case 4:return t.isOneToOneNotOwner?t.isCascadeRemove?(a=void 0,e.hasEntity&&!e.mustBeRemoved&&(m=t.getEntityValue(e.entity),m&&(a=t.inverseRelation.getEntityValue(m)),void 0===a)?[2]:null===(f=t.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(e.databaseEntity))||void 0===f?[2]:(u=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&t.inverseRelation.getEntityValue(e.databaseEntity)===f}),u?[3,6]:[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).where(i+"."+t.inverseSidePropertyPath+"=:id").setParameter("id",f).enableAutoRelationIdsLoad().getOne()])):[2]:[3,8];case 5:p=S.sent(),u=new n.Subject(r,void 0,p),this.operateSubjects.push(u),S.label=6;case 6:return u&&u.hasDatabaseEntity?(y=t.inverseRelation.getEntityValue(u.databaseEntity),a&&a===y?[2]:u.mustBeRemoved?[2]:(u.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(u)])):[3,8];case 7:S.sent(),S.label=8;case 8:return t.isOneToMany||t.isManyToMany?(h=void 0,e.hasEntity&&void 0===(h=t.getEntityValue(e.entity))?[2]:(g=[],v=function(e){return A.connection.driver.escapeAliasName(e)},b=function(e){return A.connection.driver.escapeColumnName(e)},t.isManyToManyOwner?t.isCascadeRemove?(E=v("persistenceJoinedRelation"),_=t.joinColumns.map(function(e){return E+"."+e.propertyName+" = :"+e.propertyName}),C=t.inverseJoinColumns.map(function(e){return E+"."+e.propertyName+" = "+v(i)+"."+b(e.referencedColumn.propertyName)}),T=_.concat(C).join(" AND "),d=t.joinColumns.reduce(function(t,n){return t[n.propertyName]=n.referencedColumn.getEntityValue(e.databaseEntity),t},{}),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).innerJoin(t.junctionEntityMetadata.tableName,E,T).setParameters(d).enableAutoRelationIdsLoad().getMany()]):[2]:[3,10])):[3,18];case 9:return g=S.sent(),[3,14];case 10:return t.isManyToManyNotOwner?t.isCascadeRemove?(N=v("persistenceJoinedRelation"),_=t.joinColumns.map(function(e){return N+"."+e.propertyName+" = "+v(i)+"."+b(e.referencedColumn.propertyName)}),C=t.inverseJoinColumns.map(function(e){return N+"."+e.propertyName+" = :"+e.propertyName}),T=_.concat(C).join(" AND "),d=t.inverseRelation.inverseJoinColumns.reduce(function(t,n){return t[n.propertyName]=n.referencedColumn.getEntityValue(e.databaseEntity),t},{}),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).innerJoin(t.junctionEntityMetadata.tableName,N,T).setParameters(d).enableAutoRelationIdsLoad().getMany()]):[2]:[3,12];case 11:return g=S.sent(),[3,14];case 12:return w=t.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(e.databaseEntity),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).where(i+"."+t.inverseSidePropertyPath+"=:id").setParameter("id",w).enableAutoRelationIdsLoad().getMany()];case 13:g=S.sent(),S.label=14;case 14:return g.forEach(function(e){var t=A.findByEntityLike(r.target,e);if(t&&!t.hasDatabaseEntity)t.databaseEntity=e;else if(!t){var i=new n.Subject(r,void 0,e);A.operateSubjects.push(i)}}),t.isOneToMany&&h?(R=h.map(function(o){return __awaiter(A,void 0,void 0,function(){var a,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return(a=g.find(function(e){return r.compareEntities(o,e)}))?[3,3]:(s=this.findByDatabaseEntityLike(r.target,o))?[3,2]:(u=r.getEntityIdMap(o),u?[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunnerProvider).andWhereInIds([u]).enableAutoRelationIdsLoad().getOne()]:[3,2]);case 1:c=l.sent(),c&&(s=new n.Subject(r,void 0,c),this.operateSubjects.push(s)),l.label=2;case 2:s&&s.relationUpdates.push({relation:t.inverseRelation,value:e.entity}),l.label=3;case 3:return[2]}})})}),[4,Promise.all(R)]):[3,16];case 15:S.sent(),S.label=16;case 16:return M=g.map(function(e){return __awaiter(A,void 0,void 0,function(){var n,i;return __generator(this,function(o){switch(o.label){case 0:return(n=this.findByDatabaseEntityLike(r.target,e))?n.mustBeRemoved?[2]:(i=(h||[]).find(function(e){return r.compareEntities(n.databaseEntity,e)}),null!==h&&i?[3,3]:t.isCascadeRemove?(n.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(n)]):[3,2]):[2];case 1:return o.sent(),[3,3];case 2:t.isOneToMany&&t.inverseRelation&&n.relationUpdates.push({relation:t.inverseRelation,value:null}),o.label=3;case 3:return[2]}})})}),[4,Promise.all(M)];case 17:S.sent(),S.label=18;case 18:return[2]}})})}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e.prototype.buildJunctionOperations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){switch(r.label){case 0:return t=this.operateSubjects.filter(function(e){return e.hasEntity}).map(function(t){var r=t.metadata.parentEntityMetadata?t.metadata.parentEntityMetadata:t.metadata,o=r.manyToManyRelations.map(function(r){return __awaiter(n,void 0,void 0,function(){var n,o,a,s,u,c;return __generator(this,function(l){return t.mustBeRemoved&&e.remove?(n=r.getEntityValue(t.databaseEntity),n.length>0&&t.junctionRemoves.push({relation:r,junctionRelationIds:n}),[2]):t.hasEntity&&(o=r.getEntityValue(t.entity))instanceof Array?(a=[],t.hasDatabaseEntity&&(a=r.getEntityValue(t.databaseEntity)),s=o.map(function(e){return(r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns).reduce(function(t,n){return i.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(n.referencedColumn.getEntityValue(e)))},{})}).filter(function(e){return void 0!==e&&null!==e}),u=a.filter(function(e){return!s.find(function(t){return r.inverseEntityMetadata.compareIds(t,e)})}),c=o.filter(function(e){var t=r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns,n=t.reduce(function(t,n){return i.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(n.referencedColumn.getEntityValue(e)))},{});return!a.find(function(e){return r.inverseEntityMetadata.compareIds(e,n)})}),c.length>0&&e.insert&&t.junctionInserts.push({relation:r,junctionEntities:c}),u.length>0&&e.remove&&t.junctionRemoves.push({relation:r,junctionRelationIds:u}),[2]):[2]})})});return Promise.all(o)}),[4,Promise.all(t)];case 1:return r.sent(),[2]}})})},e.prototype.findByEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasEntity&&(n.entity===t||n.entityTarget===e&&n.metadata.compareEntities(n.entity,t))})},e.prototype.findByDatabaseEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasDatabaseEntity&&(n.entityTarget===e&&n.metadata.compareEntities(n.databaseEntity,t))})},e.prototype.groupByEntityTargets=function(){return this.operateSubjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.entityTarget});return n||(n={target:t.entityTarget,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),e("SubjectBuilder",o)}}}),System.register("typeorm/util/PromiseUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.runInSequence=function(e,t){var n=[];return e.reduce(function(e,r){return e.then(function(){return t(r)}).then(function(e){n.push(e)})},Promise.resolve()).then(function(){return n})},e}(),e("PromiseUtils",n)}}}),System.register("typeorm/persistence/SubjectOperationExecutor",["typeorm/util/OrmUtils","typeorm/util/PromiseUtils","typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e,t,n){this.connection=e,this.transactionEntityManager=t,this.queryRunnerProvider=n}return e.prototype.execute=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(e.forEach(function(e){return e.validate()}),this.allSubjects=e,this.insertSubjects=e.filter(function(e){return e.mustBeInserted}),this.updateSubjects=e.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=e.filter(function(e){return e.mustBeRemoved}),this.relationUpdateSubjects=e.filter(function(e){return e.hasRelationUpdates}),!this.insertSubjects.length&&!this.updateSubjects.length&&!this.removeSubjects.length&&!this.relationUpdateSubjects.length&&e.every(function(e){return!e.junctionInserts.length})&&e.every(function(e){return!e.junctionRemoves.length}))return[2];t=!1,o.label=1;case 1:return o.trys.push([1,17,,22]),n=this,[4,this.queryRunnerProvider.provide()];case 2:return n.queryRunner=o.sent(),this.queryRunner.isTransactionActive()?[3,4]:(t=!0,[4,this.queryRunner.beginTransaction()]);case 3:o.sent(),o.label=4;case 4:return[4,this.connection.broadcaster.broadcastBeforeEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 5:return o.sent(),this.updateSubjects.forEach(function(e){return e.recompute()}),[4,this.executeInsertOperations()];case 6:return o.sent(),[4,this.executeInsertClosureTableOperations()];case 7:return o.sent(),[4,this.executeInsertJunctionsOperations()];case 8:return o.sent(),[4,this.executeRemoveJunctionsOperations()];case 9:return o.sent(),[4,this.executeUpdateOperations()];case 10:return o.sent(),[4,this.executeUpdateRelations()];case 11:return o.sent(),[4,this.executeRemoveOperations()];case 12:return o.sent(),!0!==t?[3,14]:[4,this.queryRunner.commitTransaction()];case 13:o.sent(),o.label=14;case 14:return[4,this.updateSpecialColumnsInPersistedEntities()];case 15:return o.sent(),[4,this.connection.broadcaster.broadcastAfterEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 16:return o.sent(),[3,22];case 17:if(r=o.sent(),!t)return[3,21];o.label=18;case 18:return o.trys.push([18,20,,21]),[4,this.queryRunner.rollbackTransaction()];case 19:return o.sent(),[3,21];case 20:return i=o.sent(),[3,21];case 21:throw r;case 22:return[2]}})})},e.prototype.executeInsertOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return e=this.insertSubjects.filter(function(e){return!e.metadata.hasNonNullableRelations}),t=this.insertSubjects.filter(function(e){return e.metadata.hasNonNullableRelations}),[4,Promise.all(e.map(function(e){return r.insert(e,[])}))];case 1:return i.sent(),[4,Promise.all(t.map(function(t){return r.insert(t,e)}))];case 2:return i.sent(),n=[],e.forEach(function(e){var t={};if(e.metadata.relationsWithJoinColumns.forEach(function(n){n.joinColumns.forEach(function(i){var o=i.referencedColumn,a=n.getEntityValue(e.entity);if(a){var s,u=n.inverseEntityMetadata.findRelationWithPropertyPath(i.referencedColumn.propertyPath);if(u){var c=r.insertSubjects.find(function(e){return e.entity===o.getEntityValue(a)});c&&((s=u.getEntityValue(o.getEntityValue(a)))||(o.isGenerated?s=c.newlyGeneratedId:o.isObjectId&&(s=c.generatedObjectId)))}else{var c=r.insertSubjects.find(function(e){return e.entity===a});c&&((s=o.getEntityValue(a))||(o.isGenerated?s=c.newlyGeneratedId:o.isObjectId&&(s=c.generatedObjectId)))}s&&(t[i.databaseName]=s)}})}),Object.keys(t).length>0){var i=(e.metadata.parentEntityMetadata,e.metadata.primaryColumns),o={};if(i.forEach(function(t){var n=t.getEntityValue(e.entity),i=e.metadata.relations.find(function(e){return e.propertyName===t.propertyName});n&&i?i.joinColumns.forEach(function(e){var i=n[e.referencedColumn.propertyName];if(!i){var a=r.insertSubjects.find(function(e){return e.entity===n});a&&(e.referencedColumn.isGenerated?i=a.newlyGeneratedId:e.referencedColumn.isObjectId&&(i=a.generatedObjectId))}i&&(o[t.databaseName]=i)}):n?o[t.databaseName]=n:e.newlyGeneratedId?o[t.databaseName]=e.newlyGeneratedId:e.generatedObjectId&&(o[t.databaseName]=e.generatedObjectId)}),!Object.keys(o).length)return;var a=r.queryRunner.update(e.metadata.tableName,t,o);n.push(a)}var s=e.metadata.oneToManyRelations.concat(e.metadata.oneToOneRelations.filter(function(e){return!e.isOwning}));e.metadata.extractRelationValuesFromEntity(e.entity,s).forEach(function(t){var i=t[0],o=t[1],a=t[2];i.inverseRelation.joinColumns.forEach(function(t){var s=t.referencedColumn,u=(a.parentEntityMetadata,a.primaryColumns),c={};if(u.forEach(function(e){var t=e.getEntityValue(o),n=a.relations.find(function(t){return t.propertyName===e.propertyName});if(t&&n)n.joinColumns.forEach(function(n){var i=t[n.referencedColumn.propertyName];if(!i){var o=r.insertSubjects.find(function(e){return e.entity===t});o&&(n.referencedColumn.isGenerated?i=o.newlyGeneratedId:n.referencedColumn.isObjectId&&(i=o.generatedObjectId))}i&&(c[e.databaseName]=i)});else{var i=r.insertSubjects.find(function(e){return e.entity===o});t?c[e.databaseName]=t:i&&i.newlyGeneratedId?c[e.databaseName]=i.newlyGeneratedId:i&&i.generatedObjectId&&(c[e.databaseName]=i.generatedObjectId)}}),Object.keys(c).length){var l={},d=i.inverseEntityMetadata.relations.find(function(e){return e.propertyName===s.propertyName}),p=s.getEntityValue(e.entity);if(d){var m=d.getEntityValue(p);if(!m){var f=r.insertSubjects.find(function(e){return e.entity===p});f&&(f.newlyGeneratedId?m=f.newlyGeneratedId:f.generatedObjectId&&(m=f.generatedObjectId))}l[t.databaseName]=m}else l[t.databaseName]=p||e.newlyGeneratedId||o.generatedObjectId;var y=r.queryRunner.update(i.inverseEntityMetadata.tableName,l,c);n.push(y)}})})}),[4,Promise.all(n)];case 3:return i.sent(),[2]}})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:return n=e.metadata.parentEntityMetadata,(r=e.metadata,i=e.entity,r.isClassTableChild)?(s=this.collectColumnsAndValues(n,i,e.date,void 0,r.discriminatorValue,t),[4,this.queryRunner.insert(n.tableName,s,n.generatedColumn)]):[3,3];case 1:return o=a=d.sent(),u=this.collectColumnsAndValues(r,i,e.date,o,void 0,t),[4,this.queryRunner.insert(r.tableName,u,r.generatedColumn)];case 2:return c=d.sent(),!o&&c&&(o=c),[3,5];case 3:return l=this.collectColumnsAndValues(r,i,e.date,void 0,void 0,t),[4,this.queryRunner.insert(r.tableName,l,r.generatedColumn)];case 4:o=d.sent(),d.label=5;case 5:return a&&(e.parentGeneratedId=a),o&&(r.generatedColumn?e.newlyGeneratedId=o:r.objectIdColumn&&(e.generatedObjectId=o)),[2]}})})},e.prototype.collectColumns=function(e,t,n){var r=this;e.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator)){var i=t[e.propertyName];void 0!==i&&(n[e.databaseNameWithoutPrefixes]=r.connection.driver.preparePersistentValue(i,e))}})},e.prototype.collectEmbeds=function(e,t,n){var r=this;e.isArray?t[e.propertyName]instanceof Array&&(n[e.prefix]||(n[e.prefix]=[]),t[e.propertyName].forEach(function(t,i){n[e.prefix][i]||(n[e.prefix][i]={}),r.collectColumns(e.columns,t,n[e.prefix][i]),e.embeddeds.forEach(function(o){return r.collectEmbeds(o,t,n[e.prefix][i])})})):void 0!==t[e.propertyName]&&(n[e.prefix]||(n[e.prefix]={}),this.collectColumns(e.columns,t[e.propertyName],n[e.prefix]),e.embeddeds.forEach(function(i){return r.collectEmbeds(i,t[e.propertyName],n[e.prefix])}))},e.prototype.collectColumnsAndValues=function(e,t,n,r,o,a){var s=this,u={};if(this.connection.driver instanceof i.MongoDriver?(this.collectColumns(e.ownColumns,t,u),e.embeddeds.forEach(function(e){return s.collectEmbeds(e,t,u)})):e.columns.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator)){var n=e.getEntityValue(t);null!==n&&void 0!==n&&(u[e.databaseName]=s.connection.driver.preparePersistentValue(n,e))}}),e.relationsWithJoinColumns.forEach(function(e){e.joinColumns.forEach(function(n){var r,i=e.getEntityValue(t);if(i){var o=n.referencedColumn.getEntityValue(i);o&&(r=o);var c=a.find(function(e){return e.entity===i});if(c){var l=n.referencedColumn
;l.referencedColumn&&l.referencedColumn.isGenerated&&l.isParentId&&(r=c.parentGeneratedId),l.isGenerated&&(r=c.newlyGeneratedId),l.isObjectId&&(r=c.generatedObjectId),(l.isCreateDate||l.isUpdateDate)&&(r=s.connection.driver.preparePersistentValue(c.date,l)),l.isVersion&&(r=s.connection.driver.preparePersistentValue(1,l))}}else if(e.inverseRelation){var d=s.allSubjects.find(function(n){if(!n.hasEntity||n.entityTarget!==e.inverseRelation.target)return!1;var r=e.inverseRelation.getEntityValue(n.entity);return r?r instanceof Array?r.find(function(e){return e===e}):r===t:void 0});d&&n.referencedColumn.getEntityValue(d.entity)&&(r=n.referencedColumn.getEntityValue(d.entity))}r&&(u[n.databaseName]=r)})}),e.createDateColumn){var c=this.connection.driver.preparePersistentValue(n,e.createDateColumn);u[e.createDateColumn.databaseName]=c}if(e.updateDateColumn){var c=this.connection.driver.preparePersistentValue(n,e.updateDateColumn);u[e.updateDateColumn.databaseName]=c}if(e.versionColumn){var c=this.connection.driver.preparePersistentValue(1,e.versionColumn);u[e.versionColumn.databaseName]=c}if(e.discriminatorColumn){var c=this.connection.driver.preparePersistentValue(o||e.discriminatorValue,e.discriminatorColumn);u[e.discriminatorColumn.databaseName]=c}if(e.treeLevelColumn&&e.treeParentRelation){var l=e.treeParentRelation.getEntityValue(t),d=l?e.treeLevelColumn.getEntityValue(l)||0:0;u[e.treeLevelColumn.databaseName]=d+1}return e.parentEntityMetadata&&e.parentIdColumns.length&&(u[e.parentIdColumns[0].databaseName]=r||e.parentEntityMetadata.primaryColumns[0].getEntityValue(t)),u},e.prototype.executeInsertClosureTableOperations=function(){var e=this,t=this.insertSubjects.filter(function(e){return e.metadata.isClosure}).map(function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.insertClosureTableValues(t)];case 1:return e.sent(),[2]}})})});return Promise.all(t)},e.prototype.insertClosureTableValues=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,d;return __generator(this,function(p){switch(p.label){case 0:return t=e.metadata.closureJunctionTable.tableName,n=e.metadata.treeParentRelation.joinColumns[0].referencedColumn,r=n.getEntityValue(e.entity),!r&&n.isGenerated&&(r=e.newlyGeneratedId),i=e.metadata.treeParentRelation.getEntityValue(e.entity),o=0,i&&!(o=n.getEntityValue(i))&&n.isGenerated&&(a=this.insertSubjects.find(function(e){return e.entity===i}),o=a.newlyGeneratedId),o||(s=this.allSubjects.find(function(t){if(!t.hasEntity||!t.metadata.isClosure||!t.metadata.treeChildrenRelation)return!1;var n=e.metadata.treeChildrenRelation.getEntityValue(t.entity);return n instanceof Array&&-1!==n.indexOf(e.entity)}))&&!(o=n.getEntityValue(s))&&s.newlyGeneratedId&&(o=s.newlyGeneratedId),u=e,[4,this.queryRunner.insertIntoClosureTable(t,r,o,!!e.metadata.treeLevelColumn)];case 1:return u.treeLevel=p.sent(),e.metadata.treeLevelColumn?(l={},l[e.metadata.treeLevelColumn.databaseName]=e.treeLevel,c=l,[4,this.queryRunner.update(e.metadata.tableName,c,(d={},d[n.databaseName]=r,d))]):[3,3];case 2:p.sent(),p.label=3;case 3:return[2]}})})},e.prototype.executeUpdateOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return e.update(t)}))];case 1:return t.sent(),[2]}})})},e.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,a,a,a,s=this;return __generator(this,function(u){switch(u.label){case 0:if(t=e.entity,this.connection.driver instanceof i.MongoDriver){if(!(n=e.metadata.getDatabaseEntityIdMap(t)))throw new Error("Internal error. Cannot get id of the updating entity.");return r={},(this.collectColumns(e.metadata.ownColumns,t,r),e.metadata.embeddeds.forEach(function(e){return s.collectEmbeds(e,t,r)}),0===Object.keys(r).length)?[2]:(e.metadata.updateDateColumn&&(r[e.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.versionColumn&&(r[e.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.versionColumn.getEntityValue(t)+1,e.metadata.versionColumn)),[2,this.queryRunner.update(e.metadata.tableName,r,n)])}return o=[],(e.diffColumns.forEach(function(e){var n=s.connection.getMetadata(e.entityMetadata.target),r=o.find(function(e){return e.tableName===n.tableName});r||(r={tableName:n.tableName,metadata:n,values:{}},o.push(r)),r.values[e.databaseName]=s.connection.driver.preparePersistentValue(e.getEntityValue(t),e)}),e.diffRelations.forEach(function(e){var n=o.find(function(t){return t.tableName===e.entityMetadata.tableName});n||(n={tableName:e.entityMetadata.tableName,metadata:e.entityMetadata,values:{}},o.push(n));var r=e.getEntityValue(t);e.joinColumns.forEach(function(e){n.values[e.databaseName]=null!==r&&void 0!==r?r[e.referencedColumn.propertyName]:null})}),0===Object.keys(o).length)?[2]:(e.metadata.updateDateColumn&&(a=o.find(function(t){return t.tableName===e.metadata.tableName}),a||(a={tableName:e.metadata.tableName,metadata:e.metadata,values:{}},o.push(a)),a.values[e.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.versionColumn&&(a=o.find(function(t){return t.tableName===e.metadata.tableName}),a||(a={tableName:e.metadata.tableName,metadata:e.metadata,values:{}},o.push(a)),a.values[e.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.versionColumn.getEntityValue(t)+1,e.metadata.versionColumn)),e.metadata.parentEntityMetadata&&(e.metadata.parentEntityMetadata.updateDateColumn&&(a=o.find(function(t){return t.tableName===e.metadata.parentEntityMetadata.tableName}),a||(a={tableName:e.metadata.parentEntityMetadata.tableName,metadata:e.metadata.parentEntityMetadata,values:{}},o.push(a)),a.values[e.metadata.parentEntityMetadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.parentEntityMetadata.updateDateColumn)),e.metadata.parentEntityMetadata.versionColumn&&(a=o.find(function(t){return t.tableName===e.metadata.parentEntityMetadata.tableName}),a||(a={tableName:e.metadata.parentEntityMetadata.tableName,metadata:e.metadata.parentEntityMetadata,values:{}},o.push(a)),a.values[e.metadata.parentEntityMetadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.parentEntityMetadata.versionColumn.getEntityValue(t)+1,e.metadata.parentEntityMetadata.versionColumn))),[4,Promise.all(o.map(function(e){var n=e.metadata.getDatabaseEntityIdMap(t);if(!n)throw new Error("Internal error. Cannot get id of the updating entity.");return s.queryRunner.update(e.tableName,e.values,n)}))]);case 1:return u.sent(),[2]}})})},e.prototype.executeUpdateRelations=function(){var e=this;return Promise.all(this.relationUpdateSubjects.map(function(t){return e.updateRelations(t)}))},e.prototype.updateRelations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){if(t={},e.relationUpdates.forEach(function(e){e.relation.joinColumns.forEach(function(n){var r=e.value?e.value[n.referencedColumn.propertyName]:null;t[n.databaseName]=r})}),!(n=e.metadata.getDatabaseEntityIdMap(e.databaseEntity)))throw new Error("Internal error. Cannot get id of the updating entity.");return[2,this.queryRunner.update(e.metadata.tableName,t,n)]})})},e.prototype.executeRemoveOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,r.PromiseUtils.runInSequence(this.removeSubjects,function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.remove(t)];case 1:return[2,e.sent()]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return e.metadata.parentEntityMetadata?(t={},e.metadata.primaryColumns.forEach(function(n){t[n.databaseName]=n.getEntityValue(e.databaseEntity)}),[4,this.queryRunner.delete(e.metadata.parentEntityMetadata.tableName,t)]):[3,3];case 1:return r.sent(),n={},e.metadata.primaryColumns.forEach(function(t){n[t.databaseName]=t.getEntityValue(e.databaseEntity)}),[4,this.queryRunner.delete(e.metadata.tableName,n)];case 2:return r.sent(),[3,5];case 3:return[4,this.queryRunner.delete(e.metadata.tableName,e.metadata.getDatabaseEntityIdMap(e.databaseEntity))];case 4:r.sent(),r.label=5;case 5:return[2]}})})},e.prototype.executeInsertJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionInserts.forEach(function(r){e.push(t.insertJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.insertJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:if(r=function(e,t){return t.map(function(t){var n=t.referencedColumn.getEntityValue(e);if(!n&&t.referencedColumn.isGenerated){var r=u.insertSubjects.find(function(t){return t.entity===e});if(r)return r.newlyGeneratedId}if(!n&&t.referencedColumn.isObjectId){var r=u.insertSubjects.find(function(t){return t.entity===e});if(r)return r.generatedObjectId}return n})},i=t.relation,o=i.isManyToManyOwner?i.joinColumns:i.inverseRelation.inverseJoinColumns,a=r(e.entity,o),!a.length)throw new Error("Cannot insert object of "+e.entityTarget+" type. Looks like its not persisted yet, or cascades are not set on the relation.");return s=t.junctionEntities.map(function(e){var t=i.isManyToManyOwner?i.inverseJoinColumns:i.inverseRelation.joinColumns,o=r(e,t);if(!o)throw new Error("Cannot insert object of "+e.constructor.name+" type. Looks like its not persisted yet, or cascades are not set on the relation.");var s=i.junctionEntityMetadata.columns.map(function(e){return e.databaseName}),c=i.isOwning?a.concat(o):o.concat(a);return u.queryRunner.insert(i.junctionEntityMetadata.tableName,n.OrmUtils.zipObject(s,c))}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.executeRemoveJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionRemoves.forEach(function(r){e.push(t.removeJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.removeJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return n=t.relation.junctionEntityMetadata,r=e.hasEntity?e.entity:e.databaseEntity,i=t.relation.isOwning?t.relation.joinColumns:t.relation.inverseRelation.inverseJoinColumns,o=t.relation.isOwning?t.relation.inverseJoinColumns:t.relation.inverseRelation.joinColumns,a={},i.forEach(function(e){a[e.databaseName]=e.referencedColumn.getEntityValue(r)}),s=t.junctionRelationIds.map(function(e){var t={};return o.forEach(function(n){t[n.databaseName]=n.referencedColumn.getEntityValue(e)}),u.queryRunner.delete(n.tableName,Object.assign({},t,a))}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){this.insertSubjects.forEach(function(e){e.generatedObjectId&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.setEntityValue(e.entity,e.generatedObjectId),e.metadata.primaryColumns.forEach(function(t){e.newlyGeneratedId&&t.setEntityValue(e.entity,e.newlyGeneratedId)}),e.metadata.primaryColumns.forEach(function(t){e.parentGeneratedId&&t.setEntityValue(e.entity,e.parentGeneratedId)}),e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.createDateColumn&&e.metadata.createDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,1),e.metadata.treeLevelColumn&&e.metadata.treeLevelColumn.setEntityValue(e.entity,e.treeLevel)}),this.updateSubjects.forEach(function(e){e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,e.metadata.versionColumn.getEntityValue(e.entity)+1)}),this.removeSubjects.filter(function(e){return e.hasEntity}).forEach(function(e){e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})})},e}(),e("SubjectOperationExecutor",o)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.transform=function(e,t,n){return this.groupAndTransform(e,t,n),e},e.prototype.groupAndTransform=function(e,t,n){var r=this;n.columns.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(n){return e[n.propertyName]=t[n.propertyName]}),n.relations.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(i){var o=i.inverseEntityMetadata;if(!o)throw new Error("Relation metadata for the relation "+n.name+"#"+i.propertyName+" is missing");if(i.isManyToMany||i.isOneToMany)t[i.propertyName]instanceof Array?e[i.propertyName]=t[i.propertyName].map(function(t){var n=o.create();if(e[i.propertyName]instanceof Array){var a=e[i.propertyName].find(function(e){return e[i.propertyName]===t[i.propertyName]});a&&r.groupAndTransform(n,a,o)}return r.groupAndTransform(n,t,o),n}):e[i.propertyName]=t[i.propertyName];else if(t[i.propertyName]){var a=o.create();e[i.propertyName]&&r.groupAndTransform(a,e[i.propertyName],o),r.groupAndTransform(a,t[i.propertyName],o),e[i.propertyName]=a}else e[i.propertyName]=t[i.propertyName]})},e}(),e("PlainObjectToNewEntityTransformer",n)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer",[],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e.prototype.compareEntities=function(e,t){return this.metadata.compareEntities(e,t)},e}(),r=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),i=function(){function e(e){this.entityManager=e}return e.prototype.transform=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t.checkIfObjectContainsAllPrimaryKeys(e)?(i=new r,o=function(e,r,a,s){var u=new n(e,r,a,s);i.addLoadMap(u),r.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!==e&&void 0!==e}).forEach(function(e){var t=e[0],n=e[1],r=e[2];return o(n,r,u,t)})},o(e,t),[4,Promise.all(i.groupByTargetIds().map(function(e){return a.entityManager.findByIds(e.target,e.ids).then(function(t){return i.fillEntities(e.target,t)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return s.sent(),i.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,i.mainLoadMapItem?i.mainLoadMapItem.entity:void 0]}})})},e}(),e("PlainObjectToDatabaseEntityTransformer",i)}}}),System.register("typeorm/repository/error/CustomRepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CustomRepositoryNotFoundError",n.message="Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",n}return __extends(t,e),t}(Error),e("CustomRepositoryNotFoundError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryDoesNotHaveEntityError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this;return n.name="CustomRepositoryDoesNotHaveEntityError",n}return __extends(t,e),t}(Error),e("CustomRepositoryDoesNotHaveEntityError",n)}}}),System.register("typeorm/repository/AbstractRepository",["typeorm/repository/error/CustomRepositoryDoesNotHaveEntityError","typeorm/index","typeorm/repository/error/CustomRepositoryNotFoundError"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=r.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new i.CustomRepositoryNotFoundError(e);return t.entity},e}(),e("AbstractRepository",o)}}}),System.register("typeorm/repository/error/CustomRepositoryCannotInheritRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this;return n.name="CustomRepositoryCannotInheritRepositoryError",n}return __extends(t,e),t}(Error),e("CustomRepositoryCannotInheritRepositoryError",n)}}}),System.register("typeorm/entity-manager/EntityManager",["typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError","typeorm/query-runner/QueryRunnerProvider","typeorm/repository/RepositoryAggregator","typeorm/entity-manager/error/NoNeedToReleaseEntityManagerError","typeorm/repository/Repository","typeorm/connection/error/RepositoryNotTreeError","typeorm/query-builder/QueryBuilder","typeorm/find-options/FindOptionsUtils","typeorm/persistence/SubjectBuilder","typeorm/persistence/SubjectOperationExecutor","typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer","typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer","typeorm/repository/error/CustomRepositoryNotFoundError","typeorm/index","typeorm/repository/AbstractRepository","typeorm/repository/error/CustomRepositoryCannotInheritRepositoryError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e},function(e){h=e},function(e){g=e}],execute:function(){v=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t,this.data={},this.repositoryAggregators=[]}return e.prototype.getData=function(e){return this.data[e]},e.prototype.setData=function(e,t){return this.data[e]=t,this},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.createQueryBuilder=function(e,t,n){var r=this.connection.getMetadata(e);return new u.QueryBuilder(this.connection,n||this.queryRunnerProvider).select(t).from(r.target,t)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);return t?t instanceof Array?t.map(function(t){return n.create(e,t)}):this.merge(e,r.create(),t):r.create()},e.prototype.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.connection.getMetadata(e),o=new p.PlainObjectToNewEntityTransformer;return n.forEach(function(e){return o.transform(t,e,i)}),t},e.prototype.preload=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.connection.getMetadata(e),r=new m.PlainObjectToDatabaseEntityTransformer(this.connection.manager),[4,r.transform(t,n)];case 1:return i=o.sent(),i?[2,this.merge(e,i,t)]:[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=this,i=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,o=i?t:e,a=i?n:t;return Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return o instanceof Array?[4,Promise.all(o.map(function(e){var n=i||e.constructor;return t.saveOne(n,e,a)}))]:[3,2];case 1:return n.sent(),[3,4];case 2:return e=i||o.constructor,[4,this.saveOne(e,o,a)];case 3:n.sent(),n.label=4;case 4:return[2,o]}})})})},e.prototype.persist=function(e,t,n){return this.save(e,t,n)},e.prototype.update=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.findOne(e,t)];case 1:if(!(i=o.sent()))throw new Error("Cannot find entity to update by a given criteria");return Object.assign(i,n),[4,this.save(i,r)];case 2:return o.sent(),[2]}})})},e.prototype.updateById=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.findOneById(e,t)];case 1:if(!(i=o.sent()))throw new Error("Cannot find entity to update by a id");return Object.assign(i,n),[4,this.save(i,r)];case 2:return o.sent(),[2]}})})},e.prototype.remove=function(e,t,n){var r=this,i=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,o=i?t:e,a=i?n:t;return Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return o instanceof Array?[4,Promise.all(o.map(function(e){var n=i||e.constructor;return t.removeOne(n,e,a)}))]:[3,2];case 1:return n.sent(),[3,4];case 2:return e=i||o.constructor,[4,this.removeOne(e,o,a)];case 3:n.sent(),n.label=4;case 4:return[2,o]}})})})},e.prototype.removeById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOneById(e,t)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to remove by a given id");return[4,this.remove(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.count=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,c.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name);return c.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getCount()},e.prototype.find=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,c.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name);return c.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getMany()},e.prototype.findAndCount=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,c.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name);return c.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getManyAndCount()},e.prototype.findByIds=function(e,t,n){var r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,c.FindOptionsUtils.extractFindManyOptionsAlias(n)||r.name);return c.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(i,n),t=t.map(function(e){return r.hasMultiplePrimaryKeys||e instanceof Object?e:r.createEntityIdMap([e])}),i.andWhereInIds(t),i.getMany()},e.prototype.findOne=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,c.FindOptionsUtils.extractFindOneOptionsAlias(t)||n.name);return c.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(r,t).getOne()},e.prototype.findOneById=function(e,t,n){var r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,c.FindOptionsUtils.extractFindOneOptionsAlias(n)||r.name);if(r.hasMultiplePrimaryKeys&&!(t instanceof Object))throw new Error("You have multiple primary keys in your entity, to use findOneById with multiple primary keys please provide complete object with all entity ids, like this: { firstKey: value, secondKey: value }");return c.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(i,n),r.hasMultiplePrimaryKeys||t instanceof Object||(t=r.createEntityIdMap([t])),i.andWhereInIds([t]),i.getOne()},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.queryRunnerProvider&&this.queryRunnerProvider.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;return i=this.queryRunnerProvider||new r.QueryRunnerProvider(this.connection.driver),[4,i.provide()];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,,4,6]),[4,o.query(e,t)];case 3:return[2,a.sent()];case 4:return[4,i.release(o)];case 5:return a.sent(),[7];case 6:return[2]}})})},e.prototype.transaction=function(t){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.queryRunnerProvider&&this.queryRunnerProvider.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;return i=this.queryRunnerProvider||new r.QueryRunnerProvider(this.connection.driver,!0),[4,i.provide()];case 1:o=c.sent(),a=new e(this.connection,i),c.label=2;case 2:return c.trys.push([2,6,8,12]),[4,o.beginTransaction()];case 3:return c.sent(),[4,t(a)];case 4:return s=c.sent(),[4,o.commitTransaction()];case 5:return c.sent(),[2,s];case 6:return u=c.sent(),[4,o.rollbackTransaction()];case 7:throw c.sent(),u;case 8:return[4,i.release(o)];case 9:return c.sent(),this.queryRunnerProvider?[3,11]:[4,i.releaseReused()];case 10:c.sent(),c.label=11;case 11:return[7];case 12:return[2]}})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:return t=this.connection.getMetadata(e),n=this.queryRunnerProvider||new r.QueryRunnerProvider(this.connection.driver),[4,n.provide()];case 1:i=o.sent(),o.label=2;case 2:return o.trys.push([2,,4,6]),[4,i.truncate(t.tableName)];case 3:return[2,o.sent()];case 4:return[4,n.release(i)];case 5:return o.sent(),[7];case 6:return[2]}})})},e.prototype.getRepository=function(e){return this.queryRunnerProvider?this.obtainRepositoryAggregator(e).repository:this.connection.getRepository(e)},e.prototype.getTreeRepository=function(e){if(this.queryRunnerProvider){var t=this.obtainRepositoryAggregator(e).treeRepository;if(!t)throw new s.RepositoryNotTreeError(e);return t}return this.connection.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){return this.queryRunnerProvider?this.obtainRepositoryAggregator(e).repository:this.connection.getMongoRepository(e)},e.prototype.getSpecificRepository=function(e){return this.queryRunnerProvider?this.obtainRepositoryAggregator(e).specificRepository:this.connection.getSpecificRepository(e)},e.prototype.getCustomRepository=function(e){var t=y.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new f.CustomRepositoryNotFoundError(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof h.AbstractRepository&&(r.manager||(r.manager=this)),r instanceof a.Repository){if(!n)throw new g.CustomRepositoryCannotInheritRepositoryError(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.queryRunnerProvider)throw new o.NoNeedToReleaseEntityManagerError;return[2,this.queryRunnerProvider.releaseReused()]})})},e.prototype.saveOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:n=this.connection.getMetadata(e),i=this.queryRunnerProvider||new r.QueryRunnerProvider(this.connection.driver,!0),u.label=1;case 1:return u.trys.push([1,,4,7]),o=this.connection.createEntityManagerWithSingleDatabaseConnection(i),a=new l.SubjectBuilder(this.connection,i),[4,a.persist(t,n)];case 2:return u.sent(),s=new d.SubjectOperationExecutor(this.connection,o,i),[4,s.execute(a.operateSubjects)];case 3:return u.sent(),[3,7];case 4:return this.queryRunnerProvider?[3,6]:[4,i.releaseReused()];case 5:u.sent(),u.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.removeOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:n=this.connection.getMetadata(e),i=this.queryRunnerProvider||new r.QueryRunnerProvider(this.connection.driver,!0),u.label=1;case 1:return u.trys.push([1,,4,7]),o=this.connection.createEntityManagerWithSingleDatabaseConnection(i),a=new l.SubjectBuilder(this.connection,i),[4,a.remove(t,n)];case 2:return u.sent(),s=new d.SubjectOperationExecutor(this.connection,o,i),[4,s.execute(a.operateSubjects)];case 3:return u.sent(),[3,7];case 4:return this.queryRunnerProvider?[3,6]:[4,i.releaseReused()];case 5:u.sent(),u.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.obtainRepositoryAggregator=function(e){if(this.queryRunnerProvider&&this.queryRunnerProvider.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;var t=this.connection.getMetadata(e),r=this.repositoryAggregators.find(function(e){
return e.metadata===t});return r||(r=new i.RepositoryAggregator(this.connection,this.connection.getMetadata(e),this.queryRunnerProvider),this.repositoryAggregators.push(r)),r},e}(),e("EntityManager",v)}}}),System.register("typeorm/repository/Repository",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e,t)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(r=this.manager).merge.apply(r,[this.metadata.target,e].concat(t));var r},e.prototype.preload=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.manager.preload(this.metadata.target,e)]})})},e.prototype.save=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.save(this.metadata.target,e,t)]})})},e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.save(e,t)]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOne(e)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to update by a given criteria");return Object.assign(r,t),[4,this.save(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.updateById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.manager.updateById(this.metadata.target,e,t,n)]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.remove(this.metadata.target,e,t)]})})},e.prototype.removeById=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.removeById(this.metadata.target,e,t)]})})},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,t)},e.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},e.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.query(e,t)]})})},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.clear(this.metadata.target)]})})},e}(),e("Repository",n)}}}),System.register("typeorm/subscriber/event/UpdateEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/RemoveEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/InsertEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/EntitySubscriberInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/RepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name="RepositoryNotFoundError";var i="function"==typeof n&&n.name?n.name:n;return r.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+t+'" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("RepositoryNotFoundError",n)}}}),System.register("typeorm/util/DirectoryExportedClassesLoader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";function n(e,t){function n(e,t){return e instanceof Function?t.push(e):e instanceof Object?Object.keys(e).forEach(function(r){return n(e[r],t)}):e instanceof Array&&e.forEach(function(e){return n(e,t)}),t}return void 0===t&&(t=[".js",".ts"]),n(e.reduce(function(e,t){return e.concat(i.PlatformTools.load("glob").sync(i.PlatformTools.pathNormilize(t)))},[]).filter(function(e){var n=e.substring(e.length-5,e.length);return-1!==t.indexOf(i.PlatformTools.pathExtname(e))&&".d.ts"!==n}).map(function(e){return i.PlatformTools.load(i.PlatformTools.pathResolve(e))}),[])}function r(e,t){return void 0===t&&(t=".json"),e.reduce(function(e,t){return e.concat(i.PlatformTools.load("glob").sync(i.PlatformTools.pathNormilize(t)))},[]).filter(function(e){return i.PlatformTools.pathExtname(e)===t}).map(function(e){return i.PlatformTools.load(i.PlatformTools.pathResolve(e))})}t&&t.id;e("importClassesFromDirectories",n),e("importJsonsFromDirectories",r);var i;return{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/metadata-args/NamingStrategyMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinTableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntitySubscriberMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/InheritanceMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/DiscriminatorValueMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntityRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionEntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-builder/MetadataUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),e("MetadataUtils",n)}}}),System.register("typeorm/metadata-args/MetadataArgsStorage",["typeorm/metadata-builder/MetadataUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){this.tables=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.columns=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.tables.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterColumns=function(e){return this.columns.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelations=function(e){return this.relations.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelationIds=function(e){return this.relationIds.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelationCounts=function(e){return this.relationCounts.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.entityListeners.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterEmbeddeds=function(e){return this.embeddeds.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.entitySubscribers.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterNamingStrategies=function(e){return this.namingStrategies.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterTransactionEntityManagers=function(e){return this.transactionEntityManagers.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&n.MetadataUtils.isInherited(t.target,e)&&"single-table-child"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e}(),e("MetadataArgsStorage",r)}}}),System.register("typeorm/metadata-builder/JunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/IndexMetadata"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var a=this,s=this.collectReferencedColumns(e,t),u=this.collectInverseReferencedColumns(e,t),c=t.name||this.connection.driver.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),l=new n.EntityMetadata({connection:this.connection,args:{target:"",name:c,type:"junction"}}),d=s.map(function(n){var i=t.joinColumns?t.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.driver.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new r.ColumnMetadata({entityMetadata:l,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:o,options:{name:o,length:n.length,type:n.type,nullable:!1,primary:!0}}})}),p=u.map(function(n){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.driver.namingStrategy.joinTableColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new r.ColumnMetadata({entityMetadata:l,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:o,options:{length:n.length,type:n.type,name:o,nullable:!1,primary:!0}}})});return l.ownColumns=d.concat(p),l.ownColumns.forEach(function(t){return t.relationMetadata=e}),l.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.entityMetadata,columns:d,referencedColumns:s}),new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.inverseEntityMetadata,columns:p,referencedColumns:u})],l.indices=[new o.IndexMetadata({entityMetadata:l,columns:d,args:{target:"",unique:!1}}),new o.IndexMetadata({entityMetadata:l,columns:p,args:{target:"",unique:!1}})],l},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter(function(e){return e.isPrimary}):t.joinColumns.map(function(t){var n=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n})},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map(function(t){var n=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n})},e}(),e("JunctionEntityMetadataBuilder",a)}}}),System.register("typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/types/ColumnTypes"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=new n.EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.tableNameWithoutPrefix,type:"closure-junction"}});return e.primaryColumns.forEach(function(e){t.ownColumns.push(new r.ColumnMetadata({entityMetadata:t,args:{target:"",mode:"virtual",propertyName:"ancestor_"+e.databaseName,options:{length:e.length,type:e.type}}})),t.ownColumns.push(new r.ColumnMetadata({entityMetadata:t,args:{target:"",mode:"virtual",propertyName:"descendant_"+e.databaseName,options:{length:e.length,type:e.type}}}))}),e.treeLevelColumn&&t.ownColumns.push(new r.ColumnMetadata({entityMetadata:t,args:{target:"",mode:"virtual",propertyName:"level",options:{type:o.ColumnTypes.INTEGER}}})),t.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:t,referencedEntityMetadata:e,columns:[t.ownColumns[0]],referencedColumns:e.primaryColumns}),new i.ForeignKeyMetadata({entityMetadata:t,referencedEntityMetadata:e,columns:[t.ownColumns[1]],referencedColumns:e.primaryColumns})],t},e}(),e("ClosureJunctionEntityMetadataBuilder",a)}}}),System.register("typeorm/metadata-builder/RelationJoinColumnBuilder",["typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(n.length){var i=this.collectColumns(e,t,n);return new r.ForeignKeyMetadata({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.driver.namingStrategy,columns:i,referencedColumns:n,onDelete:t.onDelete})}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var n=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!n)throw new Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n})},e.prototype.collectColumns=function(e,t,r){var i=this;return r.map(function(r){var o=e.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}),a=o?o.name:i.connection.driver.namingStrategy.joinColumnName(t.propertyName,r.propertyName),s=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return s||(s=new n.ColumnMetadata({entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:r.type,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(s)),s.referencedColumn=r,s.type=r.type,s.relationMetadata=t,s.build(i.connection.driver.namingStrategy),s})},e}(),e("RelationJoinColumnBuilder",i)}}}),System.register("typeorm/metadata-builder/EntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/IndexMetadata","typeorm/metadata/RelationMetadata","typeorm/metadata/EmbeddedMetadata","typeorm/metadata/RelationIdMetadata","typeorm/metadata/RelationCountMetadata","typeorm/metadata-builder/MetadataUtils","typeorm/metadata-builder/JunctionEntityMetadataBuilder","typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder","typeorm/metadata-builder/RelationJoinColumnBuilder","typeorm/metadata/EntityListenerMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e}],execute:function(){y=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new l.JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new d.ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new p.RelationJoinColumnBuilder(e)}return e.prototype.build=function(e){var t=this,n=e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables,i=n.filter(function(e){return"regular"===e.type||"closure"===e.type||"class-table-child"===e.type||"single-table-child"===e.type}),o=i.map(function(e){return t.createEntityMetadata(e)});return o.forEach(function(e){return t.computeEntityMetadata(e)}),o.forEach(function(e){return t.computeInverseProperties(e,o)}),o.filter(function(e){return"single-table-child"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n);i&&(n.registerForeignKeys(i),e.foreignKeys.push(i))}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var n=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(n){var r=t.junctionEntityMetadataBuilder.build(e,n);e.registerForeignKeys.apply(e,r.foreignKeys),e.registerJunctionEntityMetadata(r),t.computeEntityMetadata(r),t.computeInverseProperties(r,o),o.push(r)}}),e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),o.filter(function(e){return e.isClosure}).forEach(function(e){var n=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=n,t.computeEntityMetadata(n),t.computeInverseProperties(n,o),o.push(n)}),o.filter(function(e){return"single-table-child"===e.tableType||"class-table-child"===e.tableType}).forEach(function(e){var t=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target],n=o.find(function(e){return t.find(function(t){return t===e.target})&&("single-table"===e.inheritanceType||"class-table"===e.inheritanceType)});n&&(e.parentEntityMetadata=n,"single-table"===n.inheritanceType&&(e.tableName=n.tableName))}),o.forEach(function(e){e.childEntityMetadatas=o.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&c.MetadataUtils.isInherited(t.target,e.target)})}),o.filter(function(e){return"single-table"===e.inheritanceType&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),o.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.driver.namingStrategy)})}),o.filter(function(e){return!!e.parentEntityMetadata&&"class-table-child"===e.tableType}).forEach(function(e){var n=e.parentEntityMetadata.primaryColumns,i=n.map(function(n){var i=t.connection.driver.namingStrategy.classTableInheritanceParentColumnName(e.parentEntityMetadata.tableName,n.propertyPath),o=new r.ColumnMetadata({entityMetadata:e,referencedColumn:n,args:{target:e.target,propertyName:i,mode:"parentId",options:{name:i,type:n.type,unique:!0,nullable:!1,primary:!0}}});return e.registerColumn(o),o.build(t.connection.driver.namingStrategy),o});e.foreignKeys=[new f.ForeignKeyMetadata({entityMetadata:e,referencedEntityMetadata:e.parentEntityMetadata,namingStrategy:t.connection.driver.namingStrategy,columns:i,referencedColumns:n,onDelete:"CASCADE"})]}),o.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(n){t.connection.driver.lazyRelationsWrapper.wrap(e.target.prototype,n)})}),o},e.prototype.createEntityMetadata=function(e){var t,a=this,l=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target];"single-table-child"===e.type?(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),l.push.apply(l,t)):"class-table-child"===e.type&&l.forEach(function(e){!!a.metadataArgsStorage.inheritances.find(function(t){return t.target===e})&&l.splice(l.indexOf(e),1)});var d=new n.EntityMetadata({connection:this.connection,args:e}),p=this.metadataArgsStorage.findInheritanceType(e.target);d.inheritanceType=p?p.type:void 0;var f=this.metadataArgsStorage.findDiscriminatorValue(e.target);return d.discriminatorValue=f?f.value:e.target.name,d.embeddeds=this.createEmbeddedsRecursively(d,this.metadataArgsStorage.filterEmbeddeds(l)),d.ownColumns=this.metadataArgsStorage.filterColumns(l).map(function(e){var n=new r.ColumnMetadata({entityMetadata:d,args:e});return t&&-1!==t.indexOf(e.target)&&(n.isNullable=!0),n}),d.ownRelations=this.metadataArgsStorage.filterRelations(l).map(function(e){return new o.RelationMetadata({entityMetadata:d,args:e})}),d.relationIds=this.metadataArgsStorage.filterRelationIds(l).map(function(e){return new s.RelationIdMetadata({entityMetadata:d,args:e})}),d.relationCounts=this.metadataArgsStorage.filterRelationCounts(l).map(function(e){return new u.RelationCountMetadata({entityMetadata:d,args:e})}),d.indices=this.metadataArgsStorage.filterIndices(l).map(function(e){return new i.IndexMetadata({entityMetadata:d,args:e})}),d.listeners=this.metadataArgsStorage.filterListeners(l).map(function(e){return new m.EntityListenerMetadata(e)}),d},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map(function(t){var i=new a.EmbeddedMetadata({entityMetadata:e,args:t});return i.columns=n.metadataArgsStorage.filterColumns(i.type).map(function(t){return new r.ColumnMetadata({entityMetadata:e,embeddedMetadata:i,args:t})}),i.relations=n.metadataArgsStorage.filterRelations(i.type).map(function(t){return new o.RelationMetadata({entityMetadata:e,embeddedMetadata:i,args:t})}),i.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i.type)),i.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=i}),i})},e.prototype.computeEntityMetadata=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection.driver.namingStrategy)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection.driver.namingStrategy)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection.driver.namingStrategy)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumn=e.columns.find(function(e){return e.isGenerated}),e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.parentIdColumns=e.columns.filter(function(e){return e.isParentId}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.driver.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(n){var r=t.find(function(e){return e.target===n.type||"string"==typeof n.type&&e.targetName===n.type});if(!r)throw new Error("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object, check its really entity and its connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(e){return e.propertyPath===n.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new i.IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}),new i.IndexMetadata({entityMetadata:e,columns:e.primaryColumns.concat([e.discriminatorColumn]),args:{target:e.target,unique:!1}}))},e}(),e("EntityMetadataBuilder",y)}}}),System.register("typeorm/util/RandomGenerator",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.sha1=function(e){var t,n,r,i,o,a,s,u,c,l=function(e,t){return e<<t|e>>>32-t},d=function(e){var t,n,r="";for(t=7;t>=0;t--)n=e>>>4*t&15,r+=n.toString(16);return r},p=new Array(80),m=1732584193,f=4023233417,y=2562383102,h=271733878,g=3285377520;e=encodeURIComponent(e);var v=e.length,b=[];for(n=0;n<v-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(v%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(v-1)<<24|8388608;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=m,o=f,a=y,s=h,u=g,n=0;n<=19;n++)c=l(i,5)+(o&a|~o&s)+u+p[n]+1518500249&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(o^a^s)+u+p[n]+1859775393&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(o&a|o&s|a&s)+u+p[n]+2400959708&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(o^a^s)+u+p[n]+3395469782&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;m=m+i&4294967295,f=f+o&4294967295,y=y+a&4294967295,h=h+s&4294967295,g=g+u&4294967295}return c=d(m)+d(f)+d(y)+d(h)+d(g),c.toLowerCase()},e}(),e("RandomGenerator",n)}}}),System.register("typeorm/util/StringUtils",[],function(e,t){"use strict";function n(e){return e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,t,n,r){return n?n.toUpperCase():t.toLowerCase()})}function r(e){return e.replace(/(?:^|\.?)([A-Z])/g,function(e,t){return"_"+t.toLowerCase()}).replace(/^_/,"")}function i(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}t&&t.id;return e("camelCase",n),e("snakeCase",r),e("titleCase",i),{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/DefaultNamingStrategy",["typeorm/util/RandomGenerator","typeorm/util/StringUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.tableName=function(e,t){return t||r.snakeCase(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){return n.length?r.camelCase(n.join("_"))+(t?r.titleCase(t):r.titleCase(e)):t||e},e.prototype.relationName=function(e){return e},e.prototype.indexName=function(e,t,r){if(e)return e;var i="ind_"+t+"_"+r.join("_");return"ind_"+n.RandomGenerator.sha1(i).substr(0,26)},e.prototype.joinColumnName=function(e,t){return r.camelCase(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,i){return r.snakeCase(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return r.camelCase(e+"_"+(n||t))},e.prototype.foreignKeyName=function(e,t,r,i){var o=e+"_"+t.join("_")+"_"+r+"_"+i.join("_");return"fk_"+n.RandomGenerator.sha1(o).substr(0,27)},e.prototype.classTableInheritanceParentColumnName=function(e,t){return r.camelCase(e+"_"+t)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),e("DefaultNamingStrategy",i)}}}),System.register("typeorm/connection/error/CannotImportAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="CannotImportAlreadyConnected",r.message="Cannot import "+t+' for "'+n+'" connection because connection to the database already established.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotImportAlreadyConnectedError",n)}}}),System.register("typeorm/connection/error/CannotCloseNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotCloseNotConnectedError",n.message='Cannot close "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotCloseNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotConnectAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotConnectAlreadyConnectedError",n.message='Cannot create a "'+t+'" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotConnectAlreadyConnectedError",n)}}}),
System.register("typeorm/connection/error/NamingStrategyNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name="NamingStrategyNotFoundError";var i=t instanceof Function?t.name:t;return r.message='Naming strategy "'+i+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+n+'" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("NamingStrategyNotFoundError",n)}}}),System.register("typeorm/decorator/options/JoinColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinTableMuplipleColumnsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchema",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/CannotSyncNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotSyncNotConnectedError",n.message='Cannot sync schema of the "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotSyncNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotUseNamingStrategyNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotUseNamingStrategyNotConnectedError",n.message='Cannot use a given naming strategy for "'+t+'" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotUseNamingStrategyNotConnectedError",n)}}}),System.register("typeorm/subscriber/Broadcaster",["typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.connection=e,this.subscriberMetadatas=t}return e.prototype.broadcastBeforeEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastBeforeInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastBeforeUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastBeforeRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastAfterEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastAfterInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastAfterUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastAfterRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastBeforeInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_INSERT&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeInsert}).map(function(n){return n.beforeInsert({manager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_UPDATE&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeUpdate}).map(function(n){return n.beforeUpdate({manager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_REMOVE&&e.isAllowed(t.entity)}).map(function(e){return t.databaseEntity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeRemove}).map(function(n){return n.beforeRemove({manager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_INSERT&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterInsert}).map(function(n){return n.afterInsert({manager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_UPDATE&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterUpdate}).map(function(n){return n.afterUpdate({manager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_REMOVE&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.subscriberMetadatas.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterRemove}).map(function(n){return n.afterRemove({manager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastLoadEventsForAll=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.broadcastLoadEvents(e,t)}))];case 1:return r.sent(),[2]}})})},e.prototype.broadcastLoadEvents=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t instanceof Promise?[2]:(r=this.connection.getMetadata(e).relations.reduce(function(e,n){if(!t.hasOwnProperty(n.propertyName))return e;var r=n.getEntityValue(t);return r instanceof Array?e=e.concat(a.broadcastLoadEventsForAll(n.inverseEntityMetadata.target,r)):r&&e.push(a.broadcastLoadEvents(n.inverseEntityMetadata.target,r)),e},[]),i=this.connection.getMetadata(e).listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_LOAD&&e.isAllowed(t)}).map(function(e){return t[e.propertyName]()}),o=this.subscriberMetadatas.filter(function(t){return a.isAllowedSubscriber(t,e)&&t.afterLoad}).map(function(e){return e.afterLoad(t)}),[4,Promise.all(r.concat(i.concat(o)))]);case 1:return s.sent(),[2]}})})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t},e}(),e("Broadcaster",r)}}}),System.register("typeorm/schema-builder/SchemaBuilder",["typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e,t,n){this.driver=e,this.logger=t,this.entityMetadatas=n}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:return e=this,[4,this.driver.createQueryRunner()];case 1:return e.queryRunner=r.sent(),t=this,[4,this.loadTableSchemas()];case 2:return t.tableSchemas=r.sent(),[4,this.queryRunner.beginTransaction()];case 3:r.sent(),r.label=4;case 4:return r.trys.push([4,14,16,18]),[4,this.dropOldForeignKeys()];case 5:return r.sent(),[4,this.createNewTables()];case 6:return r.sent(),[4,this.dropRemovedColumns()];case 7:return r.sent(),[4,this.addNewColumns()];case 8:return r.sent(),[4,this.updateExistColumns()];case 9:return r.sent(),[4,this.updatePrimaryKeys()];case 10:return r.sent(),[4,this.createIndices()];case 11:return r.sent(),[4,this.createForeignKeys()];case 12:return r.sent(),[4,this.queryRunner.commitTransaction()];case 13:return r.sent(),[3,18];case 14:return n=r.sent(),[4,this.queryRunner.rollbackTransaction()];case 15:throw r.sent(),n;case 16:return[4,this.queryRunner.release()];case 17:return r.sent(),[7];case 18:return[2]}})})},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.entityMetadatas.filter(function(e){return!e.skipSchemaSync&&"single-table-child"!==e.tableType})},enumerable:!0,configurable:!0}),e.prototype.loadTableSchemas=function(){var e=this.entityToSyncMetadatas.map(function(e){return e.tableName});return this.queryRunner.loadTableSchemas(e)},e.prototype.dropOldForeignKeys=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=e.foreignKeys.filter(function(e){return!t.foreignKeys.find(function(t){return t.name===e.name})}),0===n.length?[2]:(this.logger.logSchemaBuild("dropping old foreign keys of "+e.name+": "+n.map(function(e){return e.name}).join(", ")),e.removeForeignKeys(n),[4,this.queryRunner.dropForeignKeys(e,n)])):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewTables=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?[2]:(this.logger.logSchemaBuild("creating a new table: "+t.tableName),r=new n.TableSchema(t.tableName,this.metadataColumnsToColumnSchemas(t.columns),!0),this.tableSchemas.push(r),[4,this.queryRunner.createTable(r)]);case 1:return i.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=e.columns.filter(function(e){return!t.columns.find(function(t){return t.databaseName===e.name})}),0===n.length?[2]:[4,Promise.all(n.map(function(e){return r.dropColumnReferencedForeignKeys(t.tableName,e.name)}))]):[2];case 1:return i.sent(),[4,Promise.all(n.map(function(e){return r.dropColumnReferencedIndices(t.tableName,e.name)}))];case 2:return i.sent(),this.logger.logSchemaBuild("columns dropped in "+e.name+": "+n.map(function(e){return e.name}).join(", ")),e.removeColumns(n),e.removePrimaryKeysOfColumns(n),[4,this.queryRunner.dropColumns(e,n)];case 3:return i.sent(),[2]}})})})},e.prototype.addNewColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.databaseName})}),0===n.length?[2]:(this.logger.logSchemaBuild("new columns added: "+n.map(function(e){return e.databaseName}).join(", ")),r=this.metadataColumnsToColumnSchemas(n),[4,this.queryRunner.addColumns(e,r)])):[2];case 1:return i.sent(),e.addColumns(r),[2]}})})})},e.prototype.updateExistColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=e.findChangedColumns(this.queryRunner,t.columns),0===n.length?[2]:(this.logger.logSchemaBuild("columns changed in "+e.name+". updating: "+n.map(function(e){return e.name}).join(", ")),i=n.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedForeignKeys(t.tableName,e.name)}),[4,Promise.all(i)])):[2];case 1:return u.sent(),o=n.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedIndices(t.tableName,e.name)}),[4,Promise.all(o)];case 2:return u.sent(),a=n.map(function(n){var i=t.columns.find(function(e){return e.databaseName===n.name}),o=r.ColumnSchema.create(i,s.queryRunner.normalizeType(i));return e.replaceColumn(n,o),{newColumn:o,oldColumn:n}}),[2,this.queryRunner.changeColumns(e,a)]}})})})},e.prototype.updatePrimaryKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName&&!e.justCreated}))?(n=t.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r=n.filter(function(t){return!e.primaryKeysWithoutGenerated.find(function(e){return e.columnName===t.databaseName})}).map(function(e){return new a.PrimaryKeySchema("",e.databaseName)}),i=e.primaryKeysWithoutGenerated.filter(function(e){return!n.find(function(t){return t.databaseName===e.columnName})}),0===r.length&&0===i.length?[2]:(this.logger.logSchemaBuild("primary keys of "+e.name+" has changed: dropped - "+(i.map(function(e){return e.columnName}).join(", ")||"nothing")+"; added - "+(r.map(function(e){return e.columnName}).join(", ")||"nothing")),e.addPrimaryKeys(r),e.removePrimaryKeys(i),[4,this.queryRunner.updatePrimaryKeys(e)])):[2];case 1:return o.sent(),[2]}})})})},e.prototype.createForeignKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=t.foreignKeys.filter(function(t){return!e.foreignKeys.find(function(e){return e.name===t.name})}),0===n.length?[2]:(r=n.map(function(e){return i.ForeignKeySchema.create(e)}),this.logger.logSchemaBuild("creating a foreign keys: "+n.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.createForeignKeys(e,r)])):[2];case 1:return o.sent(),e.addForeignKeys(r),[2]}})})})},e.prototype.createIndices=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=e.indices.filter(function(e){return!t.indices.find(function(t){return t.name===e.name})}).map(function(n){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.logger.logSchemaBuild("dropping an index: "+n.name),e.removeIndex(n),[4,this.queryRunner.dropIndex(t.tableName,n.name)];case 1:return r.sent(),[2]}})})}),r=t.indices.filter(function(t){return!e.indices.find(function(e){return e.name===t.name})}).map(function(t){return __awaiter(i,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=o.IndexSchema.create(t),e.indices.push(n),this.logger.logSchemaBuild("adding new index: "+n.name),[4,this.queryRunner.createIndex(n.tableName,n)];case 1:return r.sent(),[2]}})})}),[4,Promise.all(n.concat(r))]):[2];case 1:return a.sent(),[2]}})})})},e.prototype.dropColumnReferencedIndices=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return n=this.entityMetadatas.reduce(function(e,t){return e.concat(t.indices)},[]),(r=this.tableSchemas.find(function(t){return t.name===e}))?(i=n.filter(function(n){return n.tableName===e&&!!n.columns.find(function(e){return e.databaseName===t})}),i.length?(o=r.indices.filter(function(e){return!!i.find(function(t){return e.name===t.name})}),0===o.length?[2]:(this.logger.logSchemaBuild("dropping related indices of "+e+"#"+t+": "+o.map(function(e){return e.name}).join(", ")),a=o.map(function(e){return r.removeIndex(e),s.queryRunner.dropIndex(r.name,e.name)}),[4,Promise.all(a)])):[2]):[2];case 1:return u.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.entityMetadatas.reduce(function(e,t){return e.concat(t.foreignKeys)},[]),(r=this.tableSchemas.find(function(t){return t.name===e}))?(o=n.filter(function(n){return n.tableName===e?!!n.columns.find(function(e){return e.databaseName===t}):n.referencedTableName===e&&!!n.referencedColumns.find(function(e){return e.databaseName===t})}),o.length?(a=o.filter(function(e){return!!r.foreignKeys.find(function(t){return t.name===e.name})}),0===a.length?[2]:(this.logger.logSchemaBuild("dropping related foreign keys of "+e+"#"+t+": "+a.map(function(e){return e.name}).join(", ")),s=a.map(function(e){return i.ForeignKeySchema.create(e)}),r.removeForeignKeys(s),[4,this.queryRunner.dropForeignKeys(r,s)])):[2]):[2];case 1:return u.sent(),[2]}})})},e.prototype.metadataColumnsToColumnSchemas=function(e){var t=this;return e.map(function(e){return r.ColumnSchema.create(e,t.queryRunner.normalizeType(e))})},e}(),e("SchemaBuilder",u)}}}),System.register("typeorm/metadata-args/error/EntityMetadataNotFound",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name="EntityMetadataNotFound";var r="function"==typeof t&&t.name?t.name:t;return n.message='No metadata for "'+r+'" was found.',n}return __extends(t,e),t}(Error),e("EntityMetadataNotFound",n)}}}),System.register("typeorm/migration/MigrationInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/migration/Migration",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.timestamp=e,this.name=t,this.instance=n}return e}(),e("Migration",n)}}}),System.register("typeorm/migration/MigrationExecutor",["typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/types/ColumnTypes","typeorm/query-builder/QueryBuilder","typeorm/query-runner/QueryRunnerProvider","typeorm/migration/Migration","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e,t){this.connection=e,this.queryRunnerProvider=t||new a.QueryRunnerProvider(e.driver,!0)}return e.prototype.executePendingMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s,c=this;return __generator(this,function(l){switch(l.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return e=l.sent(),t=this.connection.createEntityManagerWithSingleDatabaseConnection(this.queryRunnerProvider),[4,this.createMigrationsTableIfNotExist()];case 2:return l.sent(),[4,this.loadExecutedMigrations()];case 3:return n=l.sent(),(r=this.getLatestMigration(n),i=this.getMigrations(),o=i.filter(function(e){if(n.find(function(t){return t.name===e.name}))return!1;if(r&&e.timestamp<r.timestamp)throw new Error("New migration found: "+e.name+", however this migration's timestamp is not valid. Migration's timestamp should not be older then migrations already executed in the database.");return!0}),o.length)?(this.connection.logger.log("info",n.length+" migrations are already loaded in the database."),this.connection.logger.log("info",i.length+" migrations were found in the source code."),r&&this.connection.logger.log("info",r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.log("info",o.length+" migrations are new migrations that needs to be executed."),a=!1,e.isTransactionActive()?[3,5]:[4,e.beginTransaction()]):(this.connection.logger.log("info","No migrations are pending"),[2]);case 4:l.sent(),a=!0,l.label=5;case 5:return l.trys.push([5,9,,12]),[4,u.PromiseUtils.runInSequence(o,function(n){return n.instance.up(e,c.connection,t).then(function(){return c.insertExecutedMigration(n)}).then(function(){c.connection.logger.log("info","Migration "+n.name+" has been executed successfully.")})})];case 6:return l.sent(),a?[4,e.commitTransaction()]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,12];case 9:return s=l.sent(),a?[4,e.rollbackTransaction()]:[3,11];case 10:l.sent(),l.label=11;case 11:throw s;case 12:return[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return e=u.sent(),t=this.connection.createEntityManagerWithSingleDatabaseConnection(this.queryRunnerProvider),[4,this.createMigrationsTableIfNotExist()];case 2:return u.sent(),[4,this.loadExecutedMigrations()];case 3:if(n=u.sent(),!(r=this.getLatestMigration(n)))return this.connection.logger.log("info","No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(o=i.find(function(e){return e.name===r.name})))throw new Error("No migration "+r.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.log("info",n.length+" migrations are already loaded in the database."),this.connection.logger.log("info",r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.log("info","Now reverting it..."),a=!1,e.isTransactionActive()?[3,5]:[4,e.beginTransaction()];case 4:u.sent(),a=!0,u.label=5;case 5:return u.trys.push([5,10,,13]),[4,o.instance.down(e,this.connection,t)];case 6:return u.sent(),[4,this.deleteExecutedMigration(o)];case 7:return u.sent(),this.connection.logger.log("info","Migration "+o.name+" has been reverted successfully."),a?[4,e.commitTransaction()]:[3,9];case 8:u.sent(),u.label=9;case 9:return[3,13];case 10:return s=u.sent(),a?[4,e.rollbackTransaction()]:[3,12];case 11:u.sent(),u.label=12;case 12:throw s;case 13:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(o){switch(o.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return e=o.sent(),[4,e.hasTable("migrations")];case 2:return t=o.sent(),t?[3,4]:[4,e.createTable(new n.TableSchema("migrations",[new r.ColumnSchema({name:"timestamp",type:e.normalizeType({type:i.ColumnTypes.NUMBER}),isPrimary:!0,isNullable:!1}),new r.ColumnSchema({name:"name",type:e.normalizeType({type:i.ColumnTypes.STRING}),isNullable:!1})]))];case 3:o.sent(),o.label=4;case 4:return[2]}})})},e.prototype.loadExecutedMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,new o.QueryBuilder(this.connection,this.queryRunnerProvider).select().fromTable("migrations","migrations").getRawMany()];case 1:return e=t.sent(),[2,e.map(function(e){return new s.Migration(parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.getMigrations().map(function(e){var t=e.constructor.name,n=parseInt(t.substr(-13));if(!n)throw new Error("Migration class name should contain a class name at the end of the file. "+t+" migration name is wrong.");return new s.Migration(n,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return t.length>0?t[0]:void 0},e.prototype.insertExecutedMigration=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return t=n.sent(),[4,t.insert("migrations",{timestamp:e.timestamp,name:e.name})];case 2:return n.sent(),[2]}})})},e.prototype.deleteExecutedMigration=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.queryRunnerProvider.provide()];case 1:return t=n.sent(),[4,t.delete("migrations",{timestamp:e.timestamp,name:e.name})];case 2:return n.sent(),[2]}})})},e}(),e("MigrationExecutor",c)}}}),System.register("typeorm/connection/error/CannotRunMigrationNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotRunMigrationNotConnectedError",n.message='Cannot run/revert migrations on "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotRunMigrationNotConnectedError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryReusedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+" was already used in the different connection. You can't share entity repositories between different connections when useContainer is set to true for the entity repository.")||this;return n.name="CustomRepositoryReusedError",n}return __extends(t,e),t}(Error),e("CustomRepositoryReusedError",n)}}}),System.register("typeorm/decorator/options/JoinTableOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaTransformer",["typeorm/metadata-args/MetadataArgsStorage"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.transform=function(e){var t=new n.MetadataArgsStorage;return e.forEach(function(e){var n=e.table||{},r={target:e.target||e.name,name:n.name,type:n.type||"regular",orderBy:n.orderBy};t.tables.push(r),Object.keys(e.columns).forEach(function(n){var r=e.columns[n],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel");var o={target:e.target||e.name,mode:i,propertyName:n,options:{type:r.type,name:r.name,length:r.length,primary:r.primary,generated:r.generated,unique:r.unique,nullable:r.nullable,comment:r.comment,default:r.default,precision:r.precision,scale:r.scale}};t.columns.push(o)}),e.relations&&Object.keys(e.relations).forEach(function(n){var r=e.relations[n],i={target:e.target||e.name,propertyName:n,relationType:r.type,isLazy:r.isLazy||!1,type:r.target,inverseSideProperty:r.inverseSide,isTreeParent:r.isTreeParent,isTreeChildren:r.isTreeChildren,options:{cascadeAll:r.cascadeAll,cascadeInsert:r.cascadeInsert,cascadeUpdate:r.cascadeUpdate,cascadeRemove:r.cascadeRemove,nullable:r.nullable,onDelete:r.onDelete}};if(t.relations.push(i),r.joinColumn)if("boolean"==typeof r.joinColumn){var o={target:e.target||e.name,propertyName:n};t.joinColumns.push(o)}else{var o={target:e.target||e.name,propertyName:n,name:r.joinColumn.name,referencedColumnName:r.joinColumn.referencedColumnName};t.joinColumns.push(o)}if(r.joinTable)if("boolean"==typeof r.joinTable){var a={target:e.target||e.name,propertyName:n};t.joinTables.push(a)}else{var a={target:e.target||e.name,propertyName:n,name:r.joinTable.name,joinColumns:r.joinTable.joinColumn?[r.joinTable.joinColumn]:r.joinTable.joinColumns,inverseJoinColumns:r.joinTable.inverseJoinColumn?[r.joinTable.inverseJoinColumn]:r.joinTable.inverseJoinColumns};t.joinTables.push(a)}})}),t},e}(),e("EntitySchemaTransformer",r)}}}),System.register("typeorm/metadata-builder/error/MissingPrimaryColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="MissingPrimaryColumnError",n.message='Entity "'+t.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',n}return __extends(t,e),t}(Error),e("MissingPrimaryColumnError",n)}}}),System.register("typeorm/metadata-builder/error/CircularRelationsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Circular relations detected: "+t+". To resolve this issue you need to set nullable: false somewhere in this dependency structure.")||this;return n.name="CircularRelationsError",n}return __extends(t,e),t}(Error),e("CircularRelationsError",n)}}}),System.register("typeorm/util/DepGraph",[],function(e,t){"use strict";function n(e,t,n){var r=[],i={};return function o(a){i[a]=!0,r.push(a),e[a].forEach(function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error("Dependency Cycle Found: "+r.join(" -> "))}else o(e)}),r.pop(),t&&0!==e[a].length||-1!==n.indexOf(a)||n.push(a)}}var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){
Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.outgoingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.incomingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,r=[],i=Object.keys(this.nodes);if(0===i.length)return r;var o=n(this.outgoingEdges,!1,[]);i.forEach(function(e){o(e)});var a=n(this.outgoingEdges,e,r);return i.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),r},e}(),e("DepGraph",r)}}}),System.register("typeorm/metadata-builder/EntityMetadataValidator",["typeorm/metadata-builder/error/MissingPrimaryColumnError","typeorm/metadata-builder/error/CircularRelationsError","typeorm/util/DepGraph"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return e.prototype.validateMany=function(e){var t=this;e.forEach(function(n){return t.validate(n,e)}),this.validateDependencies(e)},e.prototype.validate=function(e,t){if(!e.isClassTableChild&&!e.primaryColumns.length&&!e.isJunction)throw new n.MissingPrimaryColumnError(e);if("single-table"===e.inheritanceType){if(!e.discriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put @DiscriminatorColumn decorator?");if(-1!==["",void 0,null].indexOf(e.discriminatorValue))throw new Error("Entity "+e.name+" has empty discriminator value. Discriminator value should not be empty.");var r=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(r)throw new Error("Entities "+e.name+" and "+r.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),e.relations.forEach(function(e){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")})},e.prototype.validateDependencies=function(e){var t=new i.DepGraph;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new r.CircularRelationsError(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e}(),e("EntityMetadataValidator",o)}}}),System.register("typeorm/connection/Connection",["typeorm/connection/error/RepositoryNotFoundError","typeorm/entity-manager/EntityManager","typeorm/util/DirectoryExportedClassesLoader","typeorm/index","typeorm/metadata-builder/EntityMetadataBuilder","typeorm/naming-strategy/DefaultNamingStrategy","typeorm/connection/error/CannotImportAlreadyConnectedError","typeorm/connection/error/CannotCloseNotConnectedError","typeorm/connection/error/CannotConnectAlreadyConnectedError","typeorm/connection/error/NamingStrategyNotFoundError","typeorm/connection/error/RepositoryNotTreeError","typeorm/connection/error/CannotSyncNotConnectedError","typeorm/connection/error/CannotUseNamingStrategyNotConnectedError","typeorm/subscriber/Broadcaster","typeorm/lazy-loading/LazyRelationsWrapper","typeorm/repository/RepositoryAggregator","typeorm/schema-builder/SchemaBuilder","typeorm/query-runner/QueryRunnerProvider","typeorm/metadata-args/error/EntityMetadataNotFound","typeorm/migration/MigrationExecutor","typeorm/connection/error/CannotRunMigrationNotConnectedError","typeorm/platform/PlatformTools","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/MongoEntityManager","typeorm/entity-schema/EntitySchemaTransformer","typeorm/metadata-builder/EntityMetadataValidator"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b,E,_,C,T,N,w,R,M,A;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e},function(e){_=e},function(e){C=e},function(e){T=e},function(e){N=e},function(e){w=e},function(e){R=e},function(e){M=e}],execute:function(){A=function(){function e(e,t,n){this.entityMetadatas=[],this.repositoryAggregators=[],this.entityRepositories=[],this.entitySubscribers=[],this.entityClasses=[],this.entitySchemas=[],this.subscriberClasses=[],this.namingStrategyClasses=[],this.migrationClasses=[],this._isConnected=!1,this.name=e,this.driver=t,this.logger=n,this.manager=this.createEntityManager(),this.broadcaster=this.createBroadcaster()}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityManager",{get:function(){return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mongoEntityManager",{get:function(){if(!(this.manager instanceof w.MongoEntityManager))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new l.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:t.sent(),this._isConnected=!0,t.label=2;case 2:return t.trys.push([2,3,,5]),this.buildMetadatas(),[3,5];case 3:return e=t.sent(),[4,this.close()];case 4:throw t.sent(),e;case 5:return[2,this]}})})},e.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new c.CannotCloseNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this._isConnected=!1,[2]}})})},e.prototype.dropDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.driver.createQueryRunner()];case 1:return e=t.sent(),[4,e.clearDatabase()];case 2:return t.sent(),[2]}})})},e.prototype.syncSchema=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isConnected?e?[4,this.dropDatabase()]:[3,2]:[2,Promise.reject(new m.CannotSyncNotConnectedError(this.name))];case 1:t.sent(),t.label=2;case 2:return this.driver instanceof N.MongoDriver?[4,this.driver.syncSchema(this.entityMetadatas)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,this.createSchemaBuilder().build()];case 5:t.sent(),t.label=6;case 6:return[2]}})})},e.prototype.runMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.isConnected?(e=new _.MigrationExecutor(this),[4,e.executePendingMigrations()]):[2,Promise.reject(new C.CannotRunMigrationNotConnectedError(this.name))];case 1:return t.sent(),[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.isConnected?(e=new _.MigrationExecutor(this),[4,e.undoLastMigration()]):[2,Promise.reject(new C.CannotRunMigrationNotConnectedError(this.name))];case 1:return t.sent(),[2]}})})},e.prototype.importEntitiesFromDirectories=function(e){return this.importEntities(i.importClassesFromDirectories(e)),this},e.prototype.importEntitySchemaFromDirectories=function(e){return this.importEntitySchemas(i.importJsonsFromDirectories(e)),this},e.prototype.importSubscribersFromDirectories=function(e){return this.importSubscribers(i.importClassesFromDirectories(e)),this},e.prototype.importNamingStrategiesFromDirectories=function(e){return this.importNamingStrategies(i.importClassesFromDirectories(e)),this},e.prototype.importMigrationsFromDirectories=function(e){return this.importMigrations(i.importClassesFromDirectories(e)),this},e.prototype.importEntities=function(e){var t=this;if(this.isConnected)throw new u.CannotImportAlreadyConnectedError("entities",this.name);return e.forEach(function(e){return t.entityClasses.push(e)}),this},e.prototype.importEntitySchemas=function(e){var t=this;if(this.isConnected)throw new u.CannotImportAlreadyConnectedError("schemas",this.name);return e.forEach(function(e){return t.entitySchemas.push(e)}),this},e.prototype.importSubscribers=function(e){var t=this;if(this.isConnected)throw new u.CannotImportAlreadyConnectedError("entity subscribers",this.name);return e.forEach(function(e){return t.subscriberClasses.push(e)}),this},e.prototype.importNamingStrategies=function(e){var t=this;if(this.isConnected)throw new u.CannotImportAlreadyConnectedError("naming strategies",this.name);return e.forEach(function(e){return t.namingStrategyClasses.push(e)}),this},e.prototype.importMigrations=function(e){var t=this;if(this.isConnected)throw new u.CannotImportAlreadyConnectedError("migrations",this.name);return e.forEach(function(e){return t.migrationClasses.push(e)}),this},e.prototype.useNamingStrategy=function(e){if(this.isConnected)throw new f.CannotUseNamingStrategyNotConnectedError(this.name);return this.usedNamingStrategy=e,this},e.prototype.getMetadata=function(e){var t=this.entityMetadatas.find(function(t){return t.target===e||"string"==typeof e&&t.targetName===e});if(!t)throw new E.EntityMetadataNotFound(e);return t},e.prototype.getRepository=function(e){return this.findRepositoryAggregator(e).repository},e.prototype.getTreeRepository=function(e){var t=this.findRepositoryAggregator(e).treeRepository;if(!t)throw new p.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof N.MongoDriver))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.findRepositoryAggregator(e).repository},e.prototype.getSpecificRepository=function(e){return this.findRepositoryAggregator(e).specificRepository},e.prototype.createEntityManagerWithSingleDatabaseConnection=function(e){return e||(e=new b.QueryRunnerProvider(this.driver,!0)),new r.EntityManager(this,e)},e.prototype.getMigrations=function(){return this.migrationClasses&&this.migrationClasses.length?this.migrationClasses.map(function(e){return o.getFromContainer(e)}):[]},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.findRepositoryAggregator=function(e){if(!this.entityMetadatas.find(function(t){return t.target===e||"string"==typeof e&&t.targetName===e}))throw new n.RepositoryNotFoundError(this.name,e);var t=this.getMetadata(e),r=this.repositoryAggregators.find(function(e){return e.metadata===t});if(!r)throw new n.RepositoryNotFoundError(this.name,e);return r},e.prototype.buildMetadatas=function(){var e=this;this.entitySubscribers.length=0,this.repositoryAggregators.length=0,this.entityMetadatas.length=0,this.driver.namingStrategy=this.createNamingStrategy(),this.driver.lazyRelationsWrapper=this.createLazyRelationsWrapper();var t=new M.EntityMetadataValidator;if(this.subscriberClasses&&this.subscriberClasses.length&&!T.PlatformTools.getEnvVariable("SKIP_SUBSCRIBERS_LOADING")&&o.getMetadataArgsStorage().filterSubscribers(this.subscriberClasses).map(function(e){return o.getFromContainer(e.target)}).forEach(function(t){return e.entitySubscribers.push(t)}),this.entityClasses&&this.entityClasses.length&&new a.EntityMetadataBuilder(this,o.getMetadataArgsStorage()).build(this.entityClasses).forEach(function(t){e.entityMetadatas.push(t),e.repositoryAggregators.push(new g.RepositoryAggregator(e,t))}),this.entitySchemas&&this.entitySchemas.length){var n=o.getFromContainer(R.EntitySchemaTransformer).transform(this.entitySchemas);new a.EntityMetadataBuilder(this,n).build().forEach(function(t){e.entityMetadatas.push(t),e.repositoryAggregators.push(new g.RepositoryAggregator(e,t))})}t.validateMany(this.entityMetadatas)},e.prototype.createNamingStrategy=function(){var e=this;if(!this.namingStrategyClasses||!this.namingStrategyClasses.length||!this.usedNamingStrategy)return o.getFromContainer(s.DefaultNamingStrategy);var t=o.getMetadataArgsStorage().filterNamingStrategies(this.namingStrategyClasses).find(function(t){return"string"==typeof e.usedNamingStrategy?t.name===e.usedNamingStrategy:t.target===e.usedNamingStrategy});if(!t)throw new d.NamingStrategyNotFoundError(this.usedNamingStrategy,this.name);return o.getFromContainer(t.target)},e.prototype.createEntityManager=function(){return this.driver instanceof N.MongoDriver?new w.MongoEntityManager(this):new r.EntityManager(this)},e.prototype.createBroadcaster=function(){return new y.Broadcaster(this,this.entitySubscribers)},e.prototype.createSchemaBuilder=function(){return new v.SchemaBuilder(this.driver,this.logger,this.entityMetadatas)},e.prototype.createLazyRelationsWrapper=function(){return new h.LazyRelationsWrapper(this)},e}(),e("Connection",A)}}}),System.register("typeorm/connection/error/ConnectionNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="ConnectionNotFoundError",n.message='Connection "'+t+'" was not found.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("ConnectionNotFoundError",n)}}}),System.register("typeorm/connection/ConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/MissingDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="MissingDriverError",n.message="Wrong driver "+t+' given. Supported drivers are: "mysql", "postgres", "mssql", "oracle", "mariadb", "sqlite".',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("MissingDriverError",n)}}}),System.register("typeorm/connection/error/AlreadyHasActiveConnectionError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="AlreadyHasActiveConnectionError",n.message='Cannot create a new connection named "'+t+'", because connection with such name already exist and it now has an active connection session.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("AlreadyHasActiveConnectionError",n)}}}),System.register("typeorm/driver/sqlite/SqliteQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e}],execute:function(){p=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return i.sent(),[4,this.beginTransaction()];case 2:i.sent(),i.label=3;case 3:return i.trys.push([3,7,9,12]),e="select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 4:return t=i.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 5:return i.sent(),[4,this.commitTransaction()];case 6:return i.sent(),[3,12];case 7:return n=i.sent(),[4,this.rollbackTransaction()];case 8:throw i.sent(),n;case 9:return[4,this.release()];case 10:return i.sent(),[4,this.query("PRAGMA foreign_keys = ON;")];case 11:return i.sent(),[7];case 12:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.databaseConnection.isTransactionActive=!1,[2]}})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.all(e,t,function(o,a){o?(n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o)):r(a)})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return u.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES",s=r.map(function(e){return t[e]}),[2,new Promise(function(e,t){u.logger.logQuery(a,s);var r=u;u.databaseConnection.connection.run(a,s,function(i){if(i)r.logger.logFailedQuery(a,s),r.logger.logQueryError(i),t(i);else{if(n)return e(this.lastID);e()}})})]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return n=i.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t,n,r,i,a,d,p,m,f,y,h,g=this;return __generator(this,function(v){switch(v.label){case 0:return t=new s.TableSchema(e.name),[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return n=v.sent(),r=n[0],i=n[1],a=n[2],d=void 0,p=e.sql,-1!==p.indexOf("AUTOINCREMENT")&&(d=p.substr(0,p.indexOf("AUTOINCREMENT")),m=d.lastIndexOf(","),f=d.lastIndexOf("("),-1!==m?(d=d.substr(m),d=d.substr(0,d.lastIndexOf('"')),d=d.substr(d.indexOf('"')+1)):-1!==f&&(d=d.substr(f),d=d.substr(0,d.lastIndexOf('"')),d=d.substr(d.indexOf('"')+1))),t.columns=r.map(function(n){var r=new o.ColumnSchema;r.name=n.name,r.type=n.type.toLowerCase(),r.default=null!==n.dflt_value&&void 0!==n.dflt_value?n.dflt_value:void 0,r.isNullable=0===n.notnull,r.isPrimary=1===n.pk,r.comment="",r.isGenerated=d===n.name;var i=a.filter(function(e){return e.from===n.name}).map(function(t){var n=g.driver.namingStrategy.foreignKeyName(e.name,[t.from],t.table,[t.to]);return new c.ForeignKeySchema(n,[t.from],[t.to],t.table,t.on_delete)});return t.addForeignKeys(i),r}),[4,Promise.all(i.filter(function(e){return"pk"===e.origin}).map(function(e){return __awaiter(g,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.query('PRAGMA index_info("'+e.name+'")')];case 1:return n=i.sent(),r=n.map(function(e){return e.name}),r.forEach(function(n){t.primaryKeys.push(new l.PrimaryKeySchema(e.name,n))}),[2]}})})}))];case 2:return v.sent(),y=i.filter(function(e){return"pk"!==e.origin&&!t.foreignKeys.find(function(t){return t.name===e.name})&&!t.primaryKeys.find(function(t){return t.name===e.name})}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){return __awaiter(g,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:return r=i.find(function(e){return e.name===n}),[4,this.query('PRAGMA index_info("'+r.name+'")')];case 1:return o=s.sent(),a=o.map(function(e){return e.name}),"sqlite_autoindex"===r.name.substr(0,"sqlite_autoindex".length)?(1===r.unique&&a.forEach(function(e){var n=t.columns.find(function(t){return t.name===e});n&&(n.isUnique=!0)}),[2,Promise.resolve(void 0)]):[2,new u.IndexSchema(e.name,r.name,a,"1"===r.unique)]}})})}),[4,Promise.all(y)];case 3:return h=v.sent(),t.indices=h.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info("'+e+'")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof s.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return a=void 0,n instanceof o.ColumnSchema?a=n:(a=i.clone(),a.name=n),[2,this.changeColumn(r,i,a)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return n=void 0,e instanceof s.TableSchema?(n=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:n=i.sent(),i.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(r=void 0,!(r=t instanceof o.ColumnSchema?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=o.sent(),r=n.clone(),i=t.map(function(e){if("string"==typeof e){var t=n.columns.find(function(t){return t.name===e});if(!t)throw new Error('Cannot drop a column - column "'+e+'" was not found in the "'+n.name+'" table.');return t}return e}),r.removeColumns(i),[2,this.recreateTable(r)]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new d.QueryRunnerAlreadyReleasedError;return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return"character varying("+(e.length?e.length:255)+")";case"text":return"text"
;case"boolean":return"boolean";case"integer":case"int":return"integer";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"real";case"double":case"number":return"double precision";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return e.timezone?"time with time zone":"time without time zone";case"datetime":return e.timezone?"timestamp with time zone":"timestamp without time zone";case"json":return"json";case"simple_array":return e.length?"character varying("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"SQLite")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("DELETE FROM "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=$"+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof a.ColumnMetadata?t+=" "+this.normalizeType(e):t+=" "+e.type,!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&(t+=" PRIMARY KEY AUTOINCREMENT"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?t+=" DEFAULT "+e.default:"boolean"==typeof e.default?t+=" DEFAULT "+(!0===e.default?"1":"0"):"function"==typeof e.default?t+=" DEFAULT "+e.default():"string"==typeof e.default?t+=" DEFAULT '"+e.default+"'":t+=" DEFAULT "+e.default),t},e.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,p=this;return __generator(this,function(m){switch(m.label){case 0:return r=e.columns.map(function(e){return p.buildCreateColumnSql(e)}).join(", "),i=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),o='CREATE TABLE "temporary_'+e.name+'" ('+r,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");o+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(o+=" ON DELETE "+e.onDelete)}),a=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),a.length>0&&(o+=", PRIMARY KEY("+a.map(function(e){return""+e.name}).join(", ")+")"),o+=")",[4,this.query(o)];case 1:return m.sent(),(s=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):i,n)?(u='INSERT INTO "temporary_'+e.name+'"('+s+") SELECT "+s+' FROM "'+e.name+'"',[4,this.query(u)]):[3,3];case 2:m.sent(),m.label=3;case 3:return c='DROP TABLE "'+e.name+'"',[4,this.query(c)];case 4:return m.sent(),l='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(l)];case 5:return m.sent(),d=e.indices.map(function(t){return p.createIndex(e.name,t)}),[4,Promise.all(d)];case 6:return m.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof s.TableSchema?[2,e]:[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(t=n.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("SqliteQueryRunner",p)}}}),System.register("typeorm/driver/sqlite/SqliteDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/metadata/types/ColumnTypes","typeorm/driver/sqlite/SqliteQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e,t,n){if(this.options=e,this.logger=t,this.sqlite=n,!this.options.storage)throw new a.DriverOptionNotSetError("storage");n||this.loadDependencies()}return e.prototype.connect=function(){var e=this;return new Promise(function(t,n){var r=new e.sqlite.Database(e.options.storage,function(i){if(i)return n(i);e.databaseConnection={id:1,connection:r,isTransactionActive:!1},r.run("PRAGMA foreign_keys = ON;",function(e,n){t()})})})},e.prototype.disconnect=function(){var e=this;return new Promise(function(t,r){var i=function(e){return e?r(e):t()};if(!e.databaseConnection)return r(new n.ConnectionIsNotSetError("sqlite"));e.databaseConnection.connection.close(i)})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("sqlite"))];case 1:return e=t.sent(),[2,new o.SqliteQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{driver:this.sqlite,connection:this.databaseConnection?this.databaseConnection.connection:void 0}},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case i.ColumnTypes.BOOLEAN:return!0===e?1:0;case i.ColumnTypes.DATE:return s.DataTransformationUtils.mixedDateToDateString(e);case i.ColumnTypes.TIME:return s.DataTransformationUtils.mixedDateToTimeString(e);case i.ColumnTypes.DATETIME:return t.localTimezone?s.DataTransformationUtils.mixedDateToDatetimeString(e):s.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case i.ColumnTypes.JSON:return JSON.stringify(e);case i.ColumnTypes.SIMPLE_ARRAY:return s.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case i.ColumnTypes.BOOLEAN:return!!e;case i.ColumnTypes.DATETIME:return s.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case i.ColumnTypes.DATE:return s.DataTransformationUtils.mixedDateToDateString(e);case i.ColumnTypes.TIME:return s.DataTransformationUtils.mixedTimeToString(e);case i.ColumnTypes.JSON:return JSON.parse(e);case i.ColumnTypes.SIMPLE_ARRAY:return s.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):(n.push(r),"$"+n.length)}),[e,n]},e.prototype.escapeColumnName=function(e){return'"'+e+'"'},e.prototype.escapeAliasName=function(e){return'"'+e+'"'},e.prototype.escapeTableName=function(e){return'"'+e+'"'},e.prototype.retrieveDatabaseConnection=function(){if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("sqlite")},e.prototype.loadDependencies=function(){try{this.sqlite=u.PlatformTools.load("sqlite3").verbose()}catch(e){throw new r.DriverPackageNotInstalledError("SQLite","sqlite3")}},e}(),e("SqliteDriver",c)}}}),System.register("typeorm/connection/error/CannotDetermineConnectionOptionsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="CannotDetermineConnectionOptionsError",t.message='Cannot create connection, because connection options are missing. You either need to explicitly pass connection options, either create a ormconfig.json with connection options and "default" connection name, either to set proper environment variables. Also, if you are using environment-specific configurations in your ormconfig.json make sure your are running under correct NODE_ENV.',t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("CannotDetermineConnectionOptionsError",n)}}}),System.register("typeorm/driver/websql/WebsqlQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/driver/error/DataTypeNotSupportedByDriverError","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/TableSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e,t,n){this.databaseConnection=e,this.driver=t,this.logger=n,this.isReleased=!1}return e.prototype.release=function(){return this.databaseConnection.releaseCallback?(this.isReleased=!0,this.databaseConnection.releaseCallback()):Promise.resolve()},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.beginTransaction()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,6,8,10]),e="select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 3:return t=i.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 4:return i.sent(),[4,this.commitTransaction()];case 5:return i.sent(),[3,10];case 6:return n=i.sent(),[4,this.rollbackTransaction()];case 7:throw i.sent(),n;case 8:return[4,this.release()];case 9:return i.sent(),[7];case 10:return[2]}})})},e.prototype.beginTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;if(this.databaseConnection.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.databaseConnection.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return this.databaseConnection.isTransactionActive=!1,[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;if(!this.databaseConnection.isTransactionActive)throw new r.TransactionNotStartedError;return this.databaseConnection.isTransactionActive=!1,[2]})})},e.prototype.isTransactionActive=function(){return this.databaseConnection.isTransactionActive},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){n.logger.logQuery(e,t),n.databaseConnection.connection.transaction(function(o){o.executeSql(e,t,function(e,t){var n=Object.keys(t.rows).filter(function(e){return"length"!==e}).map(function(e){return t.rows[e]});r(n)},function(r,o){return n.logger.logFailedQuery(e,t),n.logger.logQueryError(o),i(o)})})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,c=this;return __generator(this,function(l){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return r=Object.keys(t),i=r.map(function(e){return c.driver.escapeColumnName(e)}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?"INSERT INTO "+this.driver.escapeTableName(e)+"("+i+") VALUES ("+o+")":"INSERT INTO "+this.driver.escapeTableName(e)+" DEFAULT VALUES",s=r.map(function(e){return t[e]}),[2,new Promise(function(e,t){c.logger.logQuery(a,s),c.databaseConnection.connection.transaction(function(r){r.executeSql(a,s,function(t,r){if(n)return e(r.insertId);e()},function(e,n){return c.logger.logFailedQuery(a,s),c.logger.logQueryError(n),t(n)})})})]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,c;return __generator(this,function(l){switch(l.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o="UPDATE "+this.driver.escapeTableName(e)+" SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),c=a.concat(s),[4,this.query(o,c)];case 1:return l.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM "+this.driver.escapeTableName(e)+" WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return i="",i=r?"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant, level) SELECT ancestor, "+t+", level + 1 FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.driver.escapeTableName(e)+"(ancestor, descendant) SELECT ancestor, "+t+" FROM "+this.driver.escapeTableName(e)+" WHERE descendant = "+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return n=i.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new s.TableSchema(e.name),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = "+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r.length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info("'+e+'")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,a;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof s.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(i=void 0,!(i=t instanceof o.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return a=void 0,n instanceof o.ColumnSchema?a=n:(a=i.clone(),a.name=n),[2,this.changeColumn(r,i,a)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return n=void 0,e instanceof s.TableSchema?(n=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:n=i.sent(),i.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(r=void 0,!(r=t instanceof o.ColumnSchema?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=o.sent(),r=n.clone(),i=t.map(function(e){if("string"==typeof e){var t=n.columns.find(function(t){return t.name===e});if(!t)throw new Error('Cannot drop a column - column "'+e+'" was not found in the "'+n.name+'" table.');return t}return e}),r.removeColumns(i),[2,this.recreateTable(r)]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return[4,this.getTableSchema(e)];case 1:return n=i.sent(),r=n.clone(),r.removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new u.QueryRunnerAlreadyReleasedError;return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.normalizeType=function(e){switch(e.type){case"string":return"character varying("+(e.length?e.length:255)+")";case"text":return"text";case"boolean":return"boolean";case"integer":case"int":return"integer";case"smallint":return"smallint";case"bigint":return"bigint";case"float":return"real";case"double":case"number":return"double precision";case"decimal":return e.precision&&e.scale?"decimal("+e.precision+","+e.scale+")":e.scale?"decimal("+e.scale+")":e.precision?"decimal("+e.precision+")":"decimal";case"date":return"date";case"time":return e.timezone?"time with time zone":"time without time zone";case"datetime":return e.timezone?"timestamp with time zone":"timestamp without time zone";case"json":return"json";case"simple_array":return e.length?"character varying("+e.length+")":"text"}throw new i.DataTypeNotSupportedByDriverError(e.type,"WebSQL")},e.prototype.compareDefaultValues=function(e,t){return"number"==typeof e?e===parseInt(t):"boolean"==typeof e?e===(!!t||"false"===t):"function"==typeof e?e()===t:e===t},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("DELETE FROM "+this.driver.escapeTableName(e))];case 1:return t.sent(),[2]}})})},e.prototype.parametrize=function(e,t){var n=this;return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return n.driver.escapeColumnName(e)+"=$"+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof a.ColumnMetadata?t+=" "+this.normalizeType(e):t+=" "+e.type,!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&(t+=" PRIMARY KEY AUTOINCREMENT"),void 0!==e.default&&null!==e.default&&("number"==typeof e.default?t+=" DEFAULT "+e.default:"boolean"==typeof e.default?t+=" DEFAULT "+(!0===e.default?"TRUE":"FALSE"):"function"==typeof e.default?t+=" DEFAULT "+e.default():"string"==typeof e.default?t+=" DEFAULT '"+e.default+"'":t+=" DEFAULT "+e.default),t},e.prototype.recreateTable=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d=this;return __generator(this,function(p){switch(p.label){case 0:return n=e.columns.map(function(e){return d.buildCreateColumnSql(e)}).join(", "),r=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),i='CREATE TABLE "temporary_'+e.name+'" ('+n,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");i+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(i+=" ON DELETE "+e.onDelete)}),o=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),o.length>0&&(i+=", PRIMARY KEY("+o.map(function(e){return""+e.name}).join(", ")+")"),i+=")",[4,this.query(i)];case 1:return p.sent(),a=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):r,s='INSERT INTO "temporary_'+e.name+'"('+a+") SELECT "+a+' FROM "'+e.name+'"',[4,this.query(s)];case 2:return p.sent(),u='DROP TABLE "'+e.name+'"',[4,this.query(u)];case 3:return p.sent(),c='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(c)];case 4:return p.sent(),l=e.indices.map(function(t){return d.createIndex(e.name,t)}),[4,Promise.all(l)];case 5:return p.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof s.TableSchema?[2,e]:[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(t=n.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("WebsqlQueryRunner",c)}}}),System.register("typeorm/driver/websql/WebsqlDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/DriverUtils","typeorm/metadata/types/ColumnTypes","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DataTransformationUtils","typeorm/driver/websql/WebsqlQueryRunner"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e,t){if(this.options=r.DriverUtils.buildDriverOptions(e),this.logger=t,!this.options.database)throw new o.DriverOptionNotSetError("database")}return e.prototype.connect=function(){var e=this,t=Object.assign({},{database:this.options.database},this.options.extra||{});return new Promise(function(n,r){var i=openDatabase(t.database,t.version,t.description,t.size);e.databaseConnection={id:1,connection:i,isTransactionActive:!1},n()})},e.prototype.disconnect=function(){if(!this.databaseConnection)throw new n.ConnectionIsNotSetError("websql");return new Promise(function(e,t){e()})},e.prototype.createQueryRunner=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.databaseConnection?[4,this.retrieveDatabaseConnection()]:[2,Promise.reject(new n.ConnectionIsNotSetError("websql"))];case 1:return e=t.sent(),[2,new s.WebsqlQueryRunner(e,this,this.logger)]}})})},e.prototype.nativeInterface=function(){return{connection:this.databaseConnection?this.databaseConnection.connection:void 0}},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),"?"}),[e,n]},e.prototype.escapeColumnName=function(e){return e},e.prototype.escapeAliasName=function(e){return e},e.prototype.escapeTableName=function(e){return e},e.prototype.preparePersistentValue=function(e,t){if(null===e||void 0===e)return null;switch(t.type){case i.ColumnTypes.BOOLEAN:return!0===e?1:0;case i.ColumnTypes.DATE:return a.DataTransformationUtils.mixedDateToDateString(e);case i.ColumnTypes.TIME:return a.DataTransformationUtils.mixedDateToTimeString(e);case i.ColumnTypes.DATETIME:return t.localTimezone?a.DataTransformationUtils.mixedDateToDatetimeString(e):a.DataTransformationUtils.mixedDateToUtcDatetimeString(e);case i.ColumnTypes.JSON:return JSON.stringify(e);case i.ColumnTypes.SIMPLE_ARRAY:return a.DataTransformationUtils.simpleArrayToString(e)}return e},e.prototype.prepareHydratedValue=function(e,t){switch(t.type){case i.ColumnTypes.BOOLEAN:return!!e;case i.ColumnTypes.DATETIME:return a.DataTransformationUtils.normalizeHydratedDate(e,!0===t.localTimezone);case i.ColumnTypes.DATE:return a.DataTransformationUtils.mixedDateToDateString(e);case i.ColumnTypes.TIME:return a.DataTransformationUtils.mixedTimeToString(e);case i.ColumnTypes.JSON:return JSON.parse(e);case i.ColumnTypes.SIMPLE_ARRAY:return a.DataTransformationUtils.stringToSimpleArray(e)}return e},e.prototype.retrieveDatabaseConnection=function(){if(this.databaseConnection)return Promise.resolve(this.databaseConnection);throw new n.ConnectionIsNotSetError("websql")},e}(),e("WebsqlDriver",u)}}}),System.register("typeorm/connection/ConnectionManager",["typeorm/connection/Connection","typeorm/connection/error/ConnectionNotFoundError","typeorm/driver/mysql/MysqlDriver","typeorm/connection/error/MissingDriverError","typeorm/driver/postgres/PostgresDriver","typeorm/connection/error/AlreadyHasActiveConnectionError","typeorm/logger/Logger","typeorm/driver/sqlite/SqliteDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/util/OrmUtils","typeorm/connection/error/CannotDetermineConnectionOptionsError","typeorm/platform/PlatformTools","typeorm/driver/websql/WebsqlDriver","typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e},function(e){h=e}],execute:function(){g=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new r.ConnectionNotFoundError(e);return t},e.prototype.create=function(e){var t=new u.Logger(e.logging||{}),n=this.createDriver(e.driver,t),r=this.createConnection(e.name||"default",n,t);if(e.entitySchemas){var i=this.splitStringsAndClasses(e.entitySchemas),o=i[0],a=i[1];r.importEntitySchemas(a).importEntitySchemaFromDirectories(o)}if(e.entities){var s=this.splitStringsAndClasses(e.entities),o=s[0],a=s[1];r.importEntities(a).importEntitiesFromDirectories(o)}if(e.subscribers){var c=this.splitStringsAndClasses(e.subscribers),o=c[0],a=c[1];r.importSubscribers(a).importSubscribersFromDirectories(o)}if(e.namingStrategies){var l=this.splitStringsAndClasses(e.namingStrategies),o=l[0],a=l[1];r.importNamingStrategies(a).importNamingStrategiesFromDirectories(o)}if(e.migrations){var d=this.splitStringsAndClasses(e.migrations),o=d[0],a=d[1];r.importMigrations(a).importMigrationsFromDirectories(o)}return e.usedNamingStrategy&&r.useNamingStrategy(e.usedNamingStrategy),r},e.prototype.createAndConnect=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(e&&e instanceof Object)return[2,this.createAndConnectByConnectionOptions(e)];if("string"==typeof e)return[2,this.createFromConfigAndConnect(e||"default",t)];if(this.hasDefaultConfigurationInConfigurationFile())return[2,this.createFromConfigAndConnect("default")];if(this.hasDefaultConfigurationInEnvironmentVariables())return[2,this.createFromEnvAndConnect()];throw new m.CannotDetermineConnectionOptionsError})})},e.prototype.createAndConnectToAll=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return e&&e instanceof Array?[2,Promise.all(e.map(function(e){return t.createAndConnectByConnectionOptions(e)}))]:"string"==typeof e?[2,this.createFromConfigAndConnectToAll(e)]:this.hasOrmConfigurationFile()?[2,this.createFromConfigAndConnectToAll()]:this.hasDefaultConfigurationInEnvironmentVariables()?[4,this.createFromEnvAndConnect()]:[3,2];case 1:return[2,[n.sent()]];case 2:throw new m.CannotDetermineConnectionOptionsError}})})},e.prototype.hasOrmConfigurationFile=function(){var e=f.PlatformTools.load("app-root-path").path+"/ormconfig.json";if(!f.PlatformTools.fileExist(e))return!1;var t=f.PlatformTools.load(e);return t instanceof Array?t.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")
}).length>0:t instanceof Object&&((!t.environment||t.environment===f.PlatformTools.getEnvVariable("NODE_ENV"))&&Object.keys(t).length>0)},e.prototype.hasDefaultConfigurationInConfigurationFile=function(){var e=f.PlatformTools.load("app-root-path").path+"/ormconfig.json";if(!f.PlatformTools.fileExist(e))return!1;var t=f.PlatformTools.load(e);return t instanceof Array?!!t.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}).find(function(e){return!!e.name||"default"===e.name}):t instanceof Object&&(!(!t.name||"default"!==t.name)&&(!t.environment||t.environment===f.PlatformTools.getEnvVariable("NODE_ENV")))},e.prototype.hasDefaultConfigurationInEnvironmentVariables=function(){return!!f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_TYPE")},e.prototype.createFromEnvAndConnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.createAndConnectByConnectionOptions({driver:{type:f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_TYPE"),url:f.PlatformTools.getEnvVariable("TYPEORM_URL"),host:f.PlatformTools.getEnvVariable("TYPEORM_HOST"),port:f.PlatformTools.getEnvVariable("TYPEORM_PORT"),username:f.PlatformTools.getEnvVariable("TYPEORM_USERNAME"),password:f.PlatformTools.getEnvVariable("TYPEORM_PASSWORD"),database:f.PlatformTools.getEnvVariable("TYPEORM_DATABASE"),sid:f.PlatformTools.getEnvVariable("TYPEORM_SID"),storage:f.PlatformTools.getEnvVariable("TYPEORM_STORAGE"),usePool:void 0!==f.PlatformTools.getEnvVariable("TYPEORM_USE_POOL")?p.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_USE_POOL")):void 0,extra:f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(f.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0},autoSchemaSync:p.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_AUTO_SCHEMA_SYNC")),entities:f.PlatformTools.getEnvVariable("TYPEORM_ENTITIES")?f.PlatformTools.getEnvVariable("TYPEORM_ENTITIES").split(","):[],subscribers:f.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS")?f.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS").split(","):[],entitySchemas:f.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS")?f.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS").split(","):[],namingStrategies:f.PlatformTools.getEnvVariable("TYPEORM_NAMING_STRATEGIES")?f.PlatformTools.getEnvVariable("TYPEORM_NAMING_STRATEGIES").split(","):[],usedNamingStrategy:f.PlatformTools.getEnvVariable("TYPEORM_USED_NAMING_STRATEGY"),logging:{logQueries:p.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_LOGGING_QUERIES")),logFailedQueryError:p.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_LOGGING_FAILED_QUERIES")),logOnlyFailedQueries:p.OrmUtils.toBoolean(f.PlatformTools.getEnvVariable("TYPEORM_LOGGING_ONLY_FAILED_QUERIES"))}})]})})},e.prototype.createFromConfigAndConnectToAll=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){if(t=f.PlatformTools.load(e||f.PlatformTools.load("app-root-path").path+"/ormconfig.json"),t instanceof Array||(t=[t]),!t)throw new Error("Configuration "+(e||"ormconfig.json")+" was not found. Add connection configuration inside ormconfig.json file.");return n=t.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}).map(function(e){return r.createAndConnectByConnectionOptions(e)}),[2,Promise.all(n)]})})},e.prototype.createFromConfigAndConnect=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){if(n=f.PlatformTools.load(t||f.PlatformTools.load("app-root-path").path+"/ormconfig.json"),n instanceof Array||(n=[n]),!n)throw new Error("Configuration "+(t||"ormconfig.json")+" was not found. Add connection configuration inside ormconfig.json file.");if(r=n.filter(function(t){return(t.name||"default")===e}),i=r.filter(function(e){return!e.environment||e.environment===f.PlatformTools.getEnvVariable("NODE_ENV")}),!i.length)throw new Error('Connection "'+e+'" '+(f.PlatformTools.getEnvVariable("NODE_ENV")?"for the environment "+f.PlatformTools.getEnvVariable("NODE_ENV")+" ":"")+"was not found in the json configuration file."+(r.length?" However there are such configurations for other environments: "+r.map(function(e){return e.environment}).join(", ")+".":""));return[2,this.createAndConnectByConnectionOptions(i[0])]})})},e.prototype.createAndConnectByConnectionOptions=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=this.create(e),[4,t.connect()];case 1:return n.sent(),!e.dropSchemaOnConnection||f.PlatformTools.getEnvVariable("SKIP_SCHEMA_CREATION")?[3,3]:[4,t.dropDatabase()];case 2:n.sent(),n.label=3;case 3:return!e.autoSchemaSync||f.PlatformTools.getEnvVariable("SKIP_SCHEMA_CREATION")?[3,5]:[4,t.syncSchema()];case 4:n.sent(),n.label=5;case 5:return!e.autoMigrationsRun||f.PlatformTools.getEnvVariable("SKIP_MIGRATIONS_RUN")?[3,7]:[4,t.runMigrations()];case 6:n.sent(),n.label=7;case 7:return[2,t]}})})},e.prototype.splitStringsAndClasses=function(e){return[e.filter(function(e){return"string"==typeof e}),e.filter(function(e){return"string"!=typeof e})]},e.prototype.createDriver=function(e,t){switch(e.type){case"mysql":return new i.MysqlDriver(e,t,void 0);case"postgres":return new a.PostgresDriver(e,t);case"mariadb":return new i.MysqlDriver(e,t);case"sqlite":return new c.SqliteDriver(e,t);case"oracle":return new l.OracleDriver(e,t);case"mssql":return new d.SqlServerDriver(e,t);case"websql":return new y.WebsqlDriver(e,t);case"mongodb":return new h.MongoDriver(e,t);default:throw new o.MissingDriverError(e.type)}},e.prototype.createConnection=function(e,t,r){var i=this.connections.find(function(t){return t.name===e});if(i){if(i.isConnected)throw new s.AlreadyHasActiveConnectionError(e);this.connections.splice(this.connections.indexOf(i),1)}var o=new n.Connection(e,t,r);return this.connections.push(o),o},e}(),e("ConnectionManager",g)}}}),System.register("typeorm/decorator/error/GeneratedOnlyForPrimaryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="GeneratedOnlyForPrimaryError",r.message="Column for property "+t.constructor.name+"#"+n+" cannot have a generated value because its not a primary column. Try to use @PrimaryColumn decorator.",r}return __extends(t,e),t}(Error),e("GeneratedOnlyForPrimaryError",n)}}}),System.register("typeorm/decorator/columns/Column",["typeorm/decorator/error/GeneratedOnlyForPrimaryError","typeorm/index","typeorm/metadata/types/ColumnTypes"],function(e,t){"use strict";function n(e,t){var n;return"string"==typeof e?n=e:e&&(t=e,n=e.type),function(e,a){if(!n){var s=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,a):void 0;s&&(n=o.ColumnTypes.determineTypeFromFunction(s))}if(t||(t={}),!t.type&&n&&(t=Object.assign({type:n},t)),t.generated)throw new r.GeneratedOnlyForPrimaryError(e,a);var u={target:e.constructor,propertyName:a,mode:"regular",options:t};i.getMetadataArgsStorage().columns.push(u)}}t&&t.id;e("Column",n);var r,i,o;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/CreateDateColumn",["typeorm/metadata/types/ColumnTypes","typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign({type:r.ColumnTypes.DATETIME},e);var o={target:t.constructor,propertyName:n,mode:"createDate",options:e};i.getMetadataArgsStorage().columns.push(o)}}t&&t.id;e("CreateDateColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/DiscriminatorColumn",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={name:e.name,type:e.type},i={target:t,mode:"discriminator",propertyName:e.name,options:n};r.getMetadataArgsStorage().columns.push(i)}}t&&t.id;e("DiscriminatorColumn",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/error/PrimaryColumnCannotBeNullableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="PrimaryColumnCannotBeNullableError",r.message="Primary column "+t.constructor.name+"#"+n+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",r}return __extends(t,e),t}(Error),e("PrimaryColumnCannotBeNullableError",n)}}}),System.register("typeorm/decorator/columns/PrimaryGeneratedColumn",["typeorm/index","typeorm/decorator/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";function n(e){return function(t,n){if(e||(e={}),e=Object.assign({type:"int"},e),e.nullable)throw new i.PrimaryColumnCannotBeNullableError(t,n);e=Object.assign({primary:!0,generated:!0},e);var o={target:t.constructor,propertyName:n,mode:"regular",options:e};r.getMetadataArgsStorage().columns.push(o)}}t&&t.id;e("PrimaryGeneratedColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/error/ColumnTypeUndefinedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="ColumnTypeUndefinedError",r.message="Column type for "+t.constructor.name+"#"+n+" is not defined or cannot be guessed. Try to implicitly provide a column type to @Column decorator.",r}return __extends(t,e),t}(Error),e("ColumnTypeUndefinedError",n)}}}),System.register("typeorm/decorator/columns/PrimaryColumn",["typeorm/metadata/types/ColumnTypes","typeorm/decorator/error/ColumnTypeUndefinedError","typeorm/index","typeorm/decorator/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";function n(e,t){var n;return"string"==typeof e?n=e:t=e,function(e,s){if(!n){var u=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,s):void 0;u&&(n=r.ColumnTypes.determineTypeFromFunction(u))}if(t||(t={}),!t.type&&n&&(t=Object.assign({type:n},t)),!t.type)throw new i.ColumnTypeUndefinedError(e,s);if(t.nullable)throw new a.PrimaryColumnCannotBeNullableError(e,s);t=Object.assign({primary:!0},t);var c={target:e.constructor,propertyName:s,mode:"regular",options:t};o.getMetadataArgsStorage().columns.push(c)}}t&&t.id;e("PrimaryColumn",n);var r,i,o,a;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/UpdateDateColumn",["typeorm/metadata/types/ColumnTypes","typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign({type:r.ColumnTypes.DATETIME},e);var o={target:t.constructor,propertyName:n,mode:"updateDate",options:e};i.getMetadataArgsStorage().columns.push(o)}}t&&t.id;e("UpdateDateColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/VersionColumn",["typeorm/metadata/types/ColumnTypes","typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign({type:r.ColumnTypes.INTEGER},e);var o={target:t.constructor,propertyName:n,mode:"version",options:e};i.getMetadataArgsStorage().columns.push(o)}}t&&t.id;e("VersionColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/ObjectIdColumn",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={}),e=Object.assign(e,{primary:!0,name:e.name?e.name:"_id"});var i={target:t.constructor,propertyName:n,mode:"objectId",options:e};r.getMetadataArgsStorage().columns.push(i)}}t&&t.id;e("ObjectIdColumn",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_INSERT};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("AfterInsert",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterLoad",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_LOAD};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("AfterLoad",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_REMOVE};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("AfterRemove",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_UPDATE};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("AfterUpdate",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_INSERT};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("BeforeInsert",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_REMOVE};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("BeforeRemove",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_UPDATE};r.getMetadataArgsStorage().entityListeners.push(n)}}t&&t.id;e("BeforeUpdate",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/EventSubscriber",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e};r.getMetadataArgsStorage().entitySubscribers.push(t)}}t&&t.id;e("EventSubscriber",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/options/IndexOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/EntityOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationCount",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){return function(i,o){var a={target:i.constructor,propertyName:o,relation:e,alias:t,queryBuilderFactory:n};r.getMetadataArgsStorage().relationCounts.push(a)}}t&&t.id;e("RelationCount",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinColumn",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){(e instanceof Array?e:[e||{}]).forEach(function(e){var i={target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName};r.getMetadataArgsStorage().joinColumns.push(i)})}}t&&t.id;e("JoinColumn",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinTable",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e=e||{};var i={target:t.constructor,propertyName:n,name:e.name,joinColumns:e&&e.joinColumn?[e.joinColumn]:e.joinColumns,inverseJoinColumns:e&&e.inverseJoinColumn?[e.inverseJoinColumn]:e.inverseJoinColumns};r.getMetadataArgsStorage().joinTables.push(i)}}t&&t.id;e("JoinTable",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToMany",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){var i;return"object"==typeof t?n=t:i=t,function(t,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,relationType:"many-to-many",isLazy:a,type:e,inverseSideProperty:i,options:n};r.getMetadataArgsStorage().relations.push(u)}}t&&t.id;e("ManyToMany",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToOne",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){var i;return"object"==typeof t?n=t:i=t,function(t,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:i,options:n};r.getMetadataArgsStorage().relations.push(u)}}t&&t.id;e("ManyToOne",n);var r;return{setters:[function(e){r=e}],execute:function(){}}});System.register("typeorm/decorator/relations/OneToMany",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){return function(i,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",i,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:i.constructor,propertyName:o,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n};r.getMetadataArgsStorage().relations.push(u)}}t&&t.id;e("OneToMany",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToOne",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){var i;return"object"==typeof t?n=t:i=t,function(t,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,isLazy:a,relationType:"one-to-one",type:e,inverseSideProperty:i,options:n};r.getMetadataArgsStorage().relations.push(u)}}t&&t.id;e("OneToOne",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationId",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){return function(i,o){var a={target:i.constructor,propertyName:o,relation:e,alias:t,queryBuilderFactory:n};r.getMetadataArgsStorage().relationIds.push(a)}}t&&t.id;e("RelationId",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/Entity",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n){var i={target:n,name:e,type:"regular",orderBy:t&&t.orderBy?t.orderBy:void 0,engine:t&&t.engine?t.engine:void 0,skipSchemaSync:!(!t||!0!==t.skipSchemaSync)};r.getMetadataArgsStorage().tables.push(i)}}t&&t.id;e("Entity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/AbstractEntity",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e,name:void 0,type:"abstract"};r.getMetadataArgsStorage().tables.push(t)}}t&&t.id;e("AbstractEntity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClassEntityChild",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n){var i={target:n,name:e,type:"class-table-child",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSchemaSync:!(!t||!0!==t.skipSchemaSync)};r.getMetadataArgsStorage().tables.push(i)}}t&&t.id;e("ClassEntityChild",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClosureEntity",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n){var i={target:n,name:e,type:"closure",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSchemaSync:!(!t||!0!==t.skipSchemaSync)};r.getMetadataArgsStorage().tables.push(i)}}t&&t.id;e("ClosureEntity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/EmbeddableEntity",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e,type:"embeddable",orderBy:void 0};r.getMetadataArgsStorage().tables.push(t)}}t&&t.id;e("EmbeddableEntity",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/SingleEntityChild",["typeorm/index"],function(e,t){"use strict";function n(){return function(e){var t={target:e,name:void 0,type:"single-table-child",orderBy:void 0};r.getMetadataArgsStorage().tables.push(t)}}t&&t.id;e("SingleEntityChild",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/TableInheritance",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={target:t,type:e};r.getMetadataArgsStorage().inheritances.push(n)}}t&&t.id;e("TableInheritance",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/Transaction",["typeorm/index"],function(e,t){"use strict";function n(e){return void 0===e&&(e="default"),function(t,n,i){var o=i.value;i.value=function(){for(var i=this,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return r.getConnection(e).manager.transaction(function(e){var s,u=r.getMetadataArgsStorage().filterTransactionEntityManagers(t.constructor).filter(function(e){return e.methodName===n}).map(function(e){return e.index});return u.length?(s=a.slice(),u.forEach(function(t){return s.splice(t,0,e)})):s=[e].concat(a),o.apply(i,s)})}}}t&&t.id;e("Transaction",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionEntityManager",["typeorm/index"],function(e,t){"use strict";function n(){return function(e,t,n){var i={target:e.constructor,methodName:t,index:n};r.getMetadataArgsStorage().transactionEntityManagers.push(i)}}t&&t.id;e("TransactionEntityManager",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeLevelColumn",["typeorm/index","typeorm/metadata/types/ColumnTypes"],function(e,t){"use strict";function n(){return function(e,t){var n={type:i.ColumnTypes.INTEGER},o={target:e.constructor,propertyName:t,mode:"treeLevel",options:n};r.getMetadataArgsStorage().columns.push(o)}}t&&t.id;e("TreeLevelColumn",n);var r,i;return{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeParent",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={});var i=!(!e||!0!==e.lazy);if(!i&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,n);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(i=!0)}var a={isTreeParent:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"many-to-one",type:function(){return t.constructor},options:e};r.getMetadataArgsStorage().relations.push(a)}}t&&t.id;e("TreeParent",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeChildren",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t,n){e||(e={});var i=!(!e||!0!==e.lazy);if(!i&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,n);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(i=!0)}var a={isTreeChildren:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"one-to-many",type:function(){return t.constructor},options:e};r.getMetadataArgsStorage().relations.push(a)}}t&&t.id;e("TreeChildren",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/Index",["typeorm/index"],function(e,t){"use strict";function n(e,t,n){var i="string"==typeof e?e:void 0,o="string"==typeof e?t:e,a="object"!=typeof e||Array.isArray(e)?n:e;return a||(a="object"!=typeof t||Array.isArray(t)?n:t),function(e,t){var n={target:t?e.constructor:e,name:i,columns:t?[t]:o,unique:!(!a||!a.unique)};r.getMetadataArgsStorage().indices.push(n)}}t&&t.id;e("Index",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/NamingStrategy",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n=e||t.name,i={target:t,name:n};r.getMetadataArgsStorage().namingStrategies.push(i)}}t&&t.id;e("NamingStrategy",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/Embedded",["typeorm/index"],function(e,t){"use strict";function n(e,t){return function(n,i){var o=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,i):void 0,a=!!(o===Array||t&&!0===t.array),s={target:n.constructor,propertyName:i,isArray:a,prefix:t&&void 0!==t.prefix?t.prefix:void 0,type:e};r.getMetadataArgsStorage().embeddeds.push(s)}}t&&t.id;e("Embedded",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/DiscriminatorValue",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={target:t,value:e};r.getMetadataArgsStorage().discriminatorValues.push(n)}}t&&t.id;e("DiscriminatorValue",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/EntityRepository",["typeorm/index"],function(e,t){"use strict";function n(e){return function(t){var n={target:t,entity:e};r.getMetadataArgsStorage().entityRepositories.push(n)}}t&&t.id;e("EntityRepository",n);var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/repository/EntityModel",["typeorm/index"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(){return this.constructor.getRepository().save(this)},e.prototype.remove=function(){return this.constructor.getRepository().remove(this)},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||n.getConnection()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(){return this.getRepository().create()},e.merge=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(r=this.getRepository()).merge.apply(r,[e].concat(t));var r},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.updateById=function(e,t,n){return this.getRepository().updateById(e,t,n)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.removeById=function(e,t){return this.getRepository().removeById(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e){return this.getRepository().findOne(e)},e.findOneById=function(e,t){return this.getRepository().findOneById(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()},e}(),e("EntityModel",r)}}}),System.register("typeorm/index",["typeorm/connection/ConnectionManager","typeorm/metadata-args/MetadataArgsStorage","typeorm/container","typeorm/platform/PlatformTools","typeorm/decorator/columns/Column","typeorm/decorator/columns/CreateDateColumn","typeorm/decorator/columns/DiscriminatorColumn","typeorm/decorator/columns/PrimaryGeneratedColumn","typeorm/decorator/columns/PrimaryColumn","typeorm/decorator/columns/UpdateDateColumn","typeorm/decorator/columns/VersionColumn","typeorm/decorator/columns/ObjectIdColumn","typeorm/decorator/listeners/AfterInsert","typeorm/decorator/listeners/AfterLoad","typeorm/decorator/listeners/AfterRemove","typeorm/decorator/listeners/AfterUpdate","typeorm/decorator/listeners/BeforeInsert","typeorm/decorator/listeners/BeforeRemove","typeorm/decorator/listeners/BeforeUpdate","typeorm/decorator/listeners/EventSubscriber","typeorm/decorator/relations/RelationCount","typeorm/decorator/relations/JoinColumn","typeorm/decorator/relations/JoinTable","typeorm/decorator/relations/ManyToMany","typeorm/decorator/relations/ManyToOne","typeorm/decorator/relations/OneToMany","typeorm/decorator/relations/OneToOne","typeorm/decorator/relations/RelationId","typeorm/decorator/entity/Entity","typeorm/decorator/entity/AbstractEntity","typeorm/decorator/entity/ClassEntityChild","typeorm/decorator/entity/ClosureEntity","typeorm/decorator/entity/EmbeddableEntity","typeorm/decorator/entity/SingleEntityChild","typeorm/decorator/entity/TableInheritance","typeorm/decorator/transaction/Transaction","typeorm/decorator/transaction/TransactionEntityManager","typeorm/decorator/tree/TreeLevelColumn","typeorm/decorator/tree/TreeParent","typeorm/decorator/tree/TreeChildren","typeorm/decorator/Index","typeorm/decorator/NamingStrategy","typeorm/decorator/Embedded","typeorm/decorator/DiscriminatorValue","typeorm/decorator/EntityRepository","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/TableSchema","typeorm/driver/mongodb/typings","typeorm/connection/Connection","typeorm/query-builder/QueryBuilder","typeorm/entity-manager/EntityManager","typeorm/entity-manager/MongoEntityManager","typeorm/naming-strategy/DefaultNamingStrategy","typeorm/repository/Repository","typeorm/repository/TreeRepository","typeorm/repository/SpecificRepository","typeorm/repository/MongoRepository","typeorm/repository/EntityModel"],function(e,t){"use strict";function n(){var e=y.PlatformTools.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new m.MetadataArgsStorage),e.typeormMetadataArgsStorage}function r(){return f.getFromContainer(p.ConnectionManager)}function i(e,t){return r().createAndConnect(e,t)}function o(e){return r().createAndConnectToAll(e)}function a(e){return void 0===e&&(e="default"),r().get(e)}function s(e){return void 0===e&&(e="default"),r().get(e).manager}function u(e,t){return void 0===t&&(t="default"),r().get(t).getRepository(e)}function c(e,t){return void 0===t&&(t="default"),r().get(t).getTreeRepository(e)}function l(e,t){return void 0===t&&(t="default"),r().get(t).getMongoRepository(e)}function d(t){var n={}
;for(var r in t)"default"===r||h.hasOwnProperty(r)||(n[r]=t[r]);e(n)}t&&t.id;e("getMetadataArgsStorage",n),e("getConnectionManager",r),e("createConnection",i),e("createConnections",o),e("getConnection",a),e("getEntityManager",s),e("getRepository",u),e("getTreeRepository",c),e("getMongoRepository",l);var p,m,f,y,h={getMetadataArgsStorage:!0,getConnectionManager:!0,createConnection:!0,createConnections:!0,getConnection:!0,getEntityManager:!0,getRepository:!0,getTreeRepository:!0,getMongoRepository:!0,Connection:!0,ConnectionManager:!0,QueryBuilder:!0,EntityManager:!0,MongoEntityManager:!0,DefaultNamingStrategy:!0,Repository:!0,TreeRepository:!0,SpecificRepository:!0,MongoRepository:!0,EntityModel:!0};return{setters:[function(t){p=t,e({ConnectionManager:t.ConnectionManager})},function(e){m=e},function(e){f=e,d(e)},function(e){y=e},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e),d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e),d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(e){d(e)},function(t){e({Connection:t.Connection})},function(t){e({QueryBuilder:t.QueryBuilder})},function(t){e({EntityManager:t.EntityManager})},function(t){e({MongoEntityManager:t.MongoEntityManager})},function(t){e({DefaultNamingStrategy:t.DefaultNamingStrategy})},function(t){e({Repository:t.Repository})},function(t){e({TreeRepository:t.TreeRepository})},function(t){e({SpecificRepository:t.SpecificRepository})},function(t){e({MongoRepository:t.MongoRepository})},function(t){e({EntityModel:t.EntityModel})}],execute:function(){}}}),System.register("typeorm",["typeorm/index"],function(e,t){"use strict";function n(t){var n={};for(var r in t)"default"!==r&&(n[r]=t[r]);e(n)}t&&t.id;return{setters:[function(e){n(e)}],execute:function(){}}}),System.register("typeorm/metadata-args/EntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/CannotGetEntityManagerNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotGetEntityManagerNotConnectedError",n.message='Cannot get entity manager for "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotGetEntityManagerNotConnectedError",n)}}}),System.register("typeorm/connection/error/NoConnectionForRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="NoConnectionForRepositoryError",n.message='Cannot get a Repository for "'+t+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.",n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("NoConnectionForRepositoryError",n)}}}),System.register("typeorm/driver/error/DriverPackageLoadError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="DriverPackageLoadError",t.message="Cannot load driver dependencies. Try to install all required dependencies.",t}return __extends(t,e),t}(Error),e("DriverPackageLoadError",n)}}}),System.register("typeorm/driver/error/DriverPoolingNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="DriverPoolingNotSupportedError",n.message="Connection pooling is not supported by ("+t+") driver.",n}return __extends(t,e),t}(Error),e("DriverPoolingNotSupportedError",n)}}}),System.register("typeorm/metadata-builder/error/MetadataAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name="MetadataAlreadyExistsError",i.message=t+" metadata already exists for the class constructor "+JSON.stringify(n)+(r?" on property "+r:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."),i}return __extends(t,e),t}(Error),e("MetadataAlreadyExistsError",n)}}}),System.register("typeorm/metadata-builder/error/MetadataWithSuchNameAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MetadataWithSuchNameAlreadyExistsError",r.message=t+" metadata with such name "+n+" already exists. Do you apply decorator twice? Or maybe try to change a name?",r}return __extends(t,e),t}(Error),e("MetadataWithSuchNameAlreadyExistsError",n)}}}),System.register("typeorm/metadata-builder/error/MissingJoinColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MissingJoinColumnError",n.inverseRelation?r.message="JoinColumn is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":r.message="JoinColumn is missing on "+t.name+"#"+n.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",r}return __extends(t,e),t}(Error),e("MissingJoinColumnError",n)}}}),System.register("typeorm/metadata-builder/error/MissingJoinTableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MissingJoinTableError",n.inverseRelation?r.message="JoinTable is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":r.message="JoinTable is missing on "+t.name+"#"+n.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",r}return __extends(t,e),t}(Error),e("MissingJoinTableError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinColumnIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinColumnIsNotAllowedError",r.message="Using JoinColumn on "+t.name+"#"+n.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.",r}return __extends(t,e),t}(Error),e("UsingJoinColumnIsNotAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinColumnOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinColumnOnlyOnOneSideAllowedError",r.message="Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.",r}return __extends(t,e),t}(Error),e("UsingJoinColumnOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinTableIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinTableIsNotAllowedError",r.message="Using JoinTable on "+t.name+"#"+n.propertyName+" is wrong. "+t.name+"#"+n.propertyName+" has "+n.relationType+" relation, however you can use JoinTable only on many-to-many relations.",r}return __extends(t,e),t}(Error),e("UsingJoinTableIsNotAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinTableOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinTableOnlyOnOneSideAllowedError",r.message="Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.",r}return __extends(t,e),t}(Error),e("UsingJoinTableOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/persistence/error/CascadesNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name="CascadesNotAllowedError",i.message="Cascades ("+t+") are not allowed for the given relation "+n.name+"#"+r.joinColumns[0].referencedColumn.databaseName,i}return __extends(t,e),t}(Error),e("CascadesNotAllowedError",n)}}}),System.register("typeorm/persistence/error/PersistedEntityNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="PersistedEntityNotFoundError",t.message="Internal error. Persisted entity was not found in the list of prepared operated entities.",t}return __extends(t,e),t}(Error),e("PersistedEntityNotFoundError",n)}}});